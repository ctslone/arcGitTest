var jsPlumbBrowserUI=function(t){"use strict";function e(t,e,n){return"*"===t?!0:t.length>0?-1!==t.indexOf(e):!n}function n(t,e,n){var i;t=t||{},e=e||{};var o=t,r=e;if(n)for(i=0;i<n.length;i++)o[n[i]]=r[n[i]];else for(i in r)o[i]=r[i];return t}function i(t){return"[object Number]"===Object.prototype.toString.call(t)}function o(t){return"string"==typeof t}function r(t){return"boolean"==typeof t}function s(t){return null==t?!1:"[object Object]"===Object.prototype.toString.call(t)}function a(t){return"[object Date]"===Object.prototype.toString.call(t)}function l(t){return"[object Function]"===Object.prototype.toString.call(t)}function u(t){return l(t)&&null!=t.name&&t.name.length>0}function c(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function h(t){if(o(t))return""+t;if(r(t))return!!t;if(a(t))return new Date(t.getTime());if(l(t))return t;if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(h(t[n]));return e}if(s(t)){var i={};for(var u in t)i[u]=h(t[u]);return i}return t}function d(t){var e={};for(var n in t)null!=t[n]&&(e[n]=t[n]);return e}function p(t,e,n,a){var u,c,d={},p={};for(n=n||[],a=a||[],c=0;c<n.length;c++)d[n[c]]=!0;for(c=0;c<a.length;c++)p[a[c]]=!0;var f=h(t);for(c in e)if(null==f[c]||p[c])f[c]=e[c];else if(d[c])u=[],u.push.apply(u,Array.isArray(f[c])?f[c]:[f[c]]),u.push(e[c]),f[c]=u;else if(o(e[c])||r(e[c])||l(e[c])||i(e[c]))f[c]=e[c];else if(Array.isArray(e[c]))u=[],Array.isArray(f[c])&&u.push.apply(u,f[c]),u.push.apply(u,e[c]),f[c]=u;else if(s(e[c])){s(f[c])||(f[c]={});for(var v in e[c])f[c][v]=e[c][v]}return f}function f(t,e){if(null!=t&&null==e)return!1;if((null==t||o(t)||r(t)||i(t))&&t!==e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;if(!v(t,e))return!1}else if(s(t)){if(!s(t))return!1;if(!y(t,e))return!1}return!0}function v(t,e){if(null==t&&null==e)return!0;if(null==t&&null!=e)return!1;if(null!=t&&null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!f(t[n],e[n]))return!1;return!0}function y(t,e){if(null==t&&null==e)return!0;if(null==t&&null!=e)return!1;if(null!=t&&null==e)return!1;for(var n in t){var i=t[n],o=e[n];if(!f(i,o))return!1}return!0}function g(t,e,n){if(null!=t){var i=t,o=i;return e.replace(/([^\.])+/g,function(t,e,i,r){var s=t.match(/([^\[0-9]+){1}(\[)([0-9+])/),a=i+t.length>=r.length,l=function(){return o[s[1]]||function(){return o[s[1]]=[],o[s[1]]}()};if(a)s?l()[s[3]]=n:o[t]=n;else if(s){var u=l();o=u[s[3]]||function(){return u[s[3]]={},u[s[3]]}()}else o=o[t]||function(){return o[t]={},o[t]}();return""}),t}}function m(t,e,n){for(var i=0;i<n.length;i++){var o=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(o===e)return o}return t}function _(t,e,n,i){var r=function(t){var n=t.match(/(\${.*?})/g);if(null!=n)for(var i=0;i<n.length;i++){var o=e[n[i].substring(2,n[i].length-1)]||"";null!=o&&(t=t.replace(n[i],o))}return t},a=function u(t){if(null!=t){if(o(t))return r(t);if(!l(t)||i||null!=n&&0!==(t.name||"").indexOf(n)){if(Array.isArray(t)){for(var a=[],c=0;c<t.length;c++)a.push(u(t[c]));return a}if(s(t)){var h={};for(var d in t)h[d]=u(t[d]);return h}return t}return t(e)}};return a(t)}function x(t,e){if(!t)return null;for(var n=0;n<t.length;n++)e(t[n])}function E(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1}function b(t,e){var n=[];if(t)for(var i=0;i<t.length;i++)e(t[i])&&n.push(i);return n}function k(t,e){var n=E(t,e);return-1===n?null:t[n]}function C(t,e){var n=b(t,e);return n.map(function(e){return t[e]})}function S(t,e){var n=null;return t.forEach(function(t){e(t)&&(n=t)}),n}function P(t){var e=[];return t.forEach(function(t){e.push(t)}),e}function T(t,e){var n=E(t,e);return n>-1&&t.splice(n,1),-1!==n}function w(t){if(null!=Array.fromArray)return Array.from(t);var e=[];return Array.prototype.push.apply(e,t),e}function A(t,e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),-1!==n}function D(t,e,n){-1===E(t,n)&&t.push(e)}function O(t,e,n,i){var o=t[e];return null==o&&(o=[],t[e]=o),o[i?"unshift":"push"](n),o}function M(t,e,n,i){var o=t.get(e);return null==o&&(o=[],t.set(e,o)),o[i?"unshift":"push"](n),o}function I(t,e,n){return-1===t.indexOf(e)?(n?t.unshift(e):t.push(e),!0):!1}function j(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return Ro[255&t]+Ro[t>>8&255]+Ro[t>>16&255]+Ro[t>>24&255]+"-"+Ro[255&e]+Ro[e>>8&255]+"-"+Ro[e>>16&15|64]+Ro[e>>24&255]+"-"+Ro[63&n|128]+Ro[n>>8&255]+"-"+Ro[n>>16&255]+Ro[n>>24&255]+Ro[255&i]+Ro[i>>8&255]+Ro[i>>16&255]+Ro[i>>24&255]}function N(t,e,n){var i={x:t.x-e.x,y:t.y-e.y},o=Math.cos(n/360*Math.PI*2),r=Math.sin(n/360*Math.PI*2);return{x:i.x*o-i.y*r+e.x,y:i.y*o+i.x*r+e.y,cr:o,sr:r}}function L(t,e){var n=N({x:t[0],y:t[1]},{x:0,y:0},e);return[Math.round(n.x),Math.round(n.y)]}function G(t){if(null==t)return null;for(var e=t.replace(/^\s\s*/,""),n=/\s/,i=e.length;n.test(e.charAt(--i)););return e.slice(0,i+1)}function R(t,e){t=null==t.length||"string"==typeof t?[t]:t;for(var n=0;n<t.length;n++)e(t[n])}function F(t,e){for(var n=[],i=0;i<t.length;i++)n.push(e(t[i]));return n}function B(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];if("undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(o){}}function V(t,e,n){return function(){var i=null;try{null!=e&&(i=e.apply(this,arguments))}catch(o){B("jsPlumb function failed : "+o)}if(null!=t&&(null==n||i!==n))try{i=t.apply(this,arguments)}catch(o){B("wrapped function failed : "+o)}return i}}function H(t,e,n){return t.has(e)||t.set(e,n()),t.get(e)}function U(t,e){for(var n=t.__proto__;null!=n;){if(n instanceof e)return!0;n=n.__proto__}return!1}function X(t,e,n,i){if(0===e.length)e.push(t);else{for(var o=i?-1:1,r=0,s=e.length,a=Math.floor((r+s)/2);s>r;){var l=n(t,e[a])*o;0>l?s=a:r=a+1,a=Math.floor((r+s)/2)}e.splice(a,0,t)}}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function W(t,e,n){return e&&z(t.prototype,e),n&&z(t,n),t}function q(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function J(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Z(t,e)}function K(t){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Z(t,e){return(Z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function Q(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?Q(t):e}function et(t){var e=$();return function(){var n,i=K(t);if(e){var o=K(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return tt(this,n)}}function nt(t,e){return{x:t.x+e.x,y:t.y+e.y}}function it(t,e){return{x:t.x-e.x,y:t.y-e.y}}function ot(t,e){return e.x===t.x?e.y>t.y?1/0:-(1/0):e.y===t.y?e.x>t.x?0:-0:(e.y-t.y)/(e.x-t.x)}function rt(t,e){return-1/ot(t,e)}function st(t,e){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}function at(t,e){return e.x>t.x?e.y>t.y?2:1:e.x==t.x?e.y>t.y?2:1:e.y>t.y?3:4}function lt(t,e){var n=ot(t,e),i=Math.atan(n),o=at(t,e);return(4==o||3==o)&&(i+=Math.PI),0>i&&(i+=2*Math.PI),i}function ut(t,e){var n=t.x,i=t.x+t.w,o=t.y,r=t.y+t.h,s=e.x,a=e.x+e.w,l=e.y,u=e.y+e.h;return s>=n&&i>=s&&l>=o&&r>=l||a>=n&&i>=a&&l>=o&&r>=l||s>=n&&i>=s&&u>=o&&r>=u||a>=n&&i>=s&&u>=o&&r>=u||n>=s&&a>=n&&o>=l&&u>=o||i>=s&&a>=i&&o>=l&&u>=o||n>=s&&a>=n&&r>=l&&u>=r||i>=s&&a>=n&&r>=l&&u>=r}function ct(t){var e=t[1].y-t[0].y,n=t[0].x-t[1].x;return{A:e,B:n,C:e*t[0].x+n*t[0].y}}function ht(t,e){var n=ct(t),i=ct(e),o=n.A*i.B-i.A*n.B;if(0==o)return null;var r={x:(i.B*n.C-n.B*i.C)/o,y:(n.A*i.C-i.A*n.C)/o},s=Math.min(t[0].x,t[1].x),a=Math.max(t[0].x,t[1].x),l=Math.min(t[0].y,t[1].y),u=Math.max(t[0].y,t[1].y),c=Math.min(e[0].x,e[1].x),h=Math.max(e[0].x,e[1].x),d=Math.min(e[0].y,e[1].y),p=Math.max(e[0].y,e[1].y);return r.x>=s&&r.x<=a&&r.y>=l&&r.y<=u&&r.x>=c&&r.x<=h&&r.y>=d&&r.y<=p?r:null}function dt(t,e){var n=[],i=[[{x:e.x,y:e.y},{x:e.x+e.w,y:e.y}],[{x:e.x+e.w,y:e.y},{x:e.x+e.w,y:e.y+e.h}],[{x:e.x,y:e.y},{x:e.x,y:e.y+e.h}],[{x:e.x,y:e.y+e.h},{x:e.x+e.w,y:e.y+e.h}]];return x(i,function(e){var i=ht(t,e);null!=i&&n.push(i)}),n}function pt(t,e,n){var i=t.x,o=t.x+t.w,r=t.y,s=t.y+t.h,a=e.x,l=e.x+e.w,u=e.y,c=e.y+e.h,h=function(t,e,i,o){return n?e>=t&&i>=o:e>t&&i>o};return h(i,a,o,l)&&h(r,u,s,c)}function ft(t,e,n){var i=ot(t,e),o=at(t,e),r=n>0?Uo[o]:Xo[o],s=Math.atan(i),a=Math.abs(n*Math.sin(s))*r[1],l=Math.abs(n*Math.cos(s))*r[0];return{x:t.x+l,y:t.y+a}}function vt(t,e,n){var i=ot(t,e),o=Math.atan(-1/i),r=n/2*Math.sin(o),s=n/2*Math.cos(o);return[{x:e.x+s,y:e.y+r},{x:e.x-s,y:e.y-r}]}function yt(t,e,n,i){n=null==n?null==e.thresholdX?e.w/2:e.thresholdX:n,i=null==i?null==e.thresholdY?e.h/2:e.thresholdY:i;var o=Math.floor(t.x/e.w),r=e.w*o,s=r+e.w,a=Math.abs(t.x-r)<=n?r:Math.abs(s-t.x)<=n?s:t.x,l=Math.floor(t.y/e.h),u=e.h*l,c=u+e.h,h=Math.abs(t.y-u)<=i?u:Math.abs(c-t.y)<=i?c:t.y;return{x:a,y:h}}function gt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _t(t,e,n){return e&&mt(t.prototype,e),n&&mt(t,n),t}function xt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Et(){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}function bt(){return{xmin:1/0,xmax:-(1/0),ymin:1/0,ymax:-(1/0)}}function kt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ct(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function St(t,e,n){return e&&Ct(t.prototype,e),n&&Ct(t,n),t}function Pt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Tt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&At(t,e)}function wt(t){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function At(t,e){return(At=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Dt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function Ot(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Mt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?Ot(t):e}function It(t){var e=Dt();return function(){var n,i=wt(t);if(e){var o=wt(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Mt(this,n)}}function jt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=wt(t),null!==t););return t}function Nt(t,e,n){return(Nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=jt(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Lt(t,e){return Ft(t)||Vt(t,e)||Ht(t,e)||Yt()}function Gt(t){return Rt(t)||Bt(t)||Ht(t)||Xt()}function Rt(t){return Array.isArray(t)?Ut(t):void 0}function Ft(t){return Array.isArray(t)?t:void 0}function Bt(t){return"undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"]?Array.from(t):void 0}function Vt(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(l){a=!0,o=l}finally{try{s||null==n["return"]||n["return"]()}finally{if(a)throw o}}return r}}function Ht(t,e){if(t){if("string"==typeof t)return Ut(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ut(t,e):void 0}}function Ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);e>n;n++)i[n]=t[n];return i}function Xt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Yt(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function zt(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return e.map(function(t){return"."+t}).join(",")}function Wt(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return e.join(" ")}function qt(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];return e.map(function(t){return"["+t+"]"}).join(",")}function Jt(t){return null!=t.type&&null!=t.options}function Kt(t){var e=null;return e=o(t)?{type:t,options:{}}:t,e.options.id=e.options.id||j(),e}function Zt(t){return t.type===Cs.type}function $t(t){return null==t?null:t.split(" ")}function Qt(t,e,n){for(var i in e)t[i]=n}function te(t,e){if(t.getDefaultType){var i=t.getTypeDescriptor(),o={},r=t.getDefaultType(),s=n({},r);Qt(o,r,Ms);for(var a=0,l=t._types.length;l>a;a++){var u=t._types[a];if(u!==Ms){var c=t.instance.getType(u,i);if(null!=c){var h=new Set([As,Is,js]);if(c.mergeStrategy===Ds)for(var d in c)h.add(d);s=p(s,c,[Os],P(h)),Qt(o,c,u)}}}e&&(s=_(s,e,"_")),t.applyType(s,o)}}function ee(t,e){var n=t._types[e],i=t.instance.getType(n,t.getTypeDescriptor());null!=i&&i.cssClass&&t.removeClass(i.cssClass)}function ne(t){if(t.paintStyle&&t.hoverPaintStyle){var e={};n(e,t.paintStyle),n(e,t.hoverPaintStyle),t.hoverPaintStyle=e}}function ie(t,e){var i={cssClass:e.cssClass,id:Ns,component:t},o=n(i,e);return new Cs(t.instance,t,o)}function oe(t,e){var i=null;if(o(e))i=ks.get(t.instance,e,t,{});else if(null!=e.type&&null!=e.options){var r=e,s=n({},r.options);i=ks.get(t.instance,r.type,t,s)}else i=e;return i.id=i.id||j(),t.cacheTypeItem(Ls,i,i.id),t.overlays[i.id]=i,i}function re(t){return 0===t.faces.length?Vs:t.faces[0]}function se(t,e){return-1!==t.faces.indexOf(e)}function ae(t,e){return(t.clockwise?Js:Ks)[e]}function le(t,e){return(t.clockwise?Ks:Js)[e]}function ue(t,e){return null==t.lockedAxis?null==t.lockedFace?se(t,e)===!0:t.lockedFace===e:-1!==t.lockedAxis.indexOf(e)}function ce(t,e){if(se(t,e))return e;if(se(t,qs[e]))return qs[e];var n=ae(t,e);if(se(t,n))return n;var i=le(t,e);return se(t,i)?i:e}function he(e,i){if(i=i||{},e===t.AnchorLocations.Perimeter)return Ce(i);var o=sa[e];if(null!=o)return de(e,F(o,function(t){return n({iox:t.ox,ioy:t.oy},t)}),i);if(o=aa[e],null!=o)return fe(e,o.faces,i);throw{message:"jsPlumb: unknown anchor type '"+e+"'"}}function de(t,e,n){return{type:t,locations:e,currentLocation:0,locked:!1,id:j(),isFloating:!1,isContinuous:!1,isDynamic:e.length>1,timestamp:null,cssClass:n.cssClass||""}}function pe(t,e){return new Ws(t,e)}function fe(t,e,n){var i={type:t,locations:[],currentLocation:0,locked:!1,id:j(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||e,lockedFace:null,lockedAxis:null,clockwise:!(n.clockwise===!1),__currentFace:null};return Object.defineProperty(i,la,{get:function(){return this.__currentFace},set:function(t){this.__currentFace=ce(this,t)}}),i}function ve(t){return t.length<7&&t.every(i)||7===t.length&&t.slice(0,5).every(i)&&o(t[6])}function ye(t){if(o(t))return he(t,null);if(Array.isArray(t)){if(ve(t)){var e=t;return de(null,[{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:null==e[4]?0:e[4],offy:null==e[5]?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}],{cssClass:e[6]||""})}var i=F(t,function(t){if(o(t)){var e=sa[t];return null!=e?n({iox:e[0].ox,ioy:e[0].oy,cls:""},e[0]):null}return ve(t)?{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}:void 0}).filter(function(t){return null!=t});return de("Dynamic",i,{})}var r=t;return he(r.type,r.options)}function ge(t){for(var e=.5,n=2*Math.PI/t,i=[],o=0,r=0;t>r;r++){var s=e+e*Math.sin(o),a=e+e*Math.cos(o);i.push({x:s,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),o+=n}return i}function me(t,e){for(var n=e/t.length,i=[],o=function(t,o,r,s,a,l,u){n=e*a;for(var c=(r-t)/n,h=(s-o)/n,d=0;n>d;d++)i.push({x:t+c*d,y:o+h*d,ox:null==l?0:l,oy:null==u?0:u,offx:0,offy:0,iox:0,ioy:0,cls:""})},r=0;r<t.length;r++)o.apply(null,t[r]);return i}function _e(t,e){for(var n=[],i=0;i<t.length;i++)n.push([t[i][0],t[i][1],t[i][2],t[i][3],1/t.length,t[i][4],t[i][5]]);return me(n,e)}function xe(t){return _e([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],t)}function Ee(t){return _e([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],t)}function be(t){return _e([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],t)}function ke(t,e){for(var n=[],i=e/180*Math.PI,o=0;o<t.length;o++){var r=t[o].x-.5,s=t[o].y-.5;n.push({x:.5+(r*Math.cos(i)-s*Math.sin(i)),y:.5+(r*Math.sin(i)+s*Math.cos(i)),ox:t[o].ox,oy:t[o].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}function Ce(e){e=e||{};var i=e.anchorCount||60,o=e.shape;if(!o)throw new Error("no shape supplied to Perimeter Anchor type");if(!ua.has(o))throw new Error("Shape ["+o+"] is unknown by Perimeter Anchor type");var r=ua.get(o)(i);e.rotation&&(r=ke(r,e.rotation));var s=de(t.AnchorLocations.Perimeter,r,e),a=n(s,{shape:o});return a}function Se(t,e,n,i,o,r,s){var a;if(e)t.endpoints[n]=e,e.addConnection(t);else{var l=s||t.endpointSpec||t.endpointsSpec[n]||t.instance.defaults.endpoints[n]||t.instance.defaults.endpoint,u=t.endpointStyles[n]||t.endpointStyle||t.instance.defaults.endpointStyles[n]||t.instance.defaults.endpointStyle;null==u.fill&&null!=t.paintStyle&&(u.fill=t.paintStyle.stroke),null==u.outlineStroke&&null!=t.paintStyle&&(u.outlineStroke=t.paintStyle.outlineStroke),null==u.outlineWidth&&null!=t.paintStyle&&(u.outlineWidth=t.paintStyle.outlineWidth);var c=t.endpointHoverStyles[n]||t.endpointHoverStyle||t.endpointHoverStyle||t.instance.defaults.endpointHoverStyles[n]||t.instance.defaults.endpointHoverStyle;null!=t.hoverPaintStyle&&(null==c&&(c={}),null==c.fill&&(c.fill=t.hoverPaintStyle.stroke));var h=t.uuids?t.uuids[n]:null;i=null!=i?i:null!=t.instance.defaults.anchors?t.instance.defaults.anchors[n]:t.instance.defaults.anchor,a=t.instance._internal_newEndpoint({paintStyle:u,hoverPaintStyle:c,endpoint:l,connections:[t],uuid:h,element:o,scope:t.scope,anchor:i,reattachConnections:t.reattach||t.instance.defaults.reattachConnections,connectionsDetachable:t.detachable||t.instance.defaults.connectionsDetachable}),null==e&&(a.deleteOnEmpty=!0),t.endpoints[n]=a}return a}function Pe(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}function Te(t,e,n,i,o){var r={x:t+n/2,y:e+i/2},s=Math.cos(o/360*Math.PI*2),a=Math.sin(o/360*Math.PI*2),l=function(t,e){return{x:r.x+Math.round((t-r.x)*s-(e-r.y)*a),y:r.y+Math.round((e-r.y)*s-(t-r.x)*a)}},u=l(t,e),c=l(t+n,e),h=l(t+n,e+i),d=l(t,e+i),p=l(t+n/2,e+i/2),f=Math.min(u.x,c.x,h.x,d.x),v=Math.max(u.x,c.x,h.x,d.x),y=Math.min(u.y,c.y,h.y,d.y),g=Math.max(u.y,c.y,h.y,d.y);return{x:f,y:y,w:v-f,h:g-y,c:p,r:o,x2:v,y2:g,cr:s,sr:a}}function we(t,e,n,i){X([t,e],n,ka,i)}function Ae(t,e){var n=E(e,function(e){return e[0]===t});n>-1&&e.splice(n,1)}function De(t,e,n,i,o){for(var r=n?t.w:t.h,s=n?t.h:t.w,a=[],l=r/(e.length+1),u=0;u<e.length;u++){var c=(u+1)*l,h=i*s;o&&(c=r-c);var d=n?c:h,p=t.x+d,f=d/t.w,v=n?h:c,y=t.y+v,g=v/t.h;if(0!==t.r&&null!=t.r){var m=N({x:p,y:y},t.c,t.r);p=m.x,y=m.y}a.push({x:p,y:y,xLoc:f,yLoc:g,c:e[u].c})}return a}function Oe(t,e){return e.theta-t.theta}function Me(t,e){var n=t.theta<0?-Math.PI-t.theta:Math.PI-t.theta,i=e.theta<0?-Math.PI-e.theta:Math.PI-e.theta;return n-i}function Ie(t){return t.isContinuous===!0}function je(t){return t.isContinuous===!0}function Ne(t){return t.locations.length>1}function Le(t){return[t.currentLocation,t.locations[t.currentLocation]]}function Ge(t,e){for(var n=t.scope.split(/\s/),i=e.scope.split(/\s/),o=0;o<n.length;o++)for(var r=0;r<i.length;r++)if(i[r]===n[o])return!0;return!1}function Re(t,e,n){var i=[],r=function(e){return o(e)?e:t.getId(e)};if(e)if("string"==typeof e){if("*"===e)return e;i.push(e)}else if(n)i=e;else if(null!=e.length){var s;(s=i).push.apply(s,Gt(Gt(e).map(r)))}else i.push(r(e));return i}function Fe(t,e){null!=t&&t.endpoints.push(e)}function Be(t,e){null!=t&&T(t.endpoints,function(t){return t===e})}function Ve(t,e,n){null!=e&&(e.connections.push(t),1===e.connections.length&&t.instance.addClass(t.source,t.instance.connectedClass)),null!=n&&(null==e||t.sourceId!==t.targetId)&&(n.connections.push(t),1===n.connections.length&&t.instance.addClass(t.target,t.instance.connectedClass))}function He(t,e,n){if(null!=e){var i=e.connections.length;T(e.connections,function(e){return t.id===e.id}),i>0&&0===e.connections.length&&t.instance.removeClass(t.source,t.instance.connectedClass)}if(null!=n){var o=n.connections.length;(null==e||t.sourceId!==t.targetId)&&T(n.connections,function(e){return t.id===e.id}),o>0&&0===n.connections.length&&t.instance.removeClass(t.target,t.instance.connectedClass)}}function Ue(t){var e=Math.floor(t),n=Math.ceil(t);return ja>t-e?e:ja>n-t?n:t}function Xe(t){return t.type===Ra.type}function Ye(t){return t.type===Fa.type}function ze(t){return t.type===Ba.type}function We(t){return t.type===Va.type}function qe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Je(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ke(t,e,n){return e&&Je(t.prototype,e),n&&Je(t,n),t}function Ze(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tn(t,e)}function Qe(t){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tn(t,e){return(tn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function en(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function nn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function on(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?nn(t):e}function rn(t){var e=en();return function(){var n,i=Qe(t);if(e){var o=Qe(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return on(this,n)}}function sn(t){return 0>t?-1:0===t?0:1}function an(t){return[sn(t[2]-t[0]),sn(t[3]-t[1])]}function ln(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))}function un(t){var e=[];return e.push.apply(e,t),e}function cn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function dn(t,e,n){return e&&hn(t.prototype,e),n&&hn(t,n),t}function pn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yn(t,e)}function vn(t){return(vn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yn(t,e){return(yn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function mn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _n(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?mn(t):e}function xn(t){var e=gn();return function(){var n,i=vn(t);if(e){var o=vn(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return _n(this,n)}}function En(t,e){for(var n,i=[],o=kn(t,e),r=e.length-1,s=2*r-1,a=Cn(o,s,i,0),l=Xa.subtract(t,e[0]),u=Xa.square(l),c=0,h=0;a>h;h++)l=Xa.subtract(t,wn(e,r,i[h],null,null)),n=Xa.square(l),u>n&&(u=n,c=i[h]);return l=Xa.subtract(t,e[r]),n=Xa.square(l),u>n&&(u=n,c=1),{location:c,distance:u}}function bn(t,e){var n=En(t,e);return{point:wn(e,e.length-1,n.location,null,null),location:n.location}}function kn(t,e){for(var n=e.length-1,i=2*n-1,o=[],r=[],s=[],a=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],u=0;n>=u;u++)o[u]=Xa.subtract(e[u],t);for(var c=0;n-1>=c;c++)r[c]=Xa.subtract(e[c+1],e[c]),r[c]=Xa.scale(r[c],3);for(var h=0;n-1>=h;h++)for(var d=0;n>=d;d++)s[h]||(s[h]=[]),s[h][d]=Xa.dotProduct(r[h],o[d]);for(var p=0;i>=p;p++)a[p]||(a[p]=[]),a[p].y=0,a[p].x=parseFloat(""+p)/i;for(var f=n,v=n-1,y=0;f+v>=y;y++)for(var g=Math.max(0,y-v),m=Math.min(y,f),_=g;m>=_;_++){var x=y-_;a[_+x].y+=s[x][_]*l[x][_]}return a}function Cn(t,e,n,i){var o,r,s=[],a=[],l=[],u=[];switch(Sn(t,e)){case 0:return 0;case 1:if(i>=Ya)return n[0]=(t[0].x+t[e].x)/2,1;if(Pn(t,e))return n[0]=Tn(t,e),1}wn(t,e,.5,s,a),o=Cn(s,e,l,i+1),r=Cn(a,e,u,i+1);for(var c=0;o>c;c++)n[c]=l[c];for(var h=0;r>h;h++)n[h+o]=u[h];return o+r}function Sn(t,e){var n,i,o=0;n=i=Wn(t[0].y);for(var r=1;e>=r;r++)n=Wn(t[r].y),n!=i&&o++,i=n;return o}function Pn(t,e){var n,i,o,r,s,a,l,u,c,h,d,p,f,v,y,g;a=t[0].y-t[e].y,l=t[e].x-t[0].x,u=t[0].x*t[e].y-t[e].x*t[0].y;var m,_;m=_=0;for(var x=1;e>x;x++){var E=a*t[x].x+l*t[x].y+u;E>m?m=E:_>E&&(_=E)}return d=0,p=1,f=0,v=a,y=l,g=u-m,c=d*y-v*p,h=1/c,i=(p*g-y*f)*h,v=a,y=l,g=u-_,c=d*y-v*p,h=1/c,o=(p*g-y*f)*h,r=Math.min(i,o),s=Math.max(i,o),n=s-r,za>n?1:0}function Tn(t,e){var n=1,i=0,o=t[e].x-t[0].x,r=t[e].y-t[0].y,s=t[0].x-0,a=t[0].y-0,l=o*i-r*n,u=1/l,c=(o*a-r*s)*u;return 0+n*c}function wn(t,e,n,i,o){for(var r=[[]],s=0;e>=s;s++)r[0][s]=t[s];for(var a=1;e>=a;a++)for(var l=0;e-a>=l;l++)r[a]||(r[a]=[]),r[a][l]||(r[a][l]={}),r[a][l].x=(1-n)*r[a-1][l].x+n*r[a-1][l+1].x,r[a][l].y=(1-n)*r[a-1][l].y+n*r[a-1][l+1].y;if(null!=i)for(var u=0;e>=u;u++)i[u]=r[u][0];if(null!=o)for(var c=0;e>=c;c++)o[c]=r[e-c][c];return r[e][0]}function An(t,e){var n=[];t--;for(var i=0;t>=i;i++)n.push(Dn(i/t,e));return n}function Dn(t,e){var n={x:0,y:0};if(0===t)return e[0];var i=e.length-1;if(1===t)return e[i];var o=e,r=1-t;if(0===i)return e[0];if(1===i)return{x:r*o[0].x+t*o[1].x,y:r*o[0].y+t*o[1].y};if(4>i){var s,a,l,u=r*r,c=t*t,h=0;return 2===i?(o=[o[0],o[1],o[2],n],s=u,a=2*(r*t),l=c):3===i&&(s=u*r,a=3*(u*t),l=3*(r*c),h=t*c),{x:s*o[0].x+a*o[1].x+l*o[2].x+h*o[3].x,y:s*o[0].y+a*o[1].y+l*o[2].y+h*o[3].y}}return n}function On(t){var e=0;if(!Nn(t))for(var n=16,i=An(n,t),o=0;n-1>o;o++){var r=i[o],s=i[o+1];e+=jn(r,s)}return e}function Mn(t){var e=Wa.get(t);if(!e){e=[];var n=function(){return function(e){return Math.pow(e,t)}},i=function(){return function(e){return Math.pow(1-e,t)}},o=function(t){return function(e){return t}},r=function(){return function(t){return t}},s=function(){return function(t){return 1-t}},a=function(t){return function(e){for(var n=1,i=0;i<t.length;i++)n*=t[i](e);return n}};e.push(n());for(var l=1;t>l;l++){for(var u=[o(t)],c=0;t-l>c;c++)u.push(r());for(var h=0;l>h;h++)u.push(s());e.push(a(u))}e.push(i()),Wa.set(t,e)}return e}function In(t,e){for(var n=Mn(t.length-1),i=0,o=0,r=0;r<t.length;r++)i+=t[r].x*n[r](e),o+=t[r].y*n[r](e);return{x:i,y:o}}function jn(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Nn(t){return t[0].x===t[1].x&&t[0].y===t[1].y}function Ln(t,e,n){if(Nn(t))return{point:t[0],location:e};for(var i=In(t,e),o=0,r=e,s=n>0?1:-1,a=null;o<Math.abs(n);)r+=.005*s,a=In(t,r),o+=jn(a,i),i=a;return{point:a,location:r}}function Gn(t,e,n){return Ln(t,e,n).point}function Rn(t,e,n){return Ln(t,e,n).location}function Fn(t,e){var n=In(t,e),i=In(t.slice(0,t.length-1),e),o=i.y-n.y,r=i.x-n.x;return 0===o?1/0:Math.atan(o/r)}function Bn(t,e,n){var i=Ln(t,e,n);return i.location>1&&(i.location=1),i.location<0&&(i.location=0),Fn(t,i.location)}function Vn(t,e,n,i){i=null==i?0:i;var o=Ln(t,e,i),r=Fn(t,o.location),s=Math.atan(-1/r),a=n/2*Math.sin(s),l=n/2*Math.cos(s);return[{x:o.point.x+l,y:o.point.y+a},{x:o.point.x-l,y:o.point.y-a}]}function Hn(t,e,n,i,o){var r=i-e,s=t-n,a=t*(e-i)+e*(n-t),l=zn(o),u=[r*l[0][0]+s*l[1][0],r*l[0][1]+s*l[1][1],r*l[0][2]+s*l[1][2],r*l[0][3]+s*l[1][3]+a],c=qn.apply(null,u),h=[];if(null!=c)for(var d=0;3>d;d++){var p=c[d],f=Math.pow(p,2),v=Math.pow(p,3),y={x:l[0][0]*v+l[0][1]*f+l[0][2]*p+l[0][3],y:l[1][0]*v+l[1][1]*f+l[1][2]*p+l[1][3]},g=void 0;g=n-t!==0?(y[0]-t)/(n-t):(y[1]-e)/(i-e),p>=0&&1>=p&&g>=0&&1>=g&&h.push(y)}return h}function Un(t,e,n,i,o){var r=[];return r.push.apply(r,Hn(t,e,t+n,e,o)),r.push.apply(r,Hn(t+n,e,t+n,e+i,o)),r.push.apply(r,Hn(t+n,e+i,t,e+i,o)),r.push.apply(r,Hn(t,e+i,t,e,o)),r}function Xn(t,e){var n=[];return n.push.apply(n,Hn(t.x,t.y,t.x+t.w,t.y,e)),n.push.apply(n,Hn(t.x+t.w,t.y,t.x+t.w,t.y+t.h,e)),n.push.apply(n,Hn(t.x+t.w,t.y+t.h,t.x,t.y+t.h,e)),n.push.apply(n,Hn(t.x,t.y+t.h,t.x,t.y,e)),n}function Yn(t,e){return[-t[0][e]+3*t[1][e]+-3*t[2][e]+t[3][e],3*t[0][e]-6*t[1][e]+3*t[2][e],-3*t[0][e]+3*t[1][e],t[0][e]]}function zn(t){return[Yn(t,"x"),Yn(t,"y")]}function Wn(t){return 0>t?-1:t>0?1:0}function qn(t,e,n,i){var o,r,s=e/t,a=n/t,l=i/t,u=(3*a-Math.pow(s,2))/9,c=(9*s*a-27*l-2*Math.pow(s,3))/54,h=Math.pow(u,3)+Math.pow(c,2),d=[0,0,0];if(h>=0)o=Wn(c+Math.sqrt(h))*Math.pow(Math.abs(c+Math.sqrt(h)),1/3),r=Wn(c-Math.sqrt(h))*Math.pow(Math.abs(c-Math.sqrt(h)),1/3),d[0]=-s/3+(o+r),d[1]=-s/3-(o+r)/2,d[2]=-s/3-(o+r)/2,0!==Math.abs(Math.sqrt(3)*(o-r)/2)&&(d[1]=-1,d[2]=-1);else{var p=Math.acos(c/Math.sqrt(-Math.pow(u,3)));d[0]=2*Math.sqrt(-u)*Math.cos(p/3)-s/3,d[1]=2*Math.sqrt(-u)*Math.cos((p+2*Math.PI)/3)-s/3,d[2]=2*Math.sqrt(-u)*Math.cos((p+4*Math.PI)/3)-s/3}for(var f=0;3>f;f++)(d[f]<0||d[f]>1)&&(d[f]=-1);return d}function Jn(t,e,n,i){return n>=t&&e>=i?1:n>=t&&i>=e?2:t>=n&&i>=e?3:4}function Kn(t,e,n,i,o,r,s,a,l){return l>=a?{x:t,y:e}:1===n?i.curY<=0&&o.curY>=1?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX>=1&&o.curX<=0?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+-1*r,y:e+-1*s}:2===n?i.curY>=1&&o.curY<=0?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX>=1&&o.curX<=0?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+r,y:e+-1*s}:3===n?i.curY>=1&&o.curY<=0?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX<=0&&o.curX>=1?{x:t,y:e+(i.y<.5?-1*s:s)}:{x:t+-1*r,y:e+-1*s}:4===n?i.curY<=0&&o.curY>=1?{x:t+(i.x<.5?-1*r:r),y:e}:i.curX<=0&&o.curX>=1?{x:t,y:e+(i.y<.5?-1*s:s)
}:{x:t+r,y:e+-1*s}:void 0}function Zn(t){"@babel/helpers - typeof";return(Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ti(t,e,n){return e&&Qn(t.prototype,e),n&&Qn(t,n),t}function ei(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ni(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oi(t,e)}function ii(t){return(ii=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function oi(t,e){return(oi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ri(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function si(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ai(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?si(t):e}function li(t){var e=ri();return function(){var n,i=ii(t);if(e){var o=ii(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return ai(this,n)}}function ui(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&(t=ii(t),null!==t););return t}function ci(t,e,n){return(ci="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=ui(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function hi(t,e){return di(t)||pi(t,e)||fi(t,e)||yi()}function di(t){return Array.isArray(t)?t:void 0}function pi(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(l){a=!0,o=l}finally{try{s||null==n["return"]||n["return"]()}finally{if(a)throw o}}return r}}function fi(t,e){if(t){if("string"==typeof t)return vi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vi(t,e):void 0}}function vi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);e>n;n++)i[n]=t[n];return i}function yi(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function gi(t,e,n){n=n||t.parentNode;for(var i=n.querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function mi(t,e){t.stopPropagation?t.stopPropagation():t.returnValue=!1,!e&&t.preventDefault&&t.preventDefault()}function _i(t,e,n,i){if(i&&gi(t,e,n))return t;for(t=t.parentNode;null!=t&&t!==n;){if(gi(t,e))return t;t=t.parentNode}}function xi(t){return t.srcElement||t.target}function Ei(t,e,n){e=G(e),"undefined"!=typeof t.className.baseVal?t.className.baseVal=e:t.className=e;try{var i=t.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var o=0;o<n.length;o++)n[o]&&i.add(n[o])}}catch(r){B("JSPLUMB: cannot set class list",r)}}function bi(t){return null!=t.className?"undefined"==typeof t.className.baseVal?t.className:t.className.baseVal:""}function ki(t,e,n){var i=null==e?[]:Array.isArray(e)?e:e.split(/\s+/),o=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),r=bi(t),s=r.split(/\s+/),a=function(t,e){for(var n=0;n<e.length;n++)if(t)-1===s.indexOf(e[n])&&s.push(e[n]);else{var i=s.indexOf(e[n]);-1!==i&&s.splice(i,1)}};a(!0,i),a(!1,o),Ei(t,s.join(" "),s)}function Ci(t){return!o(t)&&!Array.isArray(t)&&null!=t.length&&null==t.documentElement&&null==t.nodeType}function Si(t){return!o(t)&&(Array.isArray(t)||Ci(t))}function Pi(t){return bi(t)}function Ti(t,e){var n=function(t,e){if(null!=t&&null!=e&&e.length>0)if(t.classList){var n=G(e).split(/\s+/);x(n,function(e){t.classList.add(e)})}else ki(t,e)};Ci(t)?x(t,function(t){return n(t,e)}):n(t,e)}function wi(t,e){return t.classList?t.classList.contains(e):-1!==bi(t).indexOf(e)}function Ai(t,e){var n=function(t,e){if(null!=t&&null!=e&&e.length>0)if(t.classList){var n=G(e).split(/\s+/);n.forEach(function(e){t.classList.remove(e)})}else ki(t,null,e)};Ci(t)?x(t,function(t){return n(t,e)}):n(t,e)}function Di(t,e){var n=this,i=function(t,e){null!=t&&null!=e&&e.length>0&&(t.classList?t.classList.toggle(e):n.hasClass(t,e)?n.removeClass(t,e):n.addClass(t,e))};Ci(t)?x(t,function(t){return i(t,e)}):i(t,e)}function Oi(t,e,n,i){return Mi(null,t,e,n,i)}function Mi(t,e,n,i,o){var r,s=null==t?document.createElement(e):document.createElementNS(t,e);n=n||{};for(r in n)s.style[r]=n[r];i&&(s.className=i),o=o||{};for(r in o)s.setAttribute(r,""+o[r]);return s}function Ii(t){var e=t.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,r=window.pageXOffset||i.scrollLeft||n.scrollLeft,s=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=e.top+o-s,u=e.left+r-a;return{x:Math.round(u),y:Math.round(l)}}function ji(t){return{w:t.offsetWidth,h:t.offsetHeight}}function Ni(t,e){for(var n in e)t.setAttribute(n,""+e[n])}function Li(t,e){return e=e||{},e.version="1.1",e.xmlns=sl.svg,Mi(sl.svg,t,null,null,e)}function Gi(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"}function Ri(t,e,n){if(e.setAttribute(tl,n.fill?n.fill:gr),e.setAttribute(el,n.stroke?n.stroke:gr),n.strokeWidth&&e.setAttribute(nl,n.strokeWidth),n[Qa]&&n[il]&&!n[$a]){var i=-1===n[Qa].indexOf(",")?" ":",",o=n[Qa].split(i),r="";x(o,function(t){r+=Math.floor(t*n.strokeWidth)+i}),e.setAttribute($a,r)}else n[$a]&&e.setAttribute($a,n[$a]);for(var s in Za)n[s]&&e.setAttribute(Za[s],n[s])}function Fi(t,e,n){t.childNodes.length>n?t.insertBefore(e,t.childNodes[n]):t.appendChild(e)}function Bi(t,e,n,i,o){t.style.width=i+"px",t.style.height=o+"px",t.style.left=e+"px",t.style.top=n+"px",t.height=o,t.width=i}function Vi(t,e,n){var i=[t,e];return n&&i.push(n),i.join(":")}function Hi(t,e,n,i,o,r,s){return new Touch({target:t,identifier:j(),pageX:e,pageY:n,screenX:i,screenY:o,clientX:r||i,clientY:s||o})}function Ui(){var t=[];return t.push.apply(t,arguments),t.item=function(t){return this[t]},t}function Xi(t,e,n,i,o,r,s){return Ui(Hi(t,e,n,i,o,r,s))}function Yi(t,e,n){n=n||t.parentNode;for(var i=n.querySelectorAll(e),o=0;o<i.length;o++)if(i[o]===t)return!0;return!1}function zi(t){return t.srcElement||t.target}function Wi(t,e,n,i){if(i){if("undefined"!=typeof t.path&&t.path.indexOf)return{path:t.path,end:t.path.indexOf(n)};var o={path:[],end:-1},r=function s(t){o.path.push(t),t===n?o.end=o.path.length-1:null!=t.parentNode&&s(t.parentNode)};return r(e),o}return{path:[e],end:1}}function qi(t,e){var n,i=0;for(i=0,n=t.length;n>i&&t[i][0]!==e;i++);i<t.length&&t.splice(i,1)}function Ji(t,e){if(null==t)return{x:0,y:0};var n=to(t),i=Qi(n,0);return{x:i[e+"X"],y:i[e+"Y"]}}function Ki(t){return Ji(t,gu)}function Zi(t){return Ji(t,mu)}function $i(t){return Ji(t,_u)}function Qi(t,e){return t.item?t.item(e):t[e]}function to(t){return t.touches&&t.touches.length>0?t.touches:t.changedTouches&&t.changedTouches.length>0?t.changedTouches:t.targetTouches&&t.targetTouches.length>0?t.targetTouches:[t]}function eo(t){return to(t).length}function no(t,e,n,i,o){if(ro(t,e,n),i.__tauid=n.__tauid,t.addEventListener)t.addEventListener(e,n,!1,o);else if(t.attachEvent){var r=e+n.__tauid;t["e"+r]=n,t[r]=function(){t["e"+r]&&t["e"+r](window.event)},t.attachEvent("on"+e,t[r])}}function io(t,e,n){var i=this;null!=n&&oo(t,function(o){if(so(o,e,n),null!=n.__tauid)if(o.removeEventListener)o.removeEventListener(e,n,!1),fu&&yu[e]&&o.removeEventListener(yu[e],n,!1);else if(i.detachEvent){var r=e+n.__tauid;o[r]&&o.detachEvent("on"+e,o[r]),o[r]=null,o["e"+r]=null}n.__taTouchProxy&&io(t,n.__taTouchProxy[1],n.__taTouchProxy[0])})}function oo(t,e){if(null!=t)for(var n="string"==typeof t?document.querySelectorAll(t):null!=t.length?t:[t],i=0;i<n.length;i++)e(n[i])}function ro(t,e,n){var i=pu++;return t.__ta=t.__ta||{},t.__ta[e]=t.__ta[e]||{},t.__ta[e][i]=n,n.__tauid=i,i}function so(t,e,n){if(t.__ta&&t.__ta[e]&&delete t.__ta[e][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)io(t,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}function ao(t,e,n,i){if(null==t)return n;var o=t.split(","),r=function s(i){s.__tauid=n.__tauid;var r=zi(i),a=!1,l=r,u=Wi(i,r,e,null!=t);if(-1!=u.end)for(var c=0;!a&&c<u.end;c++){l=u.path[c];for(var h=0;!a&&h<o.length;h++)if(Yi(l,o[h],e)){n.apply(l,[i,l]),a=!0;break}}};return lo(n,i,r),r}function lo(t,e,n){t.__taExtra=t.__taExtra||[],t.__taExtra.push([e,n])}function uo(t,e,n,i){for(var o in n.__tamee[t])n.__tamee[t].hasOwnProperty(o)&&n.__tamee[t][o].apply(i,[e])}function co(t,e,n){if(gi(e,n,t))return e;for(var i=e.parentNode;null!=i&&i!==t;){if(gi(i,n,t))return i;i=i.parentNode}}function ho(t){return{x:t.offsetLeft,y:t.offsetTop}}function po(t){return{w:t.offsetWidth,h:t.offsetHeight}}function fo(t,e){t.style.left=e.x+"px",t.style.top=e.y+"px"}function vo(t){return"function"==typeof t?(t._katavorioId=j(),t._katavorioId):t}function yo(t,e,n){var i=e.parentNode,o=t.getSize(i),r=t.getSize(e),s=n.x,a=s+r.w,l=n.y,u=l+r.h;return a>0&&s<o.w&&u>0&&l<o.h}function go(t,e,n){for(var i=null,o=e.getAttribute("katavorio-draggable"),r=null!=o?"[katavorio-draggable='"+o+"'] ":"",s=0;s<t.length;s++)if(i=co(e,n,r+t[s].selector),null!=i){if(t[s].filter){var a=gi(n,t[s].filter,i),l=t[s].filterExclude===!0;if(l&&!a||a)return null}return[t[s],i]}return null}function mo(t){return{w:t.parentNode.offsetWidth+t.parentNode.scrollLeft,h:t.parentNode.offsetHeight+t.parentNode.scrollTop}}function _o(t,e){return o(e)?{id:e,active:!0}:{id:t.getId(e),active:e.active}}function xo(t,e){var n=S(t.members,function(t){return t.el===e});return null!==n?n.active===!0:!1}function Eo(t){for(var e=[],n=t._jsPlumbParentGroup;null!=n;)e.push(n.el),n=n.group;return e}function bo(t,e,n,i,o,r){var s=pe(o,i),a={paintStyle:t,preparedAnchor:s,element:i,scope:r};null!=e&&(U(e,nr)?a.existingEndpoint=e:a.endpoint=e);var l=o._internal_newEndpoint(a);return o.paintEndpoint(l,{}),l}function ko(t,e,n,i,o){for(var r=t.target||t.srcElement,s=!1,a=i.getSelector(e,n),l=0;l<a.length;l++)if(a[l]===r){s=!0;break}return o?!s:s}function Co(t,e,i,o){So(t,e),hc.paint(e,!1,i,o);var r="",s=[0,0];if(o.xmin<0&&(s[0]=-o.xmin),o.ymin<0&&(s[1]=-o.ymin),e.segments.length>0){r=t.getPathData(e);var a={d:r,transform:"translate("+s[0]+","+s[1]+")","pointer-events":"visibleStroke"},l=null;if(i.outlineStroke){var u=i.outlineWidth||1,c=i.strokeWidth+2*u;l=n({},i),l.stroke=i.outlineStroke,l.strokeWidth=c,null==e.bgPath?(e.bgPath=Li(rl,a),t.addClass(e.bgPath,t.connectorOutlineClass),Fi(e.canvas,e.bgPath,0)):Ni(e.bgPath,a),Ri(e.canvas,e.bgPath,l)}var h=e;null==h.path?(h.path=Li(rl,a),Fi(h.canvas,h.path,i.outlineStroke?1:0)):(h.path.parentNode!==h.canvas&&Fi(h.canvas,h.path,i.outlineStroke?1:0),Ni(e.path,a)),Ri(e.canvas,e.path,i)}}function So(t,e){if(null!=e.canvas)return e.canvas;var n=Li(ol,{style:"",width:"0",height:"0","pointer-events":gr,position:xr});return e.canvas=n,t._appendElement(e.canvas,t.getContainer()),null!=e.cssClass&&t.addClass(n,e.cssClass),t.addClass(n,t.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=e,n}function Po(t,e){pc[t]=e}function To(t,e,n){var i=e,o=Zn(e.getBoundingClientRect)!==Wo?e.getBoundingClientRect():{left:0,top:0,width:0,height:0},r=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||r.scrollTop,l=window.pageXOffset||s.scrollLeft||r.scrollLeft,u=s.clientTop||r.clientTop||0,c=s.clientLeft||r.clientLeft||0,h=0,d=0,p=o.top+a-u+h*n,f=o.left+l-c+d*n,v=Ki(t),y=o.width||i.offsetWidth*n,g=o.height||i.offsetHeight*n,m=(v.x-f)/y,_=(v.y-p)/g;return{x:m,y:_}}function wo(t){return Xe(t)||ze(t)||Ye(t)}function Ao(t,e){t.canvas&&(t.canvas.style.display=e?"block":"none")}function Do(t){t.canvas&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas,delete t.svg}function Oo(t){return t.canvas}function Mo(t){return uc.getElement(t)}function Io(t){return uc.getElement(t,t.component,function(e){var n=t.create(e);return t.instance.addClass(n,t.instance.overlayClass),n})}function jo(t,e,n,i){var o=t.x,r=t.y;return e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain&&(o=Math.max(t.x,0),r=Math.max(t.y,0),o=Math.min(o,n.w-i.w),r=Math.min(r,n.h-i.h)),{x:o,y:r}}function No(){var t=Ec+1;return Ec++,t}function Lo(t){return new fc(No(),t)}function Go(t){var e=function n(){/complete|loaded|interactive/.test(document.readyState)&&"undefined"!=typeof document.body&&null!=document.body?t():setTimeout(n,9)};e()}for(var Ro=[],Fo=0;256>Fo;Fo++)Ro[Fo]=(16>Fo?"0":"")+Fo.toString(16);var Bo=!0,Vo=function(){function t(){Y(this,t),q(this,"_listeners",{}),q(this,"eventsSuspended",!1),q(this,"tick",!1),q(this,"eventsToDieOn",{ready:!0}),q(this,"queue",[])}return W(t,[{key:"fire",value:function(t,e,n){var i=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[t]){var o=this._listeners[t].length,r=0,s=!1;if(!this.shouldFireEvent||this.shouldFireEvent(t,e,n))for(;!s&&o>r&&i!==!1;){if(this.eventsToDieOn[t])this._listeners[t][r].apply(this,[e,n]);else try{i=this._listeners[t][r].apply(this,[e,n])}catch(a){B("jsPlumb: fire failed for event "+t+" : "+(a.message||a))}r++,(null==this._listeners||null==this._listeners[t])&&(s=!0)}}this.tick=!1,this._drain()}return i}},{key:"_drain",value:function(){var t=this.queue.pop();t&&this.fire.apply(this,t)}},{key:"unbind",value:function(t,e){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof t)delete this._listeners[t];else if(t.__jsPlumb){var n;for(var i in t.__jsPlumb)n=t.__jsPlumb[i],A(this._listeners[n]||[],t)}}else 2===arguments.length&&A(this._listeners[t]||[],e);return this}},{key:"getListener",value:function(t){return this._listeners[t]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(t){this.eventsSuspended=t}},{key:"bind",value:function(t,e,n){var i=this,o=function(t){O(i._listeners,t,e,n),e.__jsPlumb=e.__jsPlumb||{},e.__jsPlumb[j()]=t};if("string"==typeof t)o(t);else if(null!=t.length)for(var r=0;r<t.length;r++)o(t[r]);return this}},{key:"silently",value:function(t){this.setSuspendEvents(!0);try{t()}catch(e){B("Cannot execute silent function "+e)}this.setSuspendEvents(!1)}}]),t}(),Ho=function(t){function e(){return Y(this,e),n.apply(this,arguments)}J(e,t);var n=et(e);return W(e,[{key:"shouldFireEvent",value:function(t,e,n){return!0}}]),e}(Vo),Uo=[null,[1,-1],[1,1],[-1,1],[-1,-1]],Xo=[null,[-1,-1],[-1,1],[1,1],[1,-1]],Yo=2*Math.PI;t.PerimeterAnchorShapes=void 0,function(t){t.Circle="Circle",t.Ellipse="Ellipse",t.Triangle="Triangle",t.Diamond="Diamond",t.Rectangle="Rectangle",t.Square="Square"}(t.PerimeterAnchorShapes||(t.PerimeterAnchorShapes={})),t.AnchorLocations=void 0,function(t){t.Assign="Assign",t.AutoDefault="AutoDefault",t.Bottom="Bottom",t.BottomLeft="BottomLeft",t.BottomRight="BottomRight",t.Center="Center",t.Continuous="Continuous",t.ContinuousBottom="ContinuousBottom",t.ContinuousLeft="ContinuousLeft",t.ContinuousRight="ContinuousRight",t.ContinuousTop="ContinuousTop",t.ContinuousLeftRight="ContinuousLeftRight",t.ContinuousTopBottom="ContinuousTopBottom",t.Left="Left",t.Perimeter="Perimeter",t.Right="Right",t.Top="Top",t.TopLeft="TopLeft",t.TopRight="TopRight"}(t.AnchorLocations||(t.AnchorLocations={}));var zo=function(){function t(e){gt(this,t),this.params=e,xt(this,"x1",void 0),xt(this,"x2",void 0),xt(this,"y1",void 0),xt(this,"y2",void 0),xt(this,"extents",bt()),xt(this,"type",void 0),this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2}return _t(t,[{key:"findClosestPointOnPath",value:function(t,e){return Et()}},{key:"lineIntersection",value:function(t,e,n,i){return[]}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}},{key:"boundingBoxIntersection",value:function(t){return this.boxIntersection(t.x,t.y,t.w,t.h)}}]),t}(),Wo="undefined",qo="default",Jo="true",Ko="false",Zo="*",$o={},Qo={},tr={},er={get:function(t,e,n){var i=$o[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown endpoint type '"+e+"'"}},clone:function(t){var e=tr[t.type];return er.get(t.endpoint,t.type,e.getParams(t))},compute:function(t,e,n,i){var o=Qo[t.type];return null!=o?o(t,e,n,i):void B("jsPlumb: cannot find endpoint calculator for endpoint of type ",t.type)},registerHandler:function(t){tr[t.type]=t,$o[t.type]=t.cls,Qo[t.type]=t.compute}},nr=function(){function t(e,n){kt(this,t),this.endpoint=e,Pt(this,"typeId",void 0),Pt(this,"x",void 0),Pt(this,"y",void 0),Pt(this,"w",void 0),Pt(this,"h",void 0),Pt(this,"computedValue",void 0),Pt(this,"bounds",bt()),Pt(this,"classes",[]),Pt(this,"instance",void 0),Pt(this,"type",void 0),n=n||{},this.instance=e.instance,e.cssClass&&this.classes.push(e.cssClass),n.cssClass&&this.classes.push(n.cssClass)}return St(t,[{key:"addClass",value:function(t){this.classes.push(t),this.instance.addEndpointClass(this.endpoint,t)}},{key:"removeClass",value:function(t){this.classes=this.classes.filter(function(e){return e!==t}),this.instance.removeEndpointClass(this.endpoint,t)}},{key:"compute",value:function(t,e,n){this.computedValue=er.compute(this,t,e,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(t){this.instance.setEndpointVisible(this.endpoint,t)}}]),t}(),ir=function(t){function e(t,i){var o;return kt(this,e),o=n.call(this,t,i),Pt(Ot(o),"radius",void 0),Pt(Ot(o),"defaultOffset",void 0),Pt(Ot(o),"defaultInnerRadius",void 0),Pt(Ot(o),"type",e.type),i=i||{},o.radius=i.radius||5,o.defaultOffset=.5*o.radius,o.defaultInnerRadius=o.radius/3,o}Tt(e,t);var n=It(e);return e}(nr);Pt(ir,"type","Dot");var or={type:ir.type,cls:ir,compute:function(t,e,n,i){var o=e.curX-t.radius,r=e.curY-t.radius,s=2*t.radius,a=2*t.radius;if(i&&i.stroke){var l=i.strokeWidth||1;o-=l,r-=l,s+=2*l,a+=2*l}return t.x=o,t.y=r,t.w=s,t.h=a,[o,r,s,a,t.radius]},getParams:function(t){return{radius:t.radius}}},rr=function(t){function e(t,i){var o;return kt(this,e),o=n.call(this,t,i),Pt(Ot(o),"type",e.type),o}Tt(e,t);var n=It(e);return e}(nr);Pt(rr,"type","Blank");var sr={type:rr.type,cls:rr,compute:function(t,e,n,i){return t.x=e.curX,t.y=e.curY,t.w=10,t.h=0,[e.curX,e.curY,10,0]},getParams:function(t){return{}}},ar=function(t){function e(t,i){var o;return kt(this,e),o=n.call(this,t,i),Pt(Ot(o),"width",void 0),Pt(Ot(o),"height",void 0),Pt(Ot(o),"type",e.type),i=i||{},o.width=i.width||10,o.height=i.height||10,o}Tt(e,t);var n=It(e);return St(e,null,[{key:"_getParams",value:function(t){return{width:t.width,height:t.height}}}]),e}(nr);Pt(ar,"type","Rectangle");var lr={type:ar.type,cls:ar,compute:function(t,e,n,i){var o=i.width||t.width,r=i.height||t.height,s=e.curX-o/2,a=e.curY-r/2;return t.x=s,t.y=a,t.w=o,t.h=r,[s,a,o,r]},getParams:function(t){return{width:t.width,height:t.height}}},ur=function(){function t(e,n){kt(this,t),this.connection=e,Pt(this,"type",void 0),Pt(this,"edited",!1),Pt(this,"stub",void 0),Pt(this,"sourceStub",void 0),Pt(this,"targetStub",void 0),Pt(this,"maxStub",void 0),Pt(this,"typeId",void 0),Pt(this,"gap",void 0),Pt(this,"sourceGap",void 0),Pt(this,"targetGap",void 0),Pt(this,"segments",[]),Pt(this,"totalLength",0),Pt(this,"segmentProportions",[]),Pt(this,"segmentProportionalLengths",[]),Pt(this,"paintInfo",null),Pt(this,"strokeWidth",void 0),Pt(this,"x",void 0),Pt(this,"y",void 0),Pt(this,"w",void 0),Pt(this,"h",void 0),Pt(this,"segment",void 0),Pt(this,"bounds",bt()),Pt(this,"cssClass",void 0),Pt(this,"hoverClass",void 0),Pt(this,"geometry",void 0),this.stub=n.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=n.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=n.cssClass||"",this.hoverClass=n.hoverClass||""}return St(t,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(t,e){this.geometry=t,this.edited=null!=t&&!e}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(t){return this.geometry=t,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(t,e,n){return{x:t.x,y:t.y,ox:t.ox,oy:t.oy,curX:t.curX+e,curY:t.curY+n}}},{key:"resetBounds",value:function(){this.bounds=bt()}},{key:"findSegmentForPoint",value:function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var o=this.segments[i].findClosestPointOnPath(t,e);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=this.segments[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+o.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function(t,e,n,i){for(var o=[],r=0;r<this.segments.length;r++)o.push.apply(o,this.segments[r].lineIntersection(t,e,n,i));return o}},{key:"boxIntersection",value:function(t,e,n,i){for(var o=[],r=0;r<this.segments.length;r++)o.push.apply(o,this.segments[r].boxIntersection(t,e,n,i));return o}},{key:"boundingBoxIntersection",value:function(t){for(var e=[],n=0;n<this.segments.length;n++)e.push.apply(e,this.segments[n].boundingBoxIntersection(t));return e}},{key:"_updateSegmentProportions",value:function(){for(var t=0,e=0;e<this.segments.length;e++){var n=this.segments[e].getLength();this.segmentProportionalLengths[e]=n/this.totalLength,this.segmentProportions[e]=[t,t+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(t,e){var n,i,o;if(e&&(t=t>0?t/this.totalLength:(this.totalLength+t)/this.totalLength),1===t)n=this.segments.length-1,o=1;else if(0===t)o=0,n=0;else if(t>=.5){for(n=0,o=0,i=this.segmentProportions.length-1;i>-1;i--)if(this.segmentProportions[i][1]>=t&&this.segmentProportions[i][0]<=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(n=this.segmentProportions.length-1,o=1,i=0;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=t){n=i,o=(t-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:o,index:n}}},{key:"_addSegment",value:function(t,e){if(e.x1!==e.x2||e.y1!==e.y2){var n=new t(e);this.segments.push(n),this.totalLength+=n.getLength(),this.updateBounds(n)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(t){this.strokeWidth=t.strokeWidth;var e=t.sourcePos.curX,n=t.targetPos.curX,i=t.sourcePos.curY,o=t.targetPos.curY,r=at({x:e,y:i},{x:n,y:o}),s=e>n,a=i>o,l=[t.sourcePos.ox,t.sourcePos.oy],u=[t.targetPos.ox,t.targetPos.oy],c=s?n:e,h=a?o:i,d=Math.abs(n-e),p=Math.abs(o-i);if(0===l[0]&&0===l[1]||0===u[0]&&0===u[1]){var f=d>p?0:1,v=[1,0][f],y=0===f?e:i,g=0===f?n:o;l[f]=y>g?-1:1,u[f]=y>g?1:-1,l[v]=0,u[v]=0}var m=s?d+this.sourceGap*l[0]:this.sourceGap*l[0],_=a?p+this.sourceGap*l[1]:this.sourceGap*l[1],x=s?this.targetGap*u[0]:d+this.targetGap*u[0],E=a?this.targetGap*u[1]:p+this.targetGap*u[1],b=l[0]*u[0]+l[1]*u[1],k={sx:m,sy:_,tx:x,ty:E,xSpan:Math.abs(x-m),ySpan:Math.abs(E-_),mx:(m+x)/2,my:(_+E)/2,so:l,to:u,x:c,y:h,w:d,h:p,segment:r,startStubX:m+l[0]*this.sourceStub,startStubY:_+l[1]*this.sourceStub,endStubX:x+u[0]*this.targetStub,endStubY:E+u[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(m-x)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(_-E)>this.sourceStub+this.targetStub,opposite:-1===b,perpendicular:0===b,orthogonal:1===b,sourceAxis:0===l[0]?"y":"x",points:[c,h,d,p,m,_,x,E],stubs:[this.sourceStub,this.targetStub]};return k.anchorOrientation=k.opposite?"opposite":k.orthogonal?"orthogonal":"perpendicular",k}},{key:"updateBounds",value:function(t){var e=t.extents;this.bounds.xmin=Math.min(this.bounds.xmin,e.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,e.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,e.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,e.ymax)}},{key:"dumpSegmentsToConsole",value:function(){B("SEGMENTS:");for(var t=0;t<this.segments.length;t++)B(this.segments[t].type,""+this.segments[t].getLength(),""+this.segmentProportions[t])}},{key:"pointOnPath",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(t,e){var n=this._findSegmentForLocation(t,e);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this._findSegmentForLocation(t,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,e,!1)||{x:0,y:0}}},{key:"compute",value:function(t){this.paintInfo=this._prepareCompute(t),this._clearSegments(),this._compute(this.paintInfo,t),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(t,e){}}]),t}(),cr=function(t){function e(t){var i;return kt(this,e),i=n.call(this,t),Pt(Ot(i),"length",void 0),Pt(Ot(i),"m",void 0),Pt(Ot(i),"m2",void 0),Pt(Ot(i),"type",e.segmentType),i._setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),i}Tt(e,t);var n=It(e);return St(e,[{key:"getPath",value:function(t){return(t?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=ot({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(t){this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this._recalc()}},{key:"pointOnPath",value:function(t,e){if(0!==t||e){if(1!==t||e){var n=e?t>0?t:this.length+t:t*this.length;return ft({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}return{x:this.x2,y:this.y2}}return{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(t,e){return this.m}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=0>=e?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return 0>=e&&Math.abs(e)>1&&(e*=-1),ft(i,o,e)}},{key:"within",value:function(t,e,n){return n>=Math.min(t,e)&&n<=Math.max(t,e)}},{key:"closest",value:function(t,e,n){return Math.abs(n-t)<Math.abs(n-e)?t:e}},{key:"findClosestPointOnPath",value:function(t,e){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)n.y=this.y1,n.x=this.within(this.x1,this.x2,t)?t:this.closest(this.x1,this.x2,t);else if(this.m===1/0||this.m===-(1/0))n.x=this.x1,n.y=this.within(this.y1,this.y2,e)?e:this.closest(this.y1,this.y2,e);else{var i=this.y1-this.m*this.x1,o=e-this.m2*t,r=(o-i)/(this.m-this.m2),s=this.m*r+i;n.x=this.within(this.x1,this.x2,r)?r:this.closest(this.x1,this.x2,r),n.y=this.within(this.y1,this.y2,s)?s:this.closest(this.y1,this.y2,s)}var a=st({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=st({x:t,y:e},n),n.l=a/length,n}},{key:"_pointLiesBetween",value:function(t,e,n){return n>e?t>=e&&n>=t:e>=t&&t>=n}},{key:"lineIntersection",value:function(t,e,n,i){var o=Math.abs(ot({x:t,y:e},{x:n,y:i})),r=Math.abs(this.m),s=r===1/0?this.x1:this.y1-r*this.x1,a=[],l=o===1/0?t:e-o*t;if(o!==r)if(o===1/0&&0===r)this._pointLiesBetween(t,this.x1,this.x2)&&this._pointLiesBetween(this.y1,e,i)&&a.push({x:t,y:this.y1});else if(0===o&&r===1/0)this._pointLiesBetween(e,this.y1,this.y2)&&this._pointLiesBetween(this.x1,t,n)&&a.push({x:this.x1,y:e});else{var u,c;o===1/0?(u=t,this._pointLiesBetween(u,this.x1,this.x2)&&(c=r*t+s,this._pointLiesBetween(c,e,i)&&a.push({x:u,y:c}))):0===o?(c=e,this._pointLiesBetween(c,this.y1,this.y2)&&(u=(e-s)/r,this._pointLiesBetween(u,t,n)&&a.push({x:u,y:c}))):(u=(l-s)/(r-o),c=r*u+s,this._pointLiesBetween(u,this.x1,this.x2)&&this._pointLiesBetween(c,this.y1,this.y2)&&a.push({x:u,y:c}))}return a}},{key:"boxIntersection",value:function(t,e,n,i){var o=[];return o.push.apply(o,this.lineIntersection(t,e,t+n,e)),o.push.apply(o,this.lineIntersection(t+n,e,t+n,e+i)),o.push.apply(o,this.lineIntersection(t+n,e+i,t,e+i)),o.push.apply(o,this.lineIntersection(t,e+i,t,e)),o}}]),e}(zo);Pt(cr,"segmentType","Straight");var hr=function(t){function e(){var t;kt(this,e);for(var i=arguments.length,o=new Array(i),r=0;i>r;r++)o[r]=arguments[r];return t=n.call.apply(n,[this].concat(o)),Pt(Ot(t),"type",e.type),t}Tt(e,t);var n=It(e);return St(e,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){this._addSegment(cr,{x1:t.sx,y1:t.sy,x2:t.startStubX,y2:t.startStubY}),this._addSegment(cr,{x1:t.startStubX,y1:t.startStubY,x2:t.endStubX,y2:t.endStubY}),this._addSegment(cr,{x1:t.endStubX,y1:t.endStubY,x2:t.tx,y2:t.ty}),this.geometry={source:e.sourcePos,target:e.targetPos}}},{key:"transformGeometry",value:function(t,e,n){return{source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}}]),e}(ur);Pt(hr,"type","Straight");var dr={},pr={get:function(t,e,n){var i=dr[e];if(i)return new i(t,n);throw{message:"jsPlumb: unknown connector type '"+e+"'"}},register:function(t,e){dr[t]=e}},fr="source",vr="target",yr="block",gr="none",mr=0,_r=1,xr="absolute",Er="fixed",br="static",kr="data-jtk-group",Cr="data-jtk-managed",Sr="data-jtk-not-draggable",Pr="tabindex",Tr="data-jtk-scope",wr=Tr+"-",Ar="checkCondition",Dr="checkDropAllowed",Or="jtk-connector",Mr="jtk-connector-outline",Ir="jtk-connected",jr="jtk-endpoint",Nr="jtk-endpoint-connected",Lr="jtk-endpoint-full",Gr="jtk-endpoint-drop-allowed",Rr="jtk-endpoint-drop-forbidden",Fr="jtk-endpoint-anchor",Br="jtk-group-collapsed",Vr="jtk-group-expanded",Hr="jtk-overlay",Ur="anchor:changed",Xr="connection",Yr="internal.connection",zr="connection:detach",Wr="connection:move",qr="container:change",Jr="endpoint:replaced",Kr="internal.endpoint:unregistered",Zr="internal.connection:detached",$r="element:manage",Qr="group:added",ts="group:collapse",es="group:expand",ns="group:member:added",is="group:member:removed",os="group:removed",rs="maxConnections",ss="group:nested:added",as="group:nested:removed",ls="element:unmanage",us="zoom",cs="isDetachAllowed",hs="beforeDrag",ds="beforeDrop",ps="beforeDetach",fs="beforeStartDetach",vs=qt(Cr),ys="Cannot establish connection: source endpoint is full",gs="Cannot establish connection: target endpoint is full",ms="Cannot establish connection: source does not exist",_s="Cannot establish connection: target does not exist",xs="connectionOverlays",Es=function(t){
function e(t,i,o){var r;kt(this,e),r=n.call(this),r.instance=t,r.component=i,Pt(Ot(r),"id",void 0),Pt(Ot(r),"type",void 0),Pt(Ot(r),"cssClass",void 0),Pt(Ot(r),"visible",!0),Pt(Ot(r),"location",void 0),Pt(Ot(r),"events",void 0),o=o||{},r.id=o.id||j(),r.cssClass=o.cssClass||"",r.location=o.location||.5,r.events=o.events||{};for(var s in r.events)r.bind(s,r.events[s]);return r}Tt(e,t);var n=It(e);return St(e,[{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"setVisible",value:function(t){this.visible=t,this.instance.setOverlayVisible(this,t)}},{key:"isVisible",value:function(){return this.visible}}]),e}(Vo),bs={},ks={get:function(t,e,n,i){var o=bs[e];if(o)return new o(t,n,i);throw{message:"jsPlumb: unknown overlay type '"+e+"'"}},register:function(t,e){bs[t]=e}},Cs=function(t){function e(t,i,o){var r;return kt(this,e),r=n.call(this,t,i,o),r.instance=t,r.component=i,Pt(Ot(r),"label",void 0),Pt(Ot(r),"labelText",void 0),Pt(Ot(r),"type",e.type),Pt(Ot(r),"cachedDimensions",void 0),o=o||{label:""},r.setLabel(o.label),r}Tt(e,t);var n=It(e);return St(e,[{key:"getLabel",value:function(){return l(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(t){this.label=t,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(t){null!=t.label&&this.setLabel(t.label)}}]),e}(Es);Pt(Cs,"type","Label"),ks.register("Label",Cs);var Ss,Ps,Ts,ws,As="connector",Ds="override",Os="cssClass",Ms="__default",Is="anchor",js="anchors",Ns="__label",Ls="overlay",Gs="labelLocation",Rs="add",Fs="remove",Bs=function(t){function e(t,n){var o;if(kt(this,e),o=i.call(this),o.instance=t,Pt(Ot(o),"defaultLabelLocation",.5),Pt(Ot(o),"overlays",{}),Pt(Ot(o),"overlayPositions",{}),Pt(Ot(o),"overlayPlacements",{}),Pt(Ot(o),"clone",void 0),Pt(Ot(o),"deleted",void 0),Pt(Ot(o),"segment",void 0),Pt(Ot(o),"x",void 0),Pt(Ot(o),"y",void 0),Pt(Ot(o),"w",void 0),Pt(Ot(o),"h",void 0),Pt(Ot(o),"id",void 0),Pt(Ot(o),"visible",!0),Pt(Ot(o),"typeId",void 0),Pt(Ot(o),"params",{}),Pt(Ot(o),"paintStyle",void 0),Pt(Ot(o),"hoverPaintStyle",void 0),Pt(Ot(o),"paintStyleInUse",void 0),Pt(Ot(o),"_hover",!1),Pt(Ot(o),"lastPaintedAt",void 0),Pt(Ot(o),"data",void 0),Pt(Ot(o),"_defaultType",void 0),Pt(Ot(o),"events",void 0),Pt(Ot(o),"parameters",void 0),Pt(Ot(o),"_types",void 0),Pt(Ot(o),"_typeCache",void 0),Pt(Ot(o),"cssClass",void 0),Pt(Ot(o),"hoverClass",void 0),Pt(Ot(o),"beforeDetach",void 0),Pt(Ot(o),"beforeDrop",void 0),n=n||{},o.cssClass=n.cssClass||"",o.hoverClass=n.hoverClass||t.defaults.hoverClass,o.beforeDetach=n.beforeDetach,o.beforeDrop=n.beforeDrop,o._types=[],o._typeCache={},o.parameters=h(n.parameters||{}),o.id=n.id||o.getIdPrefix()+(new Date).getTime(),o._defaultType={parameters:o.parameters,scope:n.scope||o.instance.defaultScope,overlays:{}},n.events)for(var r in n.events)o.bind(r,n.events[r]);o.clone=function(){var e=Object.create(o.constructor.prototype);return o.constructor.apply(e,[t,n]),e},o.overlays={},o.overlayPositions={};var s=n.overlays||[],a={},l=o.getDefaultOverlayKey();if(l){var u=o.instance.defaults[l];u&&s.push.apply(s,Gt(u));for(var c=0;c<s.length;c++){var d=Kt(s[c]);a[d.options.id]=d}}return o._defaultType.overlays=a,n.label&&(o.getDefaultType().overlays[Ns]={type:Cs.type,options:{label:n.label,location:n.labelLocation||o.defaultLabelLocation,id:Ns}}),o}Tt(e,t);var i=It(e);return St(e,[{key:"isDetachAllowed",value:function(t){var e=!0;if(this.beforeDetach)try{e=this.beforeDetach(t)}catch(n){B("jsPlumb: beforeDetach callback failed",n)}return e}},{key:"isDropAllowed",value:function(t,e,n,i,o){var r,s={sourceId:t,targetId:e,scope:n,connection:i,dropEndpoint:o};if(this.beforeDrop)try{r=this.beforeDrop(s)}catch(a){B("jsPlumb: beforeDrop callback failed",a)}else r=this.instance.checkCondition(ds,s);return r}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(t){for(var e in t)this._defaultType[e]=t[e]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(t,e,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][t]=e}},{key:"getCachedTypeItem",value:function(t,e){return this._typeCache[e]?this._typeCache[e][t]:null}},{key:"setType",value:function(t,e){this.clearTypes(),this._types=$t(t)||[],te(this,e)}},{key:"getType",value:function(){return this._types}},{key:"reapplyTypes",value:function(t){te(this,t)}},{key:"hasType",value:function(t){return-1!==this._types.indexOf(t)}},{key:"addType",value:function(t,e){var n=$t(t),i=!1;if(null!=n){for(var o=0,r=n.length;r>o;o++)this.hasType(n[o])||(this._types.push(n[o]),i=!0);i&&te(this,e)}}},{key:"removeType",value:function(t,e){var n=this,i=$t(t),o=!1,r=function(t){var e=n._types.indexOf(t);return-1!==e?(ee(n,e),n._types.splice(e,1),!0):!1};if(null!=i){for(var s=0,a=i.length;a>s;s++)o=r(i[s])||o;o&&te(this,e)}}},{key:"clearTypes",value:function(t,e){for(var n=this._types.length,i=0;n>i;i++)ee(this,0),this._types.splice(0,1);te(this,t)}},{key:"toggleType",value:function(t,e){var n=$t(t);if(null!=n){for(var i=0,o=n.length;o>i;i++){var r=this._types.indexOf(n[i]);-1!==r?(ee(this,r),this._types.splice(r,1)):this._types.push(n[i])}te(this,e)}}},{key:"applyType",value:function(t,e){if(this.setPaintStyle(t.paintStyle),this.setHoverPaintStyle(t.hoverPaintStyle),this.mergeParameters(t.parameters),this.paintStyleInUse=this.getPaintStyle(),t.overlays){var n,i={};for(n in t.overlays){var o=this.overlays[t.overlays[n].options.id];if(o)o.updateFrom(t.overlays[n].options),i[t.overlays[n].options.id]=!0,this.instance.reattachOverlay(o,this);else{var r=this.getCachedTypeItem("overlay",t.overlays[n].options.id);null!=r?(this.instance.reattachOverlay(r,this),r.setVisible(!0),r.updateFrom(t.overlays[n].options),this.overlays[r.id]=r):r=this.addOverlay(t.overlays[n]),i[r.id]=!0}}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(t){this.paintStyle=t,this.paintStyleInUse=this.paintStyle,ne(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(t){this.hoverPaintStyle=t,ne(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(t){null!=t&&n(this.parameters,t)}},{key:"setVisible",value:function(t){this.visible=t,t?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(t,e){this.overlayPositions[t.id]=e}},{key:"getAbsoluteOverlayPosition",value:function(t){return this.overlayPositions?this.overlayPositions[t.id]:null}},{key:"_clazzManip",value:function(t,e){for(var n in this.overlays)t===Rs?this.instance.addOverlayClass(this.overlays[n],e):t===Fs&&this.instance.removeOverlayClass(this.overlays[n],e)}},{key:"addClass",value:function(t,e){var n=(this.cssClass||"").split(" ");n.push(t),this.cssClass=n.join(" "),this._clazzManip(Rs,t)}},{key:"removeClass",value:function(t,e){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter(function(e){return e!==t}).join(" "),this._clazzManip(Fs,t)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(t){this.data=t||{}}},{key:"mergeData",value:function(t){this.data=n(this.data,t)}},{key:"addOverlay",value:function(t){var e=oe(this,t);if(this.getData&&e.type===Cs.type&&!o(t)){var n=this.getData(),i=t.options;if(n){var r=i.labelLocationAttribute||Gs,s=n[r];s&&(e.location=s)}}return e}},{key:"getOverlay",value:function(t){return this.overlays[t]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var t in this.overlays)this.overlays[t].setVisible(!1)}},{key:"showOverlay",value:function(t){var e=this.getOverlay(t);e&&e.setVisible(!0)}},{key:"showOverlays",value:function(){for(var t in this.overlays)this.overlays[t].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var t in this.overlays)this.instance.destroyOverlay(this.overlays[t]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(t,e){var n=this.overlays[t];n&&(n.setVisible(!1),e||this.instance.destroyOverlay(n),delete this.overlays[t],this.overlayPositions&&delete this.overlayPositions[t],this.overlayPlacements&&delete this.overlayPlacements[t])}},{key:"removeOverlays",value:function(){for(var t=arguments.length,e=new Array(t),n=0;t>n;n++)e[n]=arguments[n];for(var i=0,o=e.length;o>i;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function(){var t=this.getLabelOverlay();return null!=t?t.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(Ns)}},{key:"setLabel",value:function(t){var e=this.getLabelOverlay();if(e)if(o(t)||l(t))e.setLabel(t);else{var n=t;n.label&&e.setLabel(n.label),n.location&&(e.location=n.location)}else{var i=o(t)||l(t)?{label:t}:t;e=ie(this,i),this.overlays[Ns]=e}}}]),e}(Vo);!function(t){t.top="top",t.left="left",t.right="right",t.bottom="bottom"}(ws||(ws={}));var Vs=ws.top,Hs=ws.left,Us=ws.right,Xs=ws.bottom,Ys=[Hs,Us],zs=[Vs,Xs],Ws=function(){function t(e,n){kt(this,t),this.instance=e,this.element=n,Pt(this,"isFloating",!0),Pt(this,"isContinuous",void 0),Pt(this,"isDynamic",void 0),Pt(this,"locations",[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}]),Pt(this,"currentLocation",0),Pt(this,"locked",!1),Pt(this,"cssClass",""),Pt(this,"timestamp",null),Pt(this,"type","Floating"),Pt(this,"id",j()),Pt(this,"orientation",[0,0]),Pt(this,"size",void 0),this.size=e.getSize(n)}return St(t,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(t){this.orientation=this.instance.router.getEndpointOrientation(t),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),t}(),qs=(Ss={},Pt(Ss,Vs,Xs),Pt(Ss,Us,Hs),Pt(Ss,Hs,Us),Pt(Ss,Xs,Vs),Ss),Js=(Ps={},Pt(Ps,Vs,Us),Pt(Ps,Us,Xs),Pt(Ps,Hs,Vs),Pt(Ps,Xs,Hs),Ps),Ks=(Ts={},Pt(Ts,Vs,Hs),Pt(Ts,Us,Vs),Pt(Ts,Hs,Xs),Pt(Ts,Xs,Us),Ts),Zs={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},$s={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},Qs={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},ta={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},ea={x:0,y:0,ox:0,oy:-1,offx:0,offy:0},na={x:1,y:0,ox:1,oy:-1,offx:0,offy:0},ia={x:0,y:1,ox:0,oy:1,offx:0,offy:0},oa={x:1,y:1,ox:0,oy:1,offx:0,offy:0},ra={x:.5,y:.5,ox:0,oy:0,offx:0,offy:0},sa={Top:[Zs],Bottom:[$s],Left:[Qs],Right:[ta],TopLeft:[ea],TopRight:[na],BottomLeft:[ia],BottomRight:[oa],Center:[ra],AutoDefault:[Zs,Qs,$s,ta]},aa={Continuous:{faces:[Vs,Hs,Xs,Us]},ContinuousTop:{faces:[Vs]},ContinuousRight:{faces:[Us]},ContinuousBottom:{faces:[Xs]},ContinuousLeft:{faces:[Hs]},ContinuousLeftRight:{faces:[Hs,Us]},ContinuousTopBottom:{faces:[Vs,Xs]}},la="currentFace",ua=new Map;ua.set(t.PerimeterAnchorShapes.Circle,ge),ua.set(t.PerimeterAnchorShapes.Ellipse,ge),ua.set(t.PerimeterAnchorShapes.Rectangle,xe),ua.set(t.PerimeterAnchorShapes.Square,xe),ua.set(t.PerimeterAnchorShapes.Diamond,Ee),ua.set(t.PerimeterAnchorShapes.Triangle,be);var ca="anchors",ha="connector",da=function(t){function e(t,o){var r;kt(this,e),r=i.call(this,t,o),r.instance=t,Pt(Ot(r),"connector",void 0),Pt(Ot(r),"defaultLabelLocation",.5),Pt(Ot(r),"scope",void 0),Pt(Ot(r),"typeId","_jsplumb_connection"),Pt(Ot(r),"previousConnection",void 0),Pt(Ot(r),"sourceId",void 0),Pt(Ot(r),"targetId",void 0),Pt(Ot(r),"source",void 0),Pt(Ot(r),"target",void 0),Pt(Ot(r),"detachable",!0),Pt(Ot(r),"reattach",!1),Pt(Ot(r),"uuids",void 0),Pt(Ot(r),"cost",1),Pt(Ot(r),"directed",void 0),Pt(Ot(r),"endpoints",[null,null]),Pt(Ot(r),"endpointStyles",void 0),Pt(Ot(r),"endpointSpec",void 0),Pt(Ot(r),"endpointsSpec",void 0),Pt(Ot(r),"endpointStyle",{}),Pt(Ot(r),"endpointHoverStyle",{}),Pt(Ot(r),"endpointHoverStyles",void 0),Pt(Ot(r),"suspendedEndpoint",void 0),Pt(Ot(r),"suspendedIndex",void 0),Pt(Ot(r),"suspendedElement",void 0),Pt(Ot(r),"suspendedElementId",void 0),Pt(Ot(r),"suspendedElementType",void 0),Pt(Ot(r),"_forceReattach",void 0),Pt(Ot(r),"_forceDetach",void 0),Pt(Ot(r),"proxies",[]),Pt(Ot(r),"pending",!1),r.id=o.id,r.previousConnection=o.previousConnection,r.source=o.source,r.target=o.target,o.sourceEndpoint?(r.source=o.sourceEndpoint.element,r.sourceId=o.sourceEndpoint.elementId):r.sourceId=t.getId(r.source),o.targetEndpoint?(r.target=o.targetEndpoint.element,r.targetId=o.targetEndpoint.elementId):r.targetId=t.getId(r.target),r.scope=o.scope;var a=o.anchors?o.anchors[0]:o.anchor,l=o.anchors?o.anchors[1]:o.anchor;t.manage(r.source),t.manage(r.target),r.visible=!0,r.params={cssClass:o.cssClass,hoverClass:o.hoverClass,"pointer-events":o["pointer-events"],overlays:o.overlays},r.lastPaintedAt=null,o.type&&(o.endpoints=o.endpoints||r.instance._deriveEndpointAndAnchorSpec(o.type).endpoints),r.endpointSpec=o.endpoint,r.endpointsSpec=o.endpoints||[null,null],r.endpointStyle=o.endpointStyle,r.endpointHoverStyle=o.endpointHoverStyle,r.endpointStyles=o.endpointStyles||[null,null],r.endpointHoverStyles=o.endpointHoverStyles||[null,null],r.paintStyle=o.paintStyle,r.hoverPaintStyle=o.hoverPaintStyle,r.uuids=o.uuids,r.makeEndpoint(!0,r.source,r.sourceId,a,o.sourceEndpoint),r.makeEndpoint(!1,r.target,r.targetId,l,o.targetEndpoint),r.scope||(r.scope=r.endpoints[0].scope),null!=o.deleteEndpointsOnEmpty&&(r.endpoints[0].deleteOnEmpty=o.deleteEndpointsOnEmpty,r.endpoints[1].deleteOnEmpty=o.deleteEndpointsOnEmpty);var u=r.instance.defaults.connectionsDetachable;o.detachable===!1&&(u=!1),r.endpoints[0].connectionsDetachable===!1&&(u=!1),r.endpoints[1].connectionsDetachable===!1&&(u=!1),r.endpointsSpec=o.endpoints||[null,null],r.endpointSpec=o.endpoint||null;var c=o.reattach||r.endpoints[0].reattachConnections||r.endpoints[1].reattachConnections||r.instance.defaults.reattachConnections;if(r.appendToDefaultType({detachable:u,reattach:c,paintStyle:r.endpoints[0].connectorStyle||r.endpoints[1].connectorStyle||o.paintStyle||r.instance.defaults.paintStyle,hoverPaintStyle:r.endpoints[0].connectorHoverStyle||r.endpoints[1].connectorHoverStyle||o.hoverPaintStyle||r.instance.defaults.hoverPaintStyle}),!r.instance._suspendDrawing){var h=r.instance._suspendedAt||j();r.instance.paintEndpoint(r.endpoints[0],{timestamp:h}),r.instance.paintEndpoint(r.endpoints[1],{timestamp:h})}r.cost=o.cost||r.endpoints[0].connectionCost,r.directed=o.directed,null==o.directed&&(r.directed=r.endpoints[0].connectionsDirected);var d=n({},r.endpoints[1].parameters);n(d,r.endpoints[0].parameters),n(d,r.parameters),r.parameters=d,r.paintStyleInUse=r.getPaintStyle()||{},r.setConnector(r.endpoints[0].connector||r.endpoints[1].connector||o.connector||r.instance.defaults.connector,!0);var p=null!=o.data&&s(o.data)?o.data:{};r.setData(p);var f=[qo,r.endpoints[0].edgeType,r.endpoints[1].edgeType,o.type].join(" ");return/[^\s]/.test(f)&&r.addType(f,o.data),r}Tt(e,t);var i=It(e);return St(e,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return xs}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(t,e,n,i,o){return n=n||this.instance.getId(e),Se(this,o,t?0:1,i,e)}},{key:"getTypeDescriptor",value:function(){return e.type}},{key:"isDetachable",value:function(t){return this.detachable===!1?!1:null!=t?t.connectionsDetachable===!0:this.detachable===!0}},{key:"setDetachable",value:function(t){this.detachable=t===!0}},{key:"isReattach",value:function(){return this.reattach===!0||this.endpoints[0].reattachConnections===!0||this.endpoints[1].reattachConnections===!0}},{key:"setReattach",value:function(t){this.reattach=t===!0}},{key:"applyType",value:function(t,n){var i=null;null!=t.connector&&(i=this.getCachedTypeItem(ha,n.connector),null==i&&(i=this.prepareConnector(t.connector,n.connector),this.cacheTypeItem(ha,i,n.connector)),this.setPreparedConnector(i)),Nt(wt(e.prototype),"applyType",this).call(this,t,n),null!=t.detachable&&this.setDetachable(t.detachable),null!=t.reattach&&this.setReattach(t.reattach),t.scope&&(this.scope=t.scope);var o=null;t.anchor?(o=this.getCachedTypeItem(ca,n.anchor),null==o&&(o=[ye(t.anchor),ye(t.anchor)],this.cacheTypeItem(ca,o,n.anchor))):t.anchors&&(o=this.getCachedTypeItem(ca,n.anchors),null==o&&(o=[ye(t.anchors[0]),ye(t.anchors[1])],this.cacheTypeItem(ca,o,n.anchors))),null!=o&&(this.instance.router.setConnectionAnchors(this,o),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,t)}},{key:"addClass",value:function(t,n){Nt(wt(e.prototype),"addClass",this).call(this,t),n&&(this.endpoints[0].addClass(t),this.endpoints[1].addClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(t)),this.connector&&this.instance.addConnectorClass(this.connector,t)}},{key:"removeClass",value:function(t,n){Nt(wt(e.prototype),"removeClass",this).call(this,t),n&&(this.endpoints[0].removeClass(t),this.endpoints[1].removeClass(t),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(t)),this.connector&&this.instance.removeConnectorClass(this.connector,t)}},{key:"setVisible",value:function(t){Nt(wt(e.prototype),"setVisible",this).call(this,t),this.connector&&this.instance.setConnectorVisible(this.connector,t),this.instance.paintConnection(this)}},{key:"destroy",value:function(){Nt(wt(e.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(t,e){var n,i={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};if(o(t))n=this.instance.makeConnector(this,t,i);else{var r=t;n=this.instance.makeConnector(this,r.type,p(r.options,i))}return null!=e&&(n.typeId=e),n}},{key:"setPreparedConnector",value:function(t,e,n,i){if(this.connector!==t){var o,r="";if(null!=this.connector&&(o=this.connector,r=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=t,i&&this.cacheTypeItem(ha,t,i),this.addClass(r),null!=o){var s=this.getOverlays();for(var a in s)this.instance.reattachOverlay(s[a],this)}e||this.instance.paintConnection(this)}}},{key:"setConnector",value:function(t,e,n,i){var o=this.prepareConnector(t,i);this.setPreparedConnector(o,e,n,i)}},{key:"replaceEndpoint",value:function(t,e){var n=this.endpoints[t],i=n.elementId,o=this.instance.getEndpoints(n.element),r=o.indexOf(n),s=Se(this,null,t,null,n.element,i,e);this.endpoints[t]=s,o.splice(r,1,s),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire(Jr,{previous:n,current:s})}}]),e}(Bs);Pt(da,"type","connection");var pa,fa=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],va=function(e){function i(e,n){var o;kt(this,i),o=r.call(this,e,n),o.instance=e,Pt(Ot(o),"connections",[]),Pt(Ot(o),"endpoint",void 0),Pt(Ot(o),"element",void 0),Pt(Ot(o),"elementId",void 0),Pt(Ot(o),"dragAllowedWhenFull",!0),Pt(Ot(o),"timestamp",void 0),Pt(Ot(o),"portId",void 0),Pt(Ot(o),"maxConnections",void 0),Pt(Ot(o),"proxiedBy",void 0),Pt(Ot(o),"connectorClass",void 0),Pt(Ot(o),"connectorHoverClass",void 0),Pt(Ot(o),"finalEndpoint",void 0),Pt(Ot(o),"enabled",!0),Pt(Ot(o),"isSource",void 0),Pt(Ot(o),"isTarget",void 0),Pt(Ot(o),"isTemporarySource",void 0),Pt(Ot(o),"connectionCost",1),Pt(Ot(o),"connectionsDirected",void 0),Pt(Ot(o),"connectionsDetachable",void 0),Pt(Ot(o),"reattachConnections",void 0),Pt(Ot(o),"currentAnchorClass",void 0),Pt(Ot(o),"referenceEndpoint",void 0),Pt(Ot(o),"edgeType",void 0),Pt(Ot(o),"connector",void 0),Pt(Ot(o),"connectorOverlays",void 0),Pt(Ot(o),"connectorStyle",void 0),Pt(Ot(o),"connectorHoverStyle",void 0),Pt(Ot(o),"deleteOnEmpty",void 0),Pt(Ot(o),"uuid",void 0),Pt(Ot(o),"scope",void 0),Pt(Ot(o),"_anchor",void 0),Pt(Ot(o),"defaultLabelLocation",[.5,.5]),o.appendToDefaultType({edgeType:n.edgeType,maxConnections:null==n.maxConnections?o.instance.defaults.maxConnections:n.maxConnections,paintStyle:n.paintStyle||o.instance.defaults.endpointStyle,hoverPaintStyle:n.hoverPaintStyle||o.instance.defaults.endpointHoverStyle,connectorStyle:n.connectorStyle,connectorHoverStyle:n.connectorHoverStyle,connectorClass:n.connectorClass,connectorHoverClass:n.connectorHoverClass,connectorOverlays:n.connectorOverlays,connector:n.connector}),o.enabled=!(n.enabled===!1),o.visible=!0,o.element=n.element,o.uuid=n.uuid,o.portId=n.portId,o.elementId=n.elementId,o.connectionCost=null==n.connectionCost?1:n.connectionCost,o.connectionsDirected=n.connectionsDirected,o.currentAnchorClass="",o.events={},o.connectorOverlays=n.connectorOverlays,o.connectorStyle=n.connectorStyle,o.connectorHoverStyle=n.connectorHoverStyle,o.connector=n.connector,o.edgeType=n.edgeType,o.connectorClass=n.connectorClass,o.connectorHoverClass=n.connectorHoverClass,o.deleteOnEmpty=n.deleteOnEmpty===!0,o.isSource=n.source||!1,o.isTemporarySource=n.isTemporarySource||!1,o.isTarget=n.target||!1,o.connections=n.connections||[],o.scope=n.scope||e.defaultScope,o.timestamp=null,o.reattachConnections=n.reattachConnections||e.defaults.reattachConnections,o.connectionsDetachable=e.defaults.connectionsDetachable,n.connectionsDetachable===!1&&(o.connectionsDetachable=!1),o.dragAllowedWhenFull=n.dragAllowedWhenFull!==!1,n.onMaxConnections&&o.bind(rs,n.onMaxConnections);var s=n.endpoint||n.existingEndpoint||e.defaults.endpoint;if(o.setEndpoint(s),null!=n.preparedAnchor)o.setPreparedAnchor(n.preparedAnchor);else{var a=n.anchor?n.anchor:n.anchors?n.anchors:e.defaults.anchor||t.AnchorLocations.Top;o.setAnchor(a)}var l=[qo,n.type||""].join(" ");return o.addType(l,n.data),o}Tt(i,e);var r=It(i);return St(i,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var t=this._anchor&&this._anchor.cssClass;if(null!=t&&t.length>0){var e=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=t;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");e!==n&&(this.removeClass(e),this.addClass(n),this.instance.removeClass(this.element,e),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(t){return this.instance.router.setAnchor(this,t),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(t){this.fire(Ur,{endpoint:this,anchor:t}),this._updateAnchorClass()}},{key:"setAnchor",value:function(t){var e=this.instance.router.prepareAnchor(this,t);return this.setPreparedAnchor(e),this}},{key:"addConnection",value:function(t){var e=this.isFull(),n=0===this.connections.length;this.connections.push(t),n&&this.addClass(this.instance.endpointConnectedClass),this.isFull()?e||this.addClass(this.instance.endpointFullClass):e&&this.removeClass(this.instance.endpointFullClass)}},{key:"detachFromConnection",value:function(t,e,n){e=null==e?this.connections.indexOf(t):e,e>=0&&(this.connections.splice(e,1),this.instance.refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(t){for(var e=this.connections.length,n=0;e>n;n++)this.instance.deleteConnection(this.connections[0],t)}},{key:"detachFrom",value:function(t){for(var e=[],n=0;n<this.connections.length;n++)(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t)&&e.push(this.connections[n]);for(var i=0,o=e.length;o>i;i++)this.instance.deleteConnection(e[0]);return this}},{key:"setVisible",value:function(t,e,n){if(Nt(wt(i.prototype),"setVisible",this).call(this,t),this.endpoint.setVisible(t),t?this.showOverlays():this.hideOverlays(),!e)for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(t),!n){var r=this===this.connections[o].endpoints[0]?1:0;1===this.connections[o].endpoints[r].connections.length&&this.connections[o].endpoints[r].setVisible(t,!0,!0)}}},{key:"applyType",value:function(t,e){Nt(wt(i.prototype),"applyType",this).call(this,t,e),this.setPaintStyle(t.endpointStyle||t.paintStyle),this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle),this.connectorStyle=t.connectorStyle,this.connectorHoverStyle=t.connectorHoverStyle,this.connector=t.connector,this.connectorOverlays=t.connectorOverlays,this.edgeType=t.edgeType,null!=t.maxConnections&&(this.maxConnections=t.maxConnections),t.scope&&(this.scope=t.scope),n(t,fa),this.instance.applyEndpointType(this,t)}},{key:"destroy",value:function(){Nt(wt(i.prototype),"destroy",this).call(this),null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections?!0:!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(t){var e=!1;if(t)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===t||this.connections[n].endpoints[0]===t){e=!0;break}return e}},{key:"setDragAllowedWhenFull",value:function(t){this.dragAllowedWhenFull=t}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(t,e){var i,r={cssClass:this.cssClass,endpoint:this};if(U(t,nr)){var s=t;i=er.clone(s)}else if(o(t))i=er.get(this,t,r);else{var a=t;n(r,a.options||{}),i=er.get(this,a.type,r)}return i.typeId=e,i}},{key:"setEndpoint",value:function(t){var e=this.prepareEndpoint(t);this.setPreparedEndpoint(e)}},{key:"setPreparedEndpoint",value:function(t){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=t}},{key:"addClass",value:function(t,e){Nt(wt(i.prototype),"addClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.addClass(t)}},{key:"removeClass",value:function(t,e){Nt(wt(i.prototype),"removeClass",this).call(this,t,e),null!=this.endpoint&&this.endpoint.removeClass(t)}}]),i}(Bs),ya=function bc(t,e){kt(this,bc),this.instance=t,this.el=e,Pt(this,"group",void 0)},ga=function(t){function e(t,i,o){var r;kt(this,e),r=n.call(this,t,i),r.instance=t,Pt(Ot(r),"children",[]),Pt(Ot(r),"collapsed",!1),Pt(Ot(r),"droppable",void 0),Pt(Ot(r),"enabled",void 0),Pt(Ot(r),"orphan",void 0),Pt(Ot(r),"constrain",void 0),Pt(Ot(r),"proxied",void 0),Pt(Ot(r),"ghost",void 0),Pt(Ot(r),"revert",void 0),Pt(Ot(r),"prune",void 0),Pt(Ot(r),"dropOverride",void 0),Pt(Ot(r),"anchor",void 0),Pt(Ot(r),"endpoint",void 0),Pt(Ot(r),"connections",{source:[],target:[],internal:[]}),Pt(Ot(r),"manager",void 0),Pt(Ot(r),"id",void 0),Pt(Ot(r),"elId",void 0);var s=r.el;return s._isJsPlumbGroup=!0,s._jsPlumbGroup=Ot(r),r.elId=t.getId(i),r.orphan=o.orphan===!0,r.revert=r.orphan===!0?!1:o.revert!==!1,r.droppable=o.droppable!==!1,r.ghost=o.ghost===!0,r.enabled=o.enabled!==!1,r.prune=r.orphan!==!0&&o.prune===!0,r.constrain=r.ghost||o.constrain===!0,r.proxied=o.proxied!==!1,r.id=o.id||j(),r.dropOverride=o.dropOverride===!0,r.anchor=o.anchor,r.endpoint=o.endpoint,r.anchor=o.anchor,t.setAttribute(i,kr,""),r}Tt(e,t);var n=It(e);return St(e,[{key:"overrideDrop",value:function(t,e){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(t,e){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(t,e){return this.endpoint||{type:ir.type,options:{radius:10}}}},{key:"add",value:function(t,e){var n=this.instance.getGroupContentArea(this),i=t;if(null!=i._jsPlumbParentGroup){if(i._jsPlumbParentGroup===this)return;i._jsPlumbParentGroup.remove(t,!0,e,!1)}i._jsPlumbParentGroup=this,this.children.push(new ya(this.instance,t)),this.instance._appendElement(i,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(t){return null==t?null:k(this.children,function(e){return e.el===t})}},{key:"remove",value:function(t,e,n,i,o){var r=this.resolveNode(t);null!=r&&this._doRemove(r,e,n,i,o)}},{key:"_doRemove",value:function(t,e,n,i,o){var r=t.el;if(delete r._jsPlumbParentGroup,T(this.children,function(e){return e===t}),e)try{this.instance.getGroupContentArea(this).removeChild(r)}catch(s){B("Could not remove element from Group "+s)}if(!n){var a={group:this,el:r};o&&(a.targetGroup=o),this.instance.fire(is,a)}i||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(t,e){for(var n=0,i=this.children.length;i>n;n++){var o=this.children[0];this._doRemove(o,t,e,!0),this.instance.unmanage(o.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var t={},e=0;e<this.children.length;e++){var n=this.manager.orphan(this.children[e].el,!1);t[n.id]=n.pos}return this.children.length=0,t}},{key:"addGroup",value:function(t){if(this.instance.allowNestedGroups&&t!==this){if(this.instance.groupManager.isAncestor(this,t))return!1;null!=t.group&&t.group.removeGroup(t);var e=this.instance.getId(t.el),n=this.instance.getManagedElements()[e];n.group=this.elId;var i=this.instance.getOffsetRelativeToRoot(t.el),o=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));t.el._jsPlumbParentGroup=this,this.children.push(t),this.instance._appendElement(t.el,this.instance.getGroupContentArea(this)),t.group=this;var r={x:i.x-o.x,y:i.y-o.y};return this.instance.setPosition(t.el,r),this.instance.fire(ss,{parent:this,child:t}),!0}return!1}},{key:"removeGroup",value:function(t){if(t.group===this){var e=t.el,n=this.instance.getGroupContentArea(this);n===e.parentNode&&n.removeChild(t.el);var i=this.instance.getId(t.el),o=this.instance.getManagedElements()[i];o&&delete o.group,this.children=this.children.filter(function(e){return e.id!==t.id}),delete t.group,delete e._jsPlumbParentGroup,this.instance.fire(as,{parent:this,child:t})}}},{key:"getGroups",value:function(){return this.children.filter(function(t){return t.constructor===e})}},{key:"getNodes",value:function(){return this.children.filter(function(t){return t.constructor===ya})}},{key:"collapseParent",get:function(){var t=null;if(null==this.group)return null;for(var e=this.group;null!=e;)e.collapsed&&(t=e),e=e.group;return t}}]),e}(ya),ma=function(){function t(e){var n=this;kt(this,t),this.instance=e,Pt(this,"groupMap",{}),Pt(this,"_connectionSourceMap",{}),Pt(this,"_connectionTargetMap",{}),e.bind(Yr,function(t){var e=n.getGroupFor(t.source),i=n.getGroupFor(t.target);null!=e&&null!=i&&e===i?(n._connectionSourceMap[t.connection.id]=e,n._connectionTargetMap[t.connection.id]=e,I(e.connections.internal,t.connection)):(null!=e&&(t.target._jsPlumbGroup===e?I(e.connections.internal,t.connection):I(e.connections.source,t.connection),n._connectionSourceMap[t.connection.id]=e),null!=i&&(t.source._jsPlumbGroup===i?I(i.connections.internal,t.connection):I(i.connections.target,t.connection),
n._connectionTargetMap[t.connection.id]=i))}),e.bind(Zr,function(t){n._cleanupDetachedConnection(t.connection)}),e.bind(Wr,function(t){var e=t.originalEndpoint.element,i=n.getGroupFor(e),o=t.connection.endpoints[t.index],r=o.element,s=n.getGroupFor(r),a=0===t.index?n._connectionSourceMap:n._connectionTargetMap,l=0===t.index?n._connectionTargetMap:n._connectionSourceMap;null!=s?(a[t.connection.id]=s,t.connection.source===t.connection.target&&(l[t.connection.id]=s)):(delete a[t.connection.id],t.connection.source===t.connection.target&&delete l[t.connection.id]),null!=i&&n._updateConnectionsForGroup(i),null!=s&&n._updateConnectionsForGroup(s)})}return St(t,[{key:"_cleanupDetachedConnection",value:function(t){t.proxies.length=0;var e,n=this._connectionSourceMap[t.id];null!=n&&(e=function(e){return e.id===t.id},T(n.connections.source,e),T(n.connections.target,e),T(n.connections.internal,e),delete this._connectionSourceMap[t.id]),n=this._connectionTargetMap[t.id],null!=n&&(e=function(e){return e.id===t.id},T(n.connections.source,e),T(n.connections.target,e),T(n.connections.internal,e),delete this._connectionTargetMap[t.id])}},{key:"addGroup",value:function(t){var e=t.el;if(null!=this.groupMap[t.id])throw new Error("cannot create Group ["+t.id+"]; a Group with that ID exists");if(null!=e._isJsPlumbGroup)throw new Error("cannot create Group ["+t.id+"]; the given element is already a Group");var n=new ga(this.instance,t.el,t);return this.groupMap[n.id]=n,t.collapsed&&this.collapseGroup(n),this.instance.manage(n.el),this.instance.addClass(n.el,Vr),n.manager=this,this._updateConnectionsForGroup(n),this.instance.fire(Qr,{group:n}),n}},{key:"getGroup",value:function(t){var e=t;if(o(t)&&(e=this.groupMap[t],null==e))throw new Error("No such group ["+t+"]");return e}},{key:"getGroupFor",value:function(t){for(var e=t,n=this.instance.getContainer(),i=!1,o=null;!i;)null==e||e===n?i=!0:e._jsPlumbParentGroup?(o=e._jsPlumbParentGroup,i=!0):e=e.parentNode;return o}},{key:"getGroups",value:function(){var t=[];for(var e in this.groupMap)t.push(this.groupMap[e]);return t}},{key:"removeGroup",value:function(t,e,n,i){var o=this,r=this.getGroup(t);this.expandGroup(r,!0);var s={};return x(r.children,function(t){var e=o.instance.getManagedElements()[o.instance.getId(t.el)];e&&delete e.group}),e?(x(r.getGroups(),function(t){return o.removeGroup(t,e,n)}),r.removeAll(n,i)):(r.group&&x(r.children,function(t){return r.group.add(t.el)}),s=r.orphanAll()),r.group&&r.group.removeGroup(r),this.instance.unmanage(r.el,!0),delete this.groupMap[r.id],this.instance.fire(os,{group:r}),s}},{key:"removeAllGroups",value:function(t,e,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],t,e,n)}},{key:"forEach",value:function(t){for(var e in this.groupMap)t(this.groupMap[e])}},{key:"orphan",value:function(t,e){var n=t;if(n._jsPlumbParentGroup){var i=n._jsPlumbParentGroup,o=this.instance.getOffset(n),r=this.instance.getId(n),s=this.instance.getOffset(t);return n.parentNode.removeChild(n),e!==!0&&i.group?(s.x+=o.x,s.y+=o.y,this.instance.getGroupContentArea(i.group).appendChild(t)):this.instance._appendElement(t,this.instance.getContainer()),this.instance.setPosition(t,s),delete n._jsPlumbParentGroup,{id:r,pos:s}}}},{key:"_updateConnectionsForGroup",value:function(t){var e=this;t.connections.source.length=0,t.connections.target.length=0,t.connections.internal.length=0;var n=t.children.slice().map(function(t){return t.el}),i=[];if(x(n,function(t){Array.prototype.push.apply(i,e.instance.getSelector(t,vs))}),Array.prototype.push.apply(n,i),n.length>0){var o,r,s=this.instance.getConnections({source:n,scope:Zo},!0),a=this.instance.getConnections({target:n,scope:Zo},!0),l={},u=function(n){for(var i=0;i<n.length;i++)l[n[i].id]||(l[n[i].id]=!0,o=e.getGroupFor(n[i].source),r=e.getGroupFor(n[i].target),n[i].source===t.el&&r===t||n[i].target===t.el&&o===t?t.connections.internal.push(n[i]):o===t?(r!==t?t.connections.source.push(n[i]):t.connections.internal.push(n[i]),e._connectionSourceMap[n[i].id]=t):r===t&&(t.connections.target.push(n[i]),e._connectionTargetMap[n[i].id]=t))};u(s),u(a)}}},{key:"_collapseConnection",value:function(t,e,n){var i=t.endpoints[0===e?1:0].element;if(i._jsPlumbParentGroup&&!i._jsPlumbParentGroup.proxied&&i._jsPlumbParentGroup.collapsed)return!1;var o=t.endpoints[0].element,r=o._jsPlumbParentGroup,s=null!=r?r.collapseParent||r:null,a=t.endpoints[1].element,l=a._jsPlumbParentGroup,u=null!=l?l.collapseParent||l:null;if(null==s||null==u||s.id!==u.id){var c=n.el;return this.instance.getId(c),this.instance.proxyConnection(t,e,c,function(t,e){return n.getEndpoint(t,e)},function(t,e){return n.getAnchor(t,e)}),!0}return!1}},{key:"_expandConnection",value:function(t,e,n){this.instance.unproxyConnection(t,e)}},{key:"isElementDescendant",value:function(t,e){for(var n=this.instance.getContainer(),i=!1;!i;){if(null==t||t===n)return!1;if(t===e)return!0;t=t.parentNode}}},{key:"collapseGroup",value:function(t){var e=this,n=this.getGroup(t);if(null!=n&&!n.collapsed){var i=n.el;if(null==n.collapseParent){if(this.instance.setGroupVisible(n,!1),n.collapsed=!0,this.instance.removeClass(i,Vr),this.instance.addClass(i,Br),n.proxied){var o=new Set,r=function(t,i){for(var r=0;r<t.length;r++){var s=t[r];e._collapseConnection(s,i,n)===!0&&o.add(s.id)}};r(n.connections.source,0),r(n.connections.target,1),x(n.getGroups(),function(t){e.cascadeCollapse(n,t,o)})}this.instance.revalidate(i),this.repaintGroup(n),this.instance.fire(ts,{group:n})}else n.collapsed=!0,this.instance.removeClass(i,Vr),this.instance.addClass(i,Br)}}},{key:"cascadeCollapse",value:function(t,e,n){var i=this;if(t.proxied){var o=function(e,o){for(var r=0;r<e.length;r++){var s=e[r];n.has(s.id)||i._collapseConnection(s,o,t)===!0&&n.add(s.id)}};o(e.connections.source,0),o(e.connections.target,1)}x(e.getGroups(),function(e){i.cascadeCollapse(t,e,n)})}},{key:"expandGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(null!=i){var o=i.el;if(null==i.collapseParent){if(this.instance.setGroupVisible(i,!0),i.collapsed=!1,this.instance.addClass(o,Vr),this.instance.removeClass(o,Br),i.proxied){var r=function(t,e){for(var o=0;o<t.length;o++){var r=t[o];n._expandConnection(r,e,i)}};r(i.connections.source,0),r(i.connections.target,1);var s=function a(t,e){if(e||t.collapsed){var i=function(e,i){for(var o=0;o<e.length;o++){var r=e[o];n._collapseConnection(r,i,t.collapseParent||t)}};i(t.connections.source,0),i(t.connections.target,1),x(t.connections.internal,function(t){return t.setVisible(!1)}),x(t.getGroups(),function(t){return a(t,!0)})}else n.expandGroup(t,!0)};x(i.getGroups(),s)}this.instance.revalidate(o),this.repaintGroup(i),e||this.instance.fire(es,{group:i})}else i.collapsed=!1,this.instance.addClass(o,Vr),this.instance.removeClass(o,Br)}}},{key:"toggleGroup",value:function(t){t=this.getGroup(t),null!=t&&(t.collapsed?this.expandGroup(t):this.collapseGroup(t))}},{key:"repaintGroup",value:function(t){for(var e=this.getGroup(t),n=e.children,i=0;i<n.length;i++)this.instance.revalidate(n[i].el)}},{key:"addToGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=i.el,r=function(t){var r=t,s=null!=r._isJsPlumbGroup,a=r._jsPlumbGroup,l=r._jsPlumbParentGroup;if(l!==i){var u=n.instance.manage(t),c=n.instance.getOffset(t),h=i.collapsed?n.instance.getOffsetRelativeToRoot(o):n.instance.getOffset(n.instance.getGroupContentArea(i));u.group=i.elId,null!=l&&(l.remove(t,!1,e,!1,i),n._updateConnectionsForGroup(l)),s?i.addGroup(a):i.add(t,e);var d=function(t,e){var o=0===e?1:0;t.each(function(t){t.setVisible(!1),t.endpoints[o].element._jsPlumbGroup===i?(t.endpoints[o].setVisible(!1),n._expandConnection(t,o,i)):(t.endpoints[e].setVisible(!1),n._collapseConnection(t,e,i))})};i.collapsed&&(d(n.instance.select({source:t}),0),d(n.instance.select({target:t}),1)),n.instance.getId(t);var p={x:c.x-h.x,y:c.y-h.y};if(n.instance.setPosition(t,p),n._updateConnectionsForGroup(i),n.instance.revalidate(t),!e){var f={group:i,el:t,pos:p};l&&(f.sourceGroup=l),n.instance.fire(ns,f)}}},s=arguments.length,a=new Array(s>2?s-2:0),l=2;s>l;l++)a[l-2]=arguments[l];x(a,r)}}},{key:"removeFromGroup",value:function(t,e){var n=this,i=this.getGroup(t);if(i){for(var o=function(t){if(i.collapsed){var o=function(e,o){for(var r=0;r<e.length;r++){var s=e[r];if(s.proxies)for(var a=0;a<s.proxies.length;a++)if(null!=s.proxies[a]){var l=s.proxies[a].originalEp.element;(l===t||n.isElementDescendant(l,t))&&n._expandConnection(s,o,i)}}};o(i.connections.source.slice(),0),o(i.connections.target.slice(),1)}i.remove(t,null,e);var r=n.instance.getManagedElements()[n.instance.getId(t)];r&&delete r.group},r=arguments.length,s=new Array(r>2?r-2:0),a=2;r>a;a++)s[a-2]=arguments[a];x(s,o)}}},{key:"getAncestors",value:function(t){for(var e=[],n=t.group;null!=n;)e.push(n),n=n.group;return e}},{key:"isAncestor",value:function(t,e){return null==t||null==e?!1:-1!==this.getAncestors(t).indexOf(e)}},{key:"getDescendants",value:function(t){var e=[],n=function i(t){var n=t.getGroups();e.push.apply(e,Gt(n)),x(n,i)};return n(t),e}},{key:"isDescendant",value:function(t,e){return null==t||null==e?!1:-1!==this.getDescendants(e).indexOf(t)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),t}(),_a=function(){function t(e,n){kt(this,t),this.instance=e,this.entries=n}return St(t,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(t){return x(this.entries,function(e){return t(e)}),this}},{key:"get",value:function(t){return this.entries[t]}},{key:"addClass",value:function(t,e){return this.each(function(n){return n.addClass(t,e)}),this}},{key:"removeClass",value:function(t,e){return this.each(function(n){return n.removeClass(t,e)}),this}},{key:"removeAllOverlays",value:function(){return this.each(function(t){return t.removeAllOverlays()}),this}},{key:"setLabel",value:function(t){return this.each(function(e){return e.setLabel(t)}),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(t){var e=[];return this.each(function(n){return e.push(t(n))}),e}},{key:"addOverlay",value:function(t){return this.each(function(e){return e.addOverlay(t)}),this}},{key:"removeOverlay",value:function(t){return this.each(function(e){return e.removeOverlay(t)}),this}},{key:"removeOverlays",value:function(){return this.each(function(t){return t.removeOverlays()}),this}},{key:"showOverlay",value:function(t){return this.each(function(e){return e.showOverlay(t)}),this}},{key:"hideOverlay",value:function(t){return this.each(function(e){return e.hideOverlay(t)}),this}},{key:"setPaintStyle",value:function(t){return this.each(function(e){return e.setPaintStyle(t)}),this}},{key:"setHoverPaintStyle",value:function(t){return this.each(function(e){return e.setHoverPaintStyle(t)}),this}},{key:"setSuspendEvents",value:function(t){return this.each(function(e){return e.setSuspendEvents(t)}),this}},{key:"setParameter",value:function(t,e){return this.each(function(n){return n.parameters[t]=e}),this}},{key:"setParameters",value:function(t){return this.each(function(e){return e.parameters=t}),this}},{key:"setVisible",value:function(t){return this.each(function(e){return e.setVisible(t)}),this}},{key:"addType",value:function(t){return this.each(function(e){return e.addType(t)}),this}},{key:"toggleType",value:function(t){return this.each(function(e){return e.toggleType(t)}),this}},{key:"removeType",value:function(t){return this.each(function(e){return e.removeType(t)}),this}},{key:"bind",value:function(t,e){return this.each(function(n){return n.bind(t,e)}),this}},{key:"unbind",value:function(t,e){return this.each(function(n){return n.unbind(t,e)}),this}},{key:"setHover",value:function(t){var e=this;return this.each(function(n){return e.instance.setHover(n,t)}),this}}]),t}(),xa=function(t){function e(){return kt(this,e),n.apply(this,arguments)}Tt(e,t);var n=It(e);return St(e,[{key:"setEnabled",value:function(t){return this.each(function(e){return e.enabled=t}),this}},{key:"setAnchor",value:function(t){return this.each(function(e){return e.setAnchor(t)}),this}},{key:"deleteEveryConnection",value:function(){return this.each(function(t){return t.deleteEveryConnection()}),this}},{key:"deleteAll",value:function(){var t=this;return this.each(function(e){return t.instance.deleteEndpoint(e)}),this.clear(),this}}]),e}(_a),Ea=function(t){function e(){return kt(this,e),n.apply(this,arguments)}Tt(e,t);var n=It(e);return St(e,[{key:"setDetachable",value:function(t){return this.each(function(e){return e.setDetachable(t)}),this}},{key:"setReattach",value:function(t){return this.each(function(e){return e.setReattach(t)}),this}},{key:"setConnector",value:function(t){return this.each(function(e){return e.setConnector(t)}),this}},{key:"deleteAll",value:function(){var t=this;this.each(function(e){return t.instance.deleteConnection(e)}),this.clear()}},{key:"repaint",value:function(){var t=this;return this.each(function(e){return t.instance.paintConnection(e)}),this}}]),e}(_a),ba=function kc(){kt(this,kc),Pt(this,"affectedElements",new Set)},ka=function(t,e){var n=0;return e[1]>t[1]?n=-1:e[1]<t[1]&&(n=1),n},Ca=function(t,e){return-1*ka(t,e)},Sa=function(t){function e(t){var i;return kt(this,e),i=n.call(this),i.instance=t,Pt(Ot(i),"_currentTransaction",null),Pt(Ot(i),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),Pt(Ot(i),"_elementMap",new Map),Pt(Ot(i),"_transformedElementMap",new Map),Pt(Ot(i),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),i}Tt(e,t);var n=It(e);return St(e,[{key:"_updateBounds",value:function(t,e,n){null!=e&&(Ae(t,this._sortedElements.xmin),Ae(t,this._sortedElements.xmax),Ae(t,this._sortedElements.ymin),Ae(t,this._sortedElements.ymax),we(t,e.t.x,this._sortedElements.xmin,!1),we(t,e.t.x+e.t.w,this._sortedElements.xmax,!0),we(t,e.t.y,this._sortedElements.ymin,!1),we(t,e.t.y+e.t.h,this._sortedElements.ymax,!0),n!==!0&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var t=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach(function(e,n){t._sortedElements.xmin.push([n,e.t.x]),t._sortedElements.xmax.push([n,e.t.x+e.t.w]),t._sortedElements.ymin.push([n,e.t.y]),t._sortedElements.ymax.push([n,e.t.y+e.t.h])}),this._sortedElements.xmin.sort(ka),this._sortedElements.ymin.sort(ka),this._sortedElements.xmax.sort(Ca),this._sortedElements.ymax.sort(Ca),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(t,e,n){e.t=Te(e.x,e.y,e.w,e.h,e.r),this._transformedElementMap.set(t,e.t),n!==!0&&this._updateBounds(t,e,n)}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new ba}},{key:"endTransaction",value:function(){var t=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach(function(e){var n=t.getPosition(e);t._finaliseUpdate(e,n,!0)}),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(t){var e=this;x(t,function(t){return e.updateElement(t.id,t.x,t.y,t.width,t.height,t.rotation)})}},{key:"updateElement",value:function(t,e,n,i,o,r,s){var a=H(this._elementMap,t,Pe);return a.dirty=null==e&&null==a.x||null==n&&null==a.y||null==i&&null==a.w||null==o&&null==a.h,null!=e&&(a.x=e),null!=n&&(a.y=n),null!=i&&(a.w=i),null!=o&&(a.h=o),null!=r&&(a.r=r||0),a.c.x=a.x+a.w/2,a.c.y=a.y+a.h/2,a.x2=a.x+a.w,a.y2=a.y+a.h,null==this._currentTransaction?this._finaliseUpdate(t,a,s):this._currentTransaction.affectedElements.add(t),a}},{key:"refreshElement",value:function(t,e){var n=this.instance.getManagedElements(),i=n[t]?n[t].el:null;if(null!=i){var o=this.getSize(i),r=this.getOffset(i);return this.updateElement(t,r.x,r.y,o.w,o.h,null,e)}return null}},{key:"getSize",value:function(t){return this.instance.getSize(t)}},{key:"getOffset",value:function(t){return this.instance.getOffset(t)}},{key:"registerElement",value:function(t,e){return this.updateElement(t,0,0,0,0,0,e)}},{key:"addElement",value:function(t,e,n,i,o,r){return this.updateElement(t,e,n,i,o,r)}},{key:"rotateElement",value:function(t,e){var n=H(this._elementMap,t,Pe);return n.r=e||0,this._finaliseUpdate(t,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(t,e,n){return this._elementMap.has(t)?this.updateElement(t,null,null,e,n,null):void 0}},{key:"setPosition",value:function(t,e,n){return this._elementMap.has(t)?this.updateElement(t,e,n,null,null,null):void 0}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(t){Ae(t,this._sortedElements.xmin),Ae(t,this._sortedElements.xmax),Ae(t,this._sortedElements.ymin),Ae(t,this._sortedElements.ymax),this._elementMap["delete"](t),this._transformedElementMap["delete"](t),this._recalculateBounds()}},{key:"getPosition",value:function(t){return this._elementMap.get(t)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]),e}(Vo),Pa=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1;kt(this,t),this.selector=e,this.def=n,this.exclude=i,Pt(this,"id",void 0),this.id=j()}return St(t,[{key:"setEnabled",value:function(t){this.def.enabled=t}},{key:"isEnabled",value:function(){return this.def.enabled!==!1}}]),t}(),Ta="strict",wa="any",Aa=function(t){function e(t,i,o){var r;return kt(this,e),r=n.call(this,t,i,o),r.def=i,Pt(Ot(r),"redrop",void 0),r.redrop=i.def.redrop||Ta,r}Tt(e,t);var n=It(e);return e}(Pa),Da=function(t){function e(t,i,o){var r;return kt(this,e),r=n.call(this,t,i,o),r.def=i,r}Tt(e,t);var n=It(e);return e}(Pa),Oa=(pa={},Pt(pa,Vs,Me),Pt(pa,Us,Oe),Pt(pa,Xs,Oe),Pt(pa,Hs,Me),pa),Ma=function(){function t(e){var n=this;kt(this,t),this.instance=e,Pt(this,"anchorLists",new Map),Pt(this,"anchorLocations",new Map),e.bind(Zr,function(t){n._removeEndpointFromAnchorLists(t.sourceEndpoint),n._removeEndpointFromAnchorLists(t.targetEndpoint)}),e.bind(Kr,function(t){n._removeEndpointFromAnchorLists(t)})}return St(t,[{key:"getAnchorOrientation",value:function(t){var e=this.anchorLocations.get(t.id);return e?[e.ox,e.oy]:[0,0]}},{key:"_distance",value:function(t,e,n,i,o,r,s){var a=i.x+t.x*o.w,l=i.y+t.y*o.h,u=i.x+o.w/2,c=i.y+o.h/2;if(null!=r&&r.length>0){var h=this.instance._applyRotations([a,l,0,0],r);a=h.x,l=h.y}return Math.sqrt(Math.pow(e-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(u-a,2)+Math.pow(c-l,2))}},{key:"_anchorSelector",value:function(t,e,n,i,o,r,s){for(var a=n.x+i.w/2,l=n.y+i.h/2,u=-1,c=1/0,h=0;h<s.length;h++){var d=this._distance(s[h],a,l,t,e,o,r);c>d&&(u=h+0,c=d)}return[u,s[u]]}},{key:"_floatingAnchorCompute",value:function(t,e){var n=e.xy,i={curX:n.x+t.size.w/2,curY:n.y+t.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(t,i)}},{key:"_setComputedPosition",value:function(t,e,n){return this.anchorLocations.set(t.id,e),t.computedPosition=e,n&&(t.timestamp=n),e}},{key:"_computeSingleLocation",value:function(t,e,i,o){var r,s={curX:e.x+t.x*i.w+t.offx,curY:e.y+t.y*i.h+t.offy,x:t.x,y:t.y,ox:0,oy:0},a=o.rotation;if(null!=a&&a.length>0){var l=[t.iox,t.ioy],u={x:s.curX,y:s.curY,cr:0,sr:0};x(a,function(t){u=N(u,t.c,t.r);var e=[Math.round(l[0]*u.cr-l[1]*u.sr),Math.round(l[1]*u.cr+l[0]*u.sr)];l=e.slice()}),t.ox=l[0],t.oy=l[1],r={curX:u.x,curY:u.y,x:t.x,y:t.y,ox:l[0],oy:l[1]}}else t.ox=t.iox,t.oy=t.ioy,r=n({ox:t.iox,oy:t.ioy},s);return r}},{key:"_singleAnchorCompute",value:function(t,e){var n=e.xy,i=e.wh,o=e.timestamp,r=this.anchorLocations.get(t.id);if(null!=r&&o&&o===t.timestamp)return r;var s=Le(t),a=Lt(s,2);a[0];var l=a[1];return r=this._computeSingleLocation(l,n,i,e),this._setComputedPosition(t,r,o)}},{key:"_defaultAnchorCompute",value:function(t,e){var n;if(1===t.locations.length)return this._singleAnchorCompute(t,e);var i=e.xy,o=e.wh,r=e.txy,s=e.twh,a=Le(t),l=Lt(a,2),u=l[0],c=l[1];if(t.locked||null==r||null==s)n=this._computeSingleLocation(c,i,o,e);else{var h=this._anchorSelector(i,o,r,s,e.rotation,e.tRotation,t.locations),d=Lt(h,2),p=d[0],f=d[1];t.currentLocation=p,p!==u&&(t.cssClass=f.cls||t.cssClass,e.element._anchorLocationChanged(t)),n=this._computeSingleLocation(f,i,o,e)}return this._setComputedPosition(t,n,e.timestamp)}},{key:"_placeAnchors",value:function(t,e){var n=this,i=this.instance.viewport.getPosition(t),o=function(e,o,r,s,a,l){if(r.length>0)for(var u=r.sort(Oa[e]),c=e===Us||e===Vs,h=De(i,u,s,a,c),d=0;d<h.length;d++){var p=h[d].c,f=p.endpoints[0].elementId===t,v=f?p.endpoints[0]:p.endpoints[1];n._setComputedPosition(v._anchor,{curX:h[d].x,curY:h[d].y,x:h[d].xLoc,y:h[d].yLoc,ox:l[0],oy:l[1]})}};o(Xs,i,e.bottom,!0,1,[0,1]),o(Vs,i,e.top,!0,0,[0,-1]),o(Hs,i,e.left,!1,0,[-1,0]),o(Us,i,e.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(t,e,n,i,o,r,s,a,l,u,c){var h,d=i.endpoints[s],p=d.id,f=[1,0][s],v={theta:e,order:n,c:i,b:o,elId:r,epId:p},y=t[l],g=d._continuousAnchorEdge?t[d._continuousAnchorEdge]:null;if(g){var m=E(g,function(t){return t.epId===p});if(-1!==m){g.splice(m,1);for(var _=0;_<g.length;_++)h=g[_].c,h.placeholder!==!0&&u.add(h),c.add(g[_].c.endpoints[s]),c.add(g[_].c.endpoints[f])}}for(var x=0;x<y.length;x++)h=y[x].c,h.placeholder!==!0&&u.add(h),c.add(y[x].c.endpoints[s]),c.add(y[x].c.endpoints[f]);var b=a?0:y.length;y.splice(b,0,v),d._continuousAnchorEdge=l}},{key:"_removeEndpointFromAnchorLists",value:function(t){var e=this.anchorLists.get(t.elementId),n=0;!function(t,e){if(t){var i=function(t){return t.epId===e};T(t.top,i),T(t.left,i),T(t.bottom,i),T(t.right,i),n+=t.top.length,n+=t.left.length,n+=t.bottom.length,n+=t.right.length}}(e,t.id),0===n&&this.anchorLists["delete"](t.elementId),this.anchorLocations["delete"](t._anchor.id)}},{key:"computeAnchorLocation",value:function(t,e){var n;return n=Ie(t)?this.anchorLocations.get(t.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:je(t)?this._floatingAnchorCompute(t,e):this._defaultAnchorCompute(t,e),t.timestamp=e.timestamp,n}},{key:"computePath",value:function(t,e){var n=this.instance.viewport.getPosition(t.sourceId),i=this.instance.viewport.getPosition(t.targetId),o=t.endpoints[0],r=t.endpoints[1],s=this.getEndpointLocation(o,{xy:n,wh:n,element:o,timestamp:e,rotation:this.instance._getRotations(t.sourceId)}),a=this.getEndpointLocation(r,{xy:i,wh:i,element:r,timestamp:e,rotation:this.instance._getRotations(t.targetId)});t.connector.resetBounds(),t.connector.compute({sourcePos:s,targetPos:a,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1],strokeWidth:t.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function(t,e){e=e||{};var n=t._anchor,i=this.anchorLocations.get(n.id);return(null==i||null!=e.timestamp&&n.timestamp!==e.timestamp)&&(i=this.computeAnchorLocation(n,e),this._setComputedPosition(n,i,e.timestamp)),i}},{key:"getEndpointOrientation",value:function(t){return t._anchor?this.getAnchorOrientation(t._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(t,e){var n=this.anchorLocations.get(t.id);null!=n&&(n.ox=e[0],n.oy=e[1])}},{key:"isDynamicAnchor",value:function(t){return t._anchor?!Ie(t._anchor)&&t._anchor.locations.length>1:!1}},{key:"isFloating",value:function(t){return t._anchor?je(t._anchor):!1}},{key:"prepareAnchor",value:function(t,e){return ye(e)}},{key:"redraw",value:function(t,e,n){var i=this,o=new Set,r=new Set,s=new Set;if(!this.instance._suspendDrawing){var a=this.instance.endpointsByElement[t]||[];e=e||j();for(var l,u,c={},h=0;h<a.length;h++)if(u=a[h],r.add(u),l=u._anchor,0===u.connections.length)Ie(l)&&(this.anchorLists.has(t)||this.anchorLists.set(t,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(t),-Math.PI/2,0,{endpoints:[u,u],placeholder:!0},!1,t,0,!1,re(l),o,r),s.add(t));else for(var d=0;d<u.connections.length;d++){var p=u.connections[d],f=p.sourceId,v=p.targetId,y=Ie(p.endpoints[0]._anchor),g=Ie(p.endpoints[1]._anchor);if(y||g){var m=(p.endpoints[0]._anchor.faces||[]).join("-"),_=(p.endpoints[1]._anchor.faces||[]).join("-"),x=[f,m,v,_].join("-"),E=c[x],b=p.sourceId===t?1:0;y&&!this.anchorLists.has(f)&&this.anchorLists.set(f,{top:[],right:[],bottom:[],left:[]}),g&&!this.anchorLists.has(v)&&this.anchorLists.set(v,{top:[],right:[],bottom:[],left:[]});var k=this.instance.viewport.getPosition(v),C=this.instance.viewport.getPosition(f);if(v===f&&(y||g))this._updateAnchorList(this.anchorLists.get(f),-Math.PI/2,0,p,!1,v,0,!1,Vs,o,r),this._updateAnchorList(this.anchorLists.get(v),-Math.PI/2,0,p,!1,f,1,!1,Vs,o,r);else{var S=this.instance._getRotations(f),P=this.instance._getRotations(v);E||(E=this._calculateOrientation(f,v,C,k,p.endpoints[0]._anchor,p.endpoints[1]._anchor,S,P),c[x]=E),y&&this._updateAnchorList(this.anchorLists.get(f),E.theta,0,p,!1,v,0,!1,E.a[0],o,r),g&&this._updateAnchorList(this.anchorLists.get(v),E.theta2,-1,p,!0,f,1,!0,E.a[1],o,r)}y&&s.add(f),g&&s.add(v),o.add(p),(y&&0===b||g&&1===b)&&r.add(p.endpoints[b])}else{var T=u.connections[d].endpoints[p.sourceId===t?1:0],w=T._anchor;if(Ne(w)){this.instance.paintEndpoint(T,{elementWithPrecedence:t,timestamp:e}),o.add(u.connections[d]);for(var A=0;A<T.connections.length;A++)T.connections[A]!==u.connections[d]&&o.add(T.connections[A])}else o.add(u.connections[d])}}s.forEach(function(t){i._placeAnchors(t,i.anchorLists.get(t))}),r.forEach(function(t){var n=i.instance.viewport.getPosition(t.elementId);i.instance.paintEndpoint(t,{timestamp:e,offset:n})}),o.forEach(function(t){i.instance.paintConnection(t,{timestamp:e})})}return{c:o,e:r}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(t,e){null!=e&&(t._anchor=e)}},{key:"setConnectionAnchors",value:function(t,e){t.endpoints[0]._anchor=e[0],t.endpoints[1]._anchor=e[1]}},{key:"_calculateOrientation",value:function(t,e,n,i,o,r,s,a){var l=this,u={HORIZONTAL:"horizontal",VERTICAL:"vertical",DIAGONAL:"diagonal",IDENTITY:"identity"};if(t===e)return{orientation:u.IDENTITY,a:[Vs,Vs]};var c=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),h=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),d=[],p={};!function(t,e){for(var n=0;n<t.length;n++){var i;if(p[t[n]]=(i={},Pt(i,Hs,{x:e[n][0].x,y:e[n][0].c.y}),Pt(i,Us,{x:e[n][0].x+e[n][0].w,y:e[n][0].c.y}),Pt(i,Vs,{x:e[n][0].c.x,y:e[n][0].y}),Pt(i,Xs,{x:e[n][0].c.x,y:e[n][0].y+e[n][0].h}),i),null!=e[n][1]&&e[n][1].length>0)for(var o in p[t[n]])p[t[n]][o]=l.instance._applyRotationsXY(p[t[n]][o],e[n][1])}}([fr,vr],[[n,s],[i,a]]);for(var f=[Vs,Hs,Us,Xs],v=0;v<f.length;v++)for(var y=0;y<f.length;y++)d.push({source:f[v],target:f[y],dist:st(p.source[f[v]],p.target[f[y]])});d.sort(function(t,e){if(t.dist<e.dist)return-1;if(e.dist<t.dist)return 1;var n,i=(n={},Pt(n,Hs,0),Pt(n,Vs,1),Pt(n,Us,2),Pt(n,Xs,3),n),o=i[t.source],r=i[e.source],s=i[t.target],a=i[e.target];return r>o?-1:o>r?1:a>s?-1:s>a?1:0});for(var g=d[0].source,m=d[0].target,_=0;_<d.length&&(g=Ie(o)&&o.locked?o.currentFace:!o.isContinuous||ue(o,d[_].source)?d[_].source:null,m=r.isContinuous&&r.locked?r.currentFace:!r.isContinuous||ue(r,d[_].target)?d[_].target:null,null==g||null==m);_++);return o.isContinuous&&this.setCurrentFace(o,g),r.isContinuous&&this.setCurrentFace(r,m),{a:[g,m],theta:c,theta2:h}}},{key:"setCurrentFace",value:function(t,e,n){t.currentFace=e,n&&null!=t.lockedFace&&(t.lockedFace=t.currentFace)}},{key:"lock",value:function(t){t.locked=!0,Ie(t)&&(t.lockedFace=t.currentFace)}},{key:"unlock",value:function(t){t.locked=!1,Ie(t)&&(t.lockedFace=null)}},{key:"selectAnchorLocation",value:function(t,e){var n=E(t.locations,function(t){return t.x===e.x&&t.y===e.y});return-1!==n?(t.currentLocation=n,!0):!1}},{key:"lockCurrentAxis",value:function(t){null!=t.currentFace&&(t.lockedAxis=t.currentFace===Hs||t.currentFace===Us?Ys:zs)}},{key:"unlockCurrentAxis",value:function(t){t.lockedAxis=null}},{key:"anchorsEqual",value:function(t,e){if(!t||!e)return!1;var n=t.locations[t.currentLocation],i=e.locations[e.currentLocation];return n.x===i.x&&n.y===i.y&&n.offx===i.offx&&n.offy===i.offy&&n.ox===i.ox&&n.oy===i.oy}}]),t}(),Ia=function(i){function r(e,i){var o;return kt(this,r),o=s.call(this),o._instanceIndex=e,Pt(Ot(o),"defaults",void 0),Pt(Ot(o),"_initialDefaults",{}),Pt(Ot(o),"isConnectionBeingDragged",!1),Pt(Ot(o),"currentlyDragging",!1),Pt(Ot(o),"hoverSuspended",!1),Pt(Ot(o),"_suspendDrawing",!1),Pt(Ot(o),"_suspendedAt",null),Pt(Ot(o),"connectorClass",Or),Pt(Ot(o),"connectorOutlineClass",Mr),Pt(Ot(o),"connectedClass",Ir),Pt(Ot(o),"endpointClass",jr),Pt(Ot(o),"endpointConnectedClass",Nr),Pt(Ot(o),"endpointFullClass",Lr),Pt(Ot(o),"endpointDropAllowedClass",Gr),Pt(Ot(o),"endpointDropForbiddenClass",Rr),Pt(Ot(o),"endpointAnchorClassPrefix",Fr),Pt(Ot(o),"overlayClass",Hr),Pt(Ot(o),"connections",[]),Pt(Ot(o),"endpointsByElement",{}),Pt(Ot(o),"endpointsByUUID",new Map),Pt(Ot(o),"sourceSelectors",[]),Pt(Ot(o),"targetSelectors",[]),Pt(Ot(o),"allowNestedGroups",void 0),Pt(Ot(o),"_curIdStamp",1),Pt(Ot(o),"viewport",new Sa(Ot(o))),Pt(Ot(o),"router",void 0),Pt(Ot(o),"groupManager",void 0),Pt(Ot(o),"_connectionTypes",new Map),Pt(Ot(o),"_endpointTypes",new Map),Pt(Ot(o),"_container",void 0),Pt(Ot(o),"_managedElements",{}),Pt(Ot(o),"DEFAULT_SCOPE",void 0),Pt(Ot(o),"_zoom",1),o.defaults={anchor:t.AnchorLocations.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:hr.type,container:null,endpoint:ir.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},i&&n(o.defaults,i),n(o._initialDefaults,o.defaults),o.DEFAULT_SCOPE=o.defaults.scope,o.allowNestedGroups=o._initialDefaults.allowNestedGroups!==!1,o.router=new Ma(Ot(o)),o.groupManager=new ma(Ot(o)),o.setContainer(o._initialDefaults.container),o}Tt(r,i);var s=It(r);return St(r,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(t){return null!=t&&null!=t[0]&&null!=t[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(t,e){return this._zoom=t,this.fire(us,this._zoom),e&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(t,e){var n=this.getListener(t),i=!0;if(n&&n.length>0){var o=Array.prototype.slice.call(arguments,1);try{for(var r=0,s=n.length;s>r;r++)i=i&&n[r].apply(n[r],o)}catch(a){B("cannot check condition ["+t+"]"+a)}}return i}},{key:"getId",value:function(t,e){if(null==t)return null;var n=this.getAttribute(t,Cr);return n&&"undefined"!==n||(2===arguments.length&&void 0!==arguments[1]?n=e:(1===arguments.length||3===arguments.length&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(t,Cr,n)),n}},{key:"getConnections",
value:function(t,n){t?t.constructor===String&&(t={scope:t}):t={};for(var i=t.scope||this.defaultScope,o=Re(this,i,!0),r=Re(this,t.source),s=Re(this,t.target),a=!n&&o.length>1?{}:[],l=function(t,e){if(!n&&o.length>1){var i=a[t];null==i&&(i=a[t]=[]),i.push(e)}else a.push(e)},u=0,c=this.connections.length;c>u;u++){var h=this.connections[u],d=h.proxies&&h.proxies[0]?h.proxies[0].originalEp.elementId:h.sourceId,p=h.proxies&&h.proxies[1]?h.proxies[1].originalEp.elementId:h.targetId;e(o,h.scope)&&e(r,d)&&e(s,p)&&l(h.scope,h)}return a}},{key:"select",value:function(t){return t=t||{},t.scope=t.scope||"*",new Ea(this,t.connections||this.getConnections(t,!0))}},{key:"selectEndpoints",value:function(t){t=t||{},t.scope=t.scope||Zo;var n=!t.element&&!t.source&&!t.target,i=n?Zo:Re(this,t.element),o=n?Zo:Re(this,t.source),r=n?Zo:Re(this,t.target),s=Re(this,t.scope,!0),a=[];for(var l in this.endpointsByElement){var u=e(i,l,!0),c=e(o,l,!0),h="*"!==o,d=e(r,l,!0),p="*"!==r;if(u||c||d)t:for(var f=0,v=this.endpointsByElement[l].length;v>f;f++){var y=this.endpointsByElement[l][f];if(e(s,y.scope,!0)){var g=h&&o.length>0&&!y.isSource,m=p&&r.length>0&&!y.isTarget;if(g||m)continue t;a.push(y)}}}return new xa(this,a)}},{key:"setContainer",value:function(t){this._container=t,this.fire(qr,this._container)}},{key:"_set",value:function(t,e,n){var i,o,r=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}],s=r[n],a=t[s.elId],l=t.endpoints[n],u={index:n,originalEndpoint:l,originalSourceId:0===n?a:t.sourceId,newSourceId:t.sourceId,originalTargetId:1===n?a:t.targetId,newTargetId:t.targetId,connection:t,newEndpoint:l};return e instanceof va?(i=e,i.addConnection(t)):(o=this.getId(e),i=o===t[s.elId]?null:t.makeEndpoint(0===n,e,o)),null!=i&&(u.newEndpoint=i,l.detachFromConnection(t),t.endpoints[n]=i,t[s.el]=i.element,t[s.elId]=i.elementId,u[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(u),this.paintConnection(t)),u}},{key:"setSource",value:function(t,e){He(t,this._managedElements[t.sourceId]);var n=this._set(t,e,0);Ve(t,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(t,e){He(t,this._managedElements[t.targetId]);var n=this._set(t,e,1);Ve(t,this._managedElements[n.newTargetId])}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(t,e){var n=this._suspendDrawing;return this._suspendDrawing=t,t?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),e&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(t,e){var n=this._suspendDrawing===!0;n||this.setSuspendDrawing(!0),t(),n||this.setSuspendDrawing(!1,!e)}},{key:"each",value:function(t,e){if(null!=t){if(null!=t.length)for(var n=0;n<t.length;n++)e(t[n]);else e(t);return this}}},{key:"updateOffset",value:function(t){var e=t.elId;return t.recalc?this.viewport.refreshElement(e):this.viewport.getPosition(e)}},{key:"deleteConnection",value:function(t,e){if(null!=t&&t.deleted!==!0&&(e=e||{},e.force||m(!0,!1,[[t.endpoints[0],cs,[t]],[t.endpoints[1],cs,[t]],[t,cs,[t]],[this,Ar,[ps,t]]]))){He(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this.fireDetachEvent(t,!t.pending&&e.fireEvent!==!1,e.originalEvent);var n=t.endpoints[0],i=t.endpoints[1];return n!==e.endpointToIgnore&&n.detachFromConnection(t,null,!0),i!==e.endpointToIgnore&&i.detachFromConnection(t,null,!0),T(this.connections,function(e){return t.id===e.id}),t.destroy(),n!==e.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==e.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0}return!1}},{key:"deleteEveryConnection",value:function(t){var e=this;t=t||{};var n=this.connections.length,i=0;return this.batch(function(){for(var o=0;n>o;o++)i+=e.deleteConnection(e.connections[0],t)?1:0}),i}},{key:"deleteConnectionsForElement",value:function(t,e){var n=this.getId(t),i=this._managedElements[n];if(i)for(var o=i.connections.length,r=0;o>r;r++)this.deleteConnection(i.connections[0],e);return this}},{key:"fireDetachEvent",value:function(t,e,n){var i=null!=t.id,o=i?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t;e&&this.fire(zr,o,n),this.fire(Zr,o,n)}},{key:"fireMoveEvent",value:function(t,e){this.fire(Wr,t,e)}},{key:"manageAll",value:function(t,e){for(var n=o(t)?this.getSelector(this.getContainer(),t):t,i=0;i<n.length;i++)this.manage(n[i],null,e)}},{key:"manage",value:function(t,e,n){null==this.getAttribute(t,Cr)&&(e=e||this.getAttribute(t,"id")||j(),this.setAttribute(t,Cr,e));var i=this.getId(t);if(this._managedElements[i])n&&(this._managedElements[i].viewportElement=this.updateOffset({elId:i,timestamp:null,recalc:!0}));else{var o={el:t,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[i]=o,this._suspendDrawing?o.viewportElement=this.viewport.registerElement(i,!0):o.viewportElement=this.updateOffset({elId:i,recalc:!0}),this.fire($r,{el:t})}return this._managedElements[i]}},{key:"getManagedData",value:function(t,e,n){if(this._managedElements[t]){var i=this._managedElements[t].data[e];return null!=i?i[n]:null}}},{key:"setManagedData",value:function(t,e,n,i){this._managedElements[t]&&(this._managedElements[t].data[e]=this._managedElements[t].data[e]||{},this._managedElements[t].data[e][n]=i)}},{key:"getManagedElement",value:function(t){return this._managedElements[t]?this._managedElements[t].el:null}},{key:"unmanage",value:function(t,e){var n=this;this.removeAllEndpoints(t,!0);var i=function(t){var i=n.getId(t);n.removeAttribute(t,Cr),delete n._managedElements[i],n.viewport.remove(i),n.fire(ls,{el:t}),t&&e&&n._removeElement(t)};this._getAssociatedElements(t).map(i),i(t)}},{key:"rotate",value:function(t,e,n){var i=this.getId(t);return this._managedElements[i]&&(this._managedElements[i].rotation=e,this.viewport.rotateElement(i,e),n!==!0)?this.revalidate(t):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(t){var e=this._managedElements[t];return null!=e?e.rotation||0:0}},{key:"_getRotations",value:function(t){var e=this,n=[],i=this._managedElements[t],o=function r(t){if(null!=t.group){var i=e._managedElements[t.group];null!=i&&(n.push({r:i.viewportElement.r,c:i.viewportElement.c}),r(i))}};return null!=i&&(n.push({r:i.viewportElement.r||0,c:i.viewportElement.c}),o(i)),n}},{key:"_applyRotations",value:function(t,e){var n=t.slice(),i={x:n[0],y:n[1],cr:0,sr:0};return x(e,function(t){i=N(i,t.c,t.r)}),i}},{key:"_applyRotationsXY",value:function(t,e){return x(e,function(e){t=N(t,e.c,e.r)}),t}},{key:"_internal_newEndpoint",value:function(t){var e=n({},t),i=this.manage(e.element);e.elementId=this.getId(e.element),e.id="ep_"+this._idstamp();var o=new va(this,e);return Fe(i,o),t.uuid&&this.endpointsByUUID.set(t.uuid,o),O(this.endpointsByElement,o.elementId,o),this._suspendDrawing||this.paintEndpoint(o,{timestamp:this._suspendedAt}),o}},{key:"_deriveEndpointAndAnchorSpec",value:function(t,e){for(var n=((e?"":"default ")+t).split(/[\s]/),i=null,o=null,r=null,s=null,a=0;a<n.length;a++){var l=this.getConnectionType(n[a]);l&&(l.endpoints&&(i=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(s=l.anchors),l.anchor&&(r=l.anchor))}return{endpoints:i?i:[o,o],anchors:s?s:[r,r]}}},{key:"revalidate",value:function(t,e){var n=this.getId(t);return this.updateOffset({elId:n,recalc:!0,timestamp:e}),this.repaint(t)}},{key:"repaintEverything",value:function(){var t,e=j();for(t in this._managedElements)this.viewport.refreshElement(t,!0);this.viewport.recomputeBounds();for(t in this._managedElements)this.repaint(this._managedElements[t].el,e,!0);return this}},{key:"setElementPosition",value:function(t,e,n){var i=this.getId(t);return this.viewport.setPosition(i,e,n),this.repaint(t)}},{key:"repaint",value:function(t,e,n){var i={c:new Set,e:new Set},o=function(t){t.c.forEach(function(t){return i.c.add(t)}),t.e.forEach(function(t){return i.e.add(t)})};if(!this._suspendDrawing){var r=this.getId(t);if(null!=t){var s=this._getAssociatedElements(t);if(null==e&&(e=j()),!n)for(var a=0;a<s.length;a++)this.updateOffset({elId:this.getId(s[a]),recalc:!0,timestamp:e});if(o(this.router.redraw(r,e,null)),s.length>0)for(var l=0;l<s.length;l++)o(this.router.redraw(this.getId(s[l]),e,null))}}return i}},{key:"unregisterEndpoint",value:function(t){var e=t.getUuid();e&&this.endpointsByUUID["delete"](e),Be(this._managedElements[t.elementId],t);for(var n in this.endpointsByElement){var i=this.endpointsByElement[n];if(i){for(var o=[],r=0,s=i.length;s>r;r++)i[r]!==t&&o.push(i[r]);this.endpointsByElement[n]=o}this.endpointsByElement[n].length<1&&delete this.endpointsByElement[n]}this.fire(Kr,t)}},{key:"_maybePruneEndpoint",value:function(t){return t.deleteOnEmpty&&0===t.connections.length?(this.deleteEndpoint(t),!0):!1}},{key:"deleteEndpoint",value:function(t){var e=this,n="string"==typeof t?this.endpointsByUUID.get(t):t;if(n){var i=n.proxiedBy,o=n.connections.slice();x(o,function(t){n.detachFromConnection(t,null,!0)}),this.unregisterEndpoint(n),n.destroy(),x(o,function(t){e.deleteConnection(t,{force:!0,endpointToIgnore:n})}),null!=i&&this.deleteEndpoint(i)}return this}},{key:"addEndpoint",value:function(t,e,i){i=i||{};var o=n({},i);n(o,e||{});var r=n({element:t},o);return this._internal_newEndpoint(r)}},{key:"addEndpoints",value:function(t,e,n){for(var i=[],o=0,r=e.length;r>o;o++)i.push(this.addEndpoint(t,e[o],n));return i}},{key:"reset",value:function(){var t=this;this.silently(function(){t.endpointsByElement={},t._managedElements={},t.endpointsByUUID.clear(),t.viewport.reset(),t.router.reset(),t.groupManager.reset(),t.connections.length=0})}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(t){return this.endpointsByElement[this.getId(t)]||[]}},{key:"getEndpoint",value:function(t){return this.endpointsByUUID.get(t)}},{key:"setEndpointUuid",value:function(t,e){t.uuid&&this.endpointsByUUID["delete"](t.uuid),t.uuid=e,this.endpointsByUUID.set(e,t)}},{key:"connect",value:function(t,e){try{var n=this._prepareConnectionParams(t,e),i=this._newConnection(n);return this._finaliseConnection(i,n),i}catch(o){return void B(o)}}},{key:"_prepareConnectionParams",value:function(t,e){var i=n({},t);e&&n(i,e);var o=i;if(o.source&&o.source.endpoint&&(o.sourceEndpoint=o.source),o.target&&o.target.endpoint&&(o.targetEndpoint=o.target),t.uuids&&(o.sourceEndpoint=this.getEndpoint(t.uuids[0]),o.targetEndpoint=this.getEndpoint(t.uuids[1])),null!=o.sourceEndpoint){if(o.sourceEndpoint.isFull())throw ys;if(o.type||(o.type=o.sourceEndpoint.edgeType),o.sourceEndpoint.connectorOverlays){o.overlays=o.overlays||[];for(var r=0,s=o.sourceEndpoint.connectorOverlays.length;s>r;r++)o.overlays.push(o.sourceEndpoint.connectorOverlays[r])}o.sourceEndpoint.scope&&(o.scope=o.sourceEndpoint.scope)}else if(null==o.source)throw ms;if(null!=o.targetEndpoint){if(o.targetEndpoint.isFull())throw gs}else if(null==o.target)throw _s;if(o.sourceEndpoint&&o.targetEndpoint&&!Ge(o.sourceEndpoint,o.targetEndpoint))throw"Cannot establish connection: scopes do not match";return o}},{key:"_newConnection",value:function(t){t.id="con_"+this._idstamp();var e=new da(this,t);return Ve(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.paintConnection(e),e}},{key:"_finaliseConnection",value:function(t,e,n){e=e||{},t.suspendedEndpoint||this.connections.push(t),t.pending=null,t.endpoints[0].isTemporarySource=!1,this.repaint(t.source);var i={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]};this.fire(Yr,i,n),e.doNotFireConnectionEvent||e.fireEvent===!1||this.fire(Xr,i,n)}},{key:"removeAllEndpoints",value:function(t,e){var n=this,i=function(t){var e,i,o=n.getId(t),r=n.endpointsByElement[o];if(r)for(e=0,i=r.length;i>e;e++)n.deleteEndpoint(r[e]);delete n.endpointsByElement[o]};return e&&this._getAssociatedElements(t).map(i),i(t),this}},{key:"_createSourceDefinition",value:function(t,e){var i=n({},e);n(i,t),i.edgeType=i.edgeType||qo;var o=this._deriveEndpointAndAnchorSpec(i.edgeType);i.endpoint=i.endpoint||o.endpoints[0],i.anchor=i.anchor||o.anchors[0];var r=i.maxConnections||-1,s={def:n({},i),uniqueEndpoint:i.uniqueEndpoint,maxConnections:r,enabled:!0,endpoint:null};return s}},{key:"addSourceSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1,i=this._createSourceDefinition(e),o=new Aa(t,i,n);return this.sourceSelectors.push(o),o}},{key:"removeSourceSelector",value:function(t){T(this.sourceSelectors,function(e){return e===t})}},{key:"removeTargetSelector",value:function(t){T(this.targetSelectors,function(e){return e===t})}},{key:"addTargetSelector",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1,i=this._createTargetDefinition(e),o=new Da(t,i,n);return this.targetSelectors.push(o),o}},{key:"_createTargetDefinition",value:function(t,e){var i=n({},e);n(i,t),i.edgeType=i.edgeType||qo;var o=i.maxConnections||-1,r={def:n({},i),uniqueEndpoint:i.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null};return r}},{key:"show",value:function(t,e){return this._setVisible(t,yr,e)}},{key:"hide",value:function(t,e){return this._setVisible(t,gr,e)}},{key:"_setVisible",value:function(t,e,n){var i=e===yr,o=null;n&&(o=function(t){t.setVisible(i,!0,!0)});var r=this.getId(t);return this._operation(t,function(t){if(i&&n){var e=t.sourceId===r?1:0;t.endpoints[e].isVisible()&&t.setVisible(!0)}else t.setVisible(i)},o),this}},{key:"toggleVisible",value:function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),this._operation(t,function(t){var e=t.isVisible();t.setVisible(!e)},n)}},{key:"_operation",value:function(t,e,n){var i=this.getId(t),o=this.endpointsByElement[i];if(o&&o.length)for(var r=0,s=o.length;s>r;r++){for(var a=0,l=o[r].connections.length;l>a;a++){var u=e(o[r].connections[a]);if(u)return}n&&n(o[r])}}},{key:"registerConnectionType",value:function(t,e){if(this._connectionTypes.set(t,n({},e)),e.overlays){for(var i={},o=0;o<e.overlays.length;o++){var r=Kt(e.overlays[o]);i[r.options.id]=r}this._connectionTypes.get(t).overlays=i}}},{key:"registerConnectionTypes",value:function(t){for(var e in t)this.registerConnectionType(e,t[e])}},{key:"registerEndpointType",value:function(t,e){if(this._endpointTypes.set(t,n({},e)),e.overlays){for(var i={},o=0;o<e.overlays.length;o++){var r=Kt(e.overlays[o]);i[r.options.id]=r}this._endpointTypes.get(t).overlays=i}}},{key:"registerEndpointTypes",value:function(t){for(var e in t)this.registerEndpointType(e,t[e])}},{key:"getType",value:function(t,e){return"connection"===e?this.getConnectionType(t):this.getEndpointType(t)}},{key:"getConnectionType",value:function(t){return this._connectionTypes.get(t)}},{key:"getEndpointType",value:function(t){return this._endpointTypes.get(t)}},{key:"importDefaults",value:function(t){for(var e in t)this.defaults[e]=t[e];return t.container&&this.setContainer(t.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=n({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(t,e,n,i,o){var r,s=null!=t.proxies[e],a=s?t.proxies[e].originalEp.elementId:t.endpoints[e].elementId,l=s?t.proxies[e].originalEp:t.endpoints[e],u=this.getId(n);t.proxies[e]?t.proxies[e].ep.elementId===u?r=t.proxies[e].ep:(t.proxies[e].ep.detachFromConnection(t,e),r=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}})):r=this._internal_newEndpoint({element:n,endpoint:i(t,e),anchor:o(t,e),parameters:{isProxyEndpoint:!0}}),r.deleteOnEmpty=!0,t.proxies[e]={ep:r,originalEp:l},this.sourceOrTargetChanged(a,u,t,n,e),l.detachFromConnection(t,null,!0),r.connections=[t],t.endpoints[e]=r,l.proxiedBy=r,l.setVisible(!1),t.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(t,e){if(null!=t.proxies&&null!=t.proxies[e]){var n=t.proxies[e].originalEp.element,i=t.proxies[e].originalEp.elementId,o=t.proxies[e].ep.elementId;t.endpoints[e]=t.proxies[e].originalEp,delete t.proxies[e].originalEp.proxiedBy,this.sourceOrTargetChanged(o,i,t,n,e),t.proxies[e].ep.detachFromConnection(t,null),t.proxies[e].originalEp.addConnection(t),t.isVisible()&&t.proxies[e].originalEp.setVisible(!0),t.proxies[e]=null,-1===E(t.proxies,function(t){return null!=t})&&(t.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(t,e,n,i,o){t!==e&&(0===o?(n.sourceId=e,n.source=i):1===o&&(n.targetId=e,n.target=i),He(n,this._managedElements[t]),Ve(n,this._managedElements[e]))}},{key:"getGroup",value:function(t){return this.groupManager.getGroup(t)}},{key:"getGroupFor",value:function(t){return this.groupManager.getGroupFor(t)}},{key:"addGroup",value:function(t){return this.groupManager.addGroup(t)}},{key:"addToGroup",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;n>o;o++)i[o-1]=arguments[o];return(e=this.groupManager).addToGroup.apply(e,[t,!1].concat(i))}},{key:"collapseGroup",value:function(t){this.groupManager.collapseGroup(t)}},{key:"expandGroup",value:function(t){this.groupManager.expandGroup(t)}},{key:"toggleGroup",value:function(t){this.groupManager.toggleGroup(t)}},{key:"removeGroup",value:function(t,e,n,i){return this.groupManager.removeGroup(t,e,n,i)}},{key:"removeAllGroups",value:function(t,e){this.groupManager.removeAllGroups(t,e,!1)}},{key:"removeFromGroup",value:function(t,e,n){this.groupManager.removeFromGroup(t,n,e),this._appendElement(e,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(e)})}},{key:"paintEndpoint",value:function(t,e){function n(t){var n=0;if(null!=e.elementWithPrecedence)for(var i=0;i<t.connections.length;i++)if(t.connections[i].sourceId===e.elementWithPrecedence||t.connections[i].targetId===e.elementWithPrecedence){n=i;break}return t.connections[n]}e=e||{};var i=e.timestamp,o=!(e.recalc===!1);if(!i||t.timestamp!==i){var r=this.viewport.getPosition(t.elementId),s=e.offset?{x:e.offset.x,y:e.offset.y}:{x:r.x,y:r.y};if(null!=s){var a=e.anchorLoc;if(null==a){var l={xy:s,wh:r,element:t,timestamp:i};if(o&&this.router.isDynamicAnchor(t)&&t.connections.length>0){var u=n(t),c=u.endpoints[0]===t?1:0,h=0===c?u.sourceId:u.targetId,d=this.viewport.getPosition(h);l.index=0===c?1:0,l.connection=u,l.txy=d,l.twh=d,l.tElement=u.endpoints[c],l.tRotation=this._getRotations(h)}else t.connections.length>0&&(l.connection=t.connections[0]);l.rotation=this._getRotations(t.elementId),a=this.router.computeAnchorLocation(t._anchor,l)}t.endpoint.compute(a,this.router.getEndpointOrientation(t),t.paintStyleInUse),this.renderEndpoint(t,t.paintStyleInUse),t.timestamp=i;for(var p in t.overlays)if(t.overlays.hasOwnProperty(p)){var f=t.overlays[p];f.isVisible()&&(t.overlayPlacements[p]=this.drawOverlay(f,t.endpoint,t.paintStyleInUse,t.getAbsoluteOverlayPosition(f)),this.paintOverlay(f,t.overlayPlacements[p],{xmin:0,ymin:0}))}}}}},{key:"paintConnection",value:function(t,e){if(!this._suspendDrawing&&t.visible!==!1){e=e||{};var n=e.timestamp;if(null!=n&&n===t.lastPaintedAt)return;if(null==n||n!==t.lastPaintedAt){this.router.computePath(t,n);var i={xmin:1/0,ymin:1/0,xmax:-(1/0),ymax:-(1/0)};for(var o in t.overlays)if(t.overlays.hasOwnProperty(o)){var r=t.overlays[o];r.isVisible()&&(t.overlayPlacements[o]=this.drawOverlay(r,t.connector,t.paintStyleInUse,t.getAbsoluteOverlayPosition(r)),i.xmin=Math.min(i.xmin,t.overlayPlacements[o].xmin),i.xmax=Math.max(i.xmax,t.overlayPlacements[o].xmax),i.ymin=Math.min(i.ymin,t.overlayPlacements[o].ymin),i.ymax=Math.max(i.ymax,t.overlayPlacements[o].ymax))}var s=parseFloat(""+t.paintStyleInUse.strokeWidth||"1")/2,a=parseFloat(""+t.paintStyleInUse.strokeWidth||"0"),l={xmin:Math.min(t.connector.bounds.xmin-(s+a),i.xmin),ymin:Math.min(t.connector.bounds.ymin-(s+a),i.ymin),xmax:Math.max(t.connector.bounds.xmax+(s+a),i.xmax),ymax:Math.max(t.connector.bounds.ymax+(s+a),i.ymax)};this.paintConnector(t.connector,t.paintStyleInUse,l);for(var u in t.overlays)if(t.overlays.hasOwnProperty(u)){var c=t.overlays[u];c.isVisible()&&this.paintOverlay(c,t.overlayPlacements[u],l)}}t.lastPaintedAt=n}}},{key:"refreshEndpoint",value:function(t){t.connections.length>0?this.addEndpointClass(t,this.endpointConnectedClass):this.removeEndpointClass(t,this.endpointConnectedClass),t.isFull()?this.addEndpointClass(t,this.endpointFullClass):this.removeEndpointClass(t,this.endpointFullClass)}},{key:"makeConnector",value:function(t,e,n){return pr.get(t,e,n)}},{key:"getPathData",value:function(t){for(var e="",n=0;n<t.segments.length;n++)e+=t.segments[n].getPath(0===n),e+=" ";return e}}]),r}(Vo),ja=1e-10,Na=function(t){function e(t){var i;kt(this,e),i=n.call(this,t),Pt(Ot(i),"type",e.segmentType),Pt(Ot(i),"cx",void 0),Pt(Ot(i),"cy",void 0),Pt(Ot(i),"radius",void 0),Pt(Ot(i),"anticlockwise",void 0),Pt(Ot(i),"startAngle",void 0),Pt(Ot(i),"endAngle",void 0),Pt(Ot(i),"sweep",void 0),Pt(Ot(i),"length",void 0),Pt(Ot(i),"circumference",void 0),Pt(Ot(i),"frac",void 0),i.cx=t.cx,i.cy=t.cy,i.radius=t.r,i.anticlockwise=t.ac,t.startAngle&&t.endAngle?(i.startAngle=t.startAngle,i.endAngle=t.endAngle,i.x1=i.cx+i.radius*Math.cos(i.startAngle),i.y1=i.cy+i.radius*Math.sin(i.startAngle),i.x2=i.cx+i.radius*Math.cos(i.endAngle),i.y2=i.cy+i.radius*Math.sin(i.endAngle)):(i.startAngle=i._calcAngle(i.x1,i.y1),i.endAngle=i._calcAngle(i.x2,i.y2)),i.endAngle<0&&(i.endAngle+=Yo),i.startAngle<0&&(i.startAngle+=Yo);var o=i.endAngle<i.startAngle?i.endAngle+Yo:i.endAngle;return i.sweep=Math.abs(o-i.startAngle),i.anticlockwise&&(i.sweep=Yo-i.sweep),i.circumference=2*Math.PI*i.radius,i.frac=i.sweep/Yo,i.length=i.circumference*i.frac,i.extents={xmin:i.cx-i.radius,xmax:i.cx+i.radius,ymin:i.cy-i.radius,ymax:i.cy+i.radius},i}Tt(e,t);var n=It(e);return St(e,[{key:"_calcAngle",value:function(t,e){return lt({x:this.cx,y:this.cy},{x:t,y:e})}},{key:"_calcAngleForLocation",value:function(t,e){if(t.anticlockwise){var n=t.startAngle<t.endAngle?t.startAngle+Yo:t.startAngle,i=Math.abs(n-t.endAngle);return n-i*e}var o=t.endAngle<t.startAngle?t.endAngle+Yo:t.endAngle,r=Math.abs(o-t.startAngle);return t.startAngle+r*e}},{key:"getPath",value:function(t){var e=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(t?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+e+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(t,e){if(0===t)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===t)return{x:this.x2,y:this.y2,theta:this.endAngle};e&&(t/=length);var n=this._calcAngleForLocation(this,t),i=this.cx+this.radius*Math.cos(n),o=this.cy+this.radius*Math.sin(n);return{x:Ue(i),y:Ue(o),theta:n}}},{key:"gradientAtPoint",value:function(t,e){var n=this.pointOnPath(t,e),i=rt({x:this.cx,y:this.cy},n);return this.anticlockwise||i!==1/0&&i!==-(1/0)||(i*=-1),i}},{key:"pointAlongPathFrom",value:function(t,e,n){var i=this.pointOnPath(t,n),o=e/this.circumference*2*Math.PI,r=this.anticlockwise?-1:1,s=i.theta+r*o,a=this.cx+this.radius*Math.cos(s),l=this.cy+this.radius*Math.sin(s);return{x:a,y:l}}}]),e}(zo);Pt(Na,"segmentType","Arc");var La=20,Ga=20,Ra=function(t){function e(t,i,o){var r;return kt(this,e),r=n.call(this,t,i,o),r.instance=t,r.component=i,Pt(Ot(r),"width",void 0),Pt(Ot(r),"length",void 0),Pt(Ot(r),"foldback",void 0),Pt(Ot(r),"direction",void 0),Pt(Ot(r),"location",.5),Pt(Ot(r),"paintStyle",void 0),Pt(Ot(r),"type",e.type),Pt(Ot(r),"cachedDimensions",void 0),o=o||{},r.width=o.width||La,r.length=o.length||Ga,r.direction=(o.direction||1)<0?-1:1,r.foldback=o.foldback||.623,r.paintStyle=o.paintStyle||{strokeWidth:1},r.location=null==o.location?r.location:Array.isArray(o.location)?o.location[0]:o.location,r}Tt(e,t);var n=It(e);return St(e,[{key:"draw",value:function(t,e,n){if(t instanceof ur){var i,o,r,s,a,l=t;if(this.location>1||this.location<0){var u=this.location<0?1:0;i=l.pointAlongPathFrom(u,this.location,!1),o=l.pointAlongPathFrom(u,this.location-this.direction*this.length/2,!1),r=ft(i,o,this.length)}else if(1===this.location){if(i=l.pointOnPath(this.location),o=l.pointAlongPathFrom(this.location,-this.length),r=ft(i,o,this.length),-1===this.direction){var c=r;r=i,i=c}}else if(0===this.location){if(r=l.pointOnPath(this.location),o=l.pointAlongPathFrom(this.location,this.length),i=ft(r,o,this.length),-1===this.direction){var h=r;r=i,i=h}}else i=l.pointAlongPathFrom(this.location,this.direction*this.length/2),o=l.pointOnPath(this.location),r=ft(i,o,this.length);s=vt(i,r,this.width),a=ft(i,r,this.foldback*this.length);var d={hxy:i,tail:s,cxy:a},p=this.paintStyle.stroke||e.stroke,f=this.paintStyle.fill||e.stroke,v=this.paintStyle.strokeWidth||e.strokeWidth;return{component:t,d:d,"stroke-width":v,stroke:p,fill:f,xmin:Math.min(i.x,s[0].x,s[1].x),xmax:Math.max(i.x,s[0].x,s[1].x),ymin:Math.min(i.y,s[0].y,s[1].y),ymax:Math.max(i.y,s[0].y,s[1].y)}}}},{key:"updateFrom",value:function(t){}}]),e}(Es);Pt(Ra,"type","Arrow"),ks.register(Ra.type,Ra);var Fa=function(t){function e(t,i,o){var r;return kt(this,e),r=n.call(this,t,i,o),r.instance=t,Pt(Ot(r),"type",e.type),r.foldback=1,r}Tt(e,t);var n=It(e);return e}(Ra);Pt(Fa,"type","PlainArrow"),ks.register("PlainArrow",Fa);var Ba=function(t){function e(t,i,o){var r;return kt(this,e),r=n.call(this,t,i,o),r.instance=t,Pt(Ot(r),"type",e.type),r.length=r.length/2,r.foldback=2,r}Tt(e,t);var n=It(e);return e}(Ra);Pt(Ba,"type","Diamond"),ks.register(Ba.type,Ba);var Va=function(t){function e(t,i,o){var r;return kt(this,e),r=n.call(this,t,i,o),r.instance=t,r.component=i,Pt(Ot(r),"create",void 0),Pt(Ot(r),"type",e.type),r.create=o.create,r}Tt(e,t);var n=It(e);return St(e,[{key:"updateFrom",value:function(t){}}]),e}(Es);Pt(Va,"type","Custom"),ks.register("Custom",Va),er.registerHandler(or),er.registerHandler(lr),er.registerHandler(sr),pr.register(hr.type,hr);var Ha=function(t){function e(t,i){var o;return qe(this,e),o=n.call(this,t,i),o.connection=t,Ze(nn(o),"type",e.type),Ze(nn(o),"internalSegments",[]),Ze(nn(o),"midpoint",void 0),Ze(nn(o),"alwaysRespectStubs",void 0),Ze(nn(o),"cornerRadius",void 0),Ze(nn(o),"lastx",void 0),Ze(nn(o),"lasty",void 0),Ze(nn(o),"lastOrientation",void 0),Ze(nn(o),"loopbackRadius",void 0),Ze(nn(o),"isLoopbackCurrently",void 0),o.midpoint=null==i.midpoint||isNaN(i.midpoint)?.5:i.midpoint,o.cornerRadius=null!=i.cornerRadius?i.cornerRadius:0,o.alwaysRespectStubs=i.alwaysRespectStubs===!0,o.lastx=null,o.lasty=null,o.lastOrientation=null,o.loopbackRadius=i.loopbackRadius||25,o.isLoopbackCurrently=!1,o}$e(e,t);var n=rn(e);return Ke(e,[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(t,e,n){if(this.lastx!==t||this.lasty!==e){var i=null==this.lastx?n.sx:this.lastx,o=null==this.lasty?n.sy:this.lasty,r=i===t?"v":"h";this.lastx=t,this.lasty=e,this.internalSegments.push([i,o,t,e,r])}}},{key:"writeSegments",value:function(t){for(var e,n,i,o=null,r=0;r<this.internalSegments.length-1;r++){if(o=o||un(this.internalSegments[r]),e=un(this.internalSegments[r+1]),n=an(o),i=an(e),this.cornerRadius>0&&o[4]!==e[4]){var s=Math.min(ln(o),ln(e)),a=Math.min(this.cornerRadius,s/2);o[2]-=n[0]*a,o[3]-=n[1]*a,e[0]+=i[0]*a,e[1]+=i[1]*a;var l=n[1]===i[0]&&1===i[0]||n[1]===i[0]&&0===i[0]&&n[0]!==i[1]||n[1]===i[0]&&-1===i[0],u=e[1]>o[3]?1:-1,c=e[0]>o[2]?1:-1,h=u===c,d=h&&l||!h&&!l?e[0]:o[2],p=h&&l||!h&&!l?o[3]:e[1];this._addSegment(cr,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]}),this._addSegment(Na,{r:a,x1:o[2],y1:o[3],x2:e[0],y2:e[1],cx:d,cy:p,ac:l})}else this._addSegment(cr,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]});o=e}null!=e&&this._addSegment(cr,{x1:e[0],y1:e[1],x2:e[2],y2:e[3]})}},{key:"_compute",value:function(t,e){var n=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var i=function(e){return[t.startStubX,t.startStubY,t.endStubX,t.endStubY]},o={perpendicular:i,orthogonal:i,opposite:function(e){var i=t,o="x"===e?0:1,r={x:function(){return 1===i.so[o]&&(i.startStubX>i.endStubX&&i.tx>i.startStubX||i.sx>i.endStubX&&i.tx>i.sx)||-1===i.so[o]&&(i.startStubX<i.endStubX&&i.tx<i.startStubX||i.sx<i.endStubX&&i.tx<i.sx)},y:function(){return 1===i.so[o]&&(i.startStubY>i.endStubY&&i.ty>i.startStubY||i.sy>i.endStubY&&i.ty>i.sy)||-1===i.so[o]&&(i.startStubY<i.endStubY&&i.ty<i.startStubY||i.sy<i.endStubY&&i.ty<i.sy)}};return!n.alwaysRespectStubs&&r[e]()?{x:[(t.sx+t.tx)/2,t.startStubY,(t.sx+t.tx)/2,t.endStubY],y:[t.startStubX,(t.sy+t.ty)/2,t.endStubX,(t.sy+t.ty)/2]}[e]:[t.startStubX,t.startStubY,t.endStubX,t.endStubY]}},r=o[t.anchorOrientation](t.sourceAxis),s="x"===t.sourceAxis?0:1,a="x"===t.sourceAxis?1:0,l=r[s],u=r[a],c=r[s+2],h=r[a+2];this.addASegment(r[0],r[1],t);var d=t.startStubX+(t.endStubX-t.startStubX)*this.midpoint,p=t.startStubY+(t.endStubY-t.startStubY)*this.midpoint,f={x:[0,1],y:[1,0]},v={perpendicular:function(e,n,i,o,r){var s=t,a={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]},l={x:[[s.startStubX,s.endStubX],null,[s.endStubX,s.startStubX]],y:[[s.startStubY,s.endStubY],null,[s.endStubY,s.startStubY]]},u={x:[[d,s.startStubY],[d,s.endStubY]],y:[[s.startStubX,p],[s.endStubX,p]]},c={x:[[s.endStubX,s.startStubY]],y:[[s.startStubX,s.endStubY]]},h={x:[[s.startStubX,s.endStubY],[s.endStubX,s.endStubY]],y:[[s.endStubX,s.startStubY],[s.endStubX,s.endStubY]]},v={x:[[s.startStubX,p],[s.endStubX,p],[s.endStubX,s.endStubY]],y:[[d,s.startStubY],[d,s.endStubY],[s.endStubX,s.endStubY]]},y={x:[s.startStubY,s.endStubY],y:[s.startStubX,s.endStubX]},g=f[e][0],m=f[e][1],_=s.so[g]+1,x=s.to[m]+1,E=-1===s.to[m]&&y[e][1]<y[e][0]||1===s.to[m]&&y[e][1]>y[e][0],b=l[e][_][0],k=l[e][_][1],C=a[e][_][x];return s.segment===C[3]||s.segment===C[2]&&E?u[e]:s.segment===C[2]&&b>k?c[e]:s.segment===C[2]&&k>=b||s.segment===C[1]&&!E?v[e]:s.segment===C[0]||s.segment===C[1]&&E?h[e]:void 0},orthogonal:function(e,n,i,o,r){var s=t,a={x:-1===s.so[0]?Math.min(n,o):Math.max(n,o),y:-1===s.so[1]?Math.min(n,o):Math.max(n,o)}[e];return{x:[[a,i],[a,r],[o,r]],y:[[i,a],[r,a],[r,o]]}[e]},opposite:function(i,o,r,a,l){var u=t,c={x:"y",y:"x"}[i],h={x:"h",y:"w"}[i],f=u["is"+i.toUpperCase()+"GreaterThanStubTimes2"];if(e.sourceEndpoint.elementId===e.targetEndpoint.elementId){var v=r+(1-e.sourceEndpoint._anchor[c])*e.sourceInfo[h]+n.maxStub;return{x:[[o,v],[a,v]],y:[[v,o],[v,a]]}[i]}return!f||1===u.so[s]&&o>a||-1===u.so[s]&&a>o?{x:[[o,p],[a,p]],y:[[d,o],[d,a]]}[i]:1===u.so[s]&&a>o||-1===u.so[s]&&o>a?{x:[[d,u.sy],[d,u.ty]],y:[[u.sx,p],[u.tx,p]]}[i]:void 0}},y=v[t.anchorOrientation](t.sourceAxis,l,u,c,h);if(y)for(var g=0;g<y.length;g++)this.addASegment(y[g][0],y[g][1],t);this.addASegment(r[2],r[3],t),this.addASegment(t.tx,t.ty,t),this.writeSegments(t)}},{key:"transformGeometry",value:function(t,e,n){return t}}]),e}(ur);Ze(Ha,"type","Flowchart"),pr.register(Ha.type,Ha);var Ua=function(t){function e(t,n){var o;return cn(this,e),o=i.call(this,t,n),o.connection=t,pn(mn(o),"showLoopback",void 0),pn(mn(o),"curviness",void 0),pn(mn(o),"margin",void 0),pn(mn(o),"proximityLimit",void 0),pn(mn(o),"orientation",void 0),pn(mn(o),"loopbackRadius",void 0),pn(mn(o),"clockwise",void 0),pn(mn(o),"isLoopbackCurrently",void 0),pn(mn(o),"geometry",void 0),n=n||{},o.showLoopback=n.showLoopback!==!1,o.curviness=n.curviness||10,o.margin=n.margin||5,o.proximityLimit=n.proximityLimit||80,o.clockwise=n.orientation&&"clockwise"===n.orientation,o.loopbackRadius=n.loopbackRadius||25,o.isLoopbackCurrently=!1,o}fn(e,t);var i=xn(e);return dn(e,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(t,e){var n=e.sourcePos,i=e.targetPos,o=Math.abs(n.curX-i.curX),r=Math.abs(n.curY-i.curY);if(this.showLoopback&&e.sourceEndpoint.elementId===e.targetEndpoint.elementId){
this.isLoopbackCurrently=!0;var s=e.sourcePos.curX,a=e.sourcePos.curY-this.margin,l=s,u=a-this.loopbackRadius,c=l-this.loopbackRadius,h=u-this.loopbackRadius;o=2*this.loopbackRadius,r=2*this.loopbackRadius,t.points[0]=c,t.points[1]=h,t.points[2]=o,t.points[3]=r,this._addSegment(Na,{loopback:!0,x1:s-c+4,y1:a-h,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:s-c-4,y2:a-h,cx:l-c,cy:u-h})}else this.isLoopbackCurrently=!1,this._computeBezier(t,e,n,i,o,r)}},{key:"exportGeometry",value:function(){return null==this.geometry?null:{controlPoints:[n({},this.geometry.controlPoints[0]),n({},this.geometry.controlPoints[1])],source:n({},this.geometry.source),target:n({},this.geometry.target)}}},{key:"transformGeometry",value:function(t,e,n){return{controlPoints:[{x:t.controlPoints[0].x+e,y:t.controlPoints[0].y+n},{x:t.controlPoints[1].x+e,y:t.controlPoints[1].y+n}],source:this.transformAnchorPlacement(t.source,e,n),target:this.transformAnchorPlacement(t.target,e,n)}}},{key:"importGeometry",value:function(t){return null!=t?null==t.controlPoints||2!=t.controlPoints.length?(B("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),!1):null==t.controlPoints[0].x||null==t.controlPoints[0].y||null==t.controlPoints[1].x||null==t.controlPoints[1].y?(B("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),!1):null==t.source||null==t.source.curX||null==t.source.curY?(B("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),!1):null==t.target||null==t.target.curX||null==t.target.curY?(B("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),!1):(this.setGeometry(t,!1),!0):!1}}]),e}(ur),Xa={subtract:function(t,e){return{x:t.x-e.x,y:t.y-e.y}},dotProduct:function(t,e){return t.x*e.x+t.y*e.y},square:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},scale:function(t,e){return{x:t.x*e,y:t.y*e}}},Ya=64,za=Math.pow(2,-Ya-1),Wa=new Map,qa=function(t){function e(t){var i;return cn(this,e),i=n.call(this,t),pn(mn(i),"curve",void 0),pn(mn(i),"cp1x",void 0),pn(mn(i),"cp1y",void 0),pn(mn(i),"cp2x",void 0),pn(mn(i),"cp2y",void 0),pn(mn(i),"length",0),pn(mn(i),"type",e.segmentType),i.cp1x=t.cp1x,i.cp1y=t.cp1y,i.cp2x=t.cp2x,i.cp2y=t.cp2y,i.x1=t.x1,i.x2=t.x2,i.y1=t.y1,i.y2=t.y2,i.curve=[{x:i.x1,y:i.y1},{x:i.cp1x,y:i.cp1y},{x:i.cp2x,y:i.cp2y},{x:i.x2,y:i.y2}],i.extents={xmin:Math.min(i.x1,i.x2,i.cp1x,i.cp2x),ymin:Math.min(i.y1,i.y2,i.cp1y,i.cp2y),xmax:Math.max(i.x1,i.x2,i.cp1x,i.cp2x),ymax:Math.max(i.y1,i.y2,i.cp1y,i.cp2y)},i}fn(e,t);var n=xn(e);return dn(e,[{key:"getPath",value:function(t){return(t?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(t,n){return t=e._translateLocation(this.curve,t,n),In(this.curve,t)}},{key:"gradientAtPoint",value:function(t,n){return t=e._translateLocation(this.curve,t,n),Fn(this.curve,t)}},{key:"pointAlongPathFrom",value:function(t,n,i){return t=e._translateLocation(this.curve,t,i),Gn(this.curve,t,n)}},{key:"getLength",value:function(){return(null==this.length||0===this.length)&&(this.length=On(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(t,e){var n=bn({x:t,y:e},this.curve);return{d:Math.sqrt(Math.pow(n.point.x-t,2)+Math.pow(n.point.y-e,2)),x:n.point.x,y:n.point.y,l:1-n.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(t,e,n,i){return Hn(t,e,n,i,this.curve)}}],[{key:"_translateLocation",value:function(t,e,n){return n&&(e=Rn(t,e>0?0:1,e)),e}}]),e}(zo);pn(qa,"segmentType","Bezier");var Ja=function(t){function e(t,i){var o;return cn(this,e),o=n.call(this,t,i),o.connection=t,pn(mn(o),"type",e.type),pn(mn(o),"majorAnchor",void 0),pn(mn(o),"minorAnchor",void 0),i=i||{},o.majorAnchor=i.curviness||150,o.minorAnchor=10,o}fn(e,t);var n=xn(e);return dn(e,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(t,e,n,i,o){var r=i[0]!==o[0]||i[1]===o[1],s={x:0,y:0};return r?(0===o[0]?s.x=n.curX<e.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:s.x=t.x+this.majorAnchor*o[0],0===o[1]?s.y=n.curY<e.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:s.y=t.y+this.majorAnchor*i[1]):(0===i[0]?s.x=e.curX<n.curX?t.x+this.minorAnchor:t.x-this.minorAnchor:s.x=t.x-this.majorAnchor*i[0],0===i[1]?s.y=e.curY<n.curY?t.y+this.minorAnchor:t.y-this.minorAnchor:s.y=t.y+this.majorAnchor*o[1]),s}},{key:"_computeBezier",value:function(t,e,n,i,o,r){var s,a,l=n.curX<i.curX?o:0,u=n.curY<i.curY?r:0,c=n.curX<i.curX?0:o,h=n.curY<i.curY?0:r;this.edited!==!0?(s=this._findControlPoint({x:l,y:u},n,i,t.so,t.to),a=this._findControlPoint({x:c,y:h},i,n,t.to,t.so)):(s=this.geometry.controlPoints[0],a=this.geometry.controlPoints[1]),this.geometry={controlPoints:[s,a],source:e.sourcePos,target:e.targetPos},this._addSegment(qa,{x1:l,y1:u,x2:c,y2:h,cp1x:s.x,cp1y:s.y,cp2x:a.x,cp2y:a.y})}}]),e}(Ua);pn(Ja,"type","Bezier");var Ka=function(t){function e(t,i){var o;return cn(this,e),o=n.call(this,t,i),o.connection=t,pn(mn(o),"type",e.type),pn(mn(o),"_controlPoint",void 0),pn(mn(o),"proximityLimit",void 0),o.curviness=i.curviness||10,o.margin=i.margin||5,o.proximityLimit=i.proximityLimit||80,o.clockwise=i.orientation&&"clockwise"===i.orientation,o}fn(e,t);var n=xn(e);return dn(e,[{key:"_computeBezier",value:function(t,e,n,i,o,r){var s=n.curX<i.curX?0:o,a=n.curY<i.curY?0:r,l=n.curX<i.curX?o:0,u=n.curY<i.curY?r:0;if(0===n.x&&(s-=this.margin),1===n.x&&(s+=this.margin),0===n.y&&(a-=this.margin),1===n.y&&(a+=this.margin),0===i.x&&(l-=this.margin),1===i.x&&(l+=this.margin),0===i.y&&(u-=this.margin),1===i.y&&(u+=this.margin),this.edited!==!0){var c=(s+l)/2,h=(a+u)/2,d=Jn(s,a,l,u),p=Math.sqrt(Math.pow(l-s,2)+Math.pow(u-a,2));this._controlPoint=Kn(c,h,d,e.sourcePos,e.targetPos,this.curviness,this.curviness,p,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];var f,v,y,g;f=this._controlPoint.x,v=this._controlPoint.x,y=this._controlPoint.y,g=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:e.sourcePos,target:e.targetPos},this._addSegment(qa,{x1:l,y1:u,x2:s,y2:a,cp1x:f,cp1y:y,cp2x:v,cp2y:g})}}]),e}(Ua);pn(Ka,"type","StateMachine"),pr.register(Ja.type,Ja),pr.register(Ka.type,Ka);var Za={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},$a="stroke-dasharray",Qa="dashstyle",tl="fill",el="stroke",nl="stroke-width",il="strokeWidth",ol="svg",rl="path",sl={svg:"http://www.w3.org/2000/svg"},al="data-jtk-container",ll="data-jtk-group-content",ul="data-jtk-enabled",cl="data-jtk-scope",hl="endpoint",dl="element",pl="connection",fl="div",vl="click",yl="contextmenu",gl="dblclick",ml="dbltap",_l="focus",xl="mousedown",El="mouseenter",bl="mouseexit",kl="mousemove",Cl="mouseup",Sl="mouseout",Pl="mouseover",Tl="tap",wl="drag:move",Al="drag:stop",Dl="drag:start",Ol="revert",Ml="connection:abort",Il="connection:drag",jl=Vi(dl,vl),Nl=Vi(dl,gl),Ll=Vi(dl,ml),Gl=Vi(dl,Sl),Rl=Vi(dl,Pl),Fl=Vi(dl,kl),Bl=Vi(dl,Cl),Vl=Vi(dl,xl),Hl=Vi(dl,yl),Ul=Vi(dl,Tl),Xl=Vi(hl,vl),Yl=Vi(hl,gl),zl=Vi(hl,ml),Wl=Vi(hl,Sl),ql=Vi(hl,Pl),Jl=Vi(hl,Cl),Kl=Vi(hl,xl),Zl=Vi(hl,Tl),$l=Vi(pl,vl),Ql=Vi(pl,gl),tu=Vi(pl,ml),eu=Vi(pl,Sl),nu=Vi(pl,Pl),iu=Vi(pl,Cl),ou=Vi(pl,xl),ru=Vi(pl,yl),su=Vi(pl,Tl),au="position",lu=zt(Or),uu=zt(jr),cu=qt(kr),hu=qt(ll),du=zt(Hr),pu=1,fu="ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0,vu="onmousedown"in document.documentElement,yu={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},gu="page",mu="screen",_u="client",xu=function(t,e,n,i,o){if(fu&&yu[e]){var r=ao(i,t,n,yu[e]);no(t,yu[e],r,n,o)}e===_l&&null==t.getAttribute(Pr)&&t.setAttribute(Pr,"1"),no(t,e,ao(i,t,n,e),n,o)},Eu={tap:{touches:1,taps:1},dbltap:{touches:1,taps:2},contextmenu:{touches:2,taps:1}},bu=function(){function t(){$n(this,t)}return ti(t,null,[{key:"generate",value:function(t,e){return function(n,i,o,r){if(i==yl&&vu)xu(n,i,o,r);else{if(null==n.__taTapHandler){var s=n.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},a=function(i){for(var o=zi(i),a=Wi(i,o,n,null!=r),l=!1,h=0;h<a.end;h++){if(l)return;o=a.path[h];for(var d=0;d<s.downSelectors.length;d++)if(null==s.downSelectors[d]||Yi(o,s.downSelectors[d],n)){s.down=!0,setTimeout(u,t),setTimeout(c,e),l=!0;break}}},l=function(t){if(s.down){var e,i,o=zi(t);s.taps++;var r=eo(t);for(var a in Eu)if(Eu.hasOwnProperty(a)){var l=Eu[a];if(l.touches===r&&(1===l.taps||l.taps===s.taps))for(var u=0;u<s[a].length;u++){i=Wi(t,o,n,null!=s[a][u][1]);for(var c=0;c<i.end;c++)if(e=i.path[c],null==s[a][u][1]||Yi(e,s[a][u][1],n)){s[a][u][0].apply(e,[t,e]);break}}}}},u=function(){s.down=!1},c=function(){s.taps=0};n.__taTapHandler.downHandler=a,n.__taTapHandler.upHandler=l,xu(n,xl,a),xu(n,Cl,l)}n.__taTapHandler.downSelectors.push(r),n.__taTapHandler[i].push([o,r]),o.__taUnstore=function(){null!=n.__taTapHandler&&(T(n.__taTapHandler.downSelectors,function(t){return t===r}),qi(n.__taTapHandler[i],o),0===n.__taTapHandler.downSelectors.length&&(io(n,xl,n.__taTapHandler.downHandler),io(n,Cl,n.__taTapHandler.upHandler),delete n.__taTapHandler))}}}}}]),t}(),ku=function(){function t(){$n(this,t)}return ti(t,null,[{key:"generate",value:function(){var t=[];return function(e,n,i,o){if(!e.__tamee){e.__tamee={over:!1,mouseenter:[],mouseexit:[]};var r=function(n){var i=zi(n);(null==o&&i==e&&!e.__tamee.over||Yi(i,o,e)&&(null==i.__tamee||!i.__tamee.over))&&(uo(El,n,e,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,t.push(i))},s=function(n){for(var i=zi(n),o=0;o<t.length;o++)i!=t[o]||Yi(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,t.splice(o,1),uo(bl,n,e,i))};no(e,Pl,ao(o,e,r,Pl),r),no(e,Sl,ao(o,e,s,Sl),s)}i.__taUnstore=function(){delete e.__tamee[n][i.__tauid]},ro(e,n,i),e.__tamee[n][i.__tauid]=i}}}]),t}(),Cu=function(){function t(e){$n(this,t),ei(this,"clickThreshold",void 0),ei(this,"dblClickThreshold",void 0),ei(this,"tapHandler",void 0),ei(this,"mouseEnterExitHandler",void 0),e=e||{},this.clickThreshold=e.clickThreshold||250,this.dblClickThreshold=e.dblClickThreshold||450,this.mouseEnterExitHandler=ku.generate(),this.tapHandler=bu.generate(this.clickThreshold,this.dblClickThreshold)}return ti(t,[{key:"_doBind",value:function(t,e,n,i,o){if(null!=n){var r=t;e===Tl||e===ml||e===yl?this.tapHandler(r,e,n,i,o):e===El||e==bl?this.mouseEnterExitHandler(r,e,n,i,o):xu(r,e,n,i,o)}}},{key:"on",value:function(t,e,n,i,o){var r=null==i?null:n,s=null==i?n:i;return this._doBind(t,e,s,r,o),this}},{key:"off",value:function(t,e,n){return io(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){var r=vu&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),s=fu&&!vu&&yu[e]?yu[e]:e,a=!(fu&&!vu&&yu[e]),l=Ki(n),u=Zi(n),c=$i(n);return oo(t,function(t){var h;n=n||{screenX:u.x,screenY:u.y,clientX:c.x,clientY:c.y};var d=function(t){i&&(t.payload=i)},p={TouchEvent:function(e){var n=Xi(t,l.x,l.y,u.x,u.y,c.x,c.y),i=e.initTouchEvent||e.initEvent;i(s,!0,!0,window,null,u.x,u.y,c.x,c.y,!1,!1,!1,!1,n,n,n,1,0)},MouseEvents:function(e){e.initMouseEvent(s,!0,!0,window,null==o?1:o,u.x,u.y,c.x,c.y,!1,!1,!1,!1,1,t)}},f=!a&&!r&&fu&&yu[e],v=f?"TouchEvent":"MouseEvents";h=document.createEvent(v),p[v](h),d(h),t.dispatchEvent(h)}),this}}]),t}(),Su="start",Pu="beforeStart",Tu="drag",wu="drop",Au="over",Du="out",Ou="stop",Mu="katavorio-draggable",Iu=Mu,ju=10,Nu=10,Lu=function(){return!0},Gu=function(){return!1},Ru={delegatedDraggable:"katavorio-delegated-draggable",draggable:Iu,drag:"katavorio-drag",selected:"katavorio-drag-selected",noSelect:"katavorio-drag-no-select",ghostProxy:"katavorio-ghost-proxy",clonedDrag:"katavorio-clone-drag"},Fu=[Ou,Su,Tu,wu,Au,Du,Pu],Bu=function(){},Vu=function(t,e){if(null!=t){t=o(t)||null!=t.tagName||null==t.length?[t]:t;for(var n=0;n<t.length;n++)e.apply(t[n],[t[n]])}},Hu=function(t,e,n){var i=t.srcElement||t.target;return!gi(i,n.getInputFilterSelector(),e)},Uu=function(){function t(e,n){$n(this,t),this.el=e,this.k=n,ei(this,"_class",void 0),ei(this,"uuid",j()),ei(this,"enabled",!0),ei(this,"scopes",[])}return ti(t,[{key:"setEnabled",value:function(t){this.enabled=t}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(t){var e={};Vu(this.scopes,function(t){e[t]=!0}),Vu(t?t.split(/\s+/):[],function(t){e[t]=!0}),this.scopes.length=0;for(var n in e)this.scopes.push(n)}},{key:"removeScope",value:function(t){var e={};Vu(this.scopes,function(t){e[t]=!0}),Vu(t?t.split(/\s+/):[],function(t){delete e[t]}),this.scopes.length=0;for(var n in e)this.scopes.push(n)}},{key:"toggleScope",value:function(t){var e={};Vu(this.scopes,function(t){e[t]=!0}),Vu(t?t.split(/\s+/):[],function(t){e[t]?delete e[t]:e[t]=!0}),this.scopes.length=0;for(var n in e)this.scopes.push(n)}}]),t}();t.ContainmentType=void 0,function(t){t.notNegative="notNegative",t.parent="parent",t.parentEnclosed="parentEnclosed"}(t.ContainmentType||(t.ContainmentType={}));var Xu=function(t){function e(t,i,o){var r;if($n(this,e),r=n.call(this,t,o),ei(si(r),"_class",void 0),ei(si(r),"rightButtonCanDrag",void 0),ei(si(r),"consumeStartEvent",void 0),ei(si(r),"clone",void 0),ei(si(r),"scroll",void 0),ei(si(r),"trackScroll",void 0),ei(si(r),"_downAt",void 0),ei(si(r),"_posAtDown",void 0),ei(si(r),"_pagePosAtDown",void 0),ei(si(r),"_pageDelta",{x:0,y:0}),ei(si(r),"_moving",void 0),ei(si(r),"_lastPosition",void 0),ei(si(r),"_lastScrollValues",{x:0,y:0}),ei(si(r),"_initialScroll",{x:0,y:0}),ei(si(r),"_size",void 0),ei(si(r),"_currentParentPosition",void 0),ei(si(r),"_ghostParentPosition",void 0),ei(si(r),"_dragEl",void 0),ei(si(r),"_multipleDrop",void 0),ei(si(r),"_ghostProxyOffsets",void 0),ei(si(r),"_ghostDx",void 0),ei(si(r),"_ghostDy",void 0),ei(si(r),"_isConstrained",!1),ei(si(r),"_ghostProxyParent",void 0),ei(si(r),"_useGhostProxy",void 0),ei(si(r),"_ghostProxyFunction",void 0),ei(si(r),"_activeSelectorParams",void 0),ei(si(r),"_availableSelectors",[]),ei(si(r),"_canDrag",void 0),ei(si(r),"_consumeFilteredEvents",void 0),ei(si(r),"_parent",void 0),ei(si(r),"_ignoreZoom",void 0),ei(si(r),"_filters",{}),ei(si(r),"_constrainRect",void 0),ei(si(r),"_elementToDrag",void 0),ei(si(r),"downListener",void 0),ei(si(r),"moveListener",void 0),ei(si(r),"upListener",void 0),ei(si(r),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),r._class=r.k.css.draggable,Ti(r.el,r._class),r.downListener=r._downListener.bind(si(r)),r.upListener=r._upListener.bind(si(r)),r.moveListener=r._moveListener.bind(si(r)),r.rightButtonCanDrag=i.rightButtonCanDrag===!0,r.consumeStartEvent=i.consumeStartEvent!==!1,r._dragEl=r.el,r.clone=i.clone===!0,r.scroll=i.scroll===!0,r.trackScroll=i.trackScroll!==!1,r._multipleDrop=i.multipleDrop!==!1,r._canDrag=i.canDrag||Lu,r._consumeFilteredEvents=i.consumeFilteredEvents,r._parent=i.parent,r._ignoreZoom=i.ignoreZoom===!0,r._ghostProxyParent=i.ghostProxyParent,r.trackScroll&&document.addEventListener("scroll",function(t){if(r._moving){var e={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=e.x-r._lastScrollValues.x,i=e.y-r._lastScrollValues.y,o={x:n+r._lastPosition.x,y:i+r._lastPosition.y},s=o.x-r._downAt.x,a=o.y-r._downAt.y,l=r._ignoreZoom?1:r.k.getZoom();r._dragEl&&r._dragEl.parentNode&&(s+=r._dragEl.parentNode.scrollLeft-r._initialScroll.x,a+=r._dragEl.parentNode.scrollTop-r._initialScroll.y),s/=l,a/=l,r.moveBy(s,a,t),r._lastPosition=o,r._lastScrollValues=e}}),i.ghostProxy===!0?r._useGhostProxy=Lu:i.ghostProxy&&"function"==typeof i.ghostProxy?r._useGhostProxy=i.ghostProxy:r._useGhostProxy=function(t,e){return r._activeSelectorParams&&r._activeSelectorParams.useGhostProxy?r._activeSelectorParams.useGhostProxy(t,e):!1},i.makeGhostProxy?r._ghostProxyFunction=i.makeGhostProxy:r._ghostProxyFunction=function(t){return r._activeSelectorParams&&r._activeSelectorParams.makeGhostProxy?r._activeSelectorParams.makeGhostProxy(t):t.cloneNode(!0)},i.selector){var s=r.el.getAttribute(Mu);null==s&&(s=""+(new Date).getTime(),r.el.setAttribute("katavorio-draggable",s)),r._availableSelectors.push(i)}return r.k.eventManager.on(r.el,xl,r.downListener),r}ni(e,t);var n=li(e);return ti(e,[{key:"on",value:function(t,e){this.listeners[t]&&this.listeners[t].push(e)}},{key:"off",value:function(t,e){if(this.listeners[t]){for(var n=[],i=0;i<this.listeners[t].length;i++)this.listeners[t][i]!==e&&n.push(this.listeners[t][i]);this.listeners[t]=n}}},{key:"_upListener",value:function(t){this._downAt&&(this._downAt=null,this.k.eventManager.off(document,kl,this.moveListener),this.k.eventManager.off(document,Cl,this.upListener),Ai(document.body,Ru.noSelect),this.unmark(t),this.stop(t),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&this._activeSelectorParams.revertFunction(this._dragEl,ho(this._dragEl))===!0&&(fo(this._dragEl,this._posAtDown),this._dispatch(Ol,this._dragEl)))}},{key:"_downListener",value:function(t){if(!t.defaultPrevented){var e=this.rightButtonCanDrag||3!==t.which&&2!==t.button;if(e&&this.isEnabled()&&this._canDrag()){var n=this._testFilter(t)&&Hu(t,this.el,this.k);if(n){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var i=t.target||t.srcElement,o=go(this._availableSelectors,this.el,i);if(null!=o&&(this._activeSelectorParams=o[0],this._elementToDrag=o[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var r=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag):null;if(null!=r&&(this._elementToDrag=r),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),Ti(this._dragEl,Ru.clonedDrag),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var s=ho(this.el);this._dragEl.style.left=s.x+"px",this._dragEl.style.top=s.y+"px",this._parent.appendChild(this._dragEl)}else{var a=Ii(this._elementToDrag);this._dragEl.style.left=a.x+"px",this._dragEl.style.top=a.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&mi(t),this._downAt=Ki(t),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=ho(this._dragEl),this._pagePosAtDown=Ii(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=po(this._dragEl),this.k.eventManager.on(document,kl,this.moveListener),this.k.eventManager.on(document,Cl,this.upListener),Ti(document.body,Ru.noSelect),this._dispatch(Pu,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size})}else this._consumeFilteredEvents&&mi(t)}}}},{key:"_moveListener",value:function(t){if(this._downAt){if(!this._moving){var e=this._dispatch(Su,{el:this.el,pos:this._posAtDown,e:t,drag:this,size:this._size});if(e!==!1){if(!this._downAt)return;this.mark(e),this._moving=!0}else this.abort()}if(this._downAt){var n=Ki(t),i=n.x-this._downAt.x,o=n.y-this._downAt.y,r=this._ignoreZoom?1:this.k.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,o+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),i/=r,o/=r,this.moveBy(i,o,t)}}}},{key:"mark",value:function(t){this._posAtDown=ho(this._dragEl),this._pagePosAtDown=Ii(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=po(this._dragEl),Ti(this._dragEl,this.k.css.drag),this._constrainRect=mo(this._dragEl),this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(t){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,Ai(this._dragEl,this.k.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(t,e,n){var i=this.toGrid({x:this._posAtDown.x+t,y:this._posAtDown.y+e}),o=this._doConstrain(i,this._dragEl,this._constrainRect,this._size);if(this._useGhostProxy(this.el,this._dragEl))if(i.x!==o.x||i.y!==o.y){if(!this._isConstrained){var r=this._ghostProxyFunction(this._elementToDrag);Ti(r,Ru.ghostProxy),this._ghostProxyParent?(this._ghostProxyParent.appendChild(r),this._currentParentPosition=Ii(this._elementToDrag.parentNode),this._ghostParentPosition=Ii(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(r),this._dragEl=r,this._isConstrained=!0}o=i}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);fo(this._dragEl,{x:o.x+this._ghostDx,y:o.y+this._ghostDy}),this._dispatch(Tu,{el:this.el,pos:o,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(t){return t?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(t,e){if(e||this._moving){var n=[],i=ho(this._dragEl);n.push([this._dragEl,i,this,this._size]),this._dispatch(Ou,{el:this._dragEl,pos:this._ghostProxyOffsets||i,finalPos:i,e:t,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||(this._activeSelectorParams.dragAbort?this._activeSelectorParams.dragAbort(this._elementToDrag):null)}},{key:"_dispatch",value:function(t,e){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[t])n=this._activeSelectorParams[t](e);else if(this.listeners[t])for(var i=0;i<this.listeners[t].length;i++)try{var o=this.listeners[t][i](e);null!=o&&(n=o)}catch(r){}return n}},{key:"resolveGrid",value:function(){var t={grid:null,thresholdX:ju/2,thresholdY:Nu/2};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(t.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(t.thresholdX=this._activeSelectorParams.snapThreshold,t.thresholdY=this._activeSelectorParams.snapThreshold)),t}},{key:"toGrid",value:function(t){var e=this.resolveGrid(),n=e.grid,i=e.thresholdX,o=e.thresholdY;if(null==n)return t;var r=n?n.w/2:i,s=n?n.h/2:o;return yt(t,n,r,s)}},{key:"setUseGhostProxy",value:function(t){this._useGhostProxy=t?Lu:Gu}},{key:"_doConstrain",value:function(t,e,n,i){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(t,e,n,i):t}},{key:"_testFilter",value:function(t){for(var e in this._filters){var n=this._filters[e],i=n[0](t);if(n[1]&&(i=!i),!i)return!1}return!0}},{key:"addFilter",value:function(t,e){var n=this;if(t){var i=vo(t);this._filters[i]=[function(e){var i,r=e.srcElement||e.target;return o(t)?i=gi(r,t,n.el):"function"==typeof t&&(i=t(e,n.el)),i},e!==!1]}}},{key:"removeFilter",value:function(t){var e="function"==typeof t?t._katavorioId:t;delete this._filters[e]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(t,e){t.selector&&(e?this._availableSelectors.unshift(t):this._availableSelectors.push(t))}},{key:"destroy",value:function(){this.k.eventManager.off(this.el,xl,this.downListener),this.k.eventManager.off(document,kl,this.moveListener),this.k.eventManager.off(document,Cl,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null}}]),e}(Uu),Yu=["input","textarea","select","button","option"],zu=Yu.join(","),Wu=function(){function t(e){$n(this,t),ei(this,"eventManager",void 0),ei(this,"zoom",1),ei(this,"css",{}),ei(this,"inputFilterSelector",void 0),e=e||{},this.inputFilterSelector=e.inputFilterSelector||zu,this.eventManager=new Cu,this.zoom=e.zoom||1;var i=e.css||{};n(this.css,i)}return ti(t,[{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(t){this.zoom=t}},{key:"_prepareParams",value:function(t){t=t||{};var e,n={events:{}};for(e in t)n[e]=t[e];for(e=0;e<Fu.length;e++)n.events[Fu[e]]=t[Fu[e]]||Bu;return n}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(t){return this.inputFilterSelector=t,this}},{key:"draggable",value:function(t,e){if(null==t._katavorioDrag){var n=this._prepareParams(e),i=new Xu(t,n,this);return Ti(t,Ru.delegatedDraggable),t._katavorioDrag=i,i}return t._katavorioDrag}},{key:"destroyDraggable",value:function(t){t._katavorioDrag&&(t._katavorioDrag.destroy(),delete t._katavorioDrag)}}]),t}(),qu="jtk-drag-selected",Ju=function(){function t(e){$n(this,t),this.instance=e,ei(this,"_dragSelection",[]),ei(this,"_dragSizes",new Map),ei(this,"_dragElements",new Map),ei(this,"_dragElementStartPositions",new Map),ei(this,"_dragElementPositions",new Map),ei(this,"__activeSet",void 0)}return ti(t,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(t){var e=this;this.__activeSet=[],x(this._dragSelection,function(n){t(n)&&e.__activeSet.push(n)})}},{key:"clear",value:function(){var t=this;this.reset(),x(this._dragSelection,function(e){return t.instance.removeClass(e.jel,qu)}),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var t=this;x(this._activeSet,function(e){var n={x:parseInt(""+e.jel.offsetLeft,10),y:parseInt(""+e.jel.offsetTop,10)};t._dragElementStartPositions.set(e.id,n),t._dragElementPositions.set(e.id,n),t._dragSizes.set(e.id,t.instance.getSize(e.jel))})}},{key:"updatePositions",value:function(t,e,n){var i=this,o=t.x-e.x,r=t.y-e.y;x(this._activeSet,function(t){var e=i._dragElementStartPositions.get(t.id);if(e){var s=e.x+o,a=e.y+r,l=i._dragSizes.get(t.id),u={x:s,y:a,w:l.w,h:l.h};if(t.jel._jsPlumbParentGroup&&t.jel._jsPlumbParentGroup.constrain){var c={w:t.jel.parentNode.offsetWidth+t.jel.parentNode.scrollLeft,h:t.jel.parentNode.offsetHeight+t.jel.parentNode.scrollTop};u.x=Math.max(u.x,0),u.y=Math.max(u.y,0),u.x=Math.min(u.x,c.w-l.w),u.y=Math.min(u.y,c.h-l.h)}i._dragElementPositions.set(t.id,{x:s,y:a}),t.jel.style.left=u.x+"px",t.jel.style.top=u.y+"px",n(t.jel,t.id,l,u)}})}},{key:"each",value:function(t){var e=this;x(this._activeSet,function(n){var i=e._dragSizes.get(n.id),o=e._dragElementPositions.get(n.id),r=e._dragElementStartPositions.get(n.id);t(n.jel,n.id,o,i,r)})}},{key:"add",value:function(t,e){var n=t;e=e||this.instance.getId(n);var i=E(this._dragSelection,function(t){return t.id===e});-1===i&&(this.instance.addClass(t,qu),this._dragSelection.push({id:e,jel:n}))}},{key:"remove",value:function(t){var e=this,n=t;this._dragSelection=this._dragSelection.filter(function(t){var i=t.jel!==n;return i||e.instance.removeClass(t.jel,qu),i})}},{key:"toggle",value:function(t){var e=t,n=E(this._dragSelection,function(t){return t.jel===e});-1!==n?this.remove(e):this.add(t)}}]),t}(),Ku="jtk-delegated-draggable",Zu="jtk-draggable",$u="jtk-drag",Qu="jtk-ghost-proxy",tc="jtk-drag-active",ec="jtk-dragged",nc="jtk-drag-hover",ic=function(){function e(t,n,i){var o=this;$n(this,e),this.instance=t,this.dragSelection=n,ei(this,"collicat",void 0),ei(this,"drag",void 0),ei(this,"_draggables",{}),ei(this,"_dlist",[]),ei(this,"_elementsWithEndpoints",{}),ei(this,"_draggablesForElements",{}),ei(this,"handlers",[]),ei(this,"_trackScroll",void 0),ei(this,"_filtersToAdd",[]),this.collicat=new Wu({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:Ku,draggable:Zu,drag:$u,selected:qu,active:tc,hover:nc,ghostProxy:Qu}}),this.instance.bind(us,function(t){o.collicat.setZoom(t)}),i=i||{},this._trackScroll=i.trackScroll!==!1}return ti(e,[{key:"addHandler",value:function(e,i){var o=this,r=n({selector:e.selector},i||{});r.start=V(r.start,function(t){return e.onStart(t)}),r.drag=V(r.drag,function(t){return e.onDrag(t)}),r.stop=V(r.stop,function(t){return e.onStop(t)});var s=(e.onBeforeStart||function(t){}).bind(e);if(r.beforeStart=V(r.beforeStart,function(t){return s(t)}),r.dragInit=function(t){return e.onDragInit(t)},r.dragAbort=function(t){return e.onDragAbort(t)},e.useGhostProxy&&(r.useGhostProxy=e.useGhostProxy,r.makeGhostProxy=e.makeGhostProxy),null==r.constrainFunction&&null!=r.containment)switch(r.containment){case t.ContainmentType.notNegative:r.constrainFunction=function(t,e,n,i){return{x:Math.max(0,Math.min(t.x)),y:Math.max(0,Math.min(t.y))}};break;case t.ContainmentType.parent:var a=r.containmentPadding||5;r.constrainFunction=function(t,e,n,i){var o=t.x<0?0:t.x>n.w-a?n.w-a:t.x,r=t.y<0?0:t.y>n.h-a?n.h-a:t.y;return{x:o,y:r}};break;case t.ContainmentType.parentEnclosed:r.constrainFunction=function(t,e,n,i){var o=t.x<0?0:t.x+i.w>n.w?n.w-i.w:t.x,r=t.y<0?0:t.y+i.h>n.h?n.h-i.h:t.y;return{x:o,y:r}}}null==this.drag?(r.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),r),x(this._filtersToAdd,function(t){return o.drag.addFilter(t[0],t[1])}),this.drag.on(Ol,function(t){o.instance.revalidate(t)})):this.drag.addSelector(r),this.handlers.push({handler:e,options:r}),e.init(this.drag)}},{key:"addFilter",value:function(t,e){null==this.drag?this._filtersToAdd.push([t,e===!0]):this.drag.addFilter(t,e)}},{key:"removeFilter",value:function(t){null!=this.drag&&this.drag.removeFilter(t)}},{key:"setFilters",value:function(t){var e=this;x(t,function(t){e.drag.addFilter(t[0],t[1])})}},{key:"reset",value:function(){var t=[];if(x(this.handlers,function(t){t.handler.reset()}),null!=this.drag){var e=this.drag._filters;for(var n in e)t.push([n,e[n][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,t}},{key:"setOption",value:function(t,e){var i=k(this.handlers,function(e){return e.handler===t});null!=i&&n(i.options,e||{})}}]),e}(),oc=function(){function t(e,n){$n(this,t),this.instance=e,this._dragSelection=n,ei(this,"selector","> "+vs+":not("+zt(Hr)+")"),ei(this,"_dragOffset",null),ei(this,"_groupLocations",[]),ei(this,"_intersectingGroups",[]),ei(this,"_currentDragParentGroup",null),ei(this,"_dragGroupByElementIdMap",{}),ei(this,"_dragGroupMap",{}),ei(this,"_currentDragGroup",null),ei(this,"_currentDragGroupOffsets",new Map),ei(this,"_currentDragGroupSizes",new Map),ei(this,"_dragPayload",null),ei(this,"drag",void 0),ei(this,"originalPosition",void 0)}return ti(t,[{key:"onDragInit",value:function(t){return null}},{key:"onDragAbort",value:function(t){return null}},{key:"getDropGroup",value:function(){var t=null;if(this._intersectingGroups.length>0){var e=this._intersectingGroups[0].groupLoc.group,n=this._intersectingGroups[0].intersectingElement,i=n._jsPlumbParentGroup;i!==e&&(null!=i&&i.overrideDrop(n,e)||(t=this._intersectingGroups[0]))}return t}},{key:"onStop",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.getDropGroup(),o=[];if(o.push({el:n,id:this.instance.getId(n),pos:t.finalPos,originalGroup:n._jsPlumbParentGroup,redrawResult:null,originalPos:t.originalPos,reverted:!1,dropGroup:null!=i?i.groupLoc.group:null
}),this._dragSelection.each(function(e,n,r,s,a){if(e!==t.el){var l={x:r.x,y:r.y},u=l.x,c=l.y;if(e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain){var h={w:e.parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop};u=Math.max(u,0),c=Math.max(c,0),u=Math.min(u,h.w-s.w),c=Math.min(c,h.h-s.h),l.x=u,l.y=c}o.push({el:e,id:n,pos:l,originalPos:a,originalGroup:e._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null!=i?i.groupLoc.group:null})}}),x(o,function(t){var n=null!=t.originalGroup,o=n&&yo(e.instance,t.el,t.pos),r={x:0,y:0};if(n&&!o){if(null==i){var s=e._pruneOrOrphan(t,!0,!0);null!=s.pos?t.pos=s.pos.pos:!s.pruned&&t.originalGroup.revert&&(t.pos=t.originalPos,t.reverted=!0)}}else n&&o&&(r=e.instance.viewport.getPosition(t.originalGroup.elId));null==i||o?t.dropGroup=null:e.instance.groupManager.addToGroup(i.groupLoc.group,!1,t.el),t.reverted&&e.instance.setPosition(t.el,t.pos),t.redrawResult=e.instance.setElementPosition(t.el,t.pos.x+r.x,t.pos.y+r.y),e.instance.removeClass(t.el,ec),e.instance.select({source:t.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:t.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0)}),null!=o[0].originalGroup){var r=n._jsPlumbParentGroup;if(r!==o[0].originalGroup){var s=t.drag.getDragElement(!0);if(o[0].originalGroup.ghost){var a=this.instance.getOffset(this.instance.getGroupContentArea(r)),l=this.instance.getOffset(this.instance.getGroupContentArea(o[0].originalGroup)),u={x:l.x+t.pos.x-a.x,y:l.y+t.pos.y-a.y};s.style.left=u.x+"px",s.style.top=u.y+"px",this.instance.revalidate(s)}}}this.instance.fire(Al,{elements:o,e:t.e,el:n,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var t=this;x(this._groupLocations,function(e){t.instance.removeClass(e.el,tc),t.instance.removeClass(e.el,nc)}),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(t){this.drag=t}},{key:"onDrag",value:function(t){var e=this,n=t.drag.getDragElement(),i=t.pos,o=this.instance.getSize(n),r={x:i.x,y:i.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(r.x+=this._dragOffset.x,r.y+=this._dragOffset.y);var s=function(n,i,o){if(o){var r=new Set;x(e._groupLocations,function(n){!r.has(n.group.id)&&ut(i,n.r)?(n.group!==e._currentDragParentGroup&&e.instance.addClass(n.el,nc),e._intersectingGroups.push({groupLoc:n,intersectingElement:t.drag.getDragElement(!0),d:0}),x(e.instance.groupManager.getAncestors(n.group),function(t){return r.add(t.id)})):e.instance.removeClass(n.el,nc)})}e.instance.setElementPosition(n,i.x,i.y),e.instance.fire(wl,{el:n,e:t.e,pos:{x:i.x,y:i.y},originalPosition:e.originalPosition,payload:e._dragPayload})},a={x:r.x,y:r.y,w:o.w,h:o.h};s(n,a,!0),this._dragSelection.updatePositions(i,this.originalPosition,function(t,e,n,i){s(t,i,!1)}),this._currentDragGroupOffsets.forEach(function(t,n){var i=e._currentDragGroupSizes.get(n),o={x:a.x+t[0].x,y:a.y+t[0].y,w:i.w,h:i.h};t[1].style.left=o.x+"px",t[1].style.top=o.y+"px",s(t[1],o,!1)})}},{key:"onStart",value:function(t){var e=this,n=t.drag.getDragElement(),i=this.instance.getOffset(n);this.originalPosition={x:t.pos.x,y:t.pos.y},n._jsPlumbParentGroup&&(this._dragOffset=this.instance.getOffset(n.offsetParent),this._currentDragParentGroup=n._jsPlumbParentGroup);var o=!0,r=n.getAttribute(Sr);if((this.instance.elementsDraggable===!1||null!=r&&r!==Ko)&&(o=!1),o){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var s=t.drag.getDragElement(!0),a=s.querySelectorAll(vs),l=Eo(s),u=[];Array.prototype.push.apply(u,a),Array.prototype.push.apply(u,l),this._dragSelection.filterActiveSet(function(t){return-1===u.indexOf(t.jel)}),this._dragSelection.initialisePositions();var c=function(n){if(!n._isJsPlumbGroup||e.instance.allowNestedGroups){var i=!n._jsPlumbParentGroup,o=i||n._jsPlumbParentGroup.dropOverride!==!0,r=!i&&(n._jsPlumbParentGroup.ghost||n._jsPlumbParentGroup.constrain!==!0);(i||o&&r)&&(x(e.instance.groupManager.getGroups(),function(t){var i=n._jsPlumbGroup;if(t.droppable!==!1&&t.enabled!==!1&&n._jsPlumbGroup!==t&&!e.instance.groupManager.isDescendant(t,i)){var o=t.el,r=e.instance.getSize(o),s=e.instance.getOffset(o),a={x:s.x,y:s.y,w:r.w,h:r.h},l={el:o,r:a,group:t};e._groupLocations.push(l),t!==e._currentDragParentGroup&&e.instance.addClass(o,tc)}}),e._groupLocations.sort(function(t,n){return e.instance.groupManager.isDescendant(t.group,n.group)?-1:e.instance.groupManager.isAncestor(n.group,t.group)?1:0}))}return e.instance.select({source:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:n}).addClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0),e.instance.fire(Dl,{el:n,e:t.e,originalPosition:e.originalPosition,pos:e.originalPosition})},h=this.instance.getId(n);this._currentDragGroup=this._dragGroupByElementIdMap[h],this._currentDragGroup&&!xo(this._currentDragGroup,n)&&(this._currentDragGroup=null);var d=c(n);if(d===!1)return this._cleanup(),!1;this._dragPayload=d,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach(function(t){var n=e.instance.getOffset(t.el);e._currentDragGroupOffsets.set(t.elId,[{x:n.x-i.x,y:n.y-i.y},t.el]),e._currentDragGroupSizes.set(t.elId,e.instance.getSize(t.el)),c(t.el)}))}return o}},{key:"addToDragGroup",value:function(t){var e=this,n=_o(this.instance,t),i=this._dragGroupMap[n.id];null==i&&(i={id:n.id,members:new Set},this._dragGroupMap[n.id]=i);for(var o=arguments.length,r=new Array(o>1?o-1:0),s=1;o>s;s++)r[s-1]=arguments[s];this.removeFromDragGroup.apply(this,r),x(r,function(t){var o=e.instance.getId(t);i.members.add({elId:o,el:t,active:n.active}),e._dragGroupByElementIdMap[o]=i})}},{key:"removeFromDragGroup",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;e>i;i++)n[i]=arguments[i];x(n,function(e){var n=t.instance.getId(e),i=t._dragGroupByElementIdMap[n];if(null!=i){var o=new Set;i.members.forEach(function(t){t.el!==e&&o.add(t)}),i.members=o,delete t._dragGroupByElementIdMap[n]}})}},{key:"setDragGroupState",value:function(t){for(var e=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;n>o;o++)i[o-1]=arguments[o];var r=i.map(function(t){return e.instance.getId(t)});x(r,function(n){var i=e._dragGroupByElementIdMap[n];if(null!=i){var o=S(i.members,function(t){return t.elId===n});null!=o&&(o.active=t)}})}},{key:"_pruneOrOrphan",value:function(t,e,n){var i=t.el,o={pruned:!1,pos:null};if(n||!yo(this.instance,i,t.pos)){var r=i._jsPlumbParentGroup;r.prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):r.remove(t.el,!0),o.pruned=!0):r.orphan&&(o.pos=this.instance.groupManager.orphan(t.el,e),i._isJsPlumbGroup?r.removeGroup(i._jsPlumbGroup):r.remove(t.el))}return o}}]),t}(),rc=zt(tc,nc),sc="sourceSelectorEndpoint",ac=function(){function t(e){$n(this,t),this.instance=e,ei(this,"jpc",void 0),ei(this,"existingJpc",void 0),ei(this,"_originalAnchor",void 0),ei(this,"ep",void 0),ei(this,"endpointRepresentation",void 0),ei(this,"canvasElement",void 0),ei(this,"_activeDefinition",void 0),ei(this,"placeholderInfo",{id:null,element:null}),ei(this,"floatingIndex",void 0),ei(this,"floatingId",void 0),ei(this,"floatingElement",void 0),ei(this,"floatingEndpoint",void 0),ei(this,"floatingAnchor",void 0),ei(this,"_stopped",void 0),ei(this,"inPlaceCopy",void 0),ei(this,"endpointDropTargets",[]),ei(this,"currentDropTarget",null),ei(this,"payload",void 0),ei(this,"floatingConnections",{}),ei(this,"_forceReattach",void 0),ei(this,"_forceDetach",void 0),ei(this,"mousedownHandler",void 0),ei(this,"mouseupHandler",void 0),ei(this,"selector",zt(jr));var n=e.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),e.on(n,xl,vs,this.mousedownHandler),e.on(n,Cl,[vs,zt(jr)].join(","),this.mouseupHandler)}return ti(t,[{key:"_resolveDragParent",value:function(t,e){var n=this.instance.getContainer(),i=_i(e,vs,n,!0);if(null!=t.parentSelector){var o=_i(e,t.parentSelector,n,!0);return null!=o&&(i=_i(o.parentNode,vs,n,!1)),o||i}return i}},{key:"_mousedownHandler",value:function(t){var e,i;if(3!==t.which&&2!==t.button){var o=t.target||t.srcElement;if(i=this._getSourceDefinition(t),(null==i||(e=this._resolveDragParent(i.def.def,o),null!=e&&e.getAttribute(ul)!==Ko))&&i){var r,s=t.currentTarget;if(o.getAttribute(ul)!==Ko){mi(t),this._activeDefinition=i,r=i.def.def;var a=To(t,e,this.instance.currentZoom),l={element:e};if(n(l,r),l.isTemporarySource=!0,r.scope)l.scope=r.scope;else{var u=o.getAttribute(cl);null!=u&&(l.scope=u)}var c=r.parameterExtractor?r.parameterExtractor(e,o):{};if(l=p(l,c),null!=l.maxConnections&&l.maxConnections>=0){var h=this.instance.select({source:e}).length;if(h>=l.maxConnections)return mi(t),r.onMaxConnections&&r.onMaxConnections({element:e,maxConnections:l.maxConnections},t),t.stopImmediatePropagation&&t.stopImmediatePropagation(),!1}this._originalAnchor=l.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor),l.anchor=[a.x,a.y,0,0],l.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(l);var d={};if(r.extract){for(var f in r.extract){var v=o.getAttribute(f);v&&(d[r.extract[f]]=v)}this.ep.mergeParameters(d)}if(l.uniqueEndpoint){var y=this.ep.elementId,g=this.instance.getManagedData(y,sc,i.id);null==g?(this.instance.setManagedData(y,sc,i.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=g}s._jsPlumbOrphanedEndpoints=s._jsPlumbOrphanedEndpoints||[],s._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,xl,t,d)}}}}},{key:"_mouseupHandler",value:function(t){var e=t.currentTarget||t.srcElement;e._jsPlumbOrphanedEndpoints&&(R(e._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),e._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(t){var e=this.instance.getOffset(t),n=this.instance.getSize(t);return this._makeDraggablePlaceholder(e,n),this.placeholderInfo.element.jtk=t.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(t){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(t,e){this.placeholderInfo=this.placeholderInfo||{};var n=Oi(fl,{position:"absolute"});this.instance._appendElement(n,this.instance.getContainer());var i=this.instance.getId(n);return this.instance.setPosition(n,t),n.style.width=e.w+"px",n.style.height=e.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n,n}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var t=this.instance.getContainer();this.instance.off(t,Cl,this.mouseupHandler),this.instance.off(t,xl,this.mousedownHandler)}},{key:"init",value:function(t){}},{key:"startNewConnectionDrag",value:function(t,e){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:t,data:e}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(Il,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var t=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.floatingEndpoint.addClass(this.instance.draggingClass),this.instance.fire(Il,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[t].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,t),this.jpc.suspendedEndpoint=this.jpc.endpoints[t],this.jpc.suspendedElement=this.jpc.endpoints[t].element,this.jpc.suspendedElementId=this.jpc.endpoints[t].elementId,this.jpc.suspendedElementType=0===t?fr:vr,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[t]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=t}},{key:"_shouldStartDrag",value:function(){var t=!0;this.ep.enabled||(t=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(t=!1),!this.ep.isSource||!this.ep.isFull()||null!=this.jpc&&this.ep.dragAllowedWhenFull||(t=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?t=!1:this.jpc=null);var e={},i=this.instance.checkCondition(null==this.jpc?hs:fs,{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return i===!1?t=!1:"object"===Zn(i)?(e=i,n(e,this.payload||{})):e=this.payload||{},[t,e]}},{key:"_createFloatingEndpoint",value:function(t){var e=this.ep.endpoint;if(null!=this.ep.edgeType){var n=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType);e=n.endpoints[1]}this.floatingEndpoint=bo(this.ep.getPaintStyle(),e,t,this.placeholderInfo.element,this.instance,this.ep.scope),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(t,e){var n,i=this,o=this.jpc&&this.jpc.endpoints[0]===this.ep,r=this.instance.getContainer().querySelectorAll([".",jr,"[",wr,this.ep.scope,"]"].join(""));if(x(r,function(e){if((null!=i.jpc||e!==t)&&e!==i.floatingElement&&!e.jtk.endpoint.isFull()&&(o&&e.jtk.endpoint.isSource||!o&&e.jtk.endpoint.isTarget)){var r=i.instance.getOffset(e),s=i.instance.getSize(e);n={x:r.x,y:r.y,w:s.w,h:s.h},i.endpointDropTargets.push({el:e,targetEl:e,r:n,endpoint:e.jtk.endpoint,def:null}),i.instance.addClass(e,tc)}}),o){var s=k(this.instance.sourceSelectors,function(t){return t.isEnabled()&&(null==t.def.def.scope||t.def.def.scope===i.ep.scope)});if(null!=s){var a=this.instance.getContainer().querySelectorAll(s.redrop===wa?vs:s.selector);x(a,function(t){if(t.getAttribute(ul)!==Ko){var e=t.getAttribute(cl);if(null!=e&&e!==i.ep.scope)return;var n={r:null,el:t};n.targetEl=_i(t,vs,i.instance.getContainer(),!0);var o=i.instance.getOffset(n.el),r=i.instance.getSize(n.el);n.r={x:o.x,y:o.y,w:r.w,h:r.h},null!=s.def.def.rank&&(n.rank=s.def.def.rank),n.def=s,i.endpointDropTargets.push(n),i.instance.addClass(n.targetEl,tc)}})}}else{var l=C(this.instance.targetSelectors,function(t){return t.isEnabled()});l.forEach(function(t){var n=i.instance.getContainer().querySelectorAll(t.selector);x(n,function(n){if(n.getAttribute(ul)!==Ko){var o=n.getAttribute(cl);if(null!=o&&o!==i.ep.scope)return;var r={r:null,el:n};if(null!=t.def.def.parentSelector&&(r.targetEl=_i(n,t.def.def.parentSelector,i.instance.getContainer(),!0)),null==r.targetEl&&(r.targetEl=_i(n,vs,i.instance.getContainer(),!0)),(t.def.def.allowLoopback===!1||i._activeDefinition&&i._activeDefinition.def.def.allowLoopback===!1)&&r.targetEl===i.ep.element)return;var s=t.def.def.maxConnections;if(t.def.def.parameterExtractor){var a=t.def.def.parameterExtractor(r.targetEl,e);null!=a.maxConnections&&(s=a.maxConnections)}if(null!=s&&-1!==s&&i.instance.select({target:r.targetEl}).length>=s)return;var l=i.instance.getOffset(n),u=i.instance.getSize(n);r.r={x:l.x,y:l.y,w:u.w,h:u.h},r.def=t.def,null!=t.def.def.rank&&(r.rank=t.def.def.rank),i.endpointDropTargets.push(r),i.instance.addClass(r.targetEl,tc)}})})}this.endpointDropTargets.sort(function(t,e){if(t.targetEl._isJsPlumbGroup&&!e.targetEl._isJsPlumbGroup)return 1;if(!t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup)return-1;if(t.targetEl._isJsPlumbGroup&&e.targetEl._isJsPlumbGroup){if(i.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup))return-1;if(i.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup))return 1}else{if(null==t.rank||null==e.rank)return 0;if(t.rank>e.rank)return-1;if(t.rank<e.rank)return 1}})}},{key:"onStart",value:function(t){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var e=t.drag.getDragElement();this.ep=e.jtk.endpoint;var n=t.e.srcElement||t.e.target;if(!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var i=this._shouldStartDrag(),o=hi(i,2),r=o[0],s=o[1];return r===!1?(this._stopped=!0,!1):(this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,n),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,s):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc,this.floatingEndpoint),void(this.instance.currentlyDragging=!0))}},{key:"onBeforeStart",value:function(t){this.payload=t.e.payload||{}}},{key:"onDrag",value:function(t){if(this._stopped)return!0;if(this.placeholderInfo.element){var e=this.instance.getSize(this.floatingElement);this.instance.setElementPosition(this.placeholderInfo.element,t.pos.x,t.pos.y);for(var n,i,o,r={x:t.pos.x,y:t.pos.y,w:e.w,h:e.h},s=0;s<this.endpointDropTargets.length;s++)if(ut(r,this.endpointDropTargets[s].r)){n=this.endpointDropTargets[s];break}if(n!==this.currentDropTarget&&null!=this.currentDropTarget&&(i=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,nc),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=n&&(this.instance.addClass(n.el,nc),i=this._getFloatingAnchorIndex(),null!=n.endpoint))if(o=n.endpoint.isSource&&0===i||n.endpoint.isTarget&&0!==i||this.jpc.suspendedEndpoint&&n.endpoint.referenceEndpoint&&n.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id){var a=this.instance.checkCondition(Dr,{sourceEndpoint:this.jpc.endpoints[i],targetEndpoint:n.endpoint.endpoint,connection:this.jpc});a?(n.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(n.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(n.endpoint),this.instance.paintConnection(this.jpc)}else n=null;this.currentDropTarget=n}}},{key:"_maybeCleanup",value:function(t){t._mtNew&&0===t.connections.length?this.instance.deleteEndpoint(t):delete t._mtNew}},{key:"_reattachOrDiscard",value:function(t){var e=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return e&&this._shouldReattach(t)?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,t),!1)}},{key:"onStop",value:function(t){var e=this,n=t.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var i=Wt(nc,tc),o=this.instance.getContainer().querySelectorAll(rc);if(x(o,function(t){e.instance.removeClass(t,i)}),this.jpc&&null!=this.jpc.endpoints){var r,s=null!=this.jpc.suspendedEndpoint,a=this._getFloatingAnchorIndex(),l=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget)if(r=this._getDropEndpoint(t,this.jpc),null==r)!this._reattachOrDiscard(t.e);else if(l&&l.id===r.id)this._doForceReattach(a);else if(r.enabled)if(r.isFull())r.fire(rs,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},n),this._reattachOrDiscard(t.e);else{0===a?(this.jpc.source=r.element,this.jpc.sourceId=r.elementId):(this.jpc.target=r.element,this.jpc.targetId=r.elementId);var u=!0;s&&this.jpc.suspendedEndpoint.id!==r.id&&(this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[a].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(u=!1)),u=u&&r.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,r),u?this._drop(r,a,n,u):this._reattachOrDiscard(t.e)}else this._reattachOrDiscard(t.e);else this._reattachOrDiscard(t.e);this.instance.refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=r&&this._maybeCleanup(r)}}},{key:"_getSourceDefinition",value:function(t){for(var e,n=0;n<this.instance.sourceSelectors.length;n++)if(e=this.instance.sourceSelectors[n],e.isEnabled()){var i=ko(t,this.instance.getContainer(),e.selector,this.instance,e.exclude);if(i!==!1)return e}}},{key:"_getDropEndpoint",value:function(t,e){var i;if(null==this.currentDropTarget.endpoint){var o=this.currentDropTarget.def,r=t.e.target||t.e.srcElement;if(null==o)return null;var s=this.instance._deriveEndpointAndAnchorSpec(e.getType().join(" "),!0),a=s.endpoints?n(t,{endpoint:o.def.endpoint||s.endpoints[1]}):t,l=this.instance.validAnchorsSpec(s.anchors)?s.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null;l&&(a=n(a,{anchor:o.def.anchor||l[1]})),null!=o.def.portId&&(a.portId=o.def.portId);var u=o.def.parameterExtractor?o.def.parameterExtractor(this.currentDropTarget.el,r):{};if(a=p(a,u),a.element=this.currentDropTarget.targetEl,i=this.instance._internal_newEndpoint(a),i._mtNew=!0,i.deleteOnEmpty=!0,o.def.parameters&&i.mergeParameters(o.def.parameters),o.def.extract){var c={};for(var h in o.def.extract){var d=this.currentDropTarget.el.getAttribute(h);d&&(c[o.def.extract[h]]=d)}i.mergeParameters(c)}}else i=this.currentDropTarget.endpoint;return i&&(i.removeClass(this.instance.endpointDropAllowedClass),i.removeClass(this.instance.endpointDropForbiddenClass)),i}},{key:"_doForceReattach",value:function(t){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,t),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(t){return this.jpc.isReattach()||this.jpc._forceReattach||!m(!0,!1,[[this.jpc.endpoints[0],cs,[this.jpc]],[this.jpc.endpoints[1],cs,[this.jpc]],[this.jpc,cs,[this.jpc]],[this.instance,Ar,[ps,this.jpc]]])}},{key:"_discard",value:function(t,e){this.jpc.pending?this.instance.fire(Ml,this.jpc,e):(0===t?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[t]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:e,force:!0})}},{key:"_drop",value:function(t,e,n,i){if(this.jpc.endpoints[e].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[e]=t,t.addConnection(this.jpc),this.jpc.suspendedEndpoint){var o=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:e,originalSourceId:0===e?o:this.jpc.sourceId,newSourceId:0===e?t.elementId:this.jpc.sourceId,originalTargetId:1===e?o:this.jpc.targetId,newTargetId:1===e?t.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:t},n)}if(1===e?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint){var r=this.jpc.endpoints[0];r.detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc)}s(i)&&this.jpc.mergeData(i),this._originalAnchor&&(this.jpc.endpoints[0].setAnchor(this._originalAnchor),this._originalAnchor=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(t,e,n){this.floatingConnections[t.id]=e,O(this.instance.endpointsByElement,t.id,n)}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),t}(),lc=function(t){function e(t,i){var o;return $n(this,e),o=n.call(this,t,i),o.instance=t,o.dragSelection=i,ei(si(o),"selector",[">",cu,vs].join(" ")),ei(si(o),"doRevalidate",void 0),o.doRevalidate=o._revalidate.bind(si(o)),o}ni(e,t);var n=li(e);return ti(e,[{key:"reset",value:function(){this.drag.off(Ol,this.doRevalidate)}},{key:"_revalidate",value:function(t){this.instance.revalidate(t)}},{key:"init",value:function(t){this.drag=t,t.on(Ol,this.doRevalidate)}},{key:"useGhostProxy",value:function(t,e){var n=e._jsPlumbParentGroup;return null==n?!1:n.ghost===!0}},{key:"makeGhostProxy",value:function(t){var e=t,n=e.cloneNode(!0);return n._jsPlumbParentGroup=e._jsPlumbParentGroup,n}}]),e}(oc),uc=function(){function t(e,n){$n(this,t),this.instance=e,this.overlay=n,ei(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=n}return ti(t,null,[{key:"createElement",value:function(t){var e=Oi(fl,{},t.instance.overlayClass+" "+(t.cssClass?t.cssClass:""));return t.instance.setAttribute(e,"jtk-overlay-id",t.id),e}},{key:"getElement",value:function(e,n,i){if(null==e.canvas){i&&n?e.canvas=i(n):e.canvas=t.createElement(e),e.canvas.style.position=xr,e.instance._appendElement(e.canvas,e.instance.getContainer()),e.instance.getId(e.canvas);var o="translate(-50%, -50%)";e.canvas.style.webkitTransform=o,e.canvas.style.mozTransform=o,e.canvas.style.msTransform=o,e.canvas.style.oTransform=o,e.canvas.style.transform=o,e.isVisible()||(e.canvas.style.display=gr),e.canvas.jtk={overlay:e}}return e.canvas}},{key:"destroy",value:function(t){t.canvas&&t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),delete t.canvas,delete t.cachedDimensions}},{key:"_getDimensions",value:function(t,e){return(null==t.cachedDimensions||e)&&(t.cachedDimensions={w:1,h:1}),t.cachedDimensions}}]),t}(),cc=function(t){function e(){var t;$n(this,e);for(var i=arguments.length,o=new Array(i),r=0;i>r;r++)o[r]=arguments[r];return t=n.call.apply(n,[this].concat(o)),ei(si(t),"path",void 0),t}ni(e,t);var n=li(e);return ti(e,null,[{key:"ensurePath",value:function(t){if(null==t.path){t.path=Li(rl,{"jtk-overlay-id":t.id});var e=null;if(t.component instanceof da){var n=t.component.connector;e=null!=n?n.canvas:null}else if(t.component instanceof va){var i=t.component.endpoint;e=null!=i?i.svg:i}null!=e&&Fi(e,t.path,1),t.instance.addClass(t.path,t.instance.overlayClass),t.path.jtk={overlay:t}}return t.path}},{key:"paint",value:function(t,e,n,i){this.ensurePath(t);var o=[0,0];i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin);var r={d:e,stroke:n.stroke?n.stroke:null,fill:n.fill?n.fill:null,transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"};Ni(t.path,r)}},{key:"destroy",value:function(t,e){var n=t;null!=n.path&&null!=n.path.parentNode&&n.path.parentNode.removeChild(n.path),null!=n.bgPath&&null!=n.bgPath.parentNode&&n.bgPath.parentNode.removeChild(n.bgPath),delete n.path,delete n.bgPath}}]),e}(Es),hc=function(){function t(){$n(this,t)}return ti(t,null,[{key:"paint",value:function(t,e,n,i){if(null!=n){var o,r=[t.x,t.y],s=[t.w,t.h];null!=i&&(i.xmin<0&&(r[0]+=i.xmin),i.ymin<0&&(r[1]+=i.ymin),s[0]=i.xmax+(i.xmin<0?-i.xmin:0),s[1]=i.ymax+(i.ymin<0?-i.ymin:0)),isFinite(s[0])&&isFinite(s[1])&&(e?(Bi(t.canvas,r[0],r[1],s[0],s[1]),r[0]=0,r[1]=0,o=Gi([0,0]),Ni(t.svg,{style:o,width:""+(s[0]||0),height:""+(s[1]||0)})):(o=Gi([r[0],r[1]]),Ni(t.canvas,{style:o,width:""+(s[0]||0),height:""+(s[1]||0)})))}}}]),t}(),dc=function(){function t(){$n(this,t)}return ti(t,null,[{key:"getEndpointElement",value:function(t){if(null!=t.canvas)return t.canvas;var e=Li(ol,{style:"",width:"0",height:"0","pointer-events":gr,position:xr});t.svg=e;var n=Oi(fl,{position:xr});t.canvas=n;var i=t.classes.join(" ");t.instance.addClass(n,i);for(var o=t.endpoint.scope.split(/\s/),r=0;r<o.length;r++)t.instance.setAttribute(n,wr+o[r],Jo);return t.instance._suspendDrawing||Bi(n,0,0,1,1),t.instance._appendElement(n,t.instance.getContainer()),n.appendChild(e),null!=t.cssClass&&t.instance.addClass(n,t.cssClass),t.instance.addClass(n,t.instance.endpointClass),n.jtk=n.jtk||{},n.jtk.endpoint=t.endpoint,n.style.display=t.endpoint.visible!==!1?yr:gr,n}},{key:"paint",value:function(t,e,i){this.getEndpointElement(t),hc.paint(t,!0,i);var o=n({},i);o.outlineStroke&&(o.stroke=o.outlineStroke),null==t.node?(t.node=e.makeNode(t,o),t.svg.appendChild(t.node)):null!=e.updateNode&&e.updateNode(t,t.node),Ri(t.canvas,t.node,o)}}]),t}(),pc={},fc=function(t){function e(t,i){var o;$n(this,e),o=n.call(this,t,i),o._instanceIndex=t,ei(si(o),"dragSelection",void 0),ei(si(o),"dragManager",void 0),ei(si(o),"_connectorClick",void 0),ei(si(o),"_connectorDblClick",void 0),ei(si(o),"_connectorTap",void 0),ei(si(o),"_connectorDblTap",void 0),ei(si(o),"_endpointClick",void 0),ei(si(o),"_endpointDblClick",void 0),ei(si(o),"_overlayClick",void 0),ei(si(o),"_overlayDblClick",void 0),ei(si(o),"_overlayTap",void 0),ei(si(o),"_overlayDblTap",void 0),ei(si(o),"_connectorMouseover",void 0),ei(si(o),"_connectorMouseout",void 0),ei(si(o),"_endpointMouseover",void 0),ei(si(o),"_endpointMouseout",void 0),ei(si(o),"_connectorContextmenu",void 0),ei(si(o),"_connectorMousedown",void 0),ei(si(o),"_connectorMouseup",void 0),ei(si(o),"_endpointMousedown",void 0),ei(si(o),"_endpointMouseup",void 0),ei(si(o),"_overlayMouseover",void 0),ei(si(o),"_overlayMouseout",void 0),ei(si(o),"_elementClick",void 0),ei(si(o),"_elementTap",void 0),ei(si(o),"_elementDblTap",void 0),ei(si(o),"_elementMouseenter",void 0),ei(si(o),"_elementMouseexit",void 0),ei(si(o),"_elementMousemove",void 0),ei(si(o),"_elementMouseup",void 0),ei(si(o),"_elementMousedown",void 0),ei(si(o),"_elementContextmenu",void 0),ei(si(o),"eventManager",void 0),ei(si(o),"draggingClass","jtk-dragging"),ei(si(o),"elementDraggingClass","jtk-element-dragging"),ei(si(o),"hoverClass","jtk-hover"),ei(si(o),"sourceElementDraggingClass","jtk-source-element-dragging"),ei(si(o),"targetElementDraggingClass","jtk-target-element-dragging"),ei(si(o),"hoverSourceClass","jtk-source-hover"),ei(si(o),"hoverTargetClass","jtk-target-hover"),ei(si(o),"dragSelectClass","jtk-drag-select"),
ei(si(o),"managedElementsSelector",void 0),ei(si(o),"elementsDraggable",void 0),ei(si(o),"elementDragHandler",void 0),ei(si(o),"groupDragOptions",void 0),ei(si(o),"elementDragOptions",void 0),ei(si(o),"svg",{node:function(t,e){return Li(t,e)},attr:function(t,e){return Ni(t,e)},pos:function(t){return Gi(t)}}),o.elementsDraggable=i&&i.elementsDraggable!==!1,o.managedElementsSelector=i?i.managedElementsSelector||vs:vs,o.eventManager=new Cu,o.dragSelection=new Ju(si(o)),o.dragManager=new ic(si(o),o.dragSelection),o.dragManager.addHandler(new ac(si(o))),o.groupDragOptions={constrainFunction:jo},o.dragManager.addHandler(new lc(si(o),o.dragSelection),o.groupDragOptions),o.elementDragHandler=new oc(si(o),o.dragSelection),o.elementDragOptions=i&&i.dragOptions||{},o.dragManager.addHandler(o.elementDragHandler,o.elementDragOptions),i&&i.dragOptions&&i.dragOptions.filter&&o.dragManager.addFilter(i.dragOptions.filter);var r=function(t,e){if(!e.defaultPrevented&&null==e._jsPlumbOverlay){var n=_i(xi(e),lu,this.getContainer(),!0);this.fire(t,n.jtk.connector.connection,e)}};o._connectorClick=r.bind(si(o),$l),o._connectorDblClick=r.bind(si(o),Ql),o._connectorTap=r.bind(si(o),su),o._connectorDblTap=r.bind(si(o),tu);var s=function(t,e){var n=xi(e).parentNode;if(n.jtk&&n.jtk.connector){var i=n.jtk.connector,o=i.connection;this.setConnectorHover(i,t),t?(this.addClass(o.source,this.hoverSourceClass),this.addClass(o.target,this.hoverTargetClass)):(this.removeClass(o.source,this.hoverSourceClass),this.removeClass(o.target,this.hoverTargetClass)),this.fire(t?nu:eu,n.jtk.connector.connection,e)}};o._connectorMouseover=s.bind(si(o),!0),o._connectorMouseout=s.bind(si(o),!1);var a=function(t,e){var n=xi(e).parentNode;n.jtk&&n.jtk.connector&&this.fire(t?iu:ou,n.jtk.connector.connection,e)};o._connectorMouseup=a.bind(si(o),!0),o._connectorMousedown=a.bind(si(o),!1),o._connectorContextmenu=function(t){var e=xi(t).parentNode;e.jtk&&e.jtk.connector&&this.fire(ru,e.jtk.connector.connection,t)}.bind(si(o));var l=function(t,e,n){e.defaultPrevented||null!=e._jsPlumbOverlay||this.fire(t,n.jtk.endpoint,e)};o._endpointClick=l.bind(si(o),Xl),o._endpointDblClick=l.bind(si(o),Yl);var u=function(t,e){var n=xi(e);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,t),this.fire(t?ql:Wl,n.jtk.endpoint,e))};o._endpointMouseover=u.bind(si(o),!0),o._endpointMouseout=u.bind(si(o),!1);var c=function(t,e){var n=xi(e);n.jtk&&n.jtk.endpoint&&this.fire(t?Jl:Kl,n.jtk.endpoint,e)};o._endpointMouseup=c.bind(si(o),!0),o._endpointMousedown=c.bind(si(o),!1);var h=function(t,e){var n=_i(xi(e),du,this.getContainer(),!0),i=n.jtk.overlay;i&&this.fireOverlayMethod(i,t,e)}.bind(si(o));o._overlayClick=h.bind(si(o),vl),o._overlayDblClick=h.bind(si(o),gl),o._overlayTap=h.bind(si(o),Tl),o._overlayDblTap=h.bind(si(o),ml);var d=function(t,e){var n=_i(xi(e),du,this.getContainer(),!0),i=n.jtk.overlay;i&&this.setOverlayHover(i,t)};o._overlayMouseover=d.bind(si(o),!0),o._overlayMouseout=d.bind(si(o),!1);var p=function(t,e,n){e.defaultPrevented||this.fire(1===e.detail?jl:Nl,n,e)};o._elementClick=p.bind(si(o),jl);var f=function(t,e,n){e.defaultPrevented||this.fire(Ul,n,e)};o._elementTap=f.bind(si(o),Ul);var v=function(t,e,n){e.defaultPrevented||this.fire(Ll,n,e)};o._elementDblTap=v.bind(si(o),Ll);var y=function(t,e){this.fire(t?Rl:Gl,xi(e),e)};return o._elementMouseenter=y.bind(si(o),!0),o._elementMouseexit=y.bind(si(o),!1),o._elementMousemove=function(t){this.fire(Fl,xi(t),t)}.bind(si(o)),o._elementMouseup=function(t){this.fire(Bl,xi(t),t)}.bind(si(o)),o._elementMousedown=function(t){this.fire(Vl,xi(t),t)}.bind(si(o)),o._elementContextmenu=function(t){this.fire(Hl,xi(t),t)}.bind(si(o)),o._attachEventDelegates(),o}ni(e,t);var n=li(e);return ti(e,[{key:"fireOverlayMethod",value:function(t,e,n){var i=t.component instanceof da?pl:hl,o=Vi(i,e);n._jsPlumbOverlay=t,t.fire(e,{e:n,overlay:t}),this.fire(o,t.component,n)}},{key:"addDragFilter",value:function(t,e){this.dragManager.addFilter(t,e)}},{key:"removeDragFilter",value:function(t){this.dragManager.removeFilter(t)}},{key:"setDragGrid",value:function(t){this.dragManager.setOption(this.elementDragHandler,{grid:t})}},{key:"_removeElement",value:function(t){t.parentNode&&t.parentNode.removeChild(t)}},{key:"_appendElement",value:function(t,e){e&&e.appendChild(t)}},{key:"_getAssociatedElements",value:function(t){var e=[];if(3!==t.nodeType&&8!==t.nodeType){var n=t.querySelectorAll(vs);Array.prototype.push.apply(e,n)}return e.filter(function(t){return 3!==t.nodeType&&8!==t.nodeType})}},{key:"shouldFireEvent",value:function(t,e,n){return!0}},{key:"getClass",value:function(t){return Pi(t)}},{key:"addClass",value:function(t,e){Ti(t,e)}},{key:"hasClass",value:function(t,e){return wi(t,e)}},{key:"removeClass",value:function(t,e){Ai(t,e)}},{key:"toggleClass",value:function(t,e){Di(t,e)}},{key:"setAttribute",value:function(t,e,n){t.setAttribute(e,n)}},{key:"getAttribute",value:function(t,e){return t.getAttribute(e)}},{key:"setAttributes",value:function(t,e){for(var n in e)t.setAttribute(n,e[n])}},{key:"removeAttribute",value:function(t,e){t.removeAttribute&&t.removeAttribute(e)}},{key:"on",value:function(t,e,n,i){var o=this,r=function(t){null==i?o.eventManager.on(t,e,n):o.eventManager.on(t,e,n,i)};return Ci(t)?x(t,function(t){return r(t)}):r(t),this}},{key:"off",value:function(t,e,n){var i=this;return Ci(t)?x(t,function(t){return i.eventManager.off(t,e,n)}):this.eventManager.off(t,e,n),this}},{key:"trigger",value:function(t,e,n,i,o){this.eventManager.trigger(t,e,n,i,o)}},{key:"getOffsetRelativeToRoot",value:function(t){return Ii(t)}},{key:"getOffset",value:function(t){for(var e=t,n=this.getContainer(),i={x:e.offsetLeft,y:e.offsetTop},o=t!==n&&e.offsetParent!==n?e.offsetParent:null,r=function(t){null!=t&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(i.x-=t.scrollLeft,i.y-=t.scrollTop)};null!=o;)i.x+=o.offsetLeft,i.y+=o.offsetTop,r(o),o=o.offsetParent===n?null:o.offsetParent;if(null!=n&&(n.scrollTop>0||n.scrollLeft>0)){var s=null!=e.offsetParent?this.getStyle(e.offsetParent,au):br,a=this.getStyle(e,au);a!==xr&&a!==Er&&s!==xr&&s!==Er&&(i.x-=n.scrollLeft,i.y-=n.scrollTop)}return i}},{key:"getSize",value:function(t){return ji(t)}},{key:"getStyle",value:function(t,e){return Zn(window.getComputedStyle)!==Wo?getComputedStyle(t,null).getPropertyValue(e):t.currentStyle[e]}},{key:"getGroupContentArea",value:function(t){var e=this.getSelector(t.el,hu);return e&&e.length>0?e[0]:t.el}},{key:"getSelector",value:function(t,e){var n=null;if(1===arguments.length){if(!o(t)){var i=document.createDocumentFragment();return i.appendChild(t),w(i.childNodes)}n=w(document.querySelectorAll(t))}else n=w(t.querySelectorAll(e));return n}},{key:"setPosition",value:function(t,e){var n=t;n.style.left=e.x+"px",n.style.top=e.y+"px"}},{key:"setDraggable",value:function(t,e){e?this.removeAttribute(t,Sr):this.setAttribute(t,Sr,Jo)}},{key:"isDraggable",value:function(t){var e=this.getAttribute(t,Sr);return null==e||e===Ko}},{key:"toggleDraggable",value:function(t){var e=this.isDraggable(t);return this.setDraggable(t,!e),!e}},{key:"_attachEventDelegates",value:function(){var t=this.getContainer();this.eventManager.on(t,vl,du,this._overlayClick),this.eventManager.on(t,gl,du,this._overlayDblClick),this.eventManager.on(t,Tl,du,this._overlayTap),this.eventManager.on(t,ml,du,this._overlayDblTap),this.eventManager.on(t,vl,lu,this._connectorClick),this.eventManager.on(t,gl,lu,this._connectorDblClick),this.eventManager.on(t,Tl,lu,this._connectorTap),this.eventManager.on(t,ml,lu,this._connectorDblTap),this.eventManager.on(t,vl,uu,this._endpointClick),this.eventManager.on(t,gl,uu,this._endpointDblClick),this.eventManager.on(t,vl,this.managedElementsSelector,this._elementClick),this.eventManager.on(t,Tl,this.managedElementsSelector,this._elementTap),this.eventManager.on(t,ml,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(t,Pl,lu,this._connectorMouseover),this.eventManager.on(t,Sl,lu,this._connectorMouseout),this.eventManager.on(t,yl,lu,this._connectorContextmenu),this.eventManager.on(t,Cl,lu,this._connectorMouseup),this.eventManager.on(t,xl,lu,this._connectorMousedown),this.eventManager.on(t,Pl,uu,this._endpointMouseover),this.eventManager.on(t,Sl,uu,this._endpointMouseout),this.eventManager.on(t,Cl,uu,this._endpointMouseup),this.eventManager.on(t,xl,uu,this._endpointMousedown),this.eventManager.on(t,Pl,du,this._overlayMouseover),this.eventManager.on(t,Sl,du,this._overlayMouseout),this.eventManager.on(t,Pl,vs,this._elementMouseenter),this.eventManager.on(t,Sl,vs,this._elementMouseexit),this.eventManager.on(t,kl,vs,this._elementMousemove),this.eventManager.on(t,Cl,vs,this._elementMouseup),this.eventManager.on(t,xl,vs,this._elementMousedown),this.eventManager.on(t,yl,vs,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var t=this.getContainer();t&&(this.eventManager.off(t,vl,this._connectorClick),this.eventManager.off(t,gl,this._connectorDblClick),this.eventManager.off(t,Tl,this._connectorTap),this.eventManager.off(t,ml,this._connectorDblTap),this.eventManager.off(t,vl,this._endpointClick),this.eventManager.off(t,gl,this._endpointDblClick),this.eventManager.off(t,vl,this._overlayClick),this.eventManager.off(t,gl,this._overlayDblClick),this.eventManager.off(t,Tl,this._overlayTap),this.eventManager.off(t,ml,this._overlayDblTap),this.eventManager.off(t,vl,this._elementClick),this.eventManager.off(t,Tl,this._elementTap),this.eventManager.off(t,ml,this._elementDblTap),this.eventManager.off(t,Pl,this._connectorMouseover),this.eventManager.off(t,Sl,this._connectorMouseout),this.eventManager.off(t,yl,this._connectorContextmenu),this.eventManager.off(t,Cl,this._connectorMouseup),this.eventManager.off(t,xl,this._connectorMousedown),this.eventManager.off(t,Pl,this._endpointMouseover),this.eventManager.off(t,Sl,this._endpointMouseout),this.eventManager.off(t,Cl,this._endpointMouseup),this.eventManager.off(t,xl,this._endpointMousedown),this.eventManager.off(t,Pl,this._overlayMouseover),this.eventManager.off(t,Sl,this._overlayMouseout),this.eventManager.off(t,El,this._elementMouseenter),this.eventManager.off(t,bl,this._elementMouseexit),this.eventManager.off(t,kl,this._elementMousemove),this.eventManager.off(t,Cl,this._elementMouseup),this.eventManager.off(t,xl,this._elementMousedown),this.eventManager.off(t,yl,this._elementContextmenu))}},{key:"setContainer",value:function(t){var n=this;if(t===document||t===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates();var i;null!=this.dragManager&&(i=this.dragManager.reset()),this.setAttribute(t,al,j().replace("-",""));var o=this.getContainer();if(null!=o){o.removeAttribute(al);var r=w(o.childNodes).filter(function(t){return null!=t&&(n.hasClass(t,Or)||n.hasClass(t,jr)||n.hasClass(t,Hr)||t.getAttribute&&null!=t.getAttribute(Cr))});x(r,function(e){t.appendChild(e)})}ci(ii(e.prototype),"setContainer",this).call(this,t),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new ac(this)),this.dragManager.addHandler(new lc(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new oc(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=i&&this.dragManager.setFilters(i))}},{key:"reset",value:function(){ci(ii(e.prototype),"reset",this).call(this);var t=this.getContainer(),n=t.querySelectorAll([vs,uu,lu,du].join(","));x(n,function(t){return t.parentNode&&t.parentNode.removeChild(t)})}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),ci(ii(e.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(t,n){this.removeFromDragSelection(t),ci(ii(e.prototype),"unmanage",this).call(this,t,n)}},{key:"addToDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;e>i;i++)n[i]=arguments[i];x(n,function(e){return t.dragSelection.add(e)})}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;e>i;i++)n[i]=arguments[i];x(n,function(e){return t.dragSelection.remove(e)})}},{key:"toggleDragSelection",value:function(){for(var t=this,e=arguments.length,n=new Array(e),i=0;e>i;i++)n[i]=arguments[i];x(n,function(e){return t.dragSelection.toggle(e)})}},{key:"addToDragGroup",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;n>o;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).addToDragGroup.apply(e,[t].concat(i))}},{key:"removeFromDragGroup",value:function(){var t;(t=this.elementDragHandler).removeFromDragGroup.apply(t,arguments)}},{key:"setDragGroupState",value:function(t){for(var e,n=arguments.length,i=new Array(n>1?n-1:0),o=1;n>o;o++)i[o-1]=arguments[o];(e=this.elementDragHandler).setDragGroupState.apply(e,[t].concat(i))}},{key:"consume",value:function(t,e){mi(t,e)}},{key:"rotate",value:function(t,n,i){var o=this.getId(t);return this._managedElements[o]?(this._managedElements[o].el.style.transform="rotate("+n+"deg)",this._managedElements[o].el.style.transformOrigin="center center",ci(ii(e.prototype),"rotate",this).call(this,t,n,i)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(t,e){if(Zt(t))t.instance.addClass(Mo(t),e);else if(wo(t))t.instance.addClass(cc.ensurePath(t),e);else{if(!We(t))throw"Could not add class to overlay of type ["+t.type+"]";t.instance.addClass(Io(t),e)}}},{key:"removeOverlayClass",value:function(t,e){if(Zt(t))t.instance.removeClass(Mo(t),e);else if(wo(t))t.instance.removeClass(cc.ensurePath(t),e);else{if(!We(t))throw"Could not remove class from overlay of type ["+t.type+"]";t.instance.removeClass(Io(t),e)}}},{key:"paintOverlay",value:function(t,e,n){if(Zt(t)){Mo(t);var i=t.component.getXY();t.canvas.style.left=i.x+e.d.minx+"px",t.canvas.style.top=i.y+e.d.miny+"px"}else if(wo(t)){var o=isNaN(e.d.cxy.x)||isNaN(e.d.cxy.y)?"M 0 0":"M"+e.d.hxy.x+","+e.d.hxy.y+" L"+e.d.tail[0].x+","+e.d.tail[0].y+" L"+e.d.cxy.x+","+e.d.cxy.y+" L"+e.d.tail[1].x+","+e.d.tail[1].y+" L"+e.d.hxy.x+","+e.d.hxy.y;cc.paint(t,o,e,n)}else{if(!We(t))throw"Could not paint overlay of type ["+t.type+"]";Io(t);var r=t.component.getXY();t.canvas.style.left=r.x+e.d.minx+"px",t.canvas.style.top=r.y+e.d.miny+"px"}}},{key:"setOverlayVisible",value:function(t,e){function n(t){null!=t&&(t.style.display=i)}var i=e?"block":"none";Zt(t)?n(Mo(t)):We(t)?n(Io(t)):wo(t)&&n(t.path)}},{key:"reattachOverlay",value:function(t,e){Zt(t)?t.instance._appendElement(Mo(t),this.getContainer()):We(t)?t.instance._appendElement(Io(t),this.getContainer()):wo(t)&&this._appendElement(cc.ensurePath(t),e.connector.canvas)}},{key:"setOverlayHover",value:function(t,e){var n;Zt(t)?n=Mo(t):We(t)?n=Io(t):wo(t)&&(n=cc.ensurePath(t)),null!=n&&(null!=this.hoverClass&&(e?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(t.component,e))}},{key:"destroyOverlay",value:function(t){if(Zt(t)){var e=Mo(t);e.parentNode.removeChild(e),delete t.canvas,delete t.cachedDimensions}else if(Xe(t)||ze(t)||Ye(t))cc.destroy(t);else if(We(t)){var n=Io(t);n.parentNode.removeChild(n),delete t.canvas,delete t.cachedDimensions}}},{key:"drawOverlay",value:function(t,e,n,i){if(Zt(t)||We(t)){var r=uc._getDimensions(t);if(null!=r&&null!=r.w&&null!=r.h){var s={x:0,y:0};if(i)s={x:i.x,y:i.y};else if(e instanceof nr){var a=Array.isArray(t.location)?t.location:[t.location,t.location];s={x:a[0]*e.w,y:a[1]*e.h}}else{var l=t.location,u=!1;(o(t.location)||t.location<0||t.location>1)&&(l=parseInt(""+t.location,10),u=!0),s=e.pointOnPath(l,u)}var c=s.x-r.w/2,h=s.y-r.h/2;return{component:t,d:{minx:c,miny:h,td:r,cxy:s},xmin:c,xmax:c+r.w,ymin:h,ymax:h+r.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(Xe(t)||ze(t)||Ye(t))return t.draw(e,n,i);throw"Could not draw overlay of type ["+t.type+"]"}},{key:"updateLabel",value:function(t){if(l(t.label)){var e=t.label(this);null!=e?Mo(t).innerText=e:Mo(t).innerText=""}else null==t.labelText&&(t.labelText=t.label,null!=t.labelText?Mo(t).innerText=t.labelText:Mo(t).innerText="")}},{key:"setHover",value:function(t,e){t._hover=e,t instanceof va&&null!=t.endpoint?this.setEndpointHover(t,e,-1):t instanceof da&&null!=t.connector&&this.setConnectorHover(t.connector,e)}},{key:"paintConnector",value:function(t,e,n){Co(this,t,e,n)}},{key:"setConnectorHover",value:function(t,e,n){if(e===!1||!this.currentlyDragging&&!this.isHoverSuspended()){var i=t.canvas;null!=i&&(null!=t.hoverClass&&(e?this.addClass(i,t.hoverClass):this.removeClass(i,t.hoverClass)),e?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null!=t.connection.hoverPaintStyle&&(t.connection.paintStyleInUse=e?t.connection.hoverPaintStyle:t.connection.paintStyle,this._suspendDrawing||this.paintConnection(t.connection)),t.connection.endpoints[0]!==n&&this.setEndpointHover(t.connection.endpoints[0],e,0,!0),t.connection.endpoints[1]!==n&&this.setEndpointHover(t.connection.endpoints[1],e,1,!0)}}},{key:"destroyConnector",value:function(t){null!=t.connector&&Do(t.connector)}},{key:"addConnectorClass",value:function(t,e){t.canvas&&this.addClass(t.canvas,e)}},{key:"removeConnectorClass",value:function(t,e){t.canvas&&this.removeClass(t.canvas,e)}},{key:"getConnectorClass",value:function(t){return t.canvas?t.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(t,e){Ao(t,e)}},{key:"applyConnectorType",value:function(t,e){if(t.canvas&&e.cssClass){var n=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(t.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(t,e){var n=Oo(t.endpoint);null!=n&&this.addClass(n,e)}},{key:"applyEndpointType",value:function(t,e){if(e.cssClass){var n=Oo(t.endpoint);if(n){var i=Array.isArray(e.cssClass)?e.cssClass:[e.cssClass];this.addClass(n,i.join(" "))}}}},{key:"destroyEndpoint",value:function(t){var e=this.endpointAnchorClassPrefix+(t.currentAnchorClass?"-"+t.currentAnchorClass:"");this.removeClass(t.element,e),Do(t.endpoint)}},{key:"renderEndpoint",value:function(t,e){var n=pc[t.endpoint.type];null!=n?dc.paint(t.endpoint,n,e):B("jsPlumb: no endpoint renderer found for type ["+t.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(t,e){var n=Oo(t.endpoint);null!=n&&this.removeClass(n,e)}},{key:"getEndpointClass",value:function(t){var e=Oo(t.endpoint);return null!=e?e.className:""}},{key:"setEndpointHover",value:function(t,e,n,i){if(null!=t&&(e===!1||!this.currentlyDragging&&!this.isHoverSuspended())){var o=Oo(t.endpoint);if(null!=o&&(null!=t.hoverClass&&(e?this.addClass(o,t.hoverClass):this.removeClass(o,t.hoverClass)),0===n||1===n)){var r=0===n?this.hoverSourceClass:this.hoverTargetClass;e?this.addClass(o,r):this.removeClass(o,r)}if(null!=t.hoverPaintStyle&&(t.paintStyleInUse=e?t.hoverPaintStyle:t.paintStyle,this._suspendDrawing||this.renderEndpoint(t,t.paintStyleInUse)),!i)for(var s=0;s<t.connections.length;s++)this.setConnectorHover(t.connections[s].connector,e,t)}}},{key:"setEndpointVisible",value:function(t,e){Ao(t.endpoint,e)}},{key:"setGroupVisible",value:function(t,e){for(var n=t.el.querySelectorAll(vs),i=0;i<n.length;i++)e?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function(t,n){return null!=t&&t.deleted!==!0?(this.setEndpointHover(t.endpoints[0],!1,0,!0),this.setEndpointHover(t.endpoints[1],!1,1,!0),ci(ii(e.prototype),"deleteConnection",this).call(this,t,n)):!1}},{key:"addSourceSelector",value:function(t,n,i){return this.addDragFilter(t),ci(ii(e.prototype),"addSourceSelector",this).call(this,t,n,i)}},{key:"removeSourceSelector",value:function(t){this.removeDragFilter(t.selector),ci(ii(e.prototype),"removeSourceSelector",this).call(this,t)}}]),e}(Ia),vc="circle",yc=function(){Po(ir.type,{makeNode:function(t,e){return Li(vc,{cx:t.w/2,cy:t.h/2,r:t.radius})},updateNode:function(t,e){Ni(e,{cx:""+t.w/2,cy:""+t.h/2,r:""+t.radius})}})},gc="rect",mc=function(){Po(ar.type,{makeNode:function(t,e){return Li(gc,{width:t.w,height:t.h})},updateNode:function(t,e){Ni(e,{width:t.w,height:t.h})}})},_c={width:10,height:0,fill:"transparent",stroke:"transparent"},xc=function(){Po(rr.type,{makeNode:function(t,e){return Li("rect",_c)},updateNode:function(t,e){Ni(e,_c)}})};yc(),xc(),mc();var Ec=0;return t.ABSOLUTE=xr,t.ATTRIBUTE_CONTAINER=al,t.ATTRIBUTE_GROUP=kr,t.ATTRIBUTE_GROUP_CONTENT=ll,t.ATTRIBUTE_JTK_ENABLED=ul,t.ATTRIBUTE_JTK_SCOPE=cl,t.ATTRIBUTE_MANAGED=Cr,t.ATTRIBUTE_NOT_DRAGGABLE=Sr,t.ATTRIBUTE_SCOPE=Tr,t.ATTRIBUTE_SCOPE_PREFIX=wr,t.ATTRIBUTE_TABINDEX=Pr,t.AbstractBezierConnector=Ua,t.AbstractConnector=ur,t.AbstractSegment=zo,t.ArcSegment=Na,t.ArrowOverlay=Ra,t.BLOCK=yr,t.BOTTOM=Xs,t.BezierConnector=Ja,t.BezierSegment=qa,t.BlankEndpoint=rr,t.BlankEndpointHandler=sr,t.BrowserJsPlumbInstance=fc,t.CHECK_CONDITION=Ar,t.CHECK_DROP_ALLOWED=Dr,t.CLASS_CONNECTED=Ir,t.CLASS_CONNECTOR=Or,t.CLASS_CONNECTOR_OUTLINE=Mr,t.CLASS_ENDPOINT=jr,t.CLASS_ENDPOINT_ANCHOR_PREFIX=Fr,t.CLASS_ENDPOINT_CONNECTED=Nr,t.CLASS_ENDPOINT_DROP_ALLOWED=Gr,t.CLASS_ENDPOINT_DROP_FORBIDDEN=Rr,t.CLASS_ENDPOINT_FULL=Lr,t.CLASS_GROUP_COLLAPSED=Br,t.CLASS_GROUP_EXPANDED=Vr,t.CLASS_OVERLAY=Hr,t.CONNECTION=pl,t.Collicat=Wu,t.Component=Bs,t.Connection=da,t.ConnectionDragSelector=Pa,t.ConnectionSelection=Ea,t.Connectors=pr,t.CustomOverlay=Va,t.DEFAULT=qo,t.DiamondOverlay=Ba,t.DotEndpoint=ir,t.DotEndpointHandler=or,t.Drag=Xu,t.ELEMENT=dl,t.ELEMENT_DIV=fl,t.EMPTY_BOUNDS=bt,t.ENDPOINT=hl,t.ERROR_SOURCE_DOES_NOT_EXIST=ms,t.ERROR_SOURCE_ENDPOINT_FULL=ys,t.ERROR_TARGET_DOES_NOT_EXIST=_s,t.ERROR_TARGET_ENDPOINT_FULL=gs,t.EVENT_ANCHOR_CHANGED=Ur,t.EVENT_BEFORE_START=Pu,t.EVENT_CLICK=vl,t.EVENT_CONNECTION=Xr,t.EVENT_CONNECTION_ABORT=Ml,t.EVENT_CONNECTION_CLICK=$l,t.EVENT_CONNECTION_CONTEXTMENU=ru,t.EVENT_CONNECTION_DBL_CLICK=Ql,t.EVENT_CONNECTION_DBL_TAP=tu,t.EVENT_CONNECTION_DETACHED=zr,t.EVENT_CONNECTION_DRAG=Il,t.EVENT_CONNECTION_MOUSEDOWN=ou,t.EVENT_CONNECTION_MOUSEOUT=eu,t.EVENT_CONNECTION_MOUSEOVER=nu,t.EVENT_CONNECTION_MOUSEUP=iu,t.EVENT_CONNECTION_MOVED=Wr,t.EVENT_CONNECTION_TAP=su,t.EVENT_CONTAINER_CHANGE=qr,t.EVENT_CONTEXTMENU=yl,t.EVENT_DBL_CLICK=gl,t.EVENT_DBL_TAP=ml,t.EVENT_DRAG=Tu,t.EVENT_DRAG_MOVE=wl,t.EVENT_DRAG_START=Dl,t.EVENT_DRAG_STOP=Al,t.EVENT_DROP=wu,t.EVENT_ELEMENT_CLICK=jl,t.EVENT_ELEMENT_CONTEXTMENU=Hl,t.EVENT_ELEMENT_DBL_CLICK=Nl,t.EVENT_ELEMENT_DBL_TAP=Ll,t.EVENT_ELEMENT_MOUSE_DOWN=Vl,t.EVENT_ELEMENT_MOUSE_MOVE=Fl,t.EVENT_ELEMENT_MOUSE_OUT=Gl,t.EVENT_ELEMENT_MOUSE_OVER=Rl,t.EVENT_ELEMENT_MOUSE_UP=Bl,t.EVENT_ELEMENT_TAP=Ul,t.EVENT_ENDPOINT_CLICK=Xl,t.EVENT_ENDPOINT_DBL_CLICK=Yl,t.EVENT_ENDPOINT_DBL_TAP=zl,t.EVENT_ENDPOINT_MOUSEDOWN=Kl,t.EVENT_ENDPOINT_MOUSEOUT=Wl,t.EVENT_ENDPOINT_MOUSEOVER=ql,t.EVENT_ENDPOINT_MOUSEUP=Jl,t.EVENT_ENDPOINT_REPLACED=Jr,t.EVENT_ENDPOINT_TAP=Zl,t.EVENT_FOCUS=_l,t.EVENT_GROUP_ADDED=Qr,t.EVENT_GROUP_COLLAPSE=ts,t.EVENT_GROUP_EXPAND=es,t.EVENT_GROUP_MEMBER_ADDED=ns,t.EVENT_GROUP_MEMBER_REMOVED=is,t.EVENT_GROUP_REMOVED=os,t.EVENT_INTERNAL_CONNECTION=Yr,t.EVENT_INTERNAL_CONNECTION_DETACHED=Zr,t.EVENT_INTERNAL_ENDPOINT_UNREGISTERED=Kr,t.EVENT_MANAGE_ELEMENT=$r,t.EVENT_MAX_CONNECTIONS=rs,t.EVENT_MOUSEDOWN=xl,t.EVENT_MOUSEENTER=El,t.EVENT_MOUSEEXIT=bl,t.EVENT_MOUSEMOVE=kl,t.EVENT_MOUSEOUT=Sl,t.EVENT_MOUSEOVER=Pl,t.EVENT_MOUSEUP=Cl,t.EVENT_NESTED_GROUP_ADDED=ss,t.EVENT_NESTED_GROUP_REMOVED=as,t.EVENT_OUT=Du,t.EVENT_OVER=Au,t.EVENT_REVERT=Ol,t.EVENT_START=Su,t.EVENT_STOP=Ou,t.EVENT_TAP=Tl,t.EVENT_UNMANAGE_ELEMENT=ls,t.EVENT_ZOOM=us,t.ElementDragHandler=oc,t.Endpoint=va,t.EndpointFactory=er,t.EndpointRepresentation=nr,t.EndpointSelection=xa,t.EventGenerator=Vo,t.EventManager=Cu,t.FALSE=Ko,t.FIXED=Er,t.FlowchartConnector=Ha,t.GroupManager=ma,t.INTERCEPT_BEFORE_DETACH=ps,t.INTERCEPT_BEFORE_DRAG=hs,t.INTERCEPT_BEFORE_DROP=ds,t.INTERCEPT_BEFORE_START_DETACH=fs,t.IS_DETACH_ALLOWED=cs,t.JsPlumbInstance=Ia,t.KEY_CONNECTION_OVERLAYS=xs,t.LEFT=Hs,t.LabelOverlay=Cs,t.LightweightFloatingAnchor=Ws,t.LightweightRouter=Ma,t.NONE=gr,t.OptimisticEventGenerator=Ho,t.Overlay=Es,t.OverlayFactory=ks,t.PROPERTY_POSITION=au,t.PlainArrowOverlay=Fa,t.REDROP_POLICY_ANY=wa,t.REDROP_POLICY_STRICT=Ta,t.RIGHT=Us,t.RectangleEndpoint=ar,t.RectangleEndpointHandler=lr,t.SELECTOR_CONNECTOR=lu,t.SELECTOR_ENDPOINT=uu,t.SELECTOR_GROUP=cu,t.SELECTOR_GROUP_CONTAINER=hu,t.SELECTOR_MANAGED_ELEMENT=vs,t.SELECTOR_OVERLAY=du,t.SOURCE=fr,t.SOURCE_INDEX=mr,t.STATIC=br,t.SourceSelector=Aa,t.StateMachineConnector=Ka,t.StraightConnector=hr,t.StraightSegment=cr,t.TARGET=vr,t.TARGET_INDEX=_r,t.TOP=Vs,t.TRUE=Jo,t.TWO_PI=Yo,t.TargetSelector=Da,t.UIGroup=ga,t.UINode=ya,t.UNDEFINED=Wo,t.Viewport=Sa,t.WILDCARD=Zo,t.X_AXIS_FACES=Ys,t.Y_AXIS_FACES=zs,t._createPerimeterAnchor=Ce,t._removeTypeCssHelper=ee,t._updateHoverStyle=ne,t.add=nt,t.addClass=Ti,t.addToDictionary=O,t.addToList=M,t.addWithFunction=D,t.arraysEqual=v,t.att=qt,t.bezierLineIntersection=Hn,t.boundingBoxIntersection=Xn,t.boxIntersection=Un,t.classList=Wt,t.clone=h,t.cls=zt,t.compoundEvent=Vi,t.computeBezierLength=On,t.consume=mi,t.convertToFullOverlaySpec=Kt,t.createElement=Oi,t.createElementNS=Mi,t.createFloatingAnchor=pe,t.dist=jn,t.distanceFromCurve=En,t.each=R,t.encloses=pt,t.extend=n,t.fastTrim=G,t.filterList=e,t.filterNull=d,t.findAllWithFunction=b,t.findParent=_i,t.findWithFunction=E,t.forEach=x,t.fromArray=w,t.functionChain=m,t.getAllWithFunction=C,t.getClass=Pi,t.getDefaultFace=re,t.getEventSource=xi,t.getFromSetWithFunction=S,t.getPositionOnElement=To,t.getTouch=Qi,t.getWithFunction=k,t.getsert=H,t.gradient=ot,t.gradientAtPoint=Fn,t.gradientAtPointAlongPathFrom=Bn,t.groupDragConstrain=jo,t.hasClass=wi,t.insertSorted=X,t.intersects=ut,t.isArrayLike=Si,t.isArrowOverlay=Xe,t.isAssignableFrom=U,t.isBoolean=r,t.isContinuous=Ie,t.isCustomOverlay=We,t.isDate=a,t.isDiamondOverlay=ze,t.isDynamic=Ne,t.isEdgeSupported=ue,t.isEmpty=c,t.isFloating=je,t.isFullOverlaySpec=Jt,t.isFunction=l,t.isInsideParent=yo,t.isLabelOverlay=Zt,t.isNamedFunction=u,t.isNodeList=Ci,t.isNumber=i,t.isObject=s,t.isPlainArrowOverlay=Ye,t.isPoint=Nn,t.isString=o,t.lineIntersection=ht,t.lineLength=st,t.lineRectangleIntersection=dt,t.locationAlongCurveFrom=Rn,t.log=B,t.logEnabled=Bo,t.makeLightweightAnchorFromSpec=ye,t.map=F,t.matchesSelector=gi,t.merge=p,t.nearestPointOnCurve=bn,t.newInstance=Lo,t.normal=rt,t.objectsEqual=y,t.offsetRelativeToRoot=Ii,t.pageLocation=Ki,t.perpendicularLineTo=vt,t.perpendicularToPathAt=Vn,t.pointAlongCurveFrom=Gn,t.pointAlongPath=Ln,t.pointOnCurve=In,t.pointOnLine=ft,t.populate=_,t.quadrant=at,t.ready=Go,t.registerEndpointRenderer=Po,t.remove=A,t.removeClass=Ai,t.removeWithFunction=T,t.replace=g,t.rotateAnchorOrientation=L,t.rotatePoint=N,t.setToArray=P,t.size=ji,t.snapToGrid=yt,t.subtract=it,t.suggest=I,t.theta=lt,t.toggleClass=Di,t.touchCount=eo,t.touches=to,t.uuid=j,t.wrap=V,Object.defineProperty(t,"__esModule",{value:!0}),t}({});