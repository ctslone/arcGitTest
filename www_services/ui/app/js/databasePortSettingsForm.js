rsb.DBSetting.resultContainer = rsb.getFormResultContainer(rsb.DBSetting.SettingsForm);rsb.DBSetting.odbcContainer = rsb.DBSetting.SettingsForm.find("#odbcContainer");rsb.DBSetting.odbcDriverName = rsb.DBSetting.odbcContainer.find("#odbc_drivername");rsb.DBSetting.odbcDataSourceName = rsb.DBSetting.odbcContainer.find(".database-odbc-drivername");rsb.DBSetting.odbcDataSourceNameTitle = rsb.DBSetting.odbcContainer.find("#odbc_datasourcename_title");rsb.DBSetting.odbcDriver = rsb.DBSetting.odbcContainer.find("#odbc_driver");rsb.DBSetting.databaseOptions = {};rsb.DBSetting.databaseInit = function($options) {rsb.DBSetting.databaseOptions = $options || {};rsb.DBSetting.driverContainer = rsb.DBSetting.SettingsForm.find('#' + rsb.DBSetting.databaseOptions.driverType + 'Container');rsb.DBSetting.databaseurlContainer = rsb.DBSetting.driverContainer.find("#databaseurlContainer");rsb.DBSetting.databaseurl = rsb.DBSetting.databaseurlContainer.find(rsb.DBSetting.databaseOptions.databaseurlname);rsb.DBSetting.connectionStringInput = rsb.DBSetting.databaseurlContainer.find("#database_hidden_connection_string");rsb.DBSetting.driverclass = rsb.DBSetting.SettingsForm.find("#driverclass");rsb.DBSetting.propertylistContainer = rsb.DBSetting.driverContainer.find("#propertylistContainer");rsb.DBSetting.drivername = rsb.DBSetting.SettingsForm.find("#database_ado_jdbc_drivername");rsb.DBSetting.providerversion = rsb.DBSetting.SettingsForm.find("#database_ado_jdbc_providerversion");rsb.DBSetting.driverNameDropdownMenu = rsb.DBSetting.SettingsForm.find(".driver-name-dropdown ul.dropdown-menu");rsb.DBSetting.drivernameTitle = rsb.DBSetting.SettingsForm.find("#drivernameTitle");rsb.DBSetting.settingsformatdatabaseurl = rsb.DBSetting.driverContainer.find("#settingsformatdatabaseurl");rsb.DBSetting.settingsformatpropertylist = rsb.DBSetting.driverContainer.find("#settingsformatpropertylist");$options.drivernameLong && rsb.DBSetting.drivernameTitle.text($options.drivernameLong)}
rsb.DBSetting.accountContainer = rsb.DBSetting.SettingsForm.find("#accountContainer");rsb.DBSetting.otherContainer = rsb.DBSetting.SettingsForm.find("#otherContainer");rsb.DBSetting.databaseContainer = rsb.DBSetting.SettingsForm.find("#databaseContainer");rsb.DBSetting.changeODBCDriverName = function($name) {rsb.DBSetting.odbcDriver.val(rsb.DBSetting.dsnDrivers[$name] || "");rsb.DBSetting.odbcDataSourceName.val($name);rsb.DBSetting.odbcDataSourceNameTitle.text($name)};rsb.DBSetting.getDriverName = function() {return rsb.DBSetting.drivername.val()}
rsb.DBSetting.getDriverClass = function() {return rsb.DBSetting.driverclass.val()}
rsb.DBSetting.showDatabaseUrl = function() {rsb.DBSetting.hiddenContainer(rsb.DBSetting.propertylistContainer);rsb.DBSetting.hiddenContainer(rsb.DBSetting.accountContainer);rsb.DBSetting.hiddenContainer(rsb.DBSetting.otherContainer);rsb.DBSetting.hiddenContainer(rsb.DBSetting.databaseContainer);rsb.DBSetting.showContainer(rsb.DBSetting.databaseurlContainer)}
rsb.DBSetting.showPropertyList = function() {rsb.DBSetting.hiddenContainer(rsb.DBSetting.databaseurlContainer);rsb.DBSetting.showContainer(rsb.DBSetting.propertylistContainer);if (rsb.DBSetting.databaseContainer.html().trim()) {rsb.DBSetting.showContainer(rsb.DBSetting.databaseContainer)}
rsb.DBSetting.resetPropertyList()}
rsb.DBSetting.resetPropertyList = function() {if (rsb.DBSetting.accountMask || rsb.DBSetting.driverInfo.isODBC) {rsb.DBSetting.driverInfo.isODBC && (rsb.DBSetting.accountMask = 3);rsb.DBSetting.showAccount()} else {rsb.DBSetting.hiddenContainer(rsb.DBSetting.accountContainer)}
if (rsb.DBSetting.driverInfo.isDynamic) {rsb.DBSetting.hiddenContainer(rsb.DBSetting.otherContainer)} else {rsb.DBSetting.showContainer(rsb.DBSetting.otherContainer)}}
rsb.DBSetting.driverNameChanged = function($title, $drivername, $providerversion) {var $isOther = $drivername && $drivername.toLowerCase() == "other";rsb.DBSetting.providerversion.val($providerversion || "");if (!$isOther) {rsb.DBSetting.drivernameTitle.text($title);rsb.DBSetting.driverclass.val(rsb.DBSetting.driverClasses[$title] || "").attr("readonly", true).off("change");if ($drivername) {rsb.DBSetting.drivername.val($drivername)} else {rsb.DBSetting.drivername.val($title.replace(/ \(.+\)/, ''))}} else if (rsb.DBSetting.driverclass.val().toLowerCase().startsWith("cdata.jdbc.") || rsb.DBSetting.driverclass.val().toLowerCase().startsWith("system.data.cdata.")) {rsb.DBSetting.driverclass.val("");rsb.showResult(rsb.DBSetting.resultContainer, 'Only third-party driver can be used of the Database port.', false, true);return false} else if (rsb.DBSetting.driverclass.val().toLowerCase() == "system.data.odbc") {rsb.showResult(rsb.DBSetting.resultContainer, 'Use ODBC connection type instead.', false, true);return false}
rsb.DBSetting.driverInfo.items = [];rsb.DBSetting.connectionStringTypeChanged(null, function (result) {rsb.DBSetting.driverInfo.items = result;rsb.DBSetting.accountMask = 0;rsb.DBSetting.settingsformatpropertylist.prop("disabled", false);rsb.DBSetting.driverInfo.isDynamic = false;rsb.forEach(rsb.DBSetting.driverInfo.items, function(prop, index) {if (!prop.name) {rsb.DBSetting.driverInfo.driverName = prop.providername.toLowerCase();rsb.DBSetting.driverInfo.driverType = prop.providertype;rsb.DBSetting.driverInfo.driverClass = prop.providerclass;rsb.DBSetting.driverInfo.isDynamic = rsb.getValueAsBool(prop.iscdata, false) || rsb.DBSetting.driverInfo.items.some(p => !!p.name && p.name.toLowerCase() !== "other" && p.tab.toLowerCase() === "advanced");if ($isOther) {$title = prop.providername + (!!prop.buildnumber ? " (" + prop.buildnumber + ")" : "");var i = 0;var options = rsb.DBSetting.driverNameDropdownMenu.find("li>a");for (; i < options.length; ++i) {if ($(options[i]).text().toLowerCase() == $title.toLowerCase()) {break}}
if (i >= options.length) {$('<li><a class="dropdown-item" href="javascript:void(0);" onclick="rsb.DBSetting.driverNameChanged($(this).text(), \'' + rsb.htmlEncode(prop.providername) + '\');">' + rsb.htmlEncode($title) + '</a></li>').insertBefore(rsb.DBSetting.driverNameDropdownMenu.find("li:last"));rsb.DBSetting.driverClasses[prop.providername] = rsb.DBSetting.driverclass.val();rsb.DBSetting.drivernameTitle.text($title)}
rsb.DBSetting.drivername.val(prop.providername);if (prop.providername.toLowerCase() == "other") {rsb.DBSetting.settingsformatdatabaseurl.prop("checked", "true");rsb.DBSetting.settingsformatdatabaseurl.closest("div.form-group").hide()} else {rsb.DBSetting.settingsformatdatabaseurl.closest("div.form-group").show()}} else {rsb.DBSetting.settingsformatdatabaseurl.closest("div.form-group").show()}
rsb.DBSetting.driverclass.attr("readonly", true).off("change");rsb.DBSetting.databaseurl.val(prop.urlformat || "")} else if ("`user`password`".match(prop.name.toLowerCase())) {rsb.DBSetting.accountMask |= (prop.name.toLowerCase() == "user" ? 1 : 2)}});if (rsb.DBSetting.settingsformatdatabaseurl.prop("checked") || $isOther && rsb.DBSetting.driverInfo.items.length < 2) {rsb.DBSetting.settingsformatdatabaseurl.prop("checked", true);rsb.DBSetting.showDatabaseUrl()} else {rsb.DBSetting.resetPropertyList()}})}
