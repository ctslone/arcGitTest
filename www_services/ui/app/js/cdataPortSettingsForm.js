rsb.cdataPort = rsb.cdataPort || {};rsb.cdataPort.SettingsForm = rsb.DBSetting.SettingsForm;rsb.cdataPort.driverName = rsb.cdataPort.SettingsForm.find("#cdataportsettingsform_drivername");rsb.cdataPort.providerVersion = rsb.cdataPort.SettingsForm.find("#cdataportsettingsform_providerversion");rsb.cdataPort.driverClass = rsb.cdataPort.SettingsForm.find("#cdataportsettingsform_driverclass");rsb.cdataPort.driverNameSelect = rsb.cdataPort.SettingsForm.find("#cdataportsettingsform_drivername_select");rsb.cdataPort.oauthSpecificContainer = rsb.cdataPort.SettingsForm.find("#cdataportsettingsform_oauthspecificcontainer");rsb.DBSetting.propertylistContainer = rsb.cdataPort.SettingsForm.find("#singleDatabaseSettingsForm_settingscontainer");rsb.cdataPort.oauthBtnContainer = rsb.cdataPort.SettingsForm.find("#authButtonGroupContainer");rsb.cdataPort.testConnBtn = rsb.cdataPort.oauthBtnContainer.find("#authButtonGroup_test_conn_btn");rsb.cdataPort.connBtn = rsb.cdataPort.oauthBtnContainer.find("#authButtonGroup_conn_btn");rsb.cdataPort.disConnBtn = rsb.cdataPort.oauthBtnContainer.find("#authButtonGroup_dis_conn_btn");rsb.cdataPort.options = {};rsb.cdataPort.init = function ($options) {rsb.cdataPort.options = $.extend($options, rsb.connect.options);rsb.DBSetting.driverInfo = rsb.cdataPort.options.driverInfo;rsb.DBSetting.driverInfo.isODBC = false;rsb.DBSetting.driverInfo.isDynamic = true;rsb.DBSetting.propIdPrefix = "cdataportsettingsform_";rsb.cdataPort.hierarchySettings = new rsb.providerHierarchySettings({requiredContainer: "#singleDatabaseSettingsForm_settingscontainer",optionalContainer: "#databaseAdvancedFormHierarchySettings",driverName: rsb.DBSetting.driverInfo.driverName,driverType: rsb.DBSetting.driverInfo.driverType || rsb.DBSetting.options.driverType,driverClass: rsb.DBSetting.driverInfo.driverClass,namePrefix: "connection",driverChanged: function ($meta, $type, $args) {rsb.DBSetting.driverInfo.driverName = $meta.providername.toLowerCase();rsb.DBSetting.driverInfo.driverType = $meta.providertype;rsb.DBSetting.driverInfo.driverClass = $meta.providerclass;rsb.DBSetting.driverInfo.isDynamic = true;rsb.DBSetting.driverInfo.capabilities = $meta.capabilities;$.ajax({url: "src/cdataListSysOptions.rsb",type: "POST",data: $.extend(rsb.getFormData(rsb.cdataPort.SettingsForm, true), {"connectorid": rsb.DBSetting.options.workspaceid + ":" + rsb.DBSetting.options.portId,"connectortype": rsb.DBSetting.options.portType,"drivername": rsb.DBSetting.driverInfo.driverName,"driverclass": rsb.DBSetting.driverInfo.driverClass}),dataType: "json",success: function (result, textStatus, jqXHR) {let errorMsg = rsb.getResultErrorMessage(result.items);if (errorMsg) {rsb.showResult(rsb.DBSetting.resultContainer, errorMsg, false)}
let supportReplicate = false;!!result.items && result.items.forEach(function ($opt) {if (!!$opt.name && $opt.name.toLowerCase() === "replicationtimecheckcolumns") {supportReplicate = !!$opt.value;return false}});!!rsb.singleDatabase.queryEditor && rsb.singleDatabase.queryEditor.updateProps({supportReplicate: supportReplicate})}});if ($args && $args.other) {var $driverName = !!$meta.version ? $meta.drivername + " (" + $meta.version + ")" : $meta.drivername;var $options = rsb.cdataPort.driverNameSelect.find("option[value='" + $driverName + "']");if (!$options || $options.length < 1) {$options = rsb.cdataPort.driverNameSelect.find("option");for (var $index; $index < $options.length; ++$index) {if ($options[$index].value.localeCompare($driverName) > 0 || $options[$index].value == "Other") {$('<option value="' + rsb.htmlEncode($driverName) + '">' + rsb.htmlEncode($driverName) + '</option>').insertBefore($options[$index]);break}}}
rsb.cdataPort.options.driverClasses[$meta.drivername] = rsb.cdataPort.driverClass.val();rsb.cdataPort.driverNameSelect.prop("nochange", true);rsb.cdataPort.driverNameSelect.val($driverName);rsb.cdataPort.driverName.val($meta.drivername);rsb.cdataPort.driverClass.prop("readonly", true);rsb.cdataPort.driverClass.parent().parent().addClass('hidden')}
rsb.cdataPort.afterDriverChanged();rsb.connect.initVaultInputGroups(rsb.DBSetting.SettingsForm, rsb.DBSetting.resultContainer);rsb.connect.initVaultInputGroups($("#databaseAdvancedForm"), rsb.DBSetting.resultContainer)},resetSchemaCache: function() {rsb.DBSetting.resetSchemaCache($(this), rsb.cdataPort.options.workspaceid, rsb.cdataPort.options.portId)}});rsb.cdataPort.afterDriverChanged()}
rsb.cdataPort.driverNameChanged = function ($changed, $title) {if (!!rsb.cdataPort.driverNameSelect.prop("nochange")) {rsb.cdataPort.driverNameSelect.prop("nochange", null);return false}
const $match = new RegExp(/^(.+)\s+\((.+)\)$/).exec($title);if ($match) {rsb.cdataPort.driverName.val($match[1]);rsb.cdataPort.providerVersion.val($match[2])}
var isOther = rsb.cdataPort.driverName.val().toLowerCase() == "other";if ($changed && isOther) {rsb.cdataPort.driverClass.prop("readonly", false);rsb.cdataPort.hierarchySettings.clear()
rsb.cdataPort.driverClass.val("");rsb.cdataPort.driverClass.parent().parent().removeClass('hidden')} else {if ($changed) {rsb.cdataPort.driverClass.val(rsb.cdataPort.options.driverClasses[rsb.cdataPort.driverName.val()] || "");rsb.cdataPort.driverClass.prop("readonly", true);rsb.cdataPort.driverClass.parent().parent().addClass('hidden')} else if (!rsb.cdataPort.driverClass.val().toLowerCase().startsWith("cdata.jdbc.")) {rsb.showResult(rsb.DBSetting.resultContainer, 'Only CData JDBC driver can be used of the CloudData port.', false, true);return false}
rsb.cdataPort.hierarchySettings.refresh(null, rsb.cdataPort.driverClass.val(), {other: isOther,change: $changed})}}
rsb.cdataPort.afterDriverChanged = function () {rsb.cdataPort.oauthSpecificContainer.empty();var drivername = (rsb.DBSetting.driverInfo.driverName || "").toLowerCase().replace("cdata ", "");rsb.cdataPort.oauthBtnContainer.attr("data-capabilities", (rsb.DBSetting.driverInfo?.capabilities || "").toUpperCase());if (rsb.DBSetting.driverInfo && (rsb.DBSetting.driverInfo.capabilities || "").toUpperCase().indexOf("OAUTH") >= 0 && ["zendesk", "suitecrm"].indexOf(drivername) < 0) {rsb.cdataPort.connBtn.toggleClass("quickbooksonline", drivername.indexOf("quickbooksonline") >= 0);rsb.cdataPort.disConnBtn.toggleClass("quickbooksonline", drivername.indexOf("quickbooksonline") >= 0);rsb.cdataPort.connBtn.removeClass('hidden');rsb.cdataPort.disConnBtn.addClass('hidden');rsb.cdataPort.testConnBtn.addClass('hidden')} else {rsb.cdataPort.testConnBtn.removeClass('hidden');rsb.cdataPort.connBtn.addClass('hidden');rsb.cdataPort.disConnBtn.addClass('hidden')}}
rsb.DBSetting.getDriverName = function () {return rsb.cdataPort.driverName.val()}
rsb.DBSetting.getDriverClass = function () {return rsb.cdataPort.driverClass.val()}
