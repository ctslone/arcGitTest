rsb = rsb || {};rsb.formPortUsersPage = rsb.formPortUsersPage || {}
rsb.formPortUsersPage.getSelectedUsers = function() {var users = [];$("#formportuserpage_users_container .formportuserspage-user-checkbox:checked").each(function() {var user = {};user.user = $(this).closest("tr").find("td").eq(1).text();user.privileges = $(this).closest("tr").find("td").eq(2).text();users.push(user)});return users}
rsb.formPortUsersPage.onAddUserBtnClicked = function() {rsb.formPortUserModal.addUser(rsb.formPortUsersPage.workspaceid, rsb.formPortUsersPage.connectorid, function() {$("#formportuserpage_users_table").DataTable().ajax.reload()})}
rsb.formPortUsersPage.onEditUserBtnClicked = function() {var users = rsb.formPortUsersPage.getSelectedUsers();if (users && users.length > 0) {rsb.formPortUserModal.editUser(rsb.formPortUsersPage.workspaceid, rsb.formPortUsersPage.connectorid, users[0], function() {$("#formportuserpage_users_table").DataTable().ajax.reload()})}}
rsb.formPortUsersPage.onDeleteUserBtnClicked = function() {var users = rsb.formPortUsersPage.getSelectedUsers();if (users && users.length > 0) {var usernames = [];for (var i in users) {usernames.push(users[i].user)}
rsb.confirmModal({title: 'Delete Users',body: rsb.evalTemplate('Are you sure you want to delete the following user? $user$', {"user": "\r\n" + usernames.join("\r\n")}),ok: function() {$.ajax({dataType: "json",type: "DELETE",url: "src/connectorUsers.rsd?@json",data: { "user": usernames.join(","), "connectorid" : rsb.formPortUsersPage.connectorid, "workspaceid": rsb.formPortUsersPage.workspaceid, "connectortype": "form" },traditional: true,success: function (data, textStatus, jqXHR) {var errorMsg = rsb.getResultErrorMessage(data.items);if (errorMsg) {rsb.showResult($("#formportuserpage_usertableresultcontainer"), errorMsg, false)} else {$("#formportuserpage_users_table").DataTable().ajax.reload()}}})}})}}
rsb.formPortUsersPage.onUserSelected = function() {var users = rsb.formPortUsersPage.getSelectedUsers();$(".formportuserspage-edit-bar #formportuserspage_edit_btn").prop("disabled", !users || users.length != 1);$(".formportuserspage-edit-bar #formportuserspage_delete_btn").prop("disabled", !users || users.length <= 0);$("#formportuserpage_users_table #formportuserpage_user_toggle_all").prop("checked", users && users.length >= $("#formportuserpage_users_tbody tr").length)}
rsb.formPortUsersPage.onToggleAllChanged = function($event) {var check = $("#formportuserpage_users_table .checkbox-toggle-all").prop("checked");$("#formportuserpage_users_table .formportuserspage-user-checkbox").prop("checked", check);rsb.formPortUsersPage.onUserSelected()}
$(document).ready( function () {var options = {serverSide: true,searching: false,autoWidth: false,sDom: "<'row'<'col-md-4 formportuserspage-edit-bar'>r>t<'row'<'col-md-4'i>>",language: {url : 'ui/datatables/lang/'+ 'english.js'},rowCallback: function (row, data) {$(row).click(rsb.formPortUsersPage.onUserSelected);$(row).children("td:eq(0)").empty().append('<input type="checkbox" class="form-check-input pointercursor formportuserspage-user-checkbox">');var privileges = data["privileges"].split(",");var userViewPrivileges = [];for (var i in privileges) {if (privileges[i].toUpperCase() == "GET") {userViewPrivileges.push("Read")} else if (privileges[i].toUpperCase() == "POST") {userViewPrivileges.push("Submit")}}},ordering: false,columns: [{width: "5px",data: null,className: "details-control center"},{data: "username"}
],preAjax: function(opt)  {opt["requestData"] = { "connectorid": rsb.formPortUsersPage.connectorid, "workspaceid": rsb.formPortUsersPage.workspaceid, "connectortype": "form" }},afterAjax: function() {$("#formportuserpage_user_toggle_all").prop("checked", false)},initComplete: function() {$("#formportuserpage_user_toggle_all").click(rsb.formPortUsersPage.onToggleAllChanged);var readonly = !rsb.connectorList[rsb.formPortUsersPage.workspaceid.toLowerCase()].connectors[rsb.formPortUsersPage.connectorid.toLowerCase()].allowedPrivileges.includes("updatesettings");if (!readonly) {var html = '<div class="btn-group">' +'  <button id="formportuserspage_add_btn" type="button" class="btn btn-primary btn-sm">' +'    <i class="icon fa fa-plus"></i> ' + 'Add'+'  </button>' +'  <button id="formportuserspage_edit_btn" type="button" class="btn btn-outline-secondary btn-sm" disabled> ' +'    <i class="icon fa fa-edit"></i> ' + 'Edit'+'  </button>' +'  <button id="formportuserspage_delete_btn" type="button" class="btn btn-outline-secondary btn-sm" disabled>' +'    <i class="icon fa fa-minus"></i> ' + 'Delete'+'  </button>' +'</div>';$(".formportuserspage-edit-bar").html(html);$(".formportuserspage-edit-bar #formportuserspage_add_btn").click(rsb.formPortUsersPage.onAddUserBtnClicked);$(".formportuserspage-edit-bar #formportuserspage_edit_btn").click(rsb.formPortUsersPage.onEditUserBtnClicked);$(".formportuserspage-edit-bar #formportuserspage_delete_btn").click(rsb.formPortUsersPage.onDeleteUserBtnClicked)}}};rsb.initTable($("#formportuserpage_users_table"), "src/connectorUsers.rsd", $("#formportuserpage_usertableresultcontainer"), options);rsb.connect.loadModal("formPortSecurityModal.rst", function () {window.self !== window.top && (rsb.formPortUserModal = window.parent.rsb.formPortUserModal)})});