{"version":3,"sources":["toc.js"],"names":["Number","isInteger","value","isFinite","Math","floor","window","NodeList","prototype","forEach","callback","thisArg","i","length","call","TOC","scrollSelector","level","scrollContainer","tocElement","tocNodeList","entryNodeList","entryNodeOffsets","_firstInit","addEventListener","e","onDomLoaded","init","helper","levelHandler","style","visibility","throttled","document","querySelector","handleData","resizeTimer","clearTimeout","setTimeout","handleHighlight","highlight","querySelectorAll","href","getAttribute","toString","push","offsetTop","findIndex","findNearestNumIndexInAsendingArray","classList","remove","num","scrollTop","index","add","getElementTop","element","actualTop","current","offsetParent","array","Array","isArray","largeIndex","smallIndex","currIndex","delay","fn","lastCall","now","Date","getTime","selector","removeLevels","join"],"mappings":"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","sourcesContent":["// isInteger polyfill https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger\r\nNumber.isInteger = Number.isInteger || function(value) {\r\n    return typeof value === 'number' && \r\n      isFinite(value) && \r\n      Math.floor(value) === value;\r\n}\r\n\r\n// foreach polyfill https://developer.mozilla.org/en-US/docs/Web/API/NodeList/forEach\r\nif (window.NodeList && !NodeList.prototype.forEach) {\r\n    NodeList.prototype.forEach = function (callback, thisArg) {\r\n        thisArg = thisArg || window\r\n        for (var i = 0; i < this.length; i++) {\r\n            callback.call(thisArg, this[i], i, this)\r\n        }\r\n    }\r\n}\r\n\r\nclass TOC {\r\n    constructor(scrollSelector, level) {\r\n        this.scrollContainer\r\n        this.tocElement\r\n        this.level = typeof level === \"number\" ? level : 0\r\n        this.tocNodeList = []\r\n        this.entryNodeList = []\r\n        this.entryNodeOffsets = []\r\n\r\n        this._firstInit = true\r\n\r\n        if(!!this._firstInit) {\r\n            window.addEventListener(\"DOMContentLoaded\", e => {\r\n                this.onDomLoaded()\r\n            });\r\n            window.addEventListener(\"load\", e => {\r\n                this.init(scrollSelector)\r\n            });\r\n        }\r\n    }\r\n    onDomLoaded() {\r\n        this.tocElement = TOC.helper.levelHandler(\"#table-of-contents\", this.level)\r\n        this.tocElement.style.visibility = 'visible'\r\n    }\r\n    init(scrollSelector) {\r\n        let throttled = TOC.helper.throttled\r\n        this.scrollContainer = document.querySelector(scrollSelector)\r\n        this.tocElement = document.querySelector(\"#table-of-contents\")\r\n        this.handleData()\r\n        // when resizing, reinit\r\n        if (!!this._firstInit) {\r\n            let resizeTimer;\r\n            window.addEventListener('resize', e => {\r\n                clearTimeout(resizeTimer)\r\n                resizeTimer = setTimeout(() => {\r\n                    this.init(scrollSelector)\r\n                }, 250)\r\n            })\r\n            let handleHighlight = throttled(20, (e) => this.highlight())\r\n            this.scrollContainer.addEventListener(\"scroll\", handleHighlight)\r\n        } \r\n        this.highlight()\r\n        // first init end\r\n        this._firstInit = false\r\n    }\r\n    handleData() {\r\n        this.tocNodeList = []\r\n        this.entryNodeList = []\r\n        this.entryNodeOffsets = []\r\n        // select all entries from toc container\r\n        this.tocNodeList = this.tocElement.querySelectorAll(\".toc-entry\")\r\n        // select all corresponding heading tag nodes from every entry\r\n        this.tocNodeList.forEach( i => {\r\n            let href = i.querySelector(\"a\").getAttribute(\"href\").toString()\r\n            this.entryNodeList.push(document.querySelector(href))\r\n        })\r\n        // calculate offsetTop of each heading tag\r\n        this.entryNodeList.forEach( i => {\r\n            this.entryNodeOffsets.push(i.offsetTop - 40) // 40 offset\r\n        })\r\n    }\r\n    // add event listener to highlight current item on scroll\r\n    highlight() {\r\n        let findIndex = TOC.helper.findNearestNumIndexInAsendingArray\r\n        try {\r\n            this.tocElement.querySelector(\".active\").classList.remove(\"active\")\r\n        } catch(e) {}\r\n        let num = this.scrollContainer.scrollTop \r\n        if (num < this.entryNodeOffsets[0]) return\r\n        let index = findIndex(num, this.entryNodeOffsets)\r\n        try {\r\n            this.tocNodeList[index].querySelector(\"a\").classList.add(\"active\")\r\n        } catch(e) {}\r\n    }\r\n}\r\n\r\nTOC.helper = {\r\n    getElementTop(element) {\r\n        let actualTop = element.offsetTop\r\n        let current = element.offsetParent\r\n        while (current !== null){\r\n            actualTop += current.offsetTop\r\n            ;current = current.offsetParent\r\n        }\r\n        return actualTop\r\n    },\r\n    findNearestNumIndexInAsendingArray(num, array) {\r\n        if (!Array.isArray(array)) return\r\n        if (!Number.isInteger(num)) return\r\n        let largeIndex = array.length - 1\r\n        let smallIndex = 0\r\n        let currIndex = Math.floor(largeIndex / 2)\r\n        while (!(currIndex == largeIndex || currIndex == smallIndex)) {\r\n            if (num === array[currIndex]) {\r\n                return currIndex\r\n            } else if (num > array[currIndex]) {\r\n                smallIndex = currIndex\r\n                ;currIndex = Math.floor((currIndex + largeIndex) / 2)\r\n            } else {\r\n                largeIndex = currIndex\r\n                ;currIndex = Math.floor((currIndex + smallIndex) / 2)\r\n            }\r\n            if (largeIndex - smallIndex === 1) {\r\n                if (num >= array[largeIndex])\r\n                    return largeIndex\r\n            } \r\n        }\r\n        return currIndex\r\n    },\r\n    throttled(delay, fn) {\r\n        let lastCall = 0\r\n        return function (...args) {\r\n          const now = (new Date).getTime()\r\n          if (now - lastCall < delay) {\r\n            return\r\n          }\r\n          lastCall = now\r\n          return fn(...args)\r\n        }\r\n    },\r\n    levelHandler(selector, level) {\r\n        let tocElement = document.querySelector(selector)\r\n        // level handler\r\n        // if level is set, remove all following level nodes\r\n        if (!!level) {\r\n            tocElement.querySelectorAll(\".toc-h\" + level).forEach(i => {\r\n                try {\r\n                    i.querySelector(\"ul\").remove()\r\n                } catch(e) {}\r\n            })\r\n            var removeLevels = [];\r\n            for (var index = level + 1; index < 10; index++) removeLevels.push(\".toc-h\" + index);\r\n            tocElement.querySelectorAll(removeLevels.join(\",\")).forEach(i => {\r\n                try {\r\n                    i.remove();\r\n                } catch (e) {}\r\n            });\r\n        }\r\n        return tocElement\r\n    }\r\n}"],"file":"toc.js"}