rsb.portsListModal = rsb.portsListModal || {};rsb.portsListModal.modal = $("#portslistmodal_modal");rsb.portsListModal.portListContent = rsb.portsListModal.modal.find("#portslistmodal_port_list_content");rsb.portsListModal.allPortsNav = rsb.portsListModal.portListContent.find("#portslistmodal_all_ports_nav");rsb.portsListModal.allNavs = rsb.portsListModal.portListContent.find("ul.flex-column>li");rsb.portsListModal.portsSearchText = rsb.portsListModal.modal.find("#portslistmodal_ports_search_text");rsb.portsListModal.availableTypes = rsb.portsListModal.portListContent.find("ul.flow-modal-list>li");rsb.portsListModal.navAllTypes = rsb.portsListModal.availableTypes;rsb.portsListModal.allNavs.on("click", function() {rsb.portsListModal.allNavs.find("a").removeClass("active");rsb.portsListModal.allNavs.find("i.fa").remove();$(this).children("a").addClass("active");$(this).children("a").append("<i class='fa fa-chevron-right pull-right' aria-hidden='true'></i>");rsb.portsListModal.portsSearchText.val("");rsb.portsListModal.navAllTypes = rsb.portsListModal.availableTypes;rsb.portsListModal.filerPorts("tag:" + $(this).attr("filter"));rsb.portsListModal.navAllTypes = rsb.portsListModal.portListContent.find("ul.flow-modal-list>li:not(.hidden)");return false});rsb.portsListModal.portListContent.find("ul.flow-modal-list>li").hover(function(e) {if (rsb.isTruncated($(this).find("span.flow-port-txt"))) {$(this).popover('show')}}, function(e) {$(this).popover('hide')});rsb.portsListModal.portsSearchText.keyup(function() {rsb.portsListModal.filerPorts($(this).val())});rsb.portsListModal.availableTypes.on("click", function() {$(this).siblings().removeClass("active");$(this).addClass("active");var portType = $(this).attr('data-port');if (portType) {if (rsb.isWorkflow) {window.open("https://arc.cdata.com/apps/ports/" + portType)} else {rsb.portsListModal.modal.modal("hide");rsb.connect.createPortModal(portType, portType, $(this).attr("is-installed") == "true", $(this).attr("data-desc"), undefined, null, $(this).attr("data-help-location"))}}});rsb.portsListModal.parseFilter = function($filter) {var $pattern = {installed: [],type: [],tag: [],keyword: [],count: 0};rsb.forEach($filter.split(/\s+/), function($part, $index) {var $op = true;var $type = $part.substring(0, $part.indexOf(':') + 1);if ($type && ["installed:", "type:", "tag:", "keyword:"].indexOf($type) >= 0) {if ($type.length >= $part.length) return;var $key = $part.substring($type.length);if ($key.startsWith("+") || $key.startsWith("-")) {$op = $key.startsWith("+");if ($key.length <= 1) {if ($type == "installed:") {$key = "true"} else {return}} else {$key = $key.substring(1)}}
if ($op && $key == "*") return;$pattern[$type.substring(0, $type.length - 1)].push({ op: $op, key: $key });$pattern.count++} else if ($part == "installed") {$pattern.installed.push({ op: $op, key: "true" });$pattern.count++} else if ($part == "uninstalled") {$pattern.installed.push({ op: $op, key: "false" });$pattern.count++} else if ($part != "*") {$pattern.keyword.push({ op: $op, key: $part });$pattern.count++}});return $pattern}
rsb.portsListModal.matchPatern = function($typeObj, $pattern) {if ($pattern && $pattern.installed && $pattern.installed.length > 0) {var $installed = $typeObj.attr("is-installed");for (var $index = 0; $index < $pattern.installed.length; $index++) {var $part = $pattern.installed[$index];if ($part.op != ($part.key == "*" || $part.key == $installed)) {return false}}}
if ($pattern && $pattern.type && $pattern.type.length > 0) {var $type = $typeObj.attr("data-port").toLowerCase();for (var $index = 0; $index < $pattern.type.length; $index++) {var $part = $pattern.type[$index];if ($part.op != ($part.key == "*" || $part.key == $type)) {return false}}}
var $tags = $typeObj.attr("data-keywords").split(",");if ($pattern && $pattern.tag && $pattern.tag.length > 0) {for (var $index = 0; $index < $pattern.tag.length; $index++) {var $part = $pattern.tag[$index];if ($part.op != ($part.key == "*" || $tags.indexOf($part.key) >= 0)) {return false}}}
if ($pattern && $pattern.keyword && $pattern.keyword.length > 0) {var $keyword = $typeObj.attr("data-port").toLowerCase();for (var $index = 0; $index < $pattern.keyword.length; $index++) {var $part = $pattern.keyword[$index];if ($part.op != ($part.key == "*" || $keyword.indexOf($part.key) >= 0 || $tags.indexOf($part.key) >= 0)) {return false}}}
return true}
rsb.portsListModal.filerPorts = function($filter) {var $pattern = rsb.portsListModal.parseFilter($.trim($filter || "").toLowerCase());if ($pattern && $pattern.count > 0) {rsb.portsListModal.navAllTypes.each(function() {if (rsb.portsListModal.matchPatern($(this), $pattern)) {$(this).removeClass('hidden')} else {$(this).addClass('hidden')}})} else {rsb.portsListModal.navAllTypes.removeClass('hidden')}}
rsb.portsListModal.show = function($reset, $filter) {if ($filter) {rsb.portsListModal.navAllTypes = rsb.portsListModal.portListContent.find("ul.flow-modal-list>li");rsb.portsListModal.filerPorts($filter);rsb.portsListModal.availableTypes = rsb.portsListModal.portListContent.find("ul.flow-modal-list>li:not(.hidden)");rsb.portsListModal.navAllTypes = rsb.portsListModal.availableTypes}
for (var i =0; i< rsb.portsListModal.allNavs.length; i++) {var filter = $(rsb.portsListModal.allNavs[i]).attr("filter");rsb.portsListModal.filerPorts("tag:" + filter);rsb.portsListModal.navNum = rsb.portsListModal.portListContent.find("ul.flow-modal-list>li:not(.hidden)");if (rsb.portsListModal.navNum.length==0) {$(rsb.portsListModal.allNavs[i]).addClass("hidden")}}
if ($reset) {rsb.portsListModal.allPortsNav.click()}
rsb.portsListModal.modal.modal('show')}
