rsb = rsb || {};rsb.flatfilePort = rsb.flatfilePort || {};var removeObj = "", linetypexmlname = "", configLoaded = false;rsb.flatfilePort.init = function (linetypexmlname) {window.linetypexmlname = linetypexmlname;rsb.flatfilePort.configChanged = false}
rsb.flatfilePort.getFileType = function() {var fileType = $("#FileType").val();if (fileType != "position" && fileType != "character") return "position";return fileType};rsb.flatfilePort.fileTypeCurrentState = "";$(document).ready(function() {if ($("#flatfilesettings_delimiter").val().startsWith("\\")) {$("#flatfilesettings_delimiter").attr("maxlength", "2")}
$("#flatfilesettings_startindex").on("keyup change paste", function() {var fileType = rsb.flatfilePort.getFileType();if (fileType === "position") {if ($(this).val() > 0) {var linecount = $("#linecount").val();var i;for (i = 0; i <= linecount; i++) {if ($('#' + rsb.escapeSelector('panel' + i)).length) { $('.control-start-index').val($(this).val()).trigger('change');if (!$('#' + rsb.escapeSelector('n' + i + 'columnname0')).length) {rsb.flatfilePort.addFieldPrepend($('#' + rsb.escapeSelector("containerlineType" + i)), i)}}}}
if ($(this).val() == 0) {$(".prepended-field").remove();$(".control-start-index").val(0).trigger('change')}}});$("#flatfilesettings_fieldindex").on("keyup change paste", function() {var fileType = rsb.flatfilePort.getFileType();if (fileType === "character") {var linecount = $("#linecount").val();var i;for (i = 0; i <= linecount; i++) {if ($('#' + rsb.escapeSelector('panel' + i)).length) { $('.control-start-index').val(($(this).val() * 2)).trigger('change');if (!$('#' + rsb.escapeSelector('n' + i + 'columnname0')).length) {rsb.flatfilePort.addFieldPrepend($('#' + rsb.escapeSelector('containerlineType' + i)), i)}}}
if ($(this).val() == 0) {$(".prepended-field").remove();$(".control-start-index").val(0).trigger('change')}}});$("#flatfilesettings_paddingcharacter").on("keyup", function() {if($(this).val() == " ") {$(this).val("\u00B7")}
if ($(this).val().length != 1) {$("#paddingchardiv").addClass("has-error")} else {$("#paddingchardiv").removeClass("has-error")}});$("#positionmultilinemode").change(function() {if(this.checked) {$("#container").show();$("#multi-line-container").show();$("#single-line-container").hide();$("#positioncolumnheaderrowdiv").hide();$("#startindex_container").show();$("#controlfieldlength_container").show();$("#nestlinetypediv").show()} else {$("#multi-line-container").hide();$("#single-line-container").show();$("#positioncolumnheaderrowdiv").show();$("#startindex_container").hide();$("#controlfieldlength_container").hide();$("#nestlinetypediv").hide()}});$("#charactermultilinemode").change(function() {if(this.checked) {$("#container").show();$("#multi-line-container").show();$("#single-line-container").hide();$("#charactercolumnheaderrowdiv").addClass("hidden");$("#fieldindex_container").removeClass("hidden");$("#controlfieldlength_container").show();$("#autogeneratedfieldnamesdiv").addClass("hidden");$("#autogenerateunrecognizednames").removeClass("hidden");$("#nestlinetypediv").show()} else {$("#multi-line-container").hide();if ($("#charactercolumnheaderspresent").prop("checked")) {$("#container").hide();$("#autogeneratedfieldnamesdiv").addClass("hidden")} else {$("#autogeneratedfieldnamesdiv").removeClass("hidden")}
if ($("#autogeneratedfieldnames").prop("checked")) {$("#container").hide()}
$("#single-line-container").show();$("#charactercolumnheaderrowdiv").removeClass("hidden");$("#fieldindex_container").addClass("hidden");$("#controlfieldlength_container").hide();$("#autogenerateunrecognizednames").addClass("hidden");$("#nestlinetypediv").hide()}});$("#flatfilesettings_delimiter").on("keyup paste", function () {if ($(this).val().startsWith("\\")) {$(this).attr("maxLength", "2");if ($(this).val().length == 0) {$("#delimiterdiv").addClass("has-error")} else {$("#delimiterdiv").removeClass("has-error")}} else {$(this).attr("maxLength", "1");if ($(this).val().length != 1) {$("#delimiterdiv").addClass("has-error")} else {$("#delimiterdiv").removeClass("has-error")}}});$("#autogeneratedfieldnames").change(function() {if (this.checked) {$("#container").hide()} else {$("#container").show()}});$("#charactercolumnheaderspresent").change(function() {if(this.checked) {$("#autogeneratedfieldnamesdiv").addClass("hidden");$("#container").hide()} else {$("#autogeneratedfieldnamesdiv").removeClass("hidden");if (!$("#autogeneratedfieldnames").prop("checked")) {$("#container").show()}}});rsb.flatfilePort.refreshFileType($("#FileType"));rsb.flatfilePort.refreshMode();$("#containerlineType1").on("change paste", ".start-index", function() {rsb.flatfilePort.sortFields($("#containerlineType1"));if ($.isNumeric($(this).val())) {$(this).parent().removeClass("has-error")}});$("#single-line-container").on("change paste", ".start-index", function() {rsb.flatfilePort.sortFields($("#containerline"));if ($.isNumeric($(this).val())) {$(this).parent().removeClass("has-error")}});$("#multi-line-container").on("keyup paste", ".config-item", function() {rsb.flatfilePort.configChanged = true});$("#single-line-container").on("keyup paste", ".config-item", function() {rsb.flatfilePort.configChanged = true});$("#multi-line-container").on("mouseenter", ".custom-item-group", function() {$(this).find(":button").show()});$("#multi-line-container").on("mouseleave", ".custom-item-group", function() {$(this).find(":button").hide()});$("#single-line-container").on("mouseenter", ".custom-item-group", function() {$(this).find(":button").show()});$("#single-line-container").on("mouseleave", ".custom-item-group", function() {$(this).find(":button").hide()});$("#flatfilesettings_controlfieldlength").on("keyup change paste", function() {var val = $(this).val();if (val) {$(".control-field-length").val(val)} else {$("div.panel").each(function(index) {var l = $(this).find("input.control-field-value").val().length;$(this).find("input.control-field-length").val(l)})}});$("#multi-line-container").on("keyup change paste", "input.control-field-value", function() {var fileType = rsb.flatfilePort.getFileType();if (fileType === "position") {if (!$("#flatfilesettings_controlfieldlength").val()) {$(this).closest(".panel").find("input.control-field-length").val($(this).val().length)}}});var space_ptrn = new RegExp('\[ \]');var string_ptrn = new RegExp('\[^_a-zA-Z0-9.:-\]');$("#multi-line-container").on("keyup change paste", ".field-name", function() {var str = $(this).val();if (!(linetypexmlname.length && $(this).hasClass("control-field-value"))) {if (space_ptrn.test(str) || (string_ptrn.test(str))) {$(this).parent().addClass("has-error has-name-error")} else {$(this).parent().removeClass("has-error has-name-error")}}
if (!str.length) {$(this).parent().removeClass("has-error has-name-error")}});$("#single-line-container").on("keyup change paste", ".field-name", function() {var str = $(this).val();if (space_ptrn.test(str) || (string_ptrn.test(str))) {$(this).parent().addClass("has-error has-name-error")} else {$(this).parent().removeClass("has-error has-name-error")}
if (!str.length) {$(this).parent().removeClass("has-error has-name-error")}});var fileType = rsb.flatfilePort.getFileType();rsb.flatfilePort.loadConfig();if (fileType === "position" && ($("#flatfilesettings_startindex").val() > 0)) {rsb.flatfilePort.addFieldPrepend($('#containerlineType1'), 1)}
$("#FileType").on("change", function() {rsb.flatfilePort.changeFlatFileTypeModal()});rsb.connect.loadModal("deleteLineModal.rst", {"porttype": rsb.connect.options.portType}, function() {window.self !== window.top && (rsb.deleteLineModal = window.parent.rsb.deleteLineModal)});rsb.connect.loadModal("changeFlatFileTypeModal.rst", {"porttype": rsb.connect.options.portType}, function() {window.self !== window.top && (rsb.changeFlatFileTypeModal = window.parent.rsb.changeFlatFileTypeModal)})});rsb.flatfilePort.loadConfig = function() {var data = {};data["WorkspaceId"] = rsb.connect.options.workspaceid;data["ConnectorId"] = rsb.connect.options.portId;$.getJSON("src/flatfileGetConfig.rsb?@json", data, function($data) {var data = ($data.items.length > 0) ? $data.items["0"].config : "";rsb.flatfilePort.applyConfig(data)})}
rsb.flatfilePort.applyConfig = function(config, forceMultiLineMode) {var xmldoc;var loadConfig = false;var loadTypeList = false;if (xmldoc = $.parseXML(config)) {var ctrl = xmldoc.firstElementChild;var type = ctrl.getAttribute("file_type");var line = ctrl.firstElementChild;var fileType = rsb.flatfilePort.getFileType();if (!!forceMultiLineMode || $("#" + rsb.escapeSelector(fileType + "multilinemode")).prop("checked")) {var lineind = 1;function loadAllLinesAndFields($callback){if (!$('#' + rsb.escapeSelector('linehead' + lineind)).length) {rsb.flatfilePort.addLineType()}
$('#' + rsb.escapeSelector('linehead' + lineind)).val(line.getAttribute("value"));if (fileType === "position") {$('#' + rsb.escapeSelector('n' + lineind + 'linetypeindex')).val($('#flatfilesettings_startindex').val())} else {$('#' + rsb.escapeSelector('n' + lineind + 'linetypeindex')).val($('#flatfilesettings_fieldindex').val())}
var field = line.firstElementChild;var fieldindex = 1;var first = true;while (field) {if (first && fileType === "position" && $("#flatfilesettings_startindex").val() > 0) {$('#' + rsb.escapeSelector('n' + lineind + 'columnname0')).val(field.getAttribute("name"));$('#' + rsb.escapeSelector('n' + lineind + 'index0')).val(field.textContent);if (field.hasAttribute("length")) {$('#' + rsb.escapeSelector('n' + lineind + 'length0')).val(field.getAttribute("length"))}} else {if (!$('#' + rsb.escapeSelector('n' + lineind + 'columnname' + fieldindex)).length) {rsb.flatfilePort.addField($('#' + rsb.escapeSelector('columncount' + lineind)), $('#' + rsb.escapeSelector('containerlineType' + lineind)), $('#' + rsb.escapeSelector('lineindex' + lineind)))}
$('#' + rsb.escapeSelector('n' + lineind + 'columnname' + fieldindex)).val(field.getAttribute("name"));$('#' + rsb.escapeSelector('n' + lineind + 'index' + fieldindex)).val(field.textContent);if (field.hasAttribute("length")) {$('#' + rsb.escapeSelector('n' + lineind + 'length' + fieldindex)).val(field.getAttribute("length"))}
fieldindex++}
first = false;field = field.nextElementSibling}
line = line.nextElementSibling;rsb.flatfilePort.sortFields($("#" + rsb.escapeSelector("containerlineType" + lineind)));lineind++;if(line){setTimeout(function() {loadAllLinesAndFields($callback)}, 1)} else {if ($callback) {$callback()}}}
loadAllLinesAndFields(function() {loadTypeList = true;if (loadConfig && loadTypeList) {rsb.flatfilePort.initRestrictionFeatures()}});rsb.flatfilePort.refreshFileType($("#FileType"));if (type === "character") {for (var i = 1; i <= $("#linecount").val(); i++) {var ind_count = 1;for (var j = 1; j <= $("#" + rsb.escapeSelector("columncount" + i)).val(); j++) {$("#" + rsb.escapeSelector("n" + i + "index" + j)).val(ind_count);ind_count = ind_count + 2}}
$('.control-start-index').val(($("#flatfilesettings_fieldindex").val() * 2)).trigger('change')}} else {$("#multi-line-container").hide();$("#single-line-container").show();$("#positioncolumnheaderrowdiv").show();$("#startindex_container").hide();$("#controlfieldlength_container").hide();var field = line.firstElementChild;var fieldindex = 1;while (field) {if (!$('#' + rsb.escapeSelector('single_columnname' + fieldindex)).length) {rsb.flatfilePort.addSingleModeField($('#singlecolumncount'), $('#containerline'))}
$('#' + rsb.escapeSelector('single_columnname' + fieldindex)).attr("value", field.getAttribute("name"));$('#' + rsb.escapeSelector('single_index' + fieldindex)).val(field.textContent);if (field.hasAttribute("length")) {$('#' + rsb.escapeSelector('single_length' + fieldindex)).val(field.getAttribute("length"))}
fieldindex++;field = field.nextElementSibling}
rsb.flatfilePort.sortFields($("#containerline"));loadTypeList = true}} else {rsb.flatfilePort.refreshMode()}
loadConfig =  true;if (loadConfig && loadTypeList) {rsb.flatfilePort.initRestrictionFeatures()}
$('#loading-bar').remove();$('#panel1').show();$('#btn-add-line').show();$('#inputs').submit()};rsb.flatfilePort.refreshMode = function() {var fileType = rsb.flatfilePort.getFileType();if ($("#" + rsb.escapeSelector(fileType + "multilinemode")).prop("checked")) {$("#multi-line-container").show();$("#single-line-container").hide();$("#positioncolumnheaderrowdiv").hide();$("#startindex_container").show();$("#controlfieldlength_container").show();$("#container").show();$("#nestlinetypediv").show();if (fileType === "character") {$("#fieldindex_container").removeClass("hidden");$("#autogenerateunrecognizednames").removeClass("hidden")}} else {$("#multi-line-container").hide();$("#single-line-container").show();$("#positioncolumnheaderrowdiv").show();$("#startindex_container").hide();$("#controlfieldlength_container").hide();$("#nestlinetypediv").hide();if (fileType === "character") {if ($("#charactercolumnheaderspresent").prop("checked")) {$("#container").hide();$("#autogeneratedfieldnamesdiv").addClass("hidden")}
if ($("#autogeneratedfieldnames").prop("checked")) {$("#container").hide()}
$("#fieldindex_container").addClass("hidden");$("#autogenerateunrecognizednames").addClass("hidden")}}
$(".control-field-length").val($('#flatfilesettings_controlfieldlength').val())}
rsb.flatfilePort.refreshFileType = function(obj) {rsb.flatfilePort.fileTypeCurrentState = obj.val();if(obj.val() === 'position') {$("#container").show();$("#controlfieldlength_container").removeClass("hidden");rsb.flatfilePort.showStartIndex();$("#startindex_container").removeClass("hidden");$("#fieldindex_container").addClass("hidden");$("#delimiterdiv").addClass("hidden");$("#autogeneratedfieldnamesdiv").addClass("hidden");$("#charactermultilinediv").addClass("hidden");$("#positionmultilinediv").removeClass("hidden");$("#positioncolumnheaderrowdiv").removeClass("hidden");$("#charactercolumnheaderrowdiv").addClass("hidden");$("#autogenerateunrecognizednames").addClass("hidden");$("#forcecelldelimiterdiv").addClass("hidden")} else if (obj.val() === 'character') {rsb.flatfilePort.hideStartIndex();$("#startindex_container").addClass("hidden");if ($("#charactermultilinemode").checked) {$("#fieldindex_container").removeClass("hidden")}
$("#controlfieldlength_container").addClass("hidden");$("#delimiterdiv").removeClass("hidden");if (!$("#charactercolumnheaderspresent").prop("checked")) {$("#autogeneratedfieldnamesdiv").removeClass("hidden")}
if ($("#charactermultilinemode").prop("checked")) {$("#charactercolumnheaderrowdiv").addClass("hidden");$("#autogeneratedfieldnamesdiv").addClass("hidden")} else {$("#charactercolumnheaderrowdiv").removeClass("hidden");$("#autogeneratedfieldnamesdiv").removeClass("hidden")}
$("#positioncolumnheaderrowdiv").addClass("hidden");$("#charactermultilinediv").removeClass("hidden");$("#positionmultilinediv").addClass("hidden");$("#autogenerateunrecognizednames").removeClass("hidden");$("#forcecelldelimiterdiv").removeClass("hidden")}}
rsb.flatfilePort.toggleFileType = function() {rsb.flatfilePort.resetConfig();rsb.flatfilePort.refreshFileType($("#FileType"));rsb.flatfilePort.refreshMode();$("#flatfilePortSettings").submit()}
rsb.flatfilePort.hideStartIndex = function() {$(".start-index-div").hide();$(".start-index-head").hide();$(".field-length-div .field-fix").attr("style", "display:none !important;");$(".field-length-div .btn-fix").attr("style", "padding-left:0px !important;");$(".field-length-div").removeClass('col-md-3').addClass('col-md-1');$(".field-length-head").hide();$(".field-name-head").removeClass('col-md-6').addClass('col-md-11');$(".field-name-div").removeClass('col-md-6').addClass('col-md-11')}
rsb.flatfilePort.showStartIndex = function() {$(".start-index-div").show();$(".start-index-head").show();$(".field-length-div .field-fix").removeAttr("style");$(".field-length-div .btn-fix").removeAttr("style");$(".field-length-div").removeClass('col-md-1').addClass('col-md-3');$(".field-length-head").show();$(".field-name-head").removeClass('col-md-11').addClass('col-md-6');$(".field-name-div").removeClass('col-md-11').addClass('col-md-6')}
rsb.flatfilePort.hidePosition = function() {$("#container").hide()}
rsb.flatfilePort.showPosition = function() {$("#container").show()}
rsb.flatfilePort.hideCharacter = function() {$("#character-container").hide()}
rsb.flatfilePort.showCharacter = function() {$("#character-container").show()}
rsb.externalCheckUnsaveFunc.flatfileConnectorSettingsForm = function() {return rsb.flatfilePort.configChanged};$("#flatfileConnectorSettingsForm").off("beforeSubmit").on("beforeSubmit", function() {var validXML =  true;if ($("#multi-line-container").find(".has-name-error").length) {validXML = false;rsb.showResult($("#alert-multi"), 'Configuration was not saved. Enter valid XML element name.', false, false, true, true);  return false}
if ($("#single-line-container").find(".has-name-error").length) {validXML = false;rsb.showResult($("#alert-single"), 'Configuration was not saved. Enter valid XML element name.', false, false, true, true);  return false}
if (validXML) {var isValidLength = true;var emptyCTRLValue = false;var emptyIndexValue = false;var emptyNameValue = false;var invalidCTRLLength = false;var isFirst = true;var invalidxmlprefix = $("#flatfileConnectorSettingsForm_InvalidXMLNamePrefix").val() || "_";var emptyFields;var fileType = rsb.flatfilePort.getFileType();if ($("#" + rsb.escapeSelector(fileType + "multilinemode")).prop("checked")) {var xml = "<config mode=\"multi\" file_type=\"" + fileType + "\"";var schema = "<Items>", hasFields = false;$("#multi-line-container").find(".multi-container").each(function(index, obj) {var ctrlposition = "", fieldData ="", ctrl="", emptyFields = true, schemaFields = "";if (fileType === "position") {var ctrlVal = $(obj).closest("div.panel").find("input.control-field-value");if (ctrlVal.val().length > parseInt($("#flatfilesettings_controlfieldlength").val())) {$(ctrlVal).parent().addClass("has-error");invalidCTRLLength = true} else {$(ctrlVal).parent().removeClass("has-error")}}
$(obj).find(".custom-item-group").each(function(inindex, inobj) {var valid = true;var elem, fieldname = "", fieldindex ="", fieldlength ="";if ($(inobj).hasClass("ctrl-field")) {ctrl = $(obj).parent().parent().find(".control-field-value").val();if (fileType === "position" && parseInt(parseInt(rsb.flatfilePort.getCTRLNextIndex($(inobj))) - parseInt($(inobj).find(".start-index").val())) < parseInt($(inobj).find(".control-field-length").val())) {$(inobj).find(".control-field-length").parent().addClass("has-error has-length-error");isValidLength = false} else {$(inobj).find(".control-field-length").parent().removeClass("has-error has-length-error")}
if (ctrl.length) {ctrlposition = inindex + 1} else {$(obj).parent().parent().find(".control-field-value").parent().addClass("has-error");emptyCTRLValue = true;valid = false}} else {$(inobj).find(".config-item").each(function(ininindex, ininobj) {if (ininindex == 0) {valid = true;elem = $(ininobj).val();if (elem.length) {fieldname = elem;emptyFields = false} else {valid = false}} else if (ininindex == 1) {if (fileType === 'position') {if ($(ininobj).val().length) {fieldindex = $(ininobj).val()} else {valid = false;if (fieldname.length) {emptyIndexValue = true;$(ininobj).parent().addClass("has-error")}}}} else if (ininindex == 2) {if ($(ininobj).val().length) {if (fileType === "position" && parseInt(parseInt(rsb.flatfilePort.getNextIndex($(ininobj))) - parseInt(rsb.flatfilePort.getCurrentIndex($(ininobj)))) < parseInt($(ininobj).val())) {$(ininobj).parent().addClass("has-error has-length-error");isValidLength = false} else {$(ininobj).parent().removeClass("has-error has-length-error")}
fieldlength = " length=\"" + rsb.xmlEscape($(ininobj).val()) + "\""}
if (valid) {fieldData += "<field name=\"" + rsb.xmlEscape(elem) + "\"" + fieldlength +">" + rsb.xmlEscape(fieldindex) + "</field>";if (!rsb.flatfilePort.isValidXMLNameStart(elem)) elem = invalidxmlprefix + elem;schemaFields += "\n    <" + rsb.xmlEscape(elem) + "/>"}
if (emptyFields) {emptyCTRLValue = false;$(inobj).parent().parent().parent().find(".control-field-value").parent().removeClass("has-error")}}})}});emptyNameValue = false;var groups = $("#multi-line-container").find(".custom-item-group");groups.removeClass("has-error").removeClass("has-error");if (!emptyFields) {var lineTypes = $("#multi-line-container").find(".panel");lineTypes.each(function(index, lineType) {groups = $(lineType).find(".custom-item-group");groups.each(function(index, obj) {$(obj).find(".config-item:eq(0)").each(function(inindex, inobj) {if (!$(inobj).val() && index < groups.length - 1) {$(inobj).parent().addClass("has-error");emptyIndexValue = true}})})})}
if (fieldData.length || ctrl.length) {if (isFirst) {xml += " position=\"" + rsb.xmlEscape(ctrlposition) + "\">";isFirst = false}
xml += "<control value=\"" + rsb.xmlEscape(ctrl) + "\">" + fieldData + "</control>";if (fieldData.length) {if (!rsb.flatfilePort.isValidXMLNameStart(ctrl)) ctrl = invalidxmlprefix + ctrl;schema += "\n  <" + rsb.xmlEscape(ctrl) + ">" + schemaFields + "\n  </" + rsb.xmlEscape(ctrl) + ">";hasFields = true}} else if (isFirst) {xml += " position=\"1\"><control></control>";isFirst = false}});xml += "</config>";if (hasFields) {schema += "\n</Items>"} else {schema = ""}
rsb.showResult($("#alert-multi"), 'Configuration was saved.', true)} else {var xml = "<config mode=\"single\" file_type=\"" + rsb.xmlEscape(fileType) + "\"><control>";var schema = "<Items>\n  <control>", schemaFields = "";emptyFields = true;$("#containerline").find(".custom-item-group").each(function(index, obj) {var elem, fieldname = "", fieldindex ="", fieldlength ="";var valid = true;$(obj).find(".config-item").each(function(inindex, inobj) {if (inindex == 0) {valid = true;elem = $(inobj).val();if (elem.length) {fieldname = elem;emptyFields = false} else {valid = false}} else if (inindex == 1) {if (fileType === 'position') {if ($(inobj).val().length) {fieldindex = $(inobj).val();emptyFields = false} else {valid = false}}} else if (inindex == 2) {if ($(inobj).val().length) {if (fileType === "position" && parseInt(parseInt(rsb.flatfilePort.getNextIndex($(inobj))) - parseInt(rsb.flatfilePort.getCurrentIndex($(inobj)))) < parseInt($(inobj).val())) {$(inobj).parent().addClass("has-error has-length-error");isValidLength = false} else {$(inobj).parent().removeClass("has-error has-length-error")}
fieldlength = " length=\"" + rsb.xmlEscape($(inobj).val()) + "\""}
if (valid) {xml += "<field name=\"" + rsb.xmlEscape(elem) + "\"" + fieldlength +">" + rsb.xmlEscape(fieldindex) + "</field>";if (!rsb.flatfilePort.isValidXMLNameStart(elem)) elem = invalidxmlprefix + elem;schemaFields += "\n    <" + rsb.xmlEscape(elem) + "/>"}}})});emptyNameValue = false;var groups = $("#containerlineType").find(".custom-item-group");groups.removeClass("has-error").removeClass("has-error");if (!emptyFields) {groups.each(function(index, obj) {$(obj).find(".config-item:eq(0)").each(function(inindex, inobj) {if (!$(inobj).val()) {$(inobj).parent().addClass("has-error");emptyNameValue = true}})})}
if (schemaFields.length) {schema += schemaFields}
xml += "</control></config>";var noSchema = !!(fileType === 'character') && ($('#charactercolumnheaderspresent').prop('checked') || $('#autogeneratedfieldnames').prop('checked'));(schemaFields.length && !noSchema) ? schema += "\n  </control>\n</Items>" : schema = "";rsb.showResult($("#alert-single"), 'Configuration was saved.', true)}
if (emptyCTRLValue) {rsb.showResult($("#alert-multi"), 'Configuration was not saved. Control Field Value cannot be blank.', false, false, true, true);  return false} else if (emptyNameValue) {if ($("#" + rsb.escapeSelector(fileType + "multilinemode")).prop("checked")) {rsb.showResult($("#alert-multi"), 'Configuration was not saved. Field name cannot be blank.', false, false, true, true);  return false} else {rsb.showResult($("#alert-single"), 'Configuration was not saved. Field name cannot be blank.', false, false, true, true);  return false}} else if (emptyIndexValue) {if ($("#" + rsb.escapeSelector(fileType + "multilinemode")).prop("checked")) {rsb.showResult($("#alert-multi"), 'Configuration was not saved. Field index cannot be blank.', false, false, true, true);  return false} else {rsb.showResult($("#alert-single"), 'Configuration was not saved. Field index cannot be blank.', false, false, true, true);  return false}} else if (invalidCTRLLength) {rsb.showResult($("#alert-multi"), 'Configuration was not saved. The length of the Control field value cannot be greater than the Control field length.', false, false, true, true);  return false} else {if (isValidLength) {return ($submitCallback) => {rsb.connect.setObject($("#flatfileConnectorSettingsForm"), rsb.connect.options.workspaceid, rsb.connect.options.portId, {"Name": "Config", "Data": xml}, () => {rsb.connect.addCollectionValue($("#flatfileConnectorSettingsForm"), rsb.connect.options.workspaceid, rsb.connect.options.portId, {"Name": "Templates", "Value": "flatfile.xml", "Data": schema}, () => {rsb.flatfilePort.configChanged = false;$submitCallback()})})}} else {if ($("#" + rsb.escapeSelector(fileType + "multilinemode")).prop("checked")) {rsb.showResult($("#alert-multi"), 'Configuration was not saved. Field length exceeding the next field starting index.', false, false, true, true);  return false} else {rsb.showResult($("#alert-single"), 'Configuration was not saved. Field length exceeding the next field starting index.', false, false, true, true);  return false}}}}
rsb.flatfilePort.configChanged = false}).off("reset").on("reset", function() {rsb.flatfilePort.configChanged = false});rsb.flatfilePort.getNextIndex = function(obj) {return obj.parent().parent().next().find(".start-index").val()}
rsb.flatfilePort.getCurrentIndex = function(obj) {return obj.parent().prev().find(".start-index").val()}
rsb.flatfilePort.getCTRLNextIndex = function(obj) {return obj.next().find(".start-index").val()}
rsb.flatfilePort.addLineType = function() {rsb.flatfilePort.incr_linecount();var fileType = rsb.flatfilePort.getFileType();var linecount = $('#linecount').val();var html = "<div class=\"panel panel-default\" id=\"" + rsb.escapeSelector("panel" + linecount) + "\">" +"  <input type=\"hidden\" class=\"line-index\" id=\"" + rsb.escapeSelector("lineindex" + linecount) + "\" value=" + rsb.xmlEscape(linecount) + ">" +"  <div class=\"panel-heading\">" +"    <input type=\"hidden\" class=\"rsb-form-nosubmit\" id=\"" + rsb.escapeSelector("columncount" + linecount) + "\" value=\"1\">" +"    <div class=\"form-group row\">" +"      <label class=\"col-md-3 control-label col-form-label original-style\" for=\"" + rsb.escapeSelector("linehead" + linecount) + "\">" + 'Control Field Value:'+"</label>" +"      <div class=\"col-md-3 original-style\"><input type=\"text\" class=\"form-control rsb-form-nosubmit config-item control-field-value\" id=\"" + rsb.escapeSelector("linehead" + linecount) + "\" value=\"\" placeholder=\""+ 'Value'+ "\"></div>" +"      <div class=\"col-md-3 ms-auto original-style\"><button type=\"button\" class=\"btn-close pull-right\" style=\"margin-top:5px;\" onclick=\"rsb.flatfilePort.deleteLineTypeModal(" + rsb.xmlEscape(linecount) + ");\"></button></div>" +"    </div>" +"  </div>" +"  <div class=\"panel-body\">" +"    <div class=\"form-group row mb-3\">" +"      <div class=\"col-md-6 label-inline field-name-head\" align=\"center\"><label style=\"margin-bottom:0px;\">" + 'Field Name'+ "</label></div>" +"      <div class=\"col-md-3 label-inline start-index-head\" align=\"center\"><label style=\"margin-bottom:0px;\">" + 'Field Index'+ "</label></div>" +"       <div class=\"col-md-3 label-inline field-length-head\"><div class=\"field-fix\" align=\"center\"><label style=\"margin-bottom:0px;\">" + 'Field Length'+ "</label></div></div>" +"    </div>" +"    <div id=\"" + rsb.escapeSelector("containerlineType" + $('#linecount').val()) + "\"  class=\"multi-container\">" +"      <div class=\"form-group row mb-3 custom-item-group ctrl-field\">" +"        <div class=\"col-md-6 input-inline field-name-div\">" +"          <input type=\"text\" class=\"form-control rsb-form-nosubmit config-item control-field-name\" id=\"" + rsb.escapeSelector("n" + linecount + "linetype") + "\" placeholder=\"" + 'Field Name'+ "\" value=\"" + 'Control Field'+ "\" disabled>" +"        </div>" +"        <div class=\"col-md-3 input-inline start-index-div\">" +"          <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item start-index control-start-index\" id=\"" + rsb.escapeSelector("n" + linecount + "linetypeindex") + "\" placeholder=\"" + 'Start Index'+ "\" value=\"";if (fileType === "position") {html += rsb.xmlEscape($('#flatfilesettings_startindex').val())} else {html += rsb.xmlEscape($('#flatfilesettings_fieldindex').val())}
html +=  "\" disabled/>" +"        </div>" +"        <div class=\"col-md-3 input-inline field-length-div\">" +"          <div class=\"field-fix\">" +"            <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item control-field-length\" id=\"" + rsb.escapeSelector("n" + linecount + "linetypelength") + "\" placeholder=\"" + 'Length (Optional)'+ "\" value=\"" + rsb.xmlEscape($('#flatfilesettings_controlfieldlength').val()) + "\" disabled>" +"          </div>" +"        </div>" +"      </div>" +"      <div class=\"form-group row mb-3 custom-item-group\">" +"        <div class=\"col-md-6 input-inline field-name-div\">" +"          <input type=\"text\" class=\"form-control rsb-form-nosubmit config-item field-name\" id=\"" + rsb.escapeSelector("n" + linecount + "columnname1") + "\" placeholder=\""+ 'Field Name'+ "\"value=\"\">" +"        </div>" +"        <div class=\"col-md-3 input-inline start-index-div\">" +"          <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item start-index\" id=\"" + rsb.escapeSelector("n" + linecount + "index1") + "\" placeholder=\""+ 'Start Index'+ "\" value=\"\">" +"        </div>" +"        <div class=\"col-md-3 input-inline field-length-div\">" +"          <div class=\"field-fix\">" +"            <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item field-length\" id=\"" + rsb.escapeSelector("n" + linecount + "length1") + "\" placeholder=\"" + 'Length (Optional)'+ "\" value=\"\">" +"          </div>" +"          <div class=\"btn-fix\">" +"            <button type=\"button\" class=\"btn-close\" style=\"display:none;\" onclick=\"rsb.flatfilePort.removeCustomItem(this)\" aria-label=\"Close\"></button>" +"          </div>" +"        </div>" +"      </div>" +"    </div>" +"    <div class=\"col-md-12\" style=\"margin-left:15px\">" +"      <button type=\"button\" style=\"margin-left:-1px\" class=\"btn btn-outline-secondary\" onclick=\"rsb.flatfilePort.addField($('#" + rsb.escapeSelector("columncount" + linecount) + "'), $('#" + rsb.escapeSelector("containerlineType" + linecount) + "'), $('#" + rsb.escapeSelector("lineindex" + linecount) + "'))\"><i class=\"fa fa-plus\" aria-hidden=\"true\"></i>&nbsp;" + 'Add Field'+ "</button>" +"    </div>" +"  </div>" +"</div>";$('#custom-panel').append(html);if (fileType === "position" && $("#flatfilesettings_startindex").val() > 0) {rsb.flatfilePort.addFieldPrepend($('#' + rsb.escapeSelector('containerlineType' + linecount)), linecount)}
if (fileType === "character") {$("#" + rsb.escapeSelector("n" + linecount + "index1")).val(1);$('.control-start-index').val(($("#flatfilesettings_fieldindex").val() * 2));rsb.flatfilePort.sortFields($("#" + rsb.escapeSelector("containerlineType" + linecount)))}
$("#" + rsb.escapeSelector("containerlineType" + linecount)).on("change paste", ".start-index", function() {rsb.flatfilePort.sortFields($("#" + rsb.escapeSelector("containerlineType" + linecount)));if ($.isNumeric($(this).val())) {$(this).parent().removeClass("has-error")}});rsb.flatfilePort.refreshFileType($("#FileType"))}
rsb.flatfilePort.incr_linecount = function() {$("#linecount").val(function() {var i = $("#linecount").val();i++;return i})}
rsb.flatfilePort.addField = function(count, container, lineindex) {var c = count.val();c++;count.val(c);var fileType = rsb.flatfilePort.getFileType();var index = lineindex.val();var html = "      <div class=\"form-group row mb-3 custom-item-group\">" +"        <div class=\"col-md-6 input-inline field-name-div\">" +"          <input type=\"text\" class=\"form-control rsb-form-nosubmit config-item field-name\" id=\"" + rsb.escapeSelector("n" + index + "columnname" + c)+ "\" placeholder=\""+ 'Field Name'+ "\" value=\"\">" +"        </div>" +"        <div class=\"col-md-3 input-inline start-index-div\">" +"          <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item start-index\" id=\"" + rsb.escapeSelector("n" + index + "index" + c) + "\" placeholder=\""+ 'Start Index'+ "\" value=\"\">" +"        </div>" +"        <div class=\"col-md-3 input-inline field-length-div\">" +"          <div class=\"field-fix\">" +"            <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item field-length\" id=\"" + rsb.escapeSelector("n" + index + "length" + c) + "\" placeholder=\""+ 'Length (Optional)'+ "\" value=\"\">" +"          </div>" +"          <div class=\"btn-fix\">" +"            <button type=\"button\" class=\"btn-close\" style=\"display:none;\" onclick=\"rsb.flatfilePort.removeCustomItem(this)\" aria-label=\"Close\"></button>" +"          </div>" +"        </div>" +"      </div>";container.append(html);if (fileType === "character") {if ($("#" + rsb.escapeSelector("n" + index + "index" + (c - 1))).val()) {$("#" + rsb.escapeSelector("n" + index + "index" + c)).val(Number($("#" + rsb.escapeSelector("n" + index + "index" + (c - 1))).val()) + 2).trigger('change')} else {$("#" + rsb.escapeSelector("n" + index + "index" + c)).val(1).trigger('change')}}
rsb.flatfilePort.refreshFileType($("#FileType"))}
rsb.flatfilePort.addFieldPrepend = function(container, index) {if ($("#" + rsb.escapeSelector("n" + index + "columnname0")).length > 0) return;var html = "      <div class=\"form-group row mb-3 custom-item-group prepended-field\">" +"        <div class=\"col-md-6 input-inline field-name-div\">" +"          <input type=\"text\" class=\"form-control rsb-form-nosubmit config-item field-name\" id=\"" + rsb.escapeSelector("n" + index + "columnname0") + "\" placeholder=\""+ 'Field Name'+ "\" value=\"\">" +"        </div>" +"        <div class=\"col-md-3 input-inline start-index-div\">" +"          <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item start-index\" id=\"" + rsb.escapeSelector("n" + index + "index0") + "\" placeholder=\"" + 'Start Index'+ "\" value=\"0\" disabled>" +"        </div>" +"        <div class=\"col-md-3 input-inline field-length-div\">" +"          <div class=\"field-fix\">" +"            <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item field-length\" id=\"" + rsb.escapeSelector("n" + index + "length0") + "\" placeholder=\""+ 'Length (Optional)'+ "\" value=\"\">" +"          </div>" +"        </div>" +"      </div>";container.prepend(html);rsb.flatfilePort.refreshFileType($("#FileType"))}
rsb.flatfilePort.addSingleModeField = function(count, container) {var c = count.val();c++;count.val(c);var html = "      <div class=\"form-group row mb-3 custom-item-group\">" +"        <div class=\"col-md-6 input-inline field-name-div\">" +"          <input type=\"text\" class=\"form-control rsb-form-nosubmit config-item field-name\" id=\"" + rsb.escapeSelector("single_columnname" + c) + "\" placeholder=\""+ 'Field Name'+ "\"value=\"\">" +"        </div>" +"        <div class=\"col-md-3 input-inline start-index-div\">" +"          <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item start-index\" id=\"" + rsb.escapeSelector("single_index" + c) + "\" placeholder=\""+ 'Start Index'+ "\" value=\"\">" +"        </div>" +"        <div class=\"col-md-3 input-inline field-length-div\">" +"          <div class=\"field-fix\">" +"            <input type=\"number\" class=\"form-control rsb-form-nosubmit config-item field-length\" id=\"" + rsb.escapeSelector("single_length" + c) + "\" placeholder=\"" + 'Length (Optional)'+ "\" value=\"\">" +"          </div>" +"          <div class=\"btn-fix\">" +"            <button type=\"button\" class=\"btn-close pull-left\" style=\"display:none;\" onclick=\"rsb.flatfilePort.removeCustomItem(this)\" aria-label=\"Close\"></button>" +"          </div>" +"        </div>" +"      </div>";container.append(html);rsb.flatfilePort.refreshFileType($("#FileType"))}
rsb.flatfilePort.deleteLineTypeModal = function(linecount) {var text = "";removeObj = linecount;if ($("#" + rsb.escapeSelector("linehead" + linecount)).val().length) {text = "\"" + $("#" + rsb.escapeSelector("linehead" + linecount)).val() + "\""}
rsb.deleteLineModal.show(text, rsb.flatfilePort.removePanel)}
rsb.flatfilePort.changeFlatFileTypeModal = function() {var fileType = rsb.flatfilePort.getFileType();var text = (fileType === "position") ? "\"Character Delimited\"" : "\"Position Delimited\"";rsb.changeFlatFileTypeModal.show(text, rsb.flatfilePort.toggleFileType, rsb.flatfilePort.cancelChangeFile)}
rsb.flatfilePort.removePanel = function() {$("#" + rsb.escapeSelector("panel" + removeObj)).remove();rsb.flatfilePort.configChanged = true}
rsb.flatfilePort.removeCustomItem = function(obj) {var group = $(obj).parents("div.custom-item-group");group[0].remove();rsb.flatfilePort.configChanged = true}
rsb.flatfilePort.cancelChangeFile = function() {var fileType = rsb.flatfilePort.getFileType();$("#FileType").val((fileType === 'position') ? "character" : "position")}
rsb.flatfilePort.resetConfig = function() {var count = $("#linecount").val();for (var i = 1; i <= count; i++) {if (i === 1) {var fields = $("#columncount" + i).val();for (var j = 1; j <= fields; j++) {if (j === 1) {$("#linehead1").val("");$("#n1columnname1").val("");$("#n1index1").val("");$("#n1length1").val("")} else {$("#" + rsb.escapeSelector("n1columnname" + j)).parent().parent().remove()}}} else {$("#" + rsb.escapeSelector("panel" + i)).remove()}}
var singlecount = $("#singlecolumncount").val();for (var k = 1; k <= singlecount; k++) {if (k === 1) {$("#single_columnname1").val("");$("#single_index1").val("");$("#single_length1").val("")} else {$("#single_columnname" + k).parent().parent().remove()}}
var data = {};data["Name"] = "Config";var fileType = rsb.flatfilePort.getFileType();var mode = ($("#" + rsb.escapeSelector(fileType + "multilinemode")).prop("checked")) ? "multi" : "single";data["Data"] = "<config mode=\"" + mode + "\" file_type=\"" + rsb.escapeSelector(fileType);data["Data"] += (mode === "multi") ? "\" position=\"1\"><control></control></config>" : "\"><control></control></config>";rsb.connect.setObject($("#flatfileConnectorSettingsForm"), rsb.connect.options.workspaceid, rsb.connect.options.portId, data, function () {$("#multi-line-container").find(".panel").remove();$('#custom-panel').empty();var multiLineMode = $("#" + rsb.escapeSelector(fileType + "multilinemode")).prop("checked");rsb.flatfilePort.applyConfig(data["Data"], true);!multiLineMode && rsb.flatfilePort.applyConfig(data["Data"])})}
rsb.flatfilePort.sortFields = function(container) {var dataArray = container.find(".custom-item-group");dataArray.sort(function (a, b) {a = parseInt($(a).find(".start-index").val(), 10);b = parseInt($(b).find(".start-index").val(), 10);return a-b});container.append(dataArray)}
rsb.flatfilePort.isValidXMLNameStart = function(xmlName) {var reg = new RegExp("[^_a-zA-Z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]");return !reg.test(xmlName.charAt(0))}
rsb.flatfilePort.initRestrictionFeatures = function() {var readonly = !rsb.connectorList[rsb.connect.options.workspaceid.toLowerCase()].connectors[rsb.connect.options.portId.toLowerCase()].allowedPrivileges.includes("updatesettings");rsb.connect.initRestrictionFeatures((readonly ? "true" : "disabled"), $(".port-tab-content #settings"))}
