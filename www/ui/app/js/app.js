var rsb = rsb || {};rsb.connect = rsb.connect || {};rsb.connect.pswdmask = "***************";rsb.connect.userRole = "";$(document).ready(function() {$.validator.addMethod("certificate", rsb.connect.validateCert, $.validator.format('Can\'t open the certificate.'));$.validator.addMethod("psw-maxlength", rsb.connect.validatePwd, $.validator.format('The password is too long.'));$.validator.addMethod("pgp-key", rsb.connect.validatePGPKey, $.validator.format('Can\'t open the key.'));$.validator.addMethod("data-react-validation", (value, element, params) => {const validator = $(element).data("react-validator");return validator != null ? validator(value, element, params) : true}, $.validator.format('The value is invalid.'));$.validator.addMethod("emaillist", (value, element) => {if (!value) return true;var addrs = value.trim().split(/[;,]/);for (var i = 0; i < addrs.length; i++) {if (!addrs[i]) continue;if (!/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(addrs[i].trim())) return false}
return true}, $.validator.format('Please enter a valid email address.'));rsb.connect.initPasswordInputBox()});rsb.connect.resetConnection = function(queryData, btn, resultContainer, capabilities, queryDataCallback, oauthSuccessCallback, oauthErrorCallback, beforeOAuth, testConnectionErrorCallback) {if (beforeOAuth) {beforeOAuth()}
rsb.connect.oauth(queryData, btn, resultContainer, capabilities, queryDataCallback, function(queryData, oauth_callback){rsb.testConnection(queryData, btn, resultContainer, oauthSuccessCallback, testConnectionErrorCallback || oauthErrorCallback, oauth_callback)}, oauthErrorCallback)}
rsb.connect.oauthWarning = function(result, resultContainer) {if ((result.refreshtoken == null || result.refreshtoken.length == 0) && (result.oauthrefreshtoken == null || result.oauthrefreshtoken.length == 0)) {var date = null;if (result.expiresin != null || result.oauthexpiresin != null) {date = new Date();try {var expiresin = result.expiresin || result.oauthexpiresin;date.setSeconds(date.getSeconds() + parseInt(expiresin))} catch (error) {date = null}}
if (date) {rsb.showResult(resultContainer, 'An access token was successfully retrieved, but no refresh token was obtained for this connection. This connection is only valid for the duration of the access token'+ ": " + rsb.connect.formatTimestamp(date), "warning")} else {rsb.showResult(resultContainer, 'An access token was successfully retrieved, but no refresh token was obtained for this connection. This connection is only valid for the duration of the access token', "warning")}
return true}
return false}
rsb.connect.oauth = function(queryData, btn, resultContainer, capabilities, queryDataCallback, successCallback, oauthErrorCallback) {let downloadLogLink;if (queryData.sharedconnectionname != null) {downloadLogLink = "src/downloadOAuthLog.rst?OAuthType=SharedConnection&ConnectionName=" + encodeURIComponent(queryData.sharedconnectionname) + "&ConnectionType=" + encodeURIComponent(queryData.sharedconnectioncategory)} else {downloadLogLink = "src/downloadOAuthLog.rst?OAuthType=Connector&WorkspaceId=" + encodeURIComponent(queryData.workspaceid) + "&ConnectorId=" + encodeURIComponent(queryData.connectorid)}
const downloadBtn = '<a class="btn btn-secondary btn-outline-secondary pull-right me-24" download="OAuthLogs.log" style="margin-top: -5px;" href="' + downloadLogLink + '" role="button"><i class="fa fa-download"></i> ' + 'Download Logs'+ ' </a>';rsb.oauth(queryData, btn, resultContainer, capabilities, queryDataCallback, successCallback, oauthErrorCallback, downloadBtn)}
rsb.connect.initPaidFeatures = function(type) {const paidFeatureModal = window.self !== window.top ? window.parent.rsb.paidFeature.paidFeatureModal : rsb.paidFeature.paidFeatureModal;var types = ["disabled", "unlimited", "enterprise", "business", "professional", "standard", "starter", "true"];for (var i = 0; i < types.length; i++) {if (types[i] == type.toLowerCase()) break;var attr = "[ispaid='" + types[i] + "']";var _paidGroups = $("div" + attr);_paidGroups.find("button").prop("disabled", true);_paidGroups.find("input, select").prop("readonly", true).on("mousedown", paidFeatureModal);$("input" + attr + ", select" + attr).prop("readonly", true).on("mousedown", paidFeatureModal);$("input" + attr + "[type='checkbox'], input" + attr + "[type='radio']").parent("label").on("mousedown", paidFeatureModal);$("option" + attr).prop("disabled", true)}}
rsb.connect.initRestrictionFeatures = function($role, $container) {rsb.connect.userRole = rsb.connect.userRole || $role || "";$role = ($role || "").toLowerCase();$container = ($container || $(document));var $roles = ["disabled", "admin", "standard", "support", "true"];for (var $index = 0; $index < $roles.length; $index++) {if ($roles[$index] == $role) break;var attr = "[restrict='" + $roles[$index] + "']";var $restrictGroups = $container.find("div" + attr + ", form" + attr);$restrictGroups.find("button:not([restrict])").each(function() { $(this).prop("disabled", true).toggle($(this).attr("restrictStyle") === "disabled"); });$restrictGroups.find("input:not([restrict]), select:not([restrict]), textarea:not([restrict])").prop("readonly", true).prop("disabled", true).off("mousedown").on("mousedown", function() { return false; });$container.find("button" + attr).each(function() { $(this).prop("disabled", true).toggle($(this).attr("restrictStyle") === "disabled"); });$container.find("input" + attr + ", select" + attr + ", textarea" + attr).prop("readonly", true).prop("disabled", true).off("mousedown").on("mousedown", function() { return false; });$container.find("input" + attr + "[type='checkbox'], input" + attr + "[type='radio']").parent("label").off("mousedown").on("mousedown", function() { return false; });$container.find("option" + attr).prop("disabled", true)}}
rsb.connect.validateCert = function(value, element, params) {if (value == "rsb:uploadCert" || value == "*" || value.length <= 0) {return true}
var success = true;var form = $(element).parents("form.form-settings");params = $.parseJSON(params);var data = { "name": value, "@json": "true" };if (params["password"]) {data["password"] = rsb.connect.getUnmaskedPswd($(params["password"]));if ((!params["optional"] || params["optional"].toLowerCase() == "false") && ![".pem", ".ppk"].includes(rsb.connect.getFilenameExt(value)) && (!data["password"] || data["password"].length <= 0)) {var inputName = $(params["password"]).attr("name");var obj = {};obj[inputName] = 'Password cannot be empty.';form.validate().showErrors(obj);return false}}
form.prop("data-validation", "validating");$.ajax({url: "src/getCertificateFiles.rsb",type: "GET",data: data,dataType: "json",success: function(result, textStatus, jqXHR) {if (result["items"] && result["items"].length > 0) {result = result["items"];var container;var success = false;var containerId = $(element).attr("subject-container");if (containerId) {container = form.find("#" + containerId)}
var errorMsg = rsb.getResultErrorMessage(result);if (errorMsg) {if (container) {rsb.showResult(container, errorMsg, "error")} else {var inputName = $(element).attr("name");var obj = {};obj[inputName] = errorMsg;form.validate().showErrors(obj)}} else {var subject = result[0]["subject"];var expdays = result[0]["expirationdays"];success = true;if (container) {if (subject) {var message = "";if (params["subject"] && [subject, "*"].indexOf($(params["subject"]).val() || "*") < 0) {success = false;message = 'The certificate subject is mismatched.<br>'}
message += rsb.evalTemplate('Certificate Subject: $subject$', {"subject" : subject});if (expdays) {message += rsb.evalTemplate('This certificate expires in $expdays$ days.', {"expdays" : expdays})}
var algorithm = result[0]['signaturealgorithm'];if (algorithm.toLowerCase().indexOf('md5') !== -1 || algorithm.toLowerCase().indexOf('sha1') !== -1) {message += '<br>WARNING: This certificate is signed with a weak signature algorithm. It is recommended that the issuer of this certificate obtain a replacement.';rsb.showResult(container, message, success ? "warning" : "error", true)} else {rsb.showResult(container, message, success ? "info" : "error", !success)}} else {rsb.showResult(container, 'Selected certificate file only contains key but no certificate info.', "warning")}}}
form.prop("data-validation", success ? "success" : "failure")}}});return success}
rsb.connect.validatePwd = function(value, element, params) {if (rsb.connect.getUnmaskedPswd($(element)).length > $(element).attr("psw-maxlength")) {var obj = {};obj[$(element).attr("name")] = rsb.evalTemplate('Please enter no more than $max$ characters.', {"max" : $(element).attr("psw-maxlength")});$(element).parents("form.form-settings").validate().showErrors(obj)}
return true}
rsb.connect.validatePGPKey = function(value, element, params) {if (value == "*" || value.length <= 0) {return true}
var success = true;var form = $(element).parents("form.form-settings");params = $.parseJSON(params);if (!params["api"]) return true;var data = { "keyid": value, "@json": "true" };if (params["passphrase"]) {data["passphrase"] = rsb.connect.getUnmaskedPswd($(params["passphrase"]));if ((!data["passphrase"] || data["passphrase"].length <= 0)) {var inputName = $(params["passphrase"]).attr("name");var obj = {};obj[inputName] = 'Password cannot be empty.';form.validate().showErrors(obj);return false}}
form.prop("data-validation", "validating");$.ajax({url: params["api"],type: "GET",data: data,dataType: "json",success: function(result, textStatus, jqXHR) {if (result["items"] && result["items"].length > 0) {result = result["items"];var container;var success = false;var containerId = $(element).attr("subject-container");if (containerId) {container = form.find("#" + containerId)}
var errorMsg = rsb.getResultErrorMessage(result);if (errorMsg) {if (container) {rsb.showResult(container, errorMsg, "error")} else {var inputName = $(element).attr("name");var obj = {};obj[inputName] = errorMsg;form.validate().showErrors(obj)}} else {var keyid = result[0]["keyid"];var passphraseOK = result[0]["passphrase"];var effectivedate = result[0]["effectivedate"];var expirationdate = result[0]["expirationdate"];var fingerprint = result[0]["fingerprint"];success = true;if (container) {var message = "";if (passphraseOK && !rsb.getValueAsBool(passphraseOK)) {message = "<b>" + 'Passphrase is incorrect!'+ "</b><br>";success = false}
message += rsb.evalTemplate('<b>Key Id: </b>$keyid$, <b>Fingerprint: </b>$fingerprint$, <b>Effective Date: </b>$effectivedate$, <b>Expiration Date: </b>$expirationdate$.', {"keyid" : keyid, "effectivedate": effectivedate, "expirationdate": expirationdate, "fingerprint": fingerprint});rsb.showResult(container, message, success ? "info" : "error", true)}
form.prop("data-validation", success ? "success" : "failure")}}}});return success}
rsb.connect.createPortModal = function (portType, portId, installed, desc, callback, displayName, helpLocation) {rsb.createPort.form.portId.val(portId);rsb.createPort.form.portType.val(portType);displayName = displayName || rsb?.connectorTypeList?.[portType.toLowerCase()]?.name || portType;rsb.createPort.form.portTypeName.val(displayName);rsb.createPort.form.portDesc.text(installed ? (desc || displayName) : "")
rsb.createPort.form.portHelp.attr("href", "help.rst#" + helpLocation);rsb.createPort.installed = installed;rsb.createPort.successCallback = callback;rsb.createPort.modal.modal("show")}
rsb.connect.isOtherConnectorLicensed = function(portType, isNew, resultContainer) {var isLicensed = false;var requestData = { "@json": true, "silent": true, "isnew" : isNew, "connectorType" : portType };$.ajax({dataType: "json",url: "src/getLicenseInfo.rsb",type: "POST",data: requestData,async: false,success: function (data, textStatus, jqXHR) {var result = data["items"];var errorMsg = rsb.getResultErrorMessage(result);if (errorMsg) {rsb.showResult(resultContainer, errorMsg, false)} else if (result && result.length > 0 && result[0]){isLicensed = rsb.getValueAsBool(result[0]["result"])}}});return isLicensed}
rsb.connect.importSettingsModal = function(workspace, droppedFiles) {rsb.importSettings.form.one("success", function (e, result) {rsb.importSettings.modal.modal('hide');window.location.reload()});if (droppedFiles) {rsb.importSettings.importmode.prop("checked", true);rsb.importSettings.importmode.prop("disabled", true);rsb.importSettings.droppedFiles = droppedFiles} else {rsb.importSettings.importmode.prop("disabled", false)}
rsb.importSettings.workspace.val(workspace || "");rsb.importSettings.modal.modal("show")}
rsb.connect.exportSettingsModal = function(ports, workspace, canExportAll, canExportAllWorkspace, flowAPIs) {rsb.exportSettings.generateItems(ports, flowAPIs);if (canExportAll === undefined) {canExportAll = true}
if (canExportAll) {rsb.exportSettings.exportall.closest(".form-group").removeClass("hidden")} else {rsb.exportSettings.exportall.closest(".form-group").addClass("hidden")}
rsb.exportSettings.workspace.val(workspace || "");rsb.exportSettings.modal.modal("show")}
rsb.connect.copyConnectorModal = function(portContainer, successcallback, undocallback, workspaceSwitch) {rsb.copyConnector.connectorContainer = portContainer;rsb.copyConnector.srcworkspace.val(portContainer.srcworkspace);rsb.copyConnector.initDstOptions(rsb.copyConnector.connectorContainer);rsb.copyConnector.generateItems(portContainer.portid, portContainer.copyportid, portContainer.style);rsb.copyConnector.successCallback = successcallback;rsb.copyConnector.undoCallback = undocallback;rsb.copyConnector.workspaceSwitch = workspaceSwitch;rsb.copyConnector.modal.modal("show")}
rsb.connect.deletePortModal = function(workspace, ports, stylePorts, complete) {rsb.deletePort.successCallback = complete;rsb.deletePort.workspace.val(workspace || "");rsb.deletePort.generateItems(ports);rsb.deletePort.generatePortText(ports, stylePorts);rsb.deletePort.modal.modal("show")}
rsb.connect.deleteOnePort = function ($workspaceid, $connectorid, $callback) {$.ajax({DataType: "json",url: "api/connectors.rsd",type: "DELETE",data: {"@json": true, "workspaceid": $workspaceid, "connectorid": $connectorid},success: function (data, textStatus, jqXHR) {!!$callback && $callback(data, textStatus, jqXHR, $workspaceid, $connectorid)}})}
rsb.connect.switchPort = function(name, nextPage) {$.ajax({dataType: "html",type: "POST",url: "src/switchPort.rst",data: { "newport": name },success: function (data) {if (nextPage) {window.location.assign(nextPage)} else {window.location.reload()}}})}
rsb.connect.formatDetails = function(params) {var html = '<table class="table table-hover table-bordered2 table-striped table-condensed dataTable slide" width="100%">' +'<tr>'+'<th class="hidden-xxs">' + 'Creation Time'+ '</th>'+'<th>' + 'Log Type'+ '</th>'+'<th>' + 'File Name'+ '</th>'+'</tr>';var details = [];var data = params["data"];var requestData = { "@json": true, "messageId": data["messageid"], "workspaceid": data["workspace"], "connectorid": data["connectorid"], "direction": data["direction"] };$.ajax({dataType: "json",url: "api/getTransactionLogs.rsb",type: "POST",data: requestData,async: false,success: function (data, textStatus, jqXHR) {var result = data["items"];var errorMsg = rsb.getResultErrorMessage(result);if (errorMsg) {rsb.showResult($(params["resultContainer"]), errorMsg, false)} else {details = result}}});for (var i in details) {if (details[i]["type"] == "Log" || details[i]["type"] == "MDN" || details[i]["type"] == "Error" || details[i]["type"] == "Request" || details[i]["type"] == "Response" || details[i]["type"] == "Headers" ||
details[i]["type"] == "Async Log" || details[i]["type"] == "Async MDN" || details[i]["type"] == "EERP" || details[i]["type"] == "NERP" || details[i]["type"] == "ACK" || details[i]["type"] == "Receipt" || details[i]["type"] == "Email Message") {var row = { "filename": details[i]["file"], "workspaceid": data["workspace"], "connectorid": data["connectorid"], "messageid": data["messageid"], "direction": data["direction"] };html += '<tr>' +'<td class="hidden-xxs">' + rsb.formatTimestamp(details[i]["timecreated"]) + '</td>' +'<td>' + rsb.htmlEncode(details[i]["type"]) + '</td>' +'<td>' + rsb.connect.formatFilename(rsb.htmlEncode(details[i]["file"]), "display", row) + '</td>' +'</tr>'}}
html += '</table>';return html}
rsb.connect.showDetails = function(e) {var tr = $(this).closest('tr');var row = tr.parents("table").DataTable().row(tr);if ( row.child.isShown() ) {row.child.hide();$(this).find("i").removeClass("fa fa-minus-circle").addClass("fa fa-plus-circle")}
else {row.child(rsb.connect.formatDetails(e.data), 'drop-down-td').show();$(this).find("i").removeClass("fa fa-plus-circle").addClass("fa fa-minus-circle");row.child().find("table td").click(function() {rsb.expandCell($(this))})}}
rsb.connect.sendFiles = function(workspace, portId, table, button, errorContainer) {errorContainer && errorContainer.hide();var files = $(table).find("tbody tr.unsent-file").not(".sending").has("input[type='checkbox']:checked");if (files.length > 0) {button.button("loading");rsb.showInfoModal('Sending Files', "", false, true, files.length, true);rsb.connect.sendFileImpl(workspace, portId, files, 0, function (success, message) {rsb.closeInfoModal();button.button("reset");var showErrorDetail = success == "none" || success == "custom-warning" || success == "custom-error";rsb.showInfoModalResult(errorContainer, message, success, showErrorDetail, !showErrorDetail);if (showErrorDetail) {errorContainer.removeClass("ellipsis");errorContainer.unbind("dblclick");errorContainer.find("li").each(function() {$(this).dblclick(function() {$(this).toggleClass("ellipsis")})})} else {errorContainer.addClass("ellipsis");errorContainer.unbind("dblclick");errorContainer.dblclick(function() {$(this).toggleClass("ellipsis")})}
$(table).DataTable().ajax.reload()}, "", "")} else {rsb.showInfoModalResult(errorContainer, 'You must select a file to send.', "info")}}
rsb.connect.sendFileImpl = function(workspace, portId, files, i, complete, resultFormat, resultMsg) {if (rsb.checkInfoModalState(i, files.length)) {var postData = { "@json": true, "workspaceid": workspace, "portid": portId };postData["file"] = $(files[i]).find("td:eq(1) input[name='filepath']").val();postData["messageid"] = $(files[i]).find("td:eq(1) input[name='messageid']").val();postData["subfolder"] = $(files[i]).find("td:eq(1) input[name='subfolder']").val();postData["formatresult"] = $(files[i]).find("td:eq(1) input[name='formatresult']").val();var filename = $(files[i]).find("td:eq(1) input[name='filename']").val();if (postData["messageid"] != undefined && postData["messageid"].length > 0) {rsb.changeInfoModalMessage('Sending&nbsp;'+ filename);$.ajax({dataType: "json",url: "api/sendFile.rsb",type: "POST",data: postData,success: function(data, textStatus, jqXHR) {rsb.increaseInfoModalProgress();var result = data["items"];if (result && result.length > 0) {for (var j in result) {if (result[j]["rsb:ecode"] || result[j]["rsb:emessage"]) {resultMsg = result[j]["rsb:emessage"];resultFormat = "error"} else if (result[j]["result"]) {result[j]["result"] = result[j]["result"].toLowerCase();if (result[j]["result"] == "success") {resultFormat = "success";resultMsg = result[j]["message"] || 'File(s) sent.'} else if (result[j]["result"] == "error") {resultFormat = "error";resultMsg = result[j]["message"] || 'Send Error'} else if (result[j]["result"] == "warning") {resultFormat = "warning";resultMsg = result[j]["message"] || 'Send Warning'} else if (result[j]["result"] == "pending") {resultFormat = "info";resultMsg = result[j]["message"] || 'Send Pending'} else if (result[j]["result"] == "skipped") {resultFormat = "info";resultMsg = result[j]["message"] || 'Send Skipped'}}}}
i++;rsb.connect.sendFileImpl(workspace, portId, files, i, complete, resultFormat, resultMsg)}})}} else {if (resultFormat.length <= 0) {resultFormat = "success"}
if (resultMsg.length <= 0) {resultMsg = 'File(s) sent.'}
if (typeof(complete) == "function") {complete(resultFormat, resultMsg)}}}
rsb.connect.formatSendError = function(code, category, generalmsg, specificmsg, tip) {return "<div class='panel panel-danger'>" +"<div class='panel-heading'>" +"<h3 class='panel-title'>" +rsb.evalTemplate('Error Sending File(s): $code$', {"code" : code}) + "" +"<button type='button' class='close pull-right send-error-btn' onclick='rsb.connect.closeSendError($(this))'><span aria-hidden='true'>&times;</span><span class='sr-only'>" + 'Close'+ "</span></button>" +"</h3>" +"</div>" +"<ul class='list-group'>" +"<li class='list-group-item ellipsis'><strong>" + 'Category:'+ " </strong>" + category + "</li>" +"<li class='list-group-item ellipsis'><strong>" + 'Error:'+ " </strong>" + generalmsg + "</li>" +"<li class='list-group-item ellipsis'><strong>" + 'Response Details:'+ " </strong>" + specificmsg + "</li>" +"<li class='list-group-item ellipsis'><strong>" + 'Tip:'+ " </strong>" + tip + "</li>" +"</ul>" +"</div>"}
rsb.connect.formatSendWarning = function(code, category, generalmsg, specificmsg, tip) {return "<div class='panel panel-warning'>" +"<div class='panel-heading'>" +"<h3 class='panel-title'>" +rsb.evalTemplate('Warning Sending File(s): $code$', {"code" : code}) + "" +"<button type='button' class='close pull-right send-error-btn' onclick='rsb.connect.closeSendError($(this))'><span aria-hidden='true'>&times;</span><span class='sr-only'>Close</span></button>" +"</h3>" +"</div>" +"<ul class='list-group'>" +"<li class='list-group-item ellipsis'><strong>" + 'Category:'+ " </strong>" + category + "</li>" +"<li class='list-group-item ellipsis'><strong>" + 'Warning:'+ " </strong>" + generalmsg + "</li>" +"<li class='list-group-item ellipsis'><strong>" + 'Tip:'+ " </strong>" + tip + "</li>" +"</ul>" +"</div>"}
rsb.connect.closeSendError = function(btn) {var panel = btn.parents("div.panel:first");var alert = panel.parents("div.alert:first");panel.addClass("hidden");if (alert.find("div.panel:not(.hidden)").length <= 0) {alert.addClass("hidden")}}
rsb.connect.createTestFiles = function(workspaceId, connectorId, table) {$('#sendError').hide();var postData = { "@json": true, "WorkspaceId": workspaceId, "connectorId": connectorId };$.ajax({dataType: "json",url: "src/createTestFiles.rsb",type: "POST",data: postData,success: function (data, textStatus, jqXHR) {var errorMsg = rsb.getResultErrorMessage(data["items"]);if (errorMsg) {rsb.showResult($('#sendError'), errorMsg, false)} else {$(table).DataTable().ajax.reload()}}})}
rsb.connect.deleteLogs = function(workspace, portId, table, button, errorContainer, odata) {errorContainer && errorContainer.hide();var transactionLogs = $(table).find("tbody tr:not(.unsent-file)").has("input[type='checkbox']:checked");var unsentFiles = $(table).find("tbody tr.unsent-file").not(".sending").has("input[type='checkbox']:checked");var errorMsg = "";var filesurl = "api/files.rsd";if (typeof(odata) != 'undefined' && odata != "") {filesurl = filesurl + "?" + odata}
if (transactionLogs.length > 0) {button.button("loading");rsb.showInfoModal('Deleting Files', "", false, true, transactionLogs.length + unsentFiles.length, true);rsb.connect.deleteLogsImpl(workspace, portId, transactionLogs, 0, "api/transactions.rsd", function (success1, message1) {if (success1) {rsb.connect.deleteLogsImpl(workspace, portId, unsentFiles, 0, filesurl, function (success2, message2) {rsb.closeInfoModal();button.button("reset");rsb.showInfoModalResult(errorContainer, message2, success2);$(table).DataTable().ajax.reload()})} else {rsb.closeInfoModal();button.button("reset");rsb.showInfoModalResult(errorContainer, message1, success1);$(table).DataTable().ajax.reload()}})} else if (unsentFiles.length > 0) {button.button("loading");rsb.showInfoModal('Deleting Files', "", false, true, unsentFiles.length, true);rsb.connect.deleteLogsImpl(workspace, portId, unsentFiles, 0, filesurl, function (success2, message2) {rsb.closeInfoModal();button.button("reset");rsb.showInfoModalResult(errorContainer, message2, success2);$(table).DataTable().ajax.reload()})} else {rsb.showInfoModalResult(errorContainer, 'You must select a log to delete.', "info")}}
rsb.connect.deleteLogsImpl = function(workspace, portId, logs, i, url, complete) {if (rsb.checkInfoModalState(i, logs.length)) {var postData = { "@json": true, "workspaceid": workspace, "portId": portId };postData["messageid"] = $(logs[i]).find("input[name='messageid']").val();postData["direction"] = $(logs[i]).find("input[name='direction']").val();postData["folder"] = $(logs[i]).find("input[name='direction']").val();postData["filename"] = $(logs[i]).find("input[name='filename']").val();postData["subfolder"] = $(logs[i]).find("input[name='subfolder']").val();rsb.changeInfoModalMessage('Deleting&nbsp;'+ $(logs[i]).find("input[name='filename']").val());$.ajax({dataType: "json",url: url,type: "DELETE",data: postData,success: function(data, textStatus, jqXHR) {rsb.increaseInfoModalProgress();var errorMsg = rsb.getResultErrorMessage(data["items"]);if (errorMsg) {if (typeof(complete) == "function") {return complete(false, errorMsg)}} else {rsb.connect.deleteLogsImpl(workspace, portId, logs, i + 1, url, complete)}}})} else {if (typeof(complete) == "function") {return complete(true, 'Deletion(s) successful.')}}}
rsb.connect.deleteAllLogs = function(workspaceId, portId, direction, table, errorContainer) {errorContainer && errorContainer.hide();if (confirm(rsb.evalTemplate('Are you sure you want to delete all $direction$ transaction logs for connector $portId$?', {"direction" : direction, "portId" : portId}))) {rsb.showInfoModal('Deleting Logs', rsb.evalTemplate('Deleting All $direction$ Logs for connector $portId$', {"direction" : direction, "portId" : portId}), false);$.ajax({dataType: "json",url: "api/transactions.rsd",type: "DELETE",data: { "@json": true, "workspace": workspaceId, "portId": portId, "direction": direction },success: function(data, textStatus, jqXHR) {var errorMsg = rsb.getResultErrorMessage(data["items"]);if (errorMsg) {rsb.showResult(errorContainer, errorMsg, false)} else {rsb.showResult(errorContainer, 'Deletion(s) successful.', true)}
$(table).DataTable().ajax.reload()}}).always(function() {rsb.closeInfoModal()})}}
rsb.connect.formatFileSize = function(size) {var unitSet = ["bytes", "KB", "MB", "GB"];if (size !== "" && size >= 0) {var unit = unitSet[0];for (var i = 0; i < unitSet.length; i++) {unit = unitSet[i];if (size >= 1024 && i < unitSet.length - 1) {size = size / 1024} else {break}}
if (size < 10) size = parseInt(size*100)/100;else if(size < 100) size = parseInt(size*10)/10;else size = parseInt(size);return size + " " + unit}
return ""}
rsb.connect.formatTimeSpan = function(time) {if (!time || time == 0) return time;var timeStr = "";var units = ["ms", "s", "m", "h"];units.forEach(function(unit) {if (time) {timeStr = time % (unit == "ms" ? 1000 : 60) + unit + (timeStr.length ? " " : "") + timeStr;time = parseInt(time / (unit == "ms" ? 1000 : 60))}});return timeStr}
rsb.connect.formatFilename = function(data, type, row) {if (row["filename"] != undefined && row["filename"].length > 0) {var link = "src/downloadLogs.rst?workspaceid=" + encodeURIComponent(row["workspaceid"]) + "&connectorid=" + encodeURIComponent(row["connectorid"]) + "&messageid=" + encodeURIComponent(row["messageid"]) + "&fileName=" + encodeURIComponent(row["filename"]) + "&direction=" + encodeURIComponent(row["direction"]);return '<a title="' + data + '" href="' + link + '"  download="logs.log">' + data + "</a>"} else {return data}}
rsb.connect.uploadFiles = function(form, resultContainer, button, workspace, partner, additionData) {var hasFile = false;var inputList = form.find("input[type='file']");for (var i = 0; i < inputList.length; i++) {if ($(inputList[i]).val().length > 0) {hasFile = true;break}}
if (!hasFile) {rsb.showResult(resultContainer, 'Please select at least one file to upload.', "info");return false}
var requrl = form.attr("action") + "?inputname=uploadFile&workspaceId=" + encodeURIComponent(workspace) + "&connectorId=" + encodeURIComponent(partner);if (typeof(additionData) != 'undefined') {for (var key in additionData) {requrl = requrl + "&" + encodeURIComponent(key) + "=" + encodeURIComponent(additionData[key])}}
button.button("loading");rsb.uploadFile(requrl, "uploadFile", inputList, resultContainer, function(data) {button.button("reset");var errorMsg = rsb.getResultErrorMessage(data.items);if (errorMsg) {rsb.showResult(resultContainer, errorMsg, false);$(form).trigger("error", data)} else {var successMsg = resultContainer.attr("data-success-message");rsb.showResult(resultContainer, successMsg, true);$(form).trigger("success", data.items[0])}});return false}
rsb.connect.installLicenseModal = function() {var $modal = $("#installlicensemodal_modal");$modal.find("form.form-settings").one("success", function (e, result) {$("#installlicensemodal_modal").modal('hide')});$modal.modal("show");$modal.on('hidden.bs.modal', function (e) {rsb.clearForm($('#installlicensemodal_modal form.form-settings'))})}
rsb.connect.installTrialModal = function($prod, $prodname) {var $modal = $("#installTrialModal");if ($prod) {$modal.find("input[name='prod']").val($prod);$modal.find("input[name='prodname']").val($prodname)}
$modal.find("form.form-settings").one("success", function (e, result) {$("#installTrialModal").modal('hide')});$modal.modal("show");$modal.on('hidden.bs.modal', function (e) {rsb.clearForm($('#installTrialModal form.form-settings'))})}
rsb.connect.saveEvent = function(btn, portid, name, editor, resultContainer, workspace, displayName) {if (editor.historySize().undo > 0) {btn.button('loading');const eventResId = workspace?.toLowerCase() + ":" + portid?.toLowerCase() + "@events";var args = {};args["portid"] = portid;args["name"] = name;args["displayName"] = displayName;args["workspaceid"] = workspace;args["data"] = editor.getValue();args["data"] = rsb.encodeXml(args["data"]);$.ajax({dataType: "json",type: "POST",url: "src/saveEvent.rsb?@json&@fmtoptions=exparen",data: args,headers: {"If-Unmodified-Since": rsb.getResourceLastModified(eventResId)},success: function ($data, textStatus, jqXHR) {var result = $data.items[0];var errorMsg = rsb.getResultErrorMessage($data.items);if (errorMsg) {rsb.showResult(resultContainer, errorMsg, false)} else {rsb.showResult(resultContainer, result["message"], result["result"] == "true");btn.removeClass("btn-primary").addClass("btn-outline-secondary");editor.clearHistory()}
rsb.setResourceLastModified(eventResId, jqXHR.getResponseHeader("Last-Modified"))}}).always(function(){btn.button('reset')})}}
rsb.connect.tableSearchBarKeyPress = function(table, event) {var event = event || window.event;if(event.keyCode == 13) {$(table).DataTable().ajax.reload()}}
rsb.connect.showMessageInfo = function(event) {var event = event || window.event;var rowData = event.data;if (!rsb.hasSelection() && rowData && ((rowData["messageid"] && rowData["messageid"].length > 0) || (rowData["filename"] && rowData["filename"].length > 0))) {new rsb.messageInfo().show(rowData)}
return false}
rsb.connect.register = function(modal, btn, register) {var postData = {"register": register};var form = modal.find("form.form-settings");if (register) {if (form.valid()) {$.extend(postData, rsb.getFormData(form, false))} else {return}}
btn.button("loading");$.ajax({dataType: "html",url: "src/admin/register.rst",data: postData,success: function(data) {var errorMsg = rsb.getResultErrorMessage(data["items"]);if (errorMsg) {rsb.showResult(form.find("div.form-result-static"), errorMsg, false)} else {if (register) {rsb.showResult(form.find("div.form-result-static"), 'Thank You.', true)}
modal.modal("hide")}}}).always(function() {btn.button("reset")})}
rsb.connect.getFilenameExt = function(path) {return path.substr((~-path.lastIndexOf(".") >>> 0) + 1)}
rsb.connect.isPublicCert = function(path) {return [".crt", ".cer", ".der", ".p7b", ".pub"].indexOf(rsb.connect.getFilenameExt(path).toLowerCase()) != -1}
rsb.connect.getServiceStatus = function(connectorType, connectorId, resultContainer) {var data = {"ConnectorType": connectorType, "ConnectorId": connectorId, "@json": "true"};$.ajax({url: "src/getServiceStatus.rsb",type: "GET",data: data,dataType: "json",success: function(data, textStatus, jqXHR) {var result = data["items"];var errorMsg = rsb.getResultErrorMessage(result);if (errorMsg) {rsb.showResult(resultContainer, errorMsg, "error")} else if (result != null && result.length > 0) {if (result[0]["serverstatus"] == "running") {rsb.showResult(resultContainer, 'Server started.', "success")} else if (result[0]["serverstatus"] == "starting" || result[0]["serverstatus"] == "stopping") {setTimeout(function() {rsb.connect.getServiceStatus(connectorType, connectorId, resultContainer)}, 1000)}}}})}
rsb.connect.initVaultInputGroups = function ($container, $errorContainer) {const VAULT_TYPE_STANDARD = "Standard";const VAULT_TYPE_ENCRYPTED = "Encrypted";const VAULT_TYPE_NUMBER = "Number";let _vaultSettings = new function () {const _vaultMap = Object.create(null);const _tags = [];let _settings = null;let _split = function ($list) {$list = rsb.trimStr($list || "").replace(/\s*,\s*/g, ',').replace(/,{2,}/g, ',').replace(/^,/, '').replace(/,$/, '');return !!$list ? $list.split(/,/g) : []}
let _addVault = function ($vault) {if (!$vault || !$vault.id) return null;let $vaultType = $vault.type;$vault = {id: $vault.id,name: $vault.name,value: $vaultType === VAULT_TYPE_ENCRYPTED ? rsb.connect.pswdmask : $vault.value,tags: _split($vault.tags || "")};_settings[$vaultType].push($vault);!!$vault.value && $vaultType === VAULT_TYPE_STANDARD && $.isNumeric($vault.value) && _settings[VAULT_TYPE_NUMBER].push($vault);$vaultType === VAULT_TYPE_NUMBER && _settings[VAULT_TYPE_STANDARD].push($vault);_vaultMap[$vault.id] = $vault;$vault.tags.forEach(function ($tag) {$tag = !!$tag && rsb.htmlEncode($tag);if (!!$tag && _tags.indexOf($tag) < 0) {_tags.push($tag)}});return $vault}
let _initSettings = function ($errorContainer) {$.ajax({dataType: "json",url: "api/vault.rsd?@json&includeusage=false",type: "GET",async: false,success: function (data, textStatus, jqXHR) {let result = data["items"] || [];let errorMsg = rsb.getResultErrorMessage(result);if (errorMsg) {$errorContainer && rsb.showResult($errorContainer, errorMsg, false)} else {_settings = Object.create(null);_settings[VAULT_TYPE_STANDARD] = [];_settings[VAULT_TYPE_ENCRYPTED] = [];_settings[VAULT_TYPE_NUMBER] = [];result.sort(function (lhs, rhs) {return lhs.name.localeCompare(rhs.name)});rsb.forEach(result, function ($vault) {_addVault($vault)})}}})}
this.list = function ($type, $errorContainer) {!_settings && _initSettings($errorContainer);return _settings[$type || VAULT_TYPE_STANDARD] || []}
this.getTags = function () {!_settings && _initSettings($errorContainer);return _tags}
this.addVault = function ($vault, $callback) {$vault = _addVault($vault, $callback);!!$vault && !!$callback && $callback($vault)}
this.getVault = function ($vaultId) {!!$vaultId && !_settings && _initSettings($errorContainer);return !!$vaultId && _vaultMap[$vaultId]}
return this}
let VaultIterator = function ($vaults, $encrypted, $filter, $pageSize) {const _encrypted = !!$encrypted;const _pageSize = Math.max($pageSize || 60, 40);const _matchRegex = !!$filter ? new RegExp($filter.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "i") : null;const _escapeRegex = !!$filter ? new RegExp(rsb.htmlEncode($filter).replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'ig') : null;let _vaults = [];let _match = function ($vault) {if (!$vault || !$vault.id) return false;if (!_matchRegex || _matchRegex.test($vault.name) || !_encrypted && _matchRegex.test($vault.value)) return true;for (let index = 0; index < $vault.tags.length; index++) {if (_matchRegex.test($vault.tags[index])) return true}
return false}
rsb.forEach($vaults || [], function ($vault) {!!$vault && _match($vault) && _vaults.push($vault)});this.match = _match;this.escape = function ($vault) {if (!$vault) return "";$vault = rsb.htmlEncode($vault);return !!_escapeRegex ? $vault.replace(_escapeRegex, "<b>$&</b>") : $vault}
this.hasNext = function () {return _vaults.length > 0}
this.next = function () {if (_vaults.length <= 0) return [];let $vaults = _vaults.slice(0, _pageSize);_vaults = _vaults.slice(_pageSize);return $vaults}
return this}
let VaultInputGroup = function ($input, $resultContainer, $references) {const VAULT_ITEM_TEMPLATE = '<li class="row vault flex-nowrap px-0 mx-0 pe-1 py-1">' +'  <div class="col hidden col-id">$id$</div>' +'  <div class="col ellipsis col-name pe-0">$name$</div>' +'  <div class="col ellipsis col-value px-0">$value$</div>' +'  <div class="col ellipsis col-tags ps-0 pe-1 d-flex justify-content-end"><span data-bs-toggle="tooltip" data-bs-html="true" title="$title$">$tags$</span></div>' +'</li>';const _resultContainer = $resultContainer;const _type = $input.attr("type");const _name = $input.attr("name");const _canAddVault = rsb.connect.userRole?.toLowerCase() === "admin";let _inputGroup = $input.closest(".input-group");if (["number", "password", "text"].indexOf(_type) < 0 || !_name || _name.endsWith("@") || $input.hasClass("hidden") || !!$input.prop("readonly") || $input.hasClass("rsb-novault") || _inputGroup.hasClass("vault-input-group")) return this;_inputGroup = $('<div class="input-group vault-input-group">' +'  <input type="text" class="hidden vault-setting-reference" name="' + _name + '@">' +'  <span class="input-group-text vault-setting-name ellipsis pe-1 order-first"></span>' +'  <span class="vault-settings-dropdown">' +'    <span data-bs-toggle="dropdown" data-bs-display="static" class="dropdown-toggle pe-' + (_type == "number" ? 4 : 1) + '" aria-expanded="true"><span class="fa fa-key"></span></span>' +'    <ul class="dropdown-menu vault-settings-dropdown-menu pt-0 text-nowrap" role="menu">' +'      <li class="row add-to-vault py-1' + (_canAddVault ? '' : ' disabled') + '">' +'        <div class="col ps-4">' + 'Add to Vault'+ '</div>' +'      </li>' +'    </ul>' +'  </span>' +'</div>');const _isEncrypted = _type == "password";const _vaultType = _isEncrypted ? VAULT_TYPE_ENCRYPTED : (_type == "number" ? VAULT_TYPE_NUMBER : VAULT_TYPE_STANDARD);let _vaultName = _inputGroup.find(".vault-setting-name");let _vaultRefInput = _inputGroup.find(".vault-setting-reference");let _dropdown = _inputGroup.find(".vault-settings-dropdown");let _dropdownToggle = _dropdown.find(".dropdown-toggle");let _dropdownMenu = _dropdown.find(".vault-settings-dropdown-menu");let _addToVault = _dropdownMenu.find("li.add-to-vault");let _vaultIterator = null;let _curFilter = null;let _scrollTop = 0;let _resetDropdown = function () {_vaultIterator = null;_curFilter = null;_scrollTop = 0;_addToVault.siblings().find(".col-tags>span").tooltip('dispose');_addToVault.siblings().remove();_dropdown.children().scrollTop(0)}
let _createVaultItem = function ($vault, $enableTooltip) {if (!$vault || !$vault.id) return null;let $firstTag = $vault.tags.length > 0 ? $vault.tags[0] : "";let $item = $(rsb.evalTemplate(VAULT_ITEM_TEMPLATE, {id: rsb.htmlEncode($vault.id),name: !!_vaultIterator ? _vaultIterator.escape($vault.name) : rsb.htmlEncode($vault.name),value: !!_vaultIterator ? _vaultIterator.escape($vault.value) : rsb.htmlEncode($vault.value),tags: (!!_vaultIterator ? _vaultIterator.escape($firstTag) : rsb.htmlEncode($firstTag)) + ($vault.tags.length > 1 ? " + " + $vault.tags.length : ""),title: $vault.tags.length > 1 && $vault.tags.reduce(function ($html, $tag, $index) {return $html + ($index ? "<br>" : "") + "<span>" + rsb.htmlEncode(rsb.htmlEncode($tag)) + "</span>"}, "") || ""}));!!$enableTooltip && $vault.tags.length > 1 && new bootstrap.Tooltip($item.find(".col-tags>span"));return $item}
let _nextPage = function () {!!_vaultIterator && _vaultIterator.hasNext() && rsb.forEach(_vaultIterator.next() || [], function ($vault) {_createVaultItem($vault, true).appendTo(_dropdownMenu)})}
let _filterVaults = function ($filter) {_vaultIterator = null;let $iterator = new VaultIterator(_vaultSettings.list(_vaultType, _resultContainer), _isEncrypted, $filter, 100);_resetDropdown();_vaultIterator = $iterator;_nextPage()}
let _initVaultList = function () {_filterVaults(null)}
let _handleKeyUp = function ($event) {if (_curFilter == $input.val() || !!$event && [9, 13, 27, 37, 38, 39, 40].indexOf($event.keyCode) >= 0) {return true}
_inputGroup.removeClass("active");_vaultRefInput.val("");if (_dropdownToggle.hasClass("show")) {$input.attr("type", "text");_filterVaults($input.val());return false} else {$input.attr("type", _type).removeClass("ellipsis pe-4");_type == "number" && _dropdownToggle.addClass("pe-4").removeClass("pe-1")}}
let _handleKeyDown = function ($event) {let $selected = _dropdownMenu.find("li.selected");if (!$selected || $selected.length <= 0) return;switch ($event.keyCode) {case 9:
$selected.trigger("click");return true;case 13:
rsb.stopPropagation($event);$selected.trigger("click");return false;case 27:
rsb.stopPropagation($event);$selected.removeClass("selected");return false;case 38:
let $preVault = $selected.prev("li.vault");if ($preVault.length > 0) {$selected.removeClass("selected");$preVault.addClass("selected");_vaultItemSelected($preVault);_scrollTop -= $selected.outerHeight()} else {_scrollTop = 0}
_dropdown.children().scrollTop(_scrollTop);break;case 40:
let $nextVault = $selected.next("li.vault");if ($selected.length <= 0) {$nextVault = _addToVault.next("li.vault");if ($nextVault.length > 0) {_inputGroup.removeClass("active");_scrollTop = -$nextVault.outerHeight()}}
if ($nextVault.length > 0) {$selected.removeClass("selected");$nextVault.addClass("selected");_vaultItemSelected($nextVault);_scrollTop += $nextVault.outerHeight()}
_dropdown.children().scrollTop(_scrollTop);break}}
let _toggleActiveDropdown = function () {let $focus = $(this).is(":focus");$input.off("keyup", _handleKeyUp).off("keydown", _handleKeyDown);$focus && $input.on("keyup", _handleKeyUp).on("keydown", _handleKeyDown);if (!$focus && !_inputGroup.hasClass("active")) {$input.attr("type", _type);_type == "number" && _dropdownToggle.addClass("pe-4").removeClass("pe-1");$input.removeClass("ellipsis pe-4")}}
let _vaultItemSelected = function ($vaultItem) {_inputGroup.addClass("active");_vaultName.text($vaultItem.find(".col-name").text());_vaultRefInput.val($vaultItem.find(".col-id").text());$input.val($vaultItem.find(".col-value").text() || "").addClass("ellipsis pe-4").attr("type", "text");_type == "number" && _dropdownToggle.addClass("pe-1").removeClass("pe-4")}
let _revertChanges = function () {setTimeout(function () {if (!!_vaultRefInput.val()) {_vaultItemSelected(_createVaultItem(_vaultSettings.getVault(_vaultRefInput.val())))} else {_curFilter = null;_handleKeyUp()}}, 30)}
let _getValue = function ($event, $payload) {if (!!$payload && _inputGroup.hasClass("active") && !!_vaultRefInput.val()) {let $vault = _vaultSettings.getVault(_vaultRefInput.val());if (!_isEncrypted || $vault.value != rsb.connect.pswdmask) {$payload.value = $vault.value;return false}
$.ajax({dataType: "json",url: "api/vault.rsd?@json",type: "GET",async: false,data: {"Id": _vaultRefInput.val(), "IncludeUsage": "false"},success: function (data) {let $errorMsg = rsb.getResultErrorMessage(data.items);if ($errorMsg) {rsb.showResult($resultContainer, $errorMsg, false)} else {data.items.length > 0 && ($payload.value = data.items[0].value)}}})} else if (!!$payload) {$payload.value = $input.val()}
return false}
let _resize = function () {if (_inputGroup.parent().hasClass("input-group")) {let $width = 0;_inputGroup.parent().children().not(_inputGroup).each(function () {$width += this.offsetWidth});$width > 0 && _inputGroup.css("width", "calc(100% - " + $width + "px)")}}
_inputGroup.insertAfter($input);$input.insertAfter(_vaultRefInput);let $vaultId = !!$references && $references[_name.toLowerCase() + "@"];if (!!$vaultId) {let $vault = _createVaultItem(_vaultSettings.getVault($vaultId));!!$vault && _vaultItemSelected($vault);!!$vault && rsb.syncChanges(_inputGroup)}
_resize();$input.off("focus", _toggleActiveDropdown).on("focus", _toggleActiveDropdown).off("blur", _toggleActiveDropdown).on("blur", _toggleActiveDropdown);$input.closest("form").on("reset", _revertChanges);_inputGroup.on("vault.group.getValue", _getValue);_inputGroup.on("vault.group.resize", _resize);_dropdownToggle.off("mousedown").on("mousedown", function ($event) {if ($event.which != 1) return true;if (_inputGroup.hasClass("active") || _isEncrypted && $input.val() == rsb.connect.pswdmask) {let $clearInput = function () {$input.val("");return true}
$input.off("keydown", $clearInput).one("keydown", $clearInput)}
$input.focus();return false});_canAddVault && _addToVault.off("mousedown").on("mousedown", function ($event) {if ($event.which != 1) return true;rsb.vaultModals.addModal.tags.updateTags(_vaultSettings.getTags());rsb.vaultModals.addVault(null, _vaultType, _isEncrypted && $input.val() === rsb.connect.pswdmask ? "" : $input.val(), function ($event, $result) {_vaultSettings.addVault($.extend($result, {type: _vaultType}), function ($vault) {if (!_vaultIterator || _vaultIterator.match($vault)) {$vault = _createVaultItem($vault, !!_vaultIterator);!!_vaultIterator && $vault.insertAfter(_addToVault);_vaultItemSelected($vault)}})});return false});_dropdownMenu.off("mousedown", "li").on("mousedown", "li", function ($event) {if ($event.which != 1) return true;_vaultItemSelected($(this));return true});_dropdownMenu.scroll(function () {this.offsetHeight + this.scrollTop >= this.scrollHeight - _vaultRefInput.outerHeight() && _nextPage()});_dropdown.off("show.bs.dropdown", _initVaultList).on("show.bs.dropdown", _initVaultList);_dropdown.off("hidden.bs.dropdown", _resetDropdown).on("hidden.bs.dropdown", _resetDropdown);return this}
let $forms = !!$container && $container.is("form") ? $container : ($container || $(document)).find("form");$forms = $forms.length > 0 ? $forms : $container;!!$forms && $forms.each(function () {let $form = $(this);if ($form.hasClass("rsb-novault") || ($form.closest(".modal").length > 0 && !$form.hasClass("rsb-vault")) || $form.closest(".query-builder").length > 0) return true;let $resultContainer = $errorContainer || rsb.getFormResultContainer($form);let $type = $form.find("input[name='type']").val();let $reference = !!$type && rsb.connect.initVaultInputGroups[$type + "References"] || rsb.connect.initVaultInputGroups["references"];$form.find(".form-group input").each(function () {if (!!this.__vaultInputGroup) return true;this.__vaultInputGroup = new VaultInputGroup($(this), $resultContainer, $reference)})})}
rsb.connect.initPasswordInputBox = function () {let $handlePasswordKeydown = function () {let $input = $(this);if (!$input.is(":visible") || $input.closest('.password-group').length > 0 || $input.val().length === rsb.connect.pswdmask) return true;let $passwordGroup = $('<div class="input-group password-group"><button class="btn btn-secondary btn-outline-secondary view-sensitive-btn" type="button"><i class="fa fa-eye"></i></button></div>');let $inputGroup = $input.parents(".input-group").last();$inputGroup = $inputGroup.length > 0 ? $inputGroup : $input;$passwordGroup.insertAfter($inputGroup);$inputGroup.prependTo($passwordGroup);$passwordGroup.find('.view-sensitive-btn').on('click', function () {if ($(this).find('i').hasClass('fa-eye-slash')) {$input.attr("type", 'password');$(this).find('i').removeClass('fa-eye-slash').addClass('fa-eye')} else {$input.attr("type", 'text');$(this).find('i').removeClass('fa-eye').addClass('fa-eye-slash')}});$input.focus().off("keydown", $handlePasswordKeydown);$passwordGroup.one("password.group.destroy", function () {$inputGroup.insertAfter($passwordGroup);$input.attr("type", 'password').off("keydown", $handlePasswordKeydown).on('keydown', $handlePasswordKeydown);$passwordGroup.find('.view-sensitive-btn').off('click');$passwordGroup.remove()})};$('input:password').off("keydown", $handlePasswordKeydown).on('keydown', $handlePasswordKeydown)}
rsb.connect.hidePopover = function(parentElm) {$(parentElm).find("[data-bs-toggle='popover']").each(function(index, p) {if ($(p).popover) $(p).popover("hide")})}
rsb.connect.formatTimestamp = function(dateTime) {const hour12 = (window?.arc?.hooks?.timeFormat || "24") === "12";var date = null;if (dateTime instanceof Date) {date = dateTime} else if (dateTime?.length > 0) {date = new Date(dateTime)}
if (date != null) {if (isNaN(date)) {return ""}
const options = {hour12,year: 'US'.toLowerCase() === "us" ? "2-digit" : "numeric",month: "2-digit",day: "2-digit",hour: "2-digit",minute: "2-digit",second: "2-digit",}
const ms = date.getMilliseconds();if (ms !== 0) {options.fractionalSecondDigits = 3}
return new Intl.DateTimeFormat("default", options).format(date)}
return dateTime}
rsb.connect.getTimeZoneDisplayName = function(timeZone) {try {const locales = navigator.language || navigator.userLanguage;const offset = new Intl.DateTimeFormat(locales, {timeZone,timeZoneName: "longOffset"}).formatToParts(new Date())
.find(part => part.type === "timeZoneName").value?.replace("GMT", "UTC");const displayName = new Intl.DateTimeFormat(locales, {timeZone: timeZone,timeZoneName: "long"}).formatToParts(new Date())
.find(part => part.type === "timeZoneName").value;return offset + " " + displayName} catch (e) {return timeZone}}
$(document).ready(function () {$(document).on("hidden.bs.modal", ".modal", function () {$(this).find(".password-group").trigger("password.group.destroy")});$(document).on('shown.bs.tab', "ul.nav-tabs li a", function ($event) {!!$($event.target).attr("data-bs-target") && $($($event.target).attr("data-bs-target")).find(".vault-input-group").trigger("vault.group.resize")})});