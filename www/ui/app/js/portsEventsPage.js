var Script = function($eventName, $displayName, $welcomeMessage, $textdata) {this.eventName = $eventName;this.displayName = $displayName;this.welcomeMessage = $welcomeMessage;this.textdata = $textdata;this.setTextData = function($data) {this.textdata = $data}}
rsb.portsEvents.findScript = function($name) {for (var i = 0; i < rsb.portsEvents.scripts.length; i++) {if ($name == rsb.portsEvents.scripts[i].eventName) {return rsb.portsEvents.scripts[i]}}
return null}
rsb.portsEvents.initEditor = function($editor, $btn) {if (rsb.portsEvents.scriptTextarea.length == 0) return;if ($editor) {rsb.editors.splice(rsb.editors.indexOf($editor), 1);$($editor.getWrapperElement()).remove();$btn.removeClass('btn-primary').addClass('btn-outline-secondary')}
rsb.portsEvents.editor = CodeMirror.fromTextArea(rsb.portsEvents.scriptTextarea[0], {mode: "text/xml",theme: "xml",lineNumbers: true,textWrapping: true,autoRefresh: true,readOnly: rsb.portsEvents.readOnly});rsb.portsEvents.editor.on("change", function() {rsb.portsEvents.onEditorChange(rsb.portsEvents.editor, $btn)});rsb.editors.push(rsb.portsEvents.editor)}
rsb.portsEvents.onEditorChange = function(editor, btn) {if (editor.historySize().undo > 0) {btn.removeClass('btn-outline-secondary').addClass('btn-primary')} else {btn.removeClass('btn-primary').addClass('btn-outline-secondary')}}
rsb.portsEvents.insertCode = function(editor, code) {var event = rsb.portsEvents.selectBtn.attr("value");if(!rsb.portsEvents.hasSampleEvents.includes(event)) event = rsb.portsEvents.defaultEvent;rsb.portsEvents.codes['info'] = rsb.portsEvents.infos[event];rsb.portsEvents.codes['email'] = rsb.portsEvents.emails[event];if (editor.cursorCoords() == null) {editor.setValue(editor.getValue() + rsb.portsEvents.codes[code])} else {editor.replaceSelection(rsb.portsEvents.codes[code])}}
rsb.portsEvents.selectEvent = function($event,$selVal) {if ($event == rsb.portsEvents.currentScript.eventName) {return}
if (rsb.portsEvents.editor.historySize().undo > 0) {rsb.confirmModal({title: 'Save Changes',body: 'You have unsaved changes.  Do you want to keep the changes?',ok: function() {rsb.portsEvents.savebutton.click();rsb.portsEvents.eventChanged($event,$selVal)},cancelText: 'Continue Without Saving',cancel: function() {rsb.portsEvents.eventChanged($event,$selVal)},})} else {rsb.portsEvents.eventChanged($event,$selVal)}}
rsb.portsEvents.eventChanged = function($event,$selVal) {rsb.portsEvents.currentScript = rsb.portsEvents.findScript($event);rsb.portsEvents.selectBtn.text(rsb.portsEvents.currentScript.displayName);rsb.portsEvents.selectBtn.attr("value",$selVal);var data = rsb.portsEvents.currentScript.textdata;if (data && data[0] == '\n') data = data.substring(1);rsb.portsEvents.scriptTextarea.val(data);rsb.portsEvents.initEditor(rsb.portsEvents.editor, rsb.portsEvents.savebutton);rsb.portsEvents.welcome.text(rsb.portsEvents.currentScript.welcomeMessage);if (rsb.portsEvents.currentScript.eventName == "afterSend" || rsb.portsEvents.currentScript.eventName == "afterReceive") {rsb.portsEvents.optionSend.removeClass("hidden")} else {rsb.portsEvents.optionSend.addClass("hidden")}}
