rsb.openpgpPort = rsb.openpgpPort || {};rsb.openpgpPort.options = {};rsb.openpgpPort.init = function($options) {rsb.openpgpPort.options = $.extend($options, rsb.connect.options)}
rsb.openpgpPort.encodeCheck = function(curcb) {var encryptchecked = $("#useencryption").prop("checked");var signchecked = $("#usesigning").prop("checked");if ((!encryptchecked || encryptchecked == "false") && (!signchecked || signchecked == "false")) {$(curcb).prop("checked", true).change();$("#encryptselectionstatus").removeClass("hidden")} else {$("#encryptselectionstatus").addClass("hidden")}}
rsb.openpgpPort.onCBChanged = function() {if (arguments.length > 1) {if ($(arguments[0]).prop("checked")) {for(var i = 1; i < arguments.length; i++) {$(arguments[i]).prop("disabled", false)}} else {for(var i = 1; i < arguments.length; i++){$(arguments[i]).prop("disabled", true)}}}}
rsb.openpgpPort.showCreatePGPKeyModal = function(key, pwd) {rsb.connect.loadModal("createPGPKeyModal.rst", function() {window.self !== window.top && (rsb.createPGPKey = window.parent.rsb.createPGPKey);rsb.createPGPKey.form.one("success", function (e, result) {rsb.createPGPKey.modal.modal('hide');rsb.openpgpPort.addNewKey($("#encryptionkeyid"), result["userid"], result["keyid"]);rsb.openpgpPort.addNewKey($("#verificationkeyid"), result["userid"], result["keyid"]);rsb.openpgpPort.addNewKey($("#decryptionkeyid"), result["userid"], result["keyid"]);rsb.openpgpPort.addNewKey($("#signingkeyid"), result["userid"], result["keyid"]);$(key).find("option[value=" + $.escapeSelector(result["keyid"] || result["userid"]) + "]").prop("selected", true);$(pwd).val(result["passp"+"hrase"])});rsb.createPGPKey.portid.val(rsb.openpgpPort.options.portId);rsb.createPGPKey.workspace.val(rsb.openpgpPort.options.workspaceid);rsb.createPGPKey.homeDirectory.val($("#homedirectory").val());rsb.createPGPKey.modal.modal('show')})}
rsb.openpgpPort.showImportPGPKeyModal = function() {rsb.connect.loadModal("importPGPKeytModal.rst", function() {window.self !== window.top && (rsb.importPGPKey = window.parent.rsb.importPGPKey);rsb.importPGPKey.form.one("success", function (e, data) {rsb.importPGPKey.modal.modal('hide');var result = {items: data.items[0]};if (result.items && result.items.userid.length > 0) {var $isString = (typeof(result.items.userid) == "string");for (var index = 0; index < ($isString ? 1 : result.items.userid.length); index++) {var userId = rsb.decodeXml(($isString ? result.items.userid : result.items.userid[index]));var keyId = ($isString ? result.items.keyid : result.items.keyid[index]);rsb.openpgpPort.addNewKey($("#encryptionkeyid"), userId, keyId);rsb.openpgpPort.addNewKey($("#verificationkeyid"), userId, keyId);if (($isString ? result.items.hassecretkey : result.items.hassecretkey[index]).toLowerCase() == "true") {rsb.openpgpPort.addNewKey($("#decryptionkeyid"), userId, keyId);rsb.openpgpPort.addNewKey($("#signingkeyid"), userId, keyId)}}}});rsb.importPGPKey.portid.val(rsb.openpgpPort.options.portId);rsb.importPGPKey.homedirectory.val($("#homedirectory").val());rsb.importPGPKey.modal.modal('show')})}
rsb.openpgpPort.keyChanged = function(key, exportlink) {var userId = key.val();if (userId && userId.length > 0 && !exportlink.hasClass("disabled")) {var filename = (key.find("option:selected").text() || userId).replace(new RegExp('[\\|/|:|\\*|\\?|"|<|>|\||~|\\s]', 'gm'), '_');exportlink.attr("href", "src/standard/exportPGPKey.rst?&portid=" + encodeURIComponent(rsb.openpgpPort.options.portId) + "&userid=" + encodeURIComponent(userId) + "&homedirectory=" + encodeURIComponent($("#homedirectory").val()) + "&filename=" + encodeURIComponent(filename) + ".gpg")} else {exportlink.attr("href", "javascript:void(0);")}}
rsb.openpgpPort.addNewKey = function(obj, userId, keyId) {if (obj && userId) {var duplicate = false;obj.find("option").each(function() {if ($(this).text() == userId) {duplicate = true}});if (!duplicate) {$(obj).append($("<option>").val(keyId || userId).text(userId))}}}
$(document).ready(function() {$("#useencryption").on("subsettingsSwitch", function() {rsb.openpgpPort.onCBChanged('#useencryption', '#encryptionalgorithm');rsb.openpgpPort.encodeCheck('#useencryption')});$("#usesigning").on("subsettingsSwitch", function() {rsb.openpgpPort.onCBChanged('#usesigning', '#signaturealgorithm');rsb.openpgpPort.encodeCheck('#usesigning')});$("#operation_encode").on("subsettingsSwitch", function() {if ($(this).prop("checked")) {$(".encode-group").removeClass("hidden");$(".decode-group").addClass("hidden");rsb.openpgpPort.encodeCheck('#usesigning')}});$("#operation_decode").on("subsettingsSwitch", function() {if ($(this).prop("checked")) {$(".encode-group").addClass("hidden");$(".decode-group").removeClass("hidden")}});if (rsb.openpgpPort.options.operation == "encode") {rsb.openpgpPort.encodeCheck("#usesigning")}
rsb.openpgpPort.keyChanged($('#decryptionkeyid'), $('#decryptionkeyexport'));rsb.openpgpPort.keyChanged($('#signingkeyid'), $('#signingkeyexport'))});