rsb = rsb || {};rsb.flowapiExecuteModal = new (function () {var _modal = $("#flowapiExecuteModal_modal");var _form = _modal.find("form.flowapi-execute-form");var _resultContainer = _modal.find("div.rsb-form-result");var _workspaceId = _form.find("input.flowapi-execute-workspace-id-input");var _apiName = _form.find("input.flowapi-execute-api-name-input");var _httpMethod = _form.find("input.flowapi-execute-http-method-input");var _workspaceIdText = _modal.find("span.flowapi-execute-workspace-id");var _apiNameText = _modal.find("span.flowapi-execute-api-name");var _httpMethodText = _modal.find("span.flowapi-execute-http-method");var _nav = _form.find(".flowapi-execute-nav");var _queryParametersNav = _nav.find("li.query-parameters>a");var _bodyNav = _nav.find("li.body>a");var _queryParameterSection = _form.find(".flowapi-execute-query-parameter-section");var _queryParameterContainer = _queryParameterSection.find(".flowapi-execute-query-parameter-container");var _bodySection = _form.find(".flowapi-execute-body-section");var _bodyContainer = _bodySection.find(".flowapi-execute-body-container");var _responseContainer = _form.find(".flowapi-execute-response-container");var _executeBtn = _form.find("button.btn-execute-api");var _executePrompt = _form.find(".flowapi-execute-execute-prompt");var _queryParameterTemplate = flowapiExecuteModal_query_parameter_template.innerHTML;var _bodyContentEditor = null;var _responseContentEditor = null;var _load = function ($workspaceId, $name, $method, $callback) {$.ajax({url: "src/flowapis.rsd",type: "GET",data: {"@json": true, "WorkspaceId": $workspaceId, "APIName": $name, "HTTPMethod": $method},dataType: "json",success: function (data, textStatus, jqXHR) {var result = data["items"];var errorMsg = rsb.getResultErrorMessage(result);if (errorMsg) {rsb.showResult(_resultContainer, errorMsg, false)} else {!!$callback && $callback(!!result && result.length && result[0] || {})}}})}
var _execute = function () {_responseContentEditor.setContent('Executing...');_executeBtn.button("loading");_responseContentEditor.setContent("");_responseContentEditor.refresh();$.ajax({url: "src/flowapiExecute.rsb",type: "POST",data: rsb.getFormData(_form, true),dataType: "json",traditional: true,success: function (data, textStatus, jqXHR) {_executePrompt.addClass("hidden");var result = data["items"];var errorMsg = rsb.getResultErrorMessage(result);if (errorMsg) {rsb.showResult(_resultContainer, "<b>" + 'Failure!'+ "</b>&nbsp;&nbsp;" + errorMsg, false, true);_responseContentEditor.setContent('Failure!'+ "  " + errorMsg)} else {rsb.showResult(_resultContainer, "<b>" + 'Execute successful!'+ "</b>", true, true);_responseContentEditor.setContent(!!result && result.length && result[0].messagedata || "");_responseContentEditor.refresh()}}}).always(function () {_executeBtn.button("reset")})}
var _switchTab = function (event) {var $lastTab = _nav.find("li.active");_nav.find("li").removeClass("active").find("a").removeClass("active");$($lastTab.find("a").attr("data-bs-target")).hide();var $ele = $(event.target);$($ele.attr("data-bs-target")).show();$ele.addClass("active").closest("li").addClass("active")}
var _split = function ($list) {$list = rsb.trimStr($list || "").replace(/\s*,\s*/g, ',').replace(/,{2,}/g, ',').replace(/^,/, '').replace(/,$/, '');return !!$list ? $list.split(/,/g) : []}
var _init = function ($settings) {_apiName.val($settings.apiname);_httpMethod.val($settings.httpmethod.toUpperCase());_apiNameText.text(encodeURIComponent($settings.apiname));_httpMethodText.text($settings.httpmethod.toUpperCase());_form.removeClass("has-query-parameter");_form.removeClass("has-body");_modal.removeClass("response-only");_modal.find(".modal-dialog").addClass("modal-xl");_queryParameterContainer.empty();var $queryParameters = _split($settings.queryparameters) || [];if ($queryParameters.length) {_form.addClass("has-query-parameter");_queryParametersNav.click();rsb.forEach($queryParameters, function ($queryParameter) {var $queryParameterEle = $(_queryParameterTemplate);$queryParameterEle.find("label").text($queryParameter);$queryParameterEle.find("input.query-parameter-name").val($queryParameter);_queryParameterContainer.append($queryParameterEle)})}
var $bodytype = ($settings.bodytype || "raw").toLowerCase();if ($bodytype != "none") {_form.addClass("has-body");!$queryParameters.length && _bodyNav.click();var $contentType = "application/xml";if ($bodytype == "raw") {$contentType = $settings.requestcontenttype || $contentType;_bodyContentEditor.setContent($settings.requestsample || "")}
_bodyContentEditor.setContentType($contentType)} else {_modal.toggleClass("response-only", !$queryParameters.length);_modal.find(".modal-dialog").toggleClass("modal-xl", !!$queryParameters.length)}
_responseContentEditor.setContentType($settings.responsetype || "application/json");_responseContentEditor.setContent($settings.responsesample || "");rsb.syncChanges(_form)}
var _reset = function () {_form.removeClass("has-query-parameter");_form.removeClass("has-body");_modal.removeClass("response-only");_modal.find(".modal-dialog").addClass("modal-xl");_resultContainer.hide();_queryParameterContainer.empty();!!_bodyContentEditor && _bodyContentEditor.setContent("");!!_responseContentEditor && _responseContentEditor.setContent("");_form.find(".flowapi-execute-nav-tab-section").hide();_nav.find("li").removeClass("active");_executePrompt.removeClass("hidden")}
this.show = function ($workspaceId, $name, $method) {var $shown = _modal.hasClass("in");_reset();_bodyContentEditor = _bodyContentEditor || new rsb.flowapiContentEditor(_bodyContainer, false);_responseContentEditor = _responseContentEditor || new rsb.flowapiContentEditor(_responseContainer, true);_bodyContainer.find("select").prop("disabled", true);$workspaceId = $workspaceId || "Default";_workspaceId.val($workspaceId);_workspaceIdText.text(encodeURIComponent($workspaceId));_init({apiname: $name || "API1",httpmethod: $method || "POST",bodytype: "none"});_load($workspaceId, $name, $method, _init);!$shown && _modal.modal("show")}
_modal.off("show.bs.modal").on("show.bs.modal", _reset);_modal.off("hide.bs.modal").on("hide.bs.modal", _reset);_modal.off("shown.bs.modal").on("shown.bs.modal", function () {!!_bodyContentEditor && _bodyContentEditor.refresh();!!_responseContentEditor && _responseContentEditor.refresh()});_executeBtn.off("click").on("click", _execute);_nav.find("li>a").off("click").on("click", _switchTab);return this});